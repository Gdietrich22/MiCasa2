[{"id":"50119c6e.6ff584","type":"tab","label":"Temperaturas","disabled":false,"info":""},{"id":"e6e33852.2495f8","type":"tab","label":"Medidor internet","disabled":true,"info":""},{"id":"3ce5b54a.127d6a","type":"tab","label":"Baterias/Alarma","disabled":false,"info":""},{"id":"73083520.75304c","type":"tab","label":"Lavadero","disabled":false,"info":""},{"id":"1b403a13.0ec8c6","type":"tab","label":"Termo Solar","disabled":false,"info":""},{"id":"950c1426.ff4008","type":"tab","label":"Baño","disabled":false,"info":""},{"id":"9c63fd61.9908c","type":"tab","label":"Config Genericas","disabled":false,"info":""},{"id":"a89e305a.c50bb","type":"tab","label":"Iluminacion Living","disabled":false,"info":""},{"id":"d1d22de5.be7d8","type":"tab","label":"backEstados","disabled":false,"info":""},{"id":"e364a467.07a6a8","type":"tab","label":"Dolar","disabled":false,"info":""},{"id":"f682d492.22a758","type":"tab","label":"BackUp","disabled":false,"info":""},{"id":"7ac92c99.66ea94","type":"tab","label":"Google Now","disabled":false,"info":""},{"id":"65561250.4225fc","type":"tab","label":"Salamandra","disabled":false,"info":""},{"id":"deff4396.4722a","type":"tab","label":"Cortinas","disabled":false,"info":""},{"id":"230e7f04.aca52","type":"tab","label":"Pruebas","disabled":false,"info":""},{"id":"b86d561e.834378","type":"serial-port","z":"","serialport":"/dev/ttyUSB0","serialbaud":"9600","databits":"8","parity":"none","stopbits":"1","newline":"\\n","bin":"false","out":"char","addchar":false},{"id":"e779f8d6.7bc2c8","type":"mqtt-broker","z":"","name":"","broker":"127.0.0.1","port":"1883","clientid":"","usetls":false,"compatmode":true,"keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthPayload":"","closeTopic":"","closePayload":"","willTopic":"","willQos":"0","willPayload":""},{"id":"c339edbf.39572","type":"mqtt-broker","z":"","name":"","broker":"127.0.0.1","port":"1883","clientid":"","usetls":false,"compatmode":true,"keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthPayload":"","closeTopic":"","closePayload":"","willTopic":"","willQos":"0","willPayload":""},{"id":"637ff0bd.3c84b","type":"mqtt-broker","z":"","name":"","broker":"127.0.0.1","port":"1883","clientid":"","usetls":false,"compatmode":true,"keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthPayload":"","closeTopic":"","closePayload":"","willTopic":"","willQos":"0","willPayload":""},{"id":"43555c62.30ed34","type":"mqtt-broker","z":"","name":"","broker":"127.0.0.1","port":"1883","clientid":"","usetls":false,"compatmode":true,"keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthPayload":"","closeTopic":"","closePayload":"","willTopic":"","willQos":"0","willPayload":""},{"id":"900627dc.76e6a8","type":"mqtt-broker","z":"","name":"","broker":"127.0.0.1","port":"1883","clientid":"","usetls":false,"compatmode":true,"keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthPayload":"","closeTopic":"","closePayload":"","willTopic":"","willQos":"0","willPayload":""},{"id":"6b36e4a.1d30b1c","type":"mqtt-broker","z":"","name":"","broker":"127.0.0.1","port":"1883","clientid":"","usetls":false,"compatmode":true,"keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthPayload":"","closeTopic":"","closePayload":"","willTopic":"","willQos":"0","willPayload":""},{"id":"3fe9d635.ec409a","type":"mqtt-broker","z":"","name":"","broker":"127.0.0.1","port":"1883","clientid":"","usetls":false,"compatmode":true,"keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthPayload":"","closeTopic":"","closePayload":"","willTopic":"","willQos":"0","willPayload":""},{"id":"af08803a.808f4","type":"mqtt-broker","z":"","name":"","broker":"127.0.0.1","port":"1883","clientid":"","usetls":false,"compatmode":true,"keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthPayload":"","closeTopic":"","closeQos":"0","closePayload":"","willTopic":"","willQos":"0","willPayload":""},{"id":"8e33ffbb.27076","type":"ui_base","z":0,"theme":{"name":"theme-light","lightTheme":{"default":"#0094CE","baseColor":"#0094CE","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":true,"reset":false},"darkTheme":{"default":"#097479","baseColor":"#097479","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":false},"customTheme":{"name":"Untitled Theme 1","default":"#4B7930","baseColor":"#4B7930","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"},"themeState":{"base-color":{"default":"#0094CE","value":"#0094CE","edited":false},"page-titlebar-backgroundColor":{"value":"#0094CE","edited":false},"page-backgroundColor":{"value":"#fafafa","edited":false},"page-sidebar-backgroundColor":{"value":"#ffffff","edited":false},"group-textColor":{"value":"#1bbfff","edited":false},"group-borderColor":{"value":"#ffffff","edited":false},"group-backgroundColor":{"value":"#ffffff","edited":false},"widget-textColor":{"value":"#111111","edited":false},"widget-backgroundColor":{"value":"#0094ce","edited":false},"widget-borderColor":{"value":"#ffffff","edited":false},"base-font":{"value":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"}},"angularTheme":{"primary":"indigo","accents":"blue","warn":"red","background":"grey"}},"site":{"name":"Node-RED Dashboard","hideToolbar":"false","allowSwipe":"false","allowTempTheme":"true","dateFormat":"DD/MM/YYYY","sizes":{"sx":48,"sy":48,"gx":6,"gy":6,"cx":6,"cy":6,"px":0,"py":0}}},{"id":"d1041da5.a5788","type":"ui_tab","z":0,"name":"Home","icon":"dashboard","order":2},{"id":"e73b3a0d.765918","type":"ui_tab","z":0,"name":"Principal","icon":"dashboard","order":1},{"id":"265ca5a8.8a0dca","type":"ui_tab","z":0,"name":"Pruebas","icon":"dashboard"},{"id":"ff2252ef.d12aa","type":"ui_group","z":0,"name":"Pruebas","tab":"265ca5a8.8a0dca","order":2,"disp":true,"width":"8","collapse":false},{"id":"177e0064.22348","type":"ui_group","z":0,"name":"Temperaturas Baterias","tab":"d1041da5.a5788","order":1,"disp":false,"width":"16","collapse":false},{"id":"6a6e2505.7b8a5c","type":"ui_group","z":0,"name":"Living","tab":"e73b3a0d.765918","order":1,"disp":true,"width":"5","collapse":false},{"id":"1c362bad.cfd2e4","type":"ui_group","z":"","name":"Lavadero","tab":"e73b3a0d.765918","order":3,"disp":true,"width":"5","collapse":false},{"id":"1134b585.4c9e0a","type":"ui_group","z":0,"name":"Datos Baterias","tab":"e73b3a0d.765918","order":4,"disp":true,"width":"8","collapse":false},{"id":"1a0f799.46f9186","type":"ui_group","z":0,"name":"Baño","tab":"e73b3a0d.765918","order":2,"disp":true,"width":"5","collapse":false},{"id":"ff8a613f.fd5b7","type":"ui_group","z":0,"name":"Cortinas","tab":"265ca5a8.8a0dca","order":1,"disp":true,"width":"8","collapse":false},{"id":"2c18e412.5f5cbc","type":"blynk-ws-client","z":"","name":"wss://127.0.0.1:9443/websockets","path":"wss://127.0.0.1:9443/websockets","key":"JzzBO11TLlU74YqVbuQauHRJKHBcjRSm","dbg_all":true,"dbg_read":false,"dbg_write":false,"dbg_notify":false,"dbg_mail":false,"dbg_prop":false,"dbg_sync":false,"dbg_bridge":false,"dbg_low":false,"dbg_pins":"","multi_cmd":false,"proxy_type":"no","proxy_url":"","enabled":true},{"id":"ee76ee3c.4da06","type":"blynk-ws-client","z":0,"name":"bomba anita","path":"wss://127.0.0.1:9443/websockets","key":"ebdf8457181f458b80b2ad88dc21fc07","dbg_all":false,"dbg_read":false,"dbg_write":false,"dbg_notify":false,"dbg_mail":false,"dbg_prop":false,"dbg_sync":false,"dbg_bridge":false,"dbg_low":false,"dbg_pins":"","multi_cmd":false,"proxy_type":"no","proxy_url":""},{"id":"57f54dcb.069894","type":"MySQLdatabase","z":"","host":"127.0.0.1","port":"3306","db":"casa","tz":"-3"},{"id":"4bb5fb58.83db84","type":"debug","z":"e6e33852.2495f8","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":580.7777404785156,"y":69,"wires":[]},{"id":"f0069ce0.a32ee","type":"exec","z":"e6e33852.2495f8","command":" speedtest --share --server 10748","addpay":false,"append":"","useSpawn":"true","timer":"","oldrc":true,"name":"Server FastNet","x":341.8888931274414,"y":126.77777767181396,"wires":[["40cbd7ce.d528d8","4bb5fb58.83db84"],[],[]]},{"id":"df0fdba0.2a4e58","type":"file","z":"e6e33852.2495f8","name":"","filename":"/home/gaston/BackUp-Node-Red/FastNet.txt","appendNewline":true,"createDir":true,"overwriteFile":"false","x":790,"y":110,"wires":[[]]},{"id":"9dc175d5.17a7e8","type":"file in","z":"e6e33852.2495f8","name":"lectura archivo","filename":"/home/gaston/BackUp-Node-Red/Fibertel.txt","format":"utf8","chunk":false,"sendError":false,"x":596.3333282470703,"y":527.8888940811157,"wires":[["cd0a799.4e81988"]]},{"id":"5a1b2f56.1eef7","type":"inject","z":"e6e33852.2495f8","name":"","topic":"","payload":"","payloadType":"date","repeat":"900","crontab":"","once":false,"onceDelay":0.1,"x":161.8888931274414,"y":121.22223472595215,"wires":[["f0069ce0.a32ee"]]},{"id":"94219c12.04844","type":"debug","z":"e6e33852.2495f8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":675.5555038452148,"y":326.88891220092773,"wires":[]},{"id":"257593f1.ccf32c","type":"inject","z":"e6e33852.2495f8","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":188.5555648803711,"y":375.6666717529297,"wires":[["8f7d1150.7be34"]]},{"id":"b8046fd8.4022b","type":"inject","z":"e6e33852.2495f8","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":161.33333587646484,"y":321.11111068725586,"wires":[["89e0166f.74bba8"]]},{"id":"80065b77.186188","type":"debug","z":"e6e33852.2495f8","name":"Fibertel","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":666.3333358764648,"y":294.55553817749023,"wires":[]},{"id":"6f1ac0c9.21d27","type":"debug","z":"e6e33852.2495f8","name":"FastNet","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":670.7777328491211,"y":150.11110591888428,"wires":[]},{"id":"c3f2f383.ad5a7","type":"debug","z":"e6e33852.2495f8","name":"FastNet","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":589.6666488647461,"y":474.55553817749023,"wires":[]},{"id":"89e0166f.74bba8","type":"exec","z":"e6e33852.2495f8","command":" speedtest --share --server 18725","addpay":false,"append":"","useSpawn":"true","timer":"","oldrc":true,"name":"Server Bahia (Fibertel)","x":430.7777633666992,"y":315.66665267944336,"wires":[["80065b77.186188","8f6bdb58.8e4158"],[],[]]},{"id":"40cbd7ce.d528d8","type":"function","z":"e6e33852.2495f8","name":"","func":"var payload = msg.payload;\nvar resultado;\n\nif(payload == \".\")payload = \"Realizando medicion\";\nnode.status({text: \"Estado actual: \" + msg.payload});\nif (payload.includes(\"Download\")){\n    global.set(\"DescargaFast\", parseFloat(payload.substring(payload.indexOf(\"Download: \")+10, payload.indexOf(\"Mbit/s\"))));\n    // msg = {topic: \"DescargaFast\", payload: context.descarga}; node.send([null, null, msg, null]);\n    // node.status({text: resultado});\n    }\n\nif (payload.includes(\"Upload\")){\n    global.set(\"SubidaFast\", parseFloat(payload.substring(payload.indexOf(\"Upload: \")+8, payload.indexOf(\"Mbit/s\"))));\n    // msg = {topic: \"SubidaFast\", payload: context.subida}; node.send([null, null, msg, null]);\n    // node.status({text: resultado});\n    }    \nif (payload.includes(\"Share results\")){\n    resultado = payload.substring(payload.indexOf(\"Share results\")+15);\n    node.status({text: resultado});\n    msg = {pin: 70, payload: context.descarga + \" -- \" + context.subida}; node.send([null, null, null, msg]);\n    msg.payload = global.get(\"fechaCompleta\") + \" -- \" + resultado; return msg;\n}\nif (payload.includes(\"error\") || payload.includes(\"Error\")){\n    msg.payload = global.get(\"fechaCompleta\") + \" -- \" + \"Falla de conexion\"; \n    node.send([msg, null]);\n    return ([null, msg])\n}\n","outputs":4,"noerr":0,"x":494.1111136542426,"y":204.55555513170032,"wires":[["6f1ac0c9.21d27","89e0166f.74bba8","df0fdba0.2a4e58"],["f0069ce0.a32ee"],[],[]]},{"id":"cd0a799.4e81988","type":"debug","z":"e6e33852.2495f8","name":"Fibertel","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":772.9999618530273,"y":533.4444236755371,"wires":[]},{"id":"88336c7c.fb758","type":"inject","z":"e6e33852.2495f8","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":133,"y":582.3333549499512,"wires":[["a5dff34f.89fa6","41de7b73.054844"]]},{"id":"d1094e09.0048f","type":"file","z":"e6e33852.2495f8","name":"","filename":"/home/gaston/BackUp-Node-Red/Fibertel.txt","appendNewline":true,"createDir":true,"overwriteFile":"false","x":758.5555038452148,"y":354.55553817749023,"wires":[[]]},{"id":"8f7d1150.7be34","type":"file in","z":"e6e33852.2495f8","name":"lectura archivo","filename":"/home/gaston/BackUp-Node-Red/FastNet.txt","format":"utf8","chunk":false,"sendError":false,"x":391.88888931274414,"y":472.33331298828125,"wires":[["9dc175d5.17a7e8","c3f2f383.ad5a7"]]},{"id":"a5dff34f.89fa6","type":"file","z":"e6e33852.2495f8","name":"borrar archivo","filename":"/home/gaston/BackUp-Node-Red/FastNet.txt","appendNewline":true,"createDir":false,"overwriteFile":"delete","x":359.66665267944336,"y":560.111123085022,"wires":[[]]},{"id":"8f6bdb58.8e4158","type":"function","z":"e6e33852.2495f8","name":"","func":"var payload = msg.payload;\nvar resultado;\ncontext.descarga = context.descarga || 0;\ncontext.subida = context.subida || 0;\n\nif(payload == \".\")payload = \"Realizando medicion\";\nnode.status({text: \"Estado actual: \" + msg.payload});\nif (payload.includes(\"Download\")){\n    context.descarga = parseFloat(payload.substring(payload.indexOf(\"Download: \")+10, payload.indexOf(\"Mbit/s\")));\n    // msg = {topic: \"DescargaFast\", payload: context.descarga}; node.send([null, null, msg, null]);\n    // node.status({text: resultado});\n    }\n\nif (payload.includes(\"Upload\")){\n    context.subida = parseFloat(payload.substring(payload.indexOf(\"Upload: \")+8, payload.indexOf(\"Mbit/s\")));\n    // msg = {topic: \"SubidaFast\", payload: context.subida}; node.send([null, null, msg, null]);\n    // node.status({text: resultado});\n    }    \nif (payload.includes(\"Share results\")){\n    resultado = payload.substring(payload.indexOf(\"Share results\")+15);\n    node.status({text: resultado});\n    msg = {pin: 70, payload: global.get(\"DescargaFast\") + \" -- \" + global.get(\"SubidaFast\")}; node.send([null, null, null, msg]);\n    msg = {pin: 71, payload: context.descarga + \" -- \" + context.subida}; node.send([null, null, null, msg]);\n    msg = {pin: 72, payload: global.get(\"DescargaFast\")}; node.send([null, null, null, msg]);\n    msg = {pin: 73, payload: global.get(\"SubidaFast\")}; node.send([null, null, null, msg]);\n    msg = {pin: 74, payload: context.descarga}; node.send([null, null, null, msg]);\n    msg = {pin: 75, payload: context.subida}; node.send([null, null, null, msg]);\n    msg = {topic: \"DescargaFast\", payload: global.get(\"DescargaFast\")}; node.send([null, null, msg, null]);\n    msg = {topic: \"SubidaFast\", payload: global.get(\"SubidaFast\")}; node.send([null, null, msg, null]);\n    msg = {topic: \"DescargaFiber\", payload: context.descarga}; node.send([null, null, msg, null]);\n    msg = {topic: \"SubidaFiber\", payload: context.subida}; node.send([null, null, msg, null]);\n    msg.payload = global.get(\"fechaCompleta\") + \" -- \" + resultado; return msg;\n}\nif (payload.includes(\"error\") || payload.includes(\"Error\")){\n    msg.payload = global.get(\"fechaCompleta\") + \" -- \" + \"Falla de conexion\"; \n    node.send([msg, null]);\n    return ([null, msg])\n}// return msg;","outputs":4,"noerr":0,"x":497.44441986083984,"y":383.4444236755371,"wires":[["d1094e09.0048f","94219c12.04844"],["89e0166f.74bba8"],["6e949be8.c70644"],["cfe8aa20.5a0e18","ba239006.7d4a6"]]},{"id":"ba239006.7d4a6","type":"debug","z":"e6e33852.2495f8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":680.2222518920898,"y":425.11111068725586,"wires":[]},{"id":"16b67857.ba97a8","type":"function","z":"e6e33852.2495f8","name":"","func":"if (msg.payload == \"1\")return msg;","outputs":1,"noerr":0,"x":323.0000025431316,"y":193.44444402058923,"wires":[["f0069ce0.a32ee"]]},{"id":"41de7b73.054844","type":"file","z":"e6e33852.2495f8","name":"borrar archivo","filename":"/home/gaston/BackUp-Node-Red/Fibertel.txt","appendNewline":true,"createDir":false,"overwriteFile":"delete","x":359.6666717529297,"y":597.888861656189,"wires":[[]]},{"id":"411b27cf.122ad8","type":"function","z":"230e7f04.aca52","name":"","func":"msg = {topic: \"ESP/Bano/Recibo\", payload: \"D\" + parseInt(msg.topic) + msg.payload};\nreturn msg\n","outputs":1,"noerr":0,"x":410,"y":220,"wires":[["20706a8e.08ded6"]]},{"id":"20706a8e.08ded6","type":"mqtt out","z":"230e7f04.aca52","name":"","topic":"","qos":"","retain":"","broker":"e779f8d6.7bc2c8","x":570,"y":220,"wires":[]},{"id":"737f249a.6f982c","type":"mqtt in","z":"230e7f04.aca52","name":"","topic":"ESP/Bano/Debug","qos":"2","broker":"e779f8d6.7bc2c8","x":410,"y":300,"wires":[["f1992d54.9e6b6"]]},{"id":"e9e852e6.2ee3f","type":"mqtt in","z":"230e7f04.aca52","name":"","topic":"ESP/Bano/Inicio","qos":"2","broker":"e779f8d6.7bc2c8","x":430,"y":380,"wires":[["f1992d54.9e6b6"]]},{"id":"d45c90b5.820a2","type":"debug","z":"230e7f04.aca52","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":670,"y":30,"wires":[]},{"id":"718a8d11.6f6294","type":"mqtt in","z":"230e7f04.aca52","name":"","topic":"ESP/Bano/Recibo","qos":"2","broker":"e779f8d6.7bc2c8","x":480,"y":40,"wires":[["d45c90b5.820a2"]]},{"id":"c4d6adc9.7d5d7","type":"function","z":"e364a467.07a6a8","name":"","func":"msg.payload = msg.payload.replace(\",\", \".\");\nglobal.set(\"MaximoVender\", parseFloat(msg.payload).toFixed(2));\nnode.status({text: \"MaximoVender:\" + global.get(\"MaximoVender\")});\nreturn msg;","outputs":1,"noerr":0,"x":460,"y":160,"wires":[[]]},{"id":"b9c8c2ba.5fe5c","type":"function","z":"e364a467.07a6a8","name":"","func":"msg.payload = msg.payload.replace(\",\", \".\");\nglobal.set(\"MinimoVender\", parseFloat(msg.payload).toFixed(2));\nnode.status({text: \"MinimoVender:\" + global.get(\"MinimoVender\")});\nreturn msg;","outputs":1,"noerr":0,"x":459.9999694824219,"y":110.00000095367432,"wires":[[]]},{"id":"57eb3056.92d7d","type":"function","z":"e364a467.07a6a8","name":"Patagonia","func":"var dolarCompra;\nvar dolarVenta;\nvar payload = msg.payload;\nvar compra;\nvar venta;\n\npayload = payload.substring(payload.indexOf(\"nbsp\")+5); compra = payload.substring(0, payload.indexOf(\"</td>\"));\npayload = payload.substring(payload.indexOf(\"nbsp\")+5); venta = payload.substring(0, payload.indexOf(\"</td>\"));\n\ncompra = compra.replace(\",\", \".\");\nventa = venta.replace(\",\", \".\");\n\ncompra = parseFloat(compra).toFixed(2);\nventa = parseFloat(venta).toFixed(2);\n\nmsg = {pin:65, payload: \"$ \"+compra + \"  --  \" + \"$ \" + venta};\nreturn msg","outputs":1,"noerr":0,"x":374.1666717529297,"y":466.1111316680908,"wires":[["21fc9b0b.e0f5b4","9f8c863a.5e4538"]]},{"id":"5d42fd8.e980404","type":"function","z":"e364a467.07a6a8","name":"Dolar","func":"var dolarCompra;\nvar dolarVenta;\nvar payload = msg.payload;\nvar compra;\nvar venta;\ncontext.minimo = context.minimo || 0;\ncontext.maximo = context.maximo || 0;\ncontext.minimoVender = context.minimoVender || 0;\ncontext.maximoVender = context.maximoVender || 0;\ncontext.comprarDolares = context.comprarDolares || 0;\nvar date = new Date();\nvar frecuencia = 15;\nvar dia = date.getDay();\nvar hh = date.getHours();\nvar mm = date.getMinutes();\nvar ss = date.getSeconds();\nif (hh===0 && mm===0 && ss===0){\n    context.minimo = 100;\n    context.maximo = 0;\n    context.inicio = 0;\n}\n\npayload = payload.substring(payload.indexOf(\"$\")+2); compra = payload.substring(0, payload.indexOf(\"</t\"));\npayload = payload.substring(payload.indexOf(\"<td>$\")+5); venta = payload.substring(0, payload.indexOf(\"</t\"));\n\nif (parseFloat(compra) === 0 || compra === undefined) return;\nif (parseFloat(venta) === 0 || venta === undefined) return;\n\ncompra = compra.replace(\",\", \".\");\nventa = venta.replace(\",\", \".\");\n\ncompra = parseFloat(compra).toFixed(2);\nventa = parseFloat(venta).toFixed(2);\n\nglobal.set(\"DolarOff\", compra);\n\nmsg = {pin: 55, payload: \"$ \"+compra + \"  --  \" + \"$ \" + venta}; node.send([null, null, null, msg]);\n// msg = {pin: 53, payload: compra}; node.send([null, null, null, msg]);\n// msg = {pin: 54, payload: venta}; node.send([null, null, null, msg]);\n\n\nmsg = {topic: \"DolarVenta\", payload: venta}; node.send([msg, null, null, null]);\nmsg = {topic: \"DolarCompra\", payload: compra}; node.send([msg, null, null, null]);\n\nif (parseFloat(global.get(\"MinimoVender\")) > parseFloat(compra) && parseFloat(context.minimoVender) != parseFloat(compra)){\n\tcontext.minimoVender = compra;\n    var datos = \"Dolar muy bajo opcion a Vender, valor: \" + compra;//Dolar Bajo opcion a Comprar, valor: \n    msg = {payload: datos}; node.send([null, msg, null, null]);\n    msg = {topic: \"notifyBlynk\", payload: datos}; node.send([null, null, msg, null]);\t\n} \n\nif (parseFloat(global.get(\"MaximoVender\")) < parseFloat(compra) && parseFloat(context.maximoVender) != parseFloat(compra)){    //diferenciaCompraVenta\n    context.maximoVender = compra;\n    var datos = \"Dolar Alto opcion a Vender, valor: \" + compra;//Dolar Bajo opcion a Comprar, valor: \n    msg = {payload: datos}; node.send([null, msg, null, null]);\n    msg = {topic: \"notifyBlynk\", payload: datos}; node.send([null, null, msg, null]);\n}\n// if (hh > 9 && hh < 17 && parseFloat(dato.libre) < parseFloat(context.maximo)){\n// if (parseFloat(global.get(\"compreA\")) + parseFloat(global.get(\"diferenciaCompraVenta\") < parseFloat(compra)){    // compre a 39.04\nif (parseFloat(global.get(\"MinimoComprar\")) > parseFloat(venta) && parseFloat(context.comprarDolares) != parseFloat(venta)){    // compre a 39.04    \n    context.comprarDolares = venta;\n    var datos = \"Dolar Bajo opcion a Comprar, valor: \" + venta;\n    msg = {payload: datos}; node.send([null, msg, null, null]);\n    msg = {topic: \"notifyBlynk\", payload: datos}; node.send([null, null, msg, null]);\n}\n","outputs":4,"noerr":0,"x":566.8689880371094,"y":302.8452727198601,"wires":[["a1a99fe7.8ba95","c73e087.839dbf8"],["a3758cc8.3858d","5017e9e.15ea618"],["6dfbb0bb.311c","a28eb446.155258"],["2d7d44ee.9b478c","852f0223.43017"]]},{"id":"a1a99fe7.8ba95","type":"debug","z":"e364a467.07a6a8","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":734.0117874145508,"y":289.98811119794846,"wires":[]},{"id":"21fc9b0b.e0f5b4","type":"debug","z":"e364a467.07a6a8","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":522.2222442626953,"y":481.3888568878174,"wires":[]},{"id":"a28eb446.155258","type":"debug","z":"e364a467.07a6a8","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":822.2500076293945,"y":179.75,"wires":[]},{"id":"52e152e0.741aac","type":"http request","z":"e364a467.07a6a8","name":"","method":"GET","ret":"txt","url":"https://blockchain.info/es/ticker","tls":"","x":449.9166450500488,"y":406.17859333753586,"wires":[["38255feb.59b5f"]]},{"id":"38255feb.59b5f","type":"function","z":"e364a467.07a6a8","name":"BTC","func":"var dato = JSON.parse(msg.payload);\n// dato = JSON.parse(dato);\n\nmsg = dato.USD;\nvar datos = msg.buy;\nmsg = {topic: \"BitCoinUSD\", payload: parseFloat(datos)};\nnode.send(msg);\ndatos = datos * global.get(\"DolarOff\");\nmsg = {topic: \"BitCoinPesos\", payload: parseFloat(datos)};\nreturn msg;\n","outputs":1,"noerr":0,"x":586.9166450500488,"y":406.17859333753586,"wires":[["c73e087.839dbf8"]]},{"id":"61476039.17e6e","type":"delay","z":"e364a467.07a6a8","name":"","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":300.9166450500488,"y":403.17859333753586,"wires":[["52e152e0.741aac"]]},{"id":"f018ada8.127b","type":"debug","z":"e364a467.07a6a8","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":414.44443702697754,"y":530.4166431427002,"wires":[]},{"id":"6dfbb0bb.311c","type":"mqtt out","z":"e364a467.07a6a8","name":"","topic":"","qos":"","retain":"","broker":"637ff0bd.3c84b","x":762.4166412353516,"y":407.4285955429077,"wires":[]},{"id":"f9da74a9.205d88","type":"inject","z":"e364a467.07a6a8","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":123.27382278442383,"y":537.0833387374878,"wires":[["d0d49344.b5b8e"]]},{"id":"d0d49344.b5b8e","type":"http request","z":"e364a467.07a6a8","name":"","method":"GET","ret":"txt","url":"https://ebankpersonas.bancopatagonia.com.ar/eBanking/usuarios/cotizacionMonedaExtranjera.htm","tls":"","x":201.6666717529297,"y":475.83330059051514,"wires":[["57eb3056.92d7d","f018ada8.127b"]]},{"id":"ba05388f.9f1eb8","type":"debug","z":"e364a467.07a6a8","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":633.8690414428711,"y":200.4166914820671,"wires":[]},{"id":"2db45f76.6b1ca","type":"inject","z":"e364a467.07a6a8","name":"","topic":"prueba","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":215.66665267944336,"y":334.1785936355591,"wires":[["373edcf3.9708a4"]]},{"id":"ed2c54f5.4dc558","type":"inject","z":"e364a467.07a6a8","name":"","topic":"","payload":"","payloadType":"date","repeat":"1","crontab":"","once":false,"onceDelay":0.1,"x":131.8451919555664,"y":278.45241355895996,"wires":[["a0fa2226.36519"]]},{"id":"a3758cc8.3858d","type":"debug","z":"e364a467.07a6a8","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":774.9166450500488,"y":364.17859333753586,"wires":[]},{"id":"373edcf3.9708a4","type":"http request","z":"e364a467.07a6a8","name":"","method":"GET","ret":"txt","url":"https://banco.santanderrio.com.ar/exec/cotizacion/index.jsp","tls":"","x":424.0118713378906,"y":281.4166962504387,"wires":[["ba05388f.9f1eb8","5d42fd8.e980404","61476039.17e6e","d0d49344.b5b8e"]]},{"id":"852f0223.43017","type":"debug","z":"e364a467.07a6a8","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":764.7500076293945,"y":464.75,"wires":[]},{"id":"a0fa2226.36519","type":"function","z":"e364a467.07a6a8","name":"root","func":"var date = new Date();\nvar frecuencia = 5;\nvar dia = date.getDay();\nvar hh = date.getHours();\nvar mm = date.getMinutes();\nvar ss = date.getSeconds();\nvar tiempo = mm % frecuencia;\nnode.status({text: hh + \":\" + mm + \":\" + ss + \" - \" + tiempo + \" - \" + dia});\nif (dia !== 0 && dia !== 6 && ss === 0 && tiempo === 0){\n\tif (hh > 9 && hh < 18) return msg;\n} \n// if (ss === 0 && tiempo === 0) return msg;\n//){//hh > 9 && hh < 17 && \n //   if (ss === 0 && tiempo === 0) return msg;\n    // if (ss === 0 && tiempo === 0) return msg;\n// }","outputs":1,"noerr":0,"x":270.4166374206543,"y":278.9285936355591,"wires":[["373edcf3.9708a4"]]},{"id":"23a53a0d.bc6c56","type":"function","z":"e364a467.07a6a8","name":"","func":"msg.payload = msg.payload.replace(\",\", \".\");\nglobal.set(\"MinimoComprar\", parseFloat(msg.payload).toFixed(2));\nnode.status({text: \"MinimoComprar:\" + global.get(\"MinimoComprar\")});\nreturn msg;","outputs":1,"noerr":0,"x":449.47220611572266,"y":54.50000190734863,"wires":[[]]},{"id":"ebfe9ed0.66ac1","type":"inject","z":"e364a467.07a6a8","name":"","topic":"","payload":"prueba dolar","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":578.2222442626953,"y":365.75000190734863,"wires":[["5017e9e.15ea618"]]},{"id":"5017e9e.15ea618","type":"link out","z":"e364a467.07a6a8","name":"mailDolar","links":["294182fd.ac6bbe"],"x":733.2222442626953,"y":325.75000190734863,"wires":[]},{"id":"781635c9.10ab8c","type":"mqtt out","z":"50119c6e.6ff584","name":"","topic":"","qos":"2","retain":"","broker":"e779f8d6.7bc2c8","x":460,"y":120,"wires":[]},{"id":"3120e963.272b56","type":"function","z":"50119c6e.6ff584","name":"tempPatioLuz","func":"var temp = parseFloat(msg.payload);// + 0;\nif (isNaN(temp))temp = -1;\nif (parseFloat(msg.payload) !== 0){global.set(\"tempPatioLuz\", temp.toFixed(1));\n    msg= {topic: \"tempPatioLuz\", payload: global.get(\"tempPatioLuz\")}; node.send(msg);\n    node.status({text: \"temp: \" + global.get(\"tempPatioLuz\") + \" -- \" + global.get(\"hsCpu\")});\n}","outputs":1,"noerr":0,"x":440,"y":340,"wires":[["1f5e6cad.b1cab3"]]},{"id":"7965054.c9eeefc","type":"debug","z":"50119c6e.6ff584","name":"respuesta","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":673,"y":131,"wires":[]},{"id":"155cca1c.149836","type":"mqtt in","z":"50119c6e.6ff584","name":"","topic":"ESP/PatioLuz/Sens/Temp/Resp","qos":"2","broker":"e779f8d6.7bc2c8","x":190,"y":340,"wires":[["3120e963.272b56"]]},{"id":"29d8f876.fafdb8","type":"inject","z":"50119c6e.6ff584","name":"","topic":"tomarMedicion","payload":"1","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":154.28571891784668,"y":86.19046211242676,"wires":[["d1bdce06.cc5f9","3cbba0f1.1702a"]]},{"id":"eb7a6bb0.1114a8","type":"function","z":"50119c6e.6ff584","name":"tempLavadero","func":"var temp = parseFloat(msg.payload);// + 1.6;\nif (parseFloat(msg.payload) !== 0){global.set(\"tempLavadero\", temp.toFixed(1));\nmsg= {topic: \"tempLavadero\", payload: global.get(\"tempLavadero\")}; node.send(msg);\nnode.status({text: \"temp: \" + global.get(\"tempLavadero\") + \" -- \" + global.get(\"hsCpu\")});\n}","outputs":1,"noerr":0,"x":400,"y":280,"wires":[["1f5e6cad.b1cab3","25e92b87.f7d434"]]},{"id":"4b87f8d.3061f08","type":"inject","z":"50119c6e.6ff584","name":"","topic":"","payload":"","payloadType":"date","repeat":"1","crontab":"","once":true,"onceDelay":"0.1","x":164.2857265472412,"y":122.85712432861322,"wires":[["d1bdce06.cc5f9"]]},{"id":"d1bdce06.cc5f9","type":"function","z":"50119c6e.6ff584","name":"","func":"var date = new Date();\nvar mm = date.getMinutes();\nvar ss = date.getSeconds();\nvar tiempo = mm%5;\nnode.status({text: global.get(\"hsCpu\")});\nif (tiempo === 0 && ss === 1 || msg.topic == \"tomarMedicion\"){\n    // msg = {topic: \"USBout\", payload: \"{\\\"topic\\\":\\\"tempExt\\\",\\\"payload\\\":1}\"}; node.send(msg);\n    msg = {topic: \"ESP/Lavadero/Recibo\", payload: \"pedidoTemp\"}; node.send(msg);\n    msg = {topic: \"ESP/Pasillo/Sens/Temp/Pedido\", payload: 1}; node.send(msg);\n    msg = {topic: \"ESP/Living/Sens/Temp/Pedido\", payload: 1}; node.send(msg);\n    msg = {topic: \"ESP/TermoSolar/Recibo\", payload: 1}; node.send(msg);\n\n    // if (parseInt(global.get(\"estadoCargador\")) === 0){\n        msg = {topic: \"USBout\", payload: \"{\\\"topic\\\":\\\"Baterias/Est/Pedido\\\",\\\"payload\\\":1}\"}; node.send(msg);\n    // }\n     if (parseInt(global.get(\"llenarTanque\")) === 0){msg = {topic: \"ESP/TanqueAgua/Recibo\", payload: 1}; node.send(msg);}\n}\n","outputs":1,"noerr":0,"x":312.142915725708,"y":105.71426486968988,"wires":[["781635c9.10ab8c","2aca495.744cab6"]]},{"id":"bd212d32.d2ec8","type":"function","z":"50119c6e.6ff584","name":"tempLiving","func":"var dato = JSON.parse(msg.payload);\nvar temp = parseFloat(JSON.parse(dato.temp) + 3.0);// + 3.6;\nvar hum = parseFloat(JSON.parse(dato.hum)).toFixed(1);\n\nif (parseFloat(temp) !== 0){\n    global.set(\"tempLiving\", temp.toFixed(1));\n    global.set(\"humLiving\", hum);\n    msg= {topic: \"tempLiving\", payload: global.get(\"tempLiving\")}; node.send(msg);\n    msg= {topic: \"tempLiving\", payload: global.get(\"tempLiving\")}; node.send(null, msg);\n    msg= {topic: \"humLiving\", payload: hum}; node.send(msg);\n    msg = {payload: global.get(\"tempLiving\")}; node.send([null,msg]);\n    node.status({text: \"temp: \" + global.get(\"tempLiving\") + \" hum:\" + hum + \" -- \" + global.get(\"hsCpu\")});\n}","outputs":2,"noerr":0,"x":440,"y":390,"wires":[["1f5e6cad.b1cab3"],["7aaed2d0.0da38c"]]},{"id":"2aca495.744cab6","type":"debug","z":"50119c6e.6ff584","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":460,"y":80,"wires":[]},{"id":"4de71176.ac571","type":"comment","z":"50119c6e.6ff584","name":"Blynk privado (Prueba)","info":"wss://192.168.6.40:9443/websockets\n5e076af9bf8d46abb21c1e29066899b7","x":700,"y":80,"wires":[]},{"id":"e84a1d80.15bd5","type":"function","z":"50119c6e.6ff584","name":"tempExterior","func":"if (global.get(\"tempMaxExtValor\") === undefined)global.set(\"tempMaxExtValor\", -255);\nif (global.get(\"tempMinExtValor\") === undefined)global.set(\"tempMinExtValor\", 255);\nif (global.get(\"tempMaxExtAnt\") === undefined)global.set(\"tempMaxExtAnt\", -255);\nif (global.get(\"tempMinExtAnt\") === undefined)global.set(\"tempMinExtAnt\", 255);\nvar temp;\nvar date = new Date();\nvar dia = date.getDate();\ncontext.temp = context.temp || 0;//hola\ncontext.diaAnt = context.diaAnt || dia - 1;\n\n\nif (context.diaAnt !== dia){\ncontext.diaAnt = dia;\n\tglobal.set(\"tempMaxExtAnt\", global.get(\"tempMaxExt\"));\n\tglobal.set(\"tempMinExtAnt\", global.get(\"tempMinExt\"));\n\tglobal.set(\"tempMinExtValor\", 255);\n\tglobal.set(\"tempMaxExtValor\", -255);\n}\n\n// msg.payload = global.get(\"tempExterior\"); node.send(msg);\n\nvar tempExterior = parseFloat(global.get(\"tempExterior\"));\nvar tempmax = parseFloat(global.get(\"tempMaxExtValor\"));\nvar tempmin = parseFloat(global.get(\"tempMinExtValor\"));\n\n\nif (parseFloat(tempExterior) > parseFloat(tempmax)){\n\tglobal.set(\"tempMaxExt\", parseFloat(tempExterior).toFixed(1) + \" (\" + global.get(\"hsCpu\") + \")\");\n\tglobal.set(\"tempMaxExtValor\", global.get(\"tempExterior\"));\n}\nif (parseFloat(tempExterior) < parseFloat(tempmin)){\n\tglobal.set(\"tempMinExt\", parseFloat(tempExterior).toFixed(1) + \" (\" + global.get(\"hsCpu\") + \")\");\n\tglobal.set(\"tempMinExtValor\", global.get(\"tempExterior\"));\n}\n\nnode.status({text: \"temp: \" + parseFloat(tempExterior).toFixed(1) + \" -- \" + global.get(\"hsCpu\")});\t\nmsg = {topic: \"tempExterior\", payload: parseFloat(tempExterior).toFixed(1)}; \t\nreturn msg;\n\n","outputs":1,"noerr":0,"x":430,"y":220,"wires":[["1f5e6cad.b1cab3","7965054.c9eeefc"]]},{"id":"e0462fa7.e52fe","type":"mqtt in","z":"50119c6e.6ff584","name":"tempExterior","topic":"ESP/TermoSolar/Envio","qos":"2","broker":"e779f8d6.7bc2c8","x":140,"y":240,"wires":[["8d5ce4ce.a2a8c8"]]},{"id":"1d3d722b.454c1e","type":"function","z":"50119c6e.6ff584","name":"tempPasillo","func":"var temp = parseFloat(msg.payload);// + (-1.5);\nif (parseFloat(msg.payload) !== 0){global.set(\"tempPasillo\", temp.toFixed(1));\n    msg= {topic: \"tempPasillo\", payload: global.get(\"tempPasillo\")}; node.send(msg);\n    node.status({text: \"temp: \" + global.get(\"tempPasillo\") + \" -- \" + global.get(\"hsCpu\")});\n}","outputs":1,"noerr":0,"x":440,"y":440,"wires":[["1f5e6cad.b1cab3"]]},{"id":"48c77f6c.2ff13","type":"mqtt in","z":"50119c6e.6ff584","name":"","topic":"ESP/Pasillo/Sens/Temp/Resp","qos":"2","broker":"e779f8d6.7bc2c8","x":200,"y":440,"wires":[["1d3d722b.454c1e"]]},{"id":"c9964422.ac71b8","type":"mqtt in","z":"50119c6e.6ff584","name":"","topic":"ESP/Living/Sens/Temp/Resp","qos":"2","broker":"e779f8d6.7bc2c8","x":200,"y":390,"wires":[["bd212d32.d2ec8"]]},{"id":"8d5ce4ce.a2a8c8","type":"delay","z":"50119c6e.6ff584","name":"50","pauseType":"delay","timeout":"200","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":290,"y":220,"wires":[["e84a1d80.15bd5"]]},{"id":"79b1727b.7e302c","type":"inject","z":"50119c6e.6ff584","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":140,"y":200,"wires":[["8d5ce4ce.a2a8c8"]]},{"id":"6d18b788.0a1948","type":"mqtt in","z":"50119c6e.6ff584","name":"","topic":"ESP/Lavadero/Temperatura","qos":"2","broker":"c339edbf.39572","x":150,"y":290,"wires":[["eb7a6bb0.1114a8"]]},{"id":"e1bb7fde.4d99f","type":"inject","z":"3ce5b54a.127d6a","name":"Info","topic":"","payload":"{\"topic\":\"Baterias/Est/Pedido\",\"payload\":1}","payloadType":"str","repeat":"","crontab":"","once":true,"onceDelay":"2","x":340,"y":720,"wires":[["35c86102.3c4c2e","1e430824.b490a8"]]},{"id":"3b47184b.08c028","type":"function","z":"3ce5b54a.127d6a","name":"","func":"msg = {topic: \"tempBat1\", payload: global.get(\"tempBat1\")}; node.send(msg);\n","outputs":1,"noerr":0,"x":2623.5951919555664,"y":255.4523634229388,"wires":[["f172b930.5a1238"]]},{"id":"3743b9dc.4822b6","type":"inject","z":"3ce5b54a.127d6a","name":"","topic":"","payload":"[]","payloadType":"json","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":2620.3808822631836,"y":141.16667338779996,"wires":[["c886ed5f.c4e19"]]},{"id":"c4484790.d577c8","type":"mqtt in","z":"3ce5b54a.127d6a","name":"","topic":"resetAutos","qos":"2","broker":"c339edbf.39572","x":1490,"y":280,"wires":[[]]},{"id":"76adfb47.e0f244","type":"function","z":"3ce5b54a.127d6a","name":"","func":"msg = {topic: \"Blynk/mostrar/infos\", payload: msg.payload};\nreturn msg;","outputs":1,"noerr":0,"x":1570,"y":630,"wires":[["445cd48b.3633cc","ac76f2be.6c98a"]]},{"id":"d88558e1.84a5b8","type":"delay","z":"3ce5b54a.127d6a","name":"","pauseType":"delay","timeout":"10","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1874.3800048828125,"y":969.5000540869577,"wires":[["74700a6b.b7b424"]]},{"id":"3e7ffb21.6f9f44","type":"inject","z":"3ce5b54a.127d6a","name":"","topic":"","payload":"3","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1368.5717124938965,"y":641.4286403656006,"wires":[["76adfb47.e0f244"]]},{"id":"79f2193e.97a0f8","type":"mqtt in","z":"3ce5b54a.127d6a","name":"","topic":"USBin/Baterias","qos":"2","broker":"c339edbf.39572","x":309.8810577392578,"y":283.8095147269113,"wires":[["95935531.f40c18","2903e624.47c22a"]]},{"id":"7c2d61c4.d857a","type":"inject","z":"3ce5b54a.127d6a","name":"","topic":"","payload":"1","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1781.1667823791504,"y":528.5238674027579,"wires":[["5364362d.fcfe48"]]},{"id":"cf18dea9.b1f6d","type":"debug","z":"3ce5b54a.127d6a","name":"salida2 lcd blynk","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":1931.3927841186523,"y":755.9643287658691,"wires":[]},{"id":"8ab8978.3433d68","type":"inject","z":"3ce5b54a.127d6a","name":"","topic":"","payload":"0","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1350.5236053466797,"y":417.14293003082275,"wires":[["6528d108.e3a9c"]]},{"id":"8a88e4e8.06aa68","type":"mqtt in","z":"3ce5b54a.127d6a","name":"","topic":"USBin","qos":"2","broker":"c339edbf.39572","x":600,"y":550,"wires":[["2ada1853.b0f5c8","d1b1c079.3077f","5af90f29.39a76"]]},{"id":"9dc76856.62acb8","type":"inject","z":"3ce5b54a.127d6a","name":"","topic":"","payload":"1","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1364.2859573364258,"y":574.2858028411865,"wires":[["76adfb47.e0f244"]]},{"id":"f07145ce.8d14a8","type":"e-mail","z":"3ce5b54a.127d6a","server":"smtp.mail.yahoo.com","port":"465","secure":true,"name":"gdietrich22@yahoo.com.ar","dname":"gd28722563","x":780,"y":320,"wires":[]},{"id":"5364362d.fcfe48","type":"mqtt out","z":"3ce5b54a.127d6a","name":"","topic":"pedidoActualizacion","qos":"","retain":"","broker":"c339edbf.39572","x":1937.1430206298828,"y":580.0000352859497,"wires":[]},{"id":"f20c8fe3.a0061","type":"function","z":"3ce5b54a.127d6a","name":"","func":"msg = {topic: \"tempExterior\", payload: global.get(\"tempExterior\")}; node.send(msg);\nmsg = {topic: \"tempPatioLuz\", payload: global.get(\"tempPatioLuz\")}; node.send(msg);\nmsg = {topic: \"tempLiving\", payload: global.get(\"tempLiving\")}; node.send(msg);\nmsg = {topic: \"tempPasillo\", payload: global.get(\"tempPasillo\")}; node.send(msg);\nmsg = {topic: \"tempLavadero\", payload: global.get(\"tempLavadero\")}; node.send(msg);\nmsg = {topic: \"tempBat6\", payload: global.get(\"tempBat6\")}; node.send(msg);\nmsg = {topic: \"tempAmbiente\", payload: global.get(\"tempAmbienteBat\")}; node.send(msg);\nmsg = {topic: \"voltajeBaterias\", payload: global.get(\"voltajeBaterias\")}; node.send(msg);\nmsg = {topic: \"voltajeBaterias\", payload: global.get(\"voltajeBaterias\")}; node.send(msg);\nmsg = {topic: \"tempCPU\", payload: global.get(\"tempCPU\")}; node.send(msg);\nreturn;","outputs":1,"noerr":0,"x":2619.309543609619,"y":215.45234816414973,"wires":[["c886ed5f.c4e19"]]},{"id":"31ff5121.fd716e","type":"inject","z":"3ce5b54a.127d6a","name":"","topic":"","payload":"{\"topic\":\"most\",\"payload\":\"0\"}","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":300,"y":590,"wires":[["d5de6169.53ddd"]]},{"id":"339629e1.979776","type":"debug","z":"3ce5b54a.127d6a","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1555.4205669826933,"y":678.7540316051907,"wires":[]},{"id":"f786c1b.12b354","type":"function","z":"3ce5b54a.127d6a","name":"","func":"msg = {topic: \"Corriente Carga\", payload: global.get(\"corrienteCarga\")}; node.send(msg);\n","outputs":1,"noerr":0,"x":2629.3095474243164,"y":342.59523364475797,"wires":[["a300fbef.9d5148"]]},{"id":"e2f3ed1d.878f1","type":"mqtt in","z":"3ce5b54a.127d6a","name":"","topic":"toldo/abrir","qos":"2","broker":"c339edbf.39572","x":1339.6188926696777,"y":341.9762897491455,"wires":[["6528d108.e3a9c"]]},{"id":"2c40d55b.eedb6a","type":"mqtt out","z":"3ce5b54a.127d6a","name":"","topic":"","qos":"","retain":"","broker":"c339edbf.39572","x":900,"y":530,"wires":[]},{"id":"5af90f29.39a76","type":"function","z":"3ce5b54a.127d6a","name":"filtro USB","func":"if (msg.payload.substring(0, 18) == \"inicioNanoBaterias\"){\n    msg = {topic: \"Baterias/Inicio\", payload: 1};\n    return msg;\n}\n\nvar dato = JSON.parse(msg.payload);\n\nif (dato.topic === \"Alarma/Activacion\" || dato.topic === \"Alarma/Disparo\"){\n    msg = {topic: \"USBin/Alarma\", payload: msg.payload};\n\treturn msg;\n}\nif (dato.topic === \"Toldo\"){\n    msg = {topic: \"USBin/Toldo\", payload: msg.payload};\n\treturn msg;\n}\n\nif (dato.topic === \"Baterias/Est/Pedido/Resp\" || dato.topic === \"Cargador\"){\n    msg = {topic: \"USBin/Baterias\", payload: msg.payload};\n\treturn msg;\n}\n\n\n\n","outputs":1,"noerr":0,"x":774.5000228881836,"y":447.0000104904175,"wires":[["345da128.04a5ae","2c40d55b.eedb6a"]]},{"id":"345da128.04a5ae","type":"debug","z":"3ce5b54a.127d6a","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":900,"y":570,"wires":[]},{"id":"b91e565b.c3c818","type":"function","z":"3ce5b54a.127d6a","name":"","func":"msg = {topic: \"tempBat5\", payload: global.get(\"tempBat5\")}; node.send(msg);\n","outputs":1,"noerr":0,"x":2632.166603088379,"y":426.88093921116433,"wires":[[]]},{"id":"6b3150e6.3a576","type":"mqtt in","z":"3ce5b54a.127d6a","name":"","topic":"toldo/cerrar","qos":"2","broker":"c339edbf.39572","x":1331.9046592712402,"y":247.97626876831055,"wires":[["6528d108.e3a9c"]]},{"id":"c3665e22.cefcc","type":"function","z":"3ce5b54a.127d6a","name":"hs cel","func":"msg.payload = global.get(\"fechaCompleta\");\nreturn msg;","outputs":1,"noerr":0,"x":1567.6428565979004,"y":592.6429491043091,"wires":[["746f78d9.9ca9d8"]]},{"id":"4a5f13c4.c6331c","type":"debug","z":"3ce5b54a.127d6a","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":760,"y":130,"wires":[]},{"id":"57b149bd.b8d058","type":"debug","z":"3ce5b54a.127d6a","name":"salida lcd blynk","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":1941.3927841186523,"y":715.9643287658691,"wires":[]},{"id":"55f49290.df977c","type":"mqtt in","z":"3ce5b54a.127d6a","name":"","topic":"crepMQTT","qos":"2","broker":"c339edbf.39572","x":1492.3807945251465,"y":152.14294338226318,"wires":[[]]},{"id":"cb99b704.0df768","type":"inject","z":"3ce5b54a.127d6a","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":2405.547550201416,"y":609.9761947904317,"wires":[["6426f42f.2ca5bc"]]},{"id":"aad338fd.eb88b8","type":"function","z":"3ce5b54a.127d6a","name":"","func":"var dato = JSON.parse(msg.payload);\nif (global.get(\"tiempoEspera\") === undefined)global.set(\"tiempoEspera\", 0);\nif (global.get(\"tiempoCargando\") === undefined)global.set(\"tiempoCargando\", 0);\n// context.cont = context.cont || 0;\n// context.voltaje = context.voltaje || 0;\n// context.nivTanque = context.nivTanque || 0;\n// context.tempAmb = context.tempAmb || 0;\n// context.tempCPU = context.tempCPU || 0;\n// context.PWMCooler = context.PWMCooler || 0;\n// context.Crep = context.Crep || 0;\n\n// context.cont++;\n// context.voltaje += parseFloat(global.get(\"voltajeBaterias\"));\n// context.nivTanque += parseFloat(global.get(\"nivTanque\"));\n// context.tempAmb += parseFloat(global.get(\"tempAmbienteBat\"));\n// context.tempCPU += parseFloat(global.get(\"tempCPU\"));\n// context.PWMCooler += parseFloat(global.get(\"PWM-Cooler\"));\n// context.Crep += parseFloat(global.get(\"LDR\"));\n\n// node.status({text: context.cont});\n// if (context.cont >= 10){\n// \tcontext.voltaje = context.voltaje / context.cont;\n// \tcontext.nivTanque = context.nivTanque / context.cont;\n// \tcontext.tempAmb = context.tempAmb / context.cont;\n// \tcontext.tempCPU = context.tempCPU / context.cont;\n// \tcontext.PWMCooler = context.PWMCooler / context.cont;\n// \tcontext.Crep = context.Crep / context.cont;\nif (dato.topic == \"Baterias/Est/Pedido/Resp\"){\n\n// \tmsg= {topic: \"voltajeBat\", payload: global.get(\"voltajeBaterias\")}; node.send(msg);\n// \tmsg= {topic: \"corrienteCarga\", payload: global.get(\"corrienteCarga\")}; node.send(msg);\n// \tmsg= {topic: \"cargador\", payload: global.get(\"estadoCargador\")}; node.send(msg);\n\tmsg= {topic: \"tiempoCargando\", payload: global.get(\"tiempoCargando\").toFixed(2)}; node.send(msg);\n\tmsg= {topic: \"tiempoEspera\", payload: global.get(\"tiempoEspera\").toFixed(2)}; node.send(msg);\n\tif (parseInt(global.get(\"llenarTanque\")) === 0){\n    \tmsg= {topic: \"nivTanque\", payload: global.get(\"nivTanque\")}; node.send(msg);\n    \tmsg= {topic: \"tasaLlenado\", payload: parseFloat(global.get(\"tasaLlenadoTanque\")).toFixed(2)}; node.send(msg);\n    \tmsg = {pin: 33, payload: global.get(\"nivTanque\")}; node.send([null, msg]);\n\t}\n// \tmsg= {topic: \"tempAmb\", payload: global.get(\"tempAmbienteBat\")}; node.send(msg);\n// \tnode.status ({text: global.get(\"tempAmbienteBat\")});\n// \tmsg= {topic: \"tempBat1\", payload: global.get(\"tempBat1\")}; node.send(msg);\n}\nif (dato.topic === \"Cargador\"){\n\tglobal.set(\"voltajeBaterias\", parseFloat(dato.volt).toFixed(2));\n\tglobal.set(\"voltajeBat\", dato.voltajeBat);\n\tglobal.set(\"cargador\", dato.payload);\n\t\n\tmsg= {topic: \"voltajeBat\", payload: global.get(\"voltajeBaterias\")}; node.send(msg);\n\tmsg= {topic: \"corrienteCarga\", payload: global.get(\"corrienteCarga\")}; node.send(msg);\n\tmsg= {topic: \"cargador\", payload: global.get(\"estadoCargador\")}; node.send(msg);\n\n\t// msg= {topic: \"cargador\", payload: dato.payload}; node.send(msg);\n\t// global.set(\"voltajeBaterias\", dato.volt);\n\t// msg= {topic: \"voltajeBat\", payload: global.get(\"voltajeBaterias\")}; node.send(msg);\n}\n\n\t// msg= {topic: \"voltajeBat\", payload: context.voltaje.toFixed(2)}; node.send(msg);\n\t// msg= {topic: \"nivTanque\", payload: context.nivTanque.toFixed(2)}; node.send(msg);\n\t// msg= {topic: \"tempAmb\", payload: context.tempAmb.toFixed(2)}; node.send(msg);\n\t// msg= {topic: \"tempCPU\", payload: context.tempCPU.toFixed(2)}; node.send(msg);\n\t// msg= {topic: \"PWM-Cooler\", payload: context.PWMCooler.toFixed(2)}; node.send(msg);\n\t// msg= {topic: \"Crep\", payload: context.Crep.toFixed(2)}; node.send(msg);\n\n// \tcontext.cont = 0;\n// \tcontext.voltaje = 0;\n// \tcontext.nivTanque = 0;\n// \tcontext.tempAmb = 0;\n// \tcontext.tempCPU = 0;\n// \tcontext.PWMCooler = 0;\n// \tcontext.Crep = 0;\n// }","outputs":2,"noerr":0,"x":530,"y":950,"wires":[["490a73a0.04a99c","8e765cc1.2afb1","e14463a7.a8348"],[]]},{"id":"d5de6169.53ddd","type":"mqtt out","z":"3ce5b54a.127d6a","name":"","topic":"USBin","qos":"","retain":"","broker":"c339edbf.39572","x":450,"y":550,"wires":[]},{"id":"8e54227e.9f431","type":"function","z":"3ce5b54a.127d6a","name":"toldo andando","func":"\tvar topic = msg.topic;\n\tvar payload = parseInt(msg.payload);\n\tcontext.estadoToldo = context.estadoToldo || 0;  // estToldo:  0= parado, 1= abriendo, 2= abierto, 3= cerrando, 4= cerrado\n\tcontext.estAnt = context.estAnt || 0; // =0 parado, =1 abriendo, = 2 cerrando\n\tvar tiempoMover = 15;\n\tvar diffAmanecer = 1.5;\n\tvar date = new Date();\n\tvar hh = global.get(\"hh\");\n\tvar mm = global.get(\"mm\");\n\tvar ss = global.get(\"ss\");\n\tif (global.get(\"tiempoEsperaRociador\") === undefined)global.set(\"tiempoEsperaRociador\", 30);\n\tif (global.get(\"tiempoMojandoRociador\") === undefined)global.set(\"tiempoMojandoRociador\", 0.8);\n\n\t// context.tiempoToldo = context.tiempoToldo || date.getTime();\n\tcontext.datoAmanecer = context.datoAmanecer || date.getTime()+5000;\n\tcontext.CerrarToldoAuto = context.CerrarToldoAuto || 0; \n\tcontext.AbrirToldoAuto = context.AbrirToldoAuto || 0;\n\tcontext.hsAnterior =context.hsAnterior || hh-1;\n\tcontext.ssAnterior = context.ssAnterior || 0;\n\tcontext.inicio = context.inicio || 0;\n\tcontext.error = context.error || 0;\n\n\tcontext.avisoAuto = context.avisoAuto || 0;\n\tcontext.avisoRociador = context.avisoRociador || 0;\n\tcontext.condicionEstadoToldo = context.condicionEstadoToldo || 0;\n\tcontext.aperturaAmanecer = context.aperturaAmanecer || 0;\n\tcontext.cerradoManual = context.cerradoManual || 0;// =1 lo cerre manual se habilita pone a 0 cuando se cierra de forma automatica\n\tcontext.abiertoManual = context.abiertoManual || 0;// =1 lo habri manual se habilita pone a 0 cuando se habre de forma automatica\n\n\tif (global.get(\"tiempoMoviendo\") === undefined)global.set(\"tiempoMoviendo\", 0);\n\tif (global.get(\"enfriarToldo\") === undefined)global.set(\"enfriarToldo\", 0);\n\tif (global.get(\"mojandoToldo\") === undefined)global.set(\"mojandoToldo\", 0);\n\tif (global.get(\"estadoToldo\") === undefined)global.set(\"estadoToldo\", \"nulo\");\n\tif (global.get(\"Dia\") === undefined)global.set(\"Dia\", 0);\n\tif (global.get(\"datoAmanecer\") === undefined)global.set(\"datoAmanecer\", \"nulo\");\n\tif (global.get(\"tempPatioLuz\") === undefined)global.set(\"tempPatioLuz\", 0);\n\tif (global.get(\"hsAmanecer\") === undefined)global.set(\"hsAmanecer\", \"nulo\");\n\tif (global.get(\"hsAnochecer\") === undefined)global.set(\"hsAnochecer\", \"nulo\");\n\n\tvar dato = JSON.parse(msg.payload);\n\n\tvar tiempo = hh + \":\" + mm + \":\" + ss;\n\n\tif (dato.topic === \"Toldo\")comprobarToldo();\n\n\tif (msg.topic === \"USBin/Toldo\"){\n\t\tif (dato.topic === \"tiempoEsperaRociador\"){global.set(\"tiempoEsperaRociador\", parseFloat(dato.payload).toFixed(1)); return;}\n\t\tif (dato.topic === \"tiempoMojandoRociador\"){global.set(\"tiempoMojandoRociador\", parseFloat(dato.payload).toFixed(1)); return;}\n\t}\n\n\n\tif (global.get(\"estadoToldo\") !== \"Abriendo\" || global.get(\"estadoToldo\") !== \"Cerrando\")node.status({text: global.get(\"hsCpu\") + \"  \" + context.CerrarToldoAuto + \" -- \" + hh});\t\t\n\n\tif(context.inicio === 0){\n\t\tif (global.get(\"Dia\") === 1)context.aperturaAmanecer = 1;\n\n\tcontext.inicio = 1;\t\n\t}\n\n\tif (hh === 0 && mm === 0 && ss === 0){\n\t\tcontext.CerrarToldoAuto = 0;\n\t\tcontext.AbrirToldoAuto = 0;\t\n\t\tcontext.cerradoManual = 0;\n\t}\n\n\tif (topic === \"resetAutos\"){\n\t\tcontext.CerrarToldoAuto = 0;\n\t\tcontext.AbrirToldoAuto = 0;\t\n\t\tglobal.set(\"CerrarToldoAuto\", context.CerrarToldoAuto);\n\t\tglobal.set(\"AbrirToldoAuto\", context.AbrirToldoAuto);\n\t\treturn;}\n\n\tif (topic === \"toldoBlynk\"){\n\t\tglobal.set(\"estadoToldo\", \"Error Borrado\");\n\t\tglobal.set(\"toldoManual\", 1);\n\t\tif (payload === 1 && context.estAnt === 0){\n\t\t\t// context.abiertoManual = 0;\n\t\t\tcontext.abiertoManual = 1;\n\t\t\tcontext.condicionEstadoToldo = 0;\n\t\t\tcontext.CerrarToldoAuto = 0;\n\t\t\tglobal.set(\"estadoToldoLCD\", \"Abriendo toldo modo manual (Blynk)\");\n\t\t\tmsg = {topic: \"INSERT INTO \\`toldo\\`(\\`fecha\\`, \\`estado\\`) VALUES (now(),\\\"Abriendo Toldo Manual Blynk\\\")\"};\n\t\t\tnode.send([null, null, msg]);\t\t\n\t\t\tmsg = {topic: \"USBout\", payload: \"{\\\"topic\\\":\\\"toldo\\\",\\\"payload\\\":2}\"};\n\t\t\tnode.send([msg, null, null]); \n\t\t\treturn;}\n\n\t\tif (payload === 1 && context.estAnt === 1){\n\t\t\tcontext.cerradoManual = 1;\n\t\t\t// context.cerradoManual = 0;\n\t\t\tcontext.condicionEstadoToldo = 0;\n\t\t\tcontext.AbrirToldoAuto = 0;\n\t\t\tglobal.set(\"estadoToldoLCD\", \"Cerrando toldo modo manual (Blynk)\");\n\t\t\tmsg = {topic: \"INSERT INTO \\`toldo\\`(\\`fecha\\`, \\`estado\\`) VALUES (now(),\\\"Cerrando Toldo Manual Blynk\\\")\"};\n\t\t\tnode.send([null, null, msg]);\t\t\t\n\t\t\tmsg = {topic: \"USBout\", payload: \"{\\\"topic\\\":\\\"toldo\\\",\\\"payload\\\":4}\"};\n\t\t\tnode.send([msg, null, null]); \n\t\t\treturn;}\n\n\t\tif (payload === 0 && context.estadoToldo === 2){\n\t\t\tcontext.cerradoManual = 1;\n\t\t\t// context.cerradoManual = 0;\n\t\t\tcontext.condicionEstadoToldo = 0;\n\t\t\tglobal.set(\"estadoToldoLCD\", \"Cerrando toldo modo manual (Blynk)\");\n\t\t\tmsg = {topic: \"INSERT INTO \\`toldo\\`(\\`fecha\\`, \\`estado\\`) VALUES (now(),\\\"Cerrando Toldo Manual Blynk\\\")\"};\n\t\t\tnode.send([null, null, msg]);\t\t\t\n\t\t\tmsg = {topic: \"USBout\", payload: \"{\\\"topic\\\":\\\"toldo\\\",\\\"payload\\\":4}\"};\n\t\t\tnode.send([msg, null, null]); \n\t\t\treturn;}\n\n\t\tif (payload === 0){\n\t\t\tcontext.abiertoManual = 0;\n\t\t\tcontext.cerradoManual = 0;\t\t\n\t\t\tglobal.set(\"estadoToldoLCD\", \"Toldo Parado\");\n\t\t\tcontext.cerradoManual = 0;\n\t\t\tmsg = {topic: \"USBout\", payload: \"{\\\"topic\\\":\\\"toldo\\\",\\\"payload\\\":0}\"};\n\t\t\tnode.send([msg, null, null]); \n\t\t\tglobal.set(\"estadoToldoLCD\", \"Toldo parado de forma manual (Blynk)\");\n\t\t\treturn;}\n\t\t}\n\n\tif (global.get(\"Dia\") === 0){context.aperturaAmanecer = 0; context.datoAmanecer = date.getTime() + 1000;}\n\n\t// global.set(\"datoAmanecer\", context.datoAmanecer);\t\n\tif (global.get(\"tempPatioLuz\") > 19 && global.get(\"estadoToldo\") === \"Abierto\")context.CerrarToldoAuto = 0;\n\tif (topic === \"crepMQTT\" && payload === 0){context.CerrarToldoAuto = 0;}\n\n\tglobal.set(\"CerrarToldoAuto\", context.CerrarToldoAuto);\n\tglobal.set(\"AbrirToldoAuto\", context.AbrirToldoAuto);\n\tglobal.set(\"aperturaAmanecer\", context.aperturaAmanecer);\t\n\tglobal.set(\"diff\", date.getTime() - (context.datoAmanecer + (1000 * 2)));\n\n\tif (global.get(\"mes\") >= 3 && global.get(\"mes\") <= 8 && hh === 22 && mm < 5 && context.CerrarToldoAuto === 0 && global.get(\"estadoToldo\") !== \"Cerrado\"){\n\t\tcontext.abiertoManual = 0;\t\n\t\tcontext.AbrirToldoAuto = 0;\t\n\t\tcontext.condicionEstadoToldo = 1;\n\t\tvar datoMsg = \"Cerrando toldo por oscurcer en invierno\";\n\t\tglobal.set(\"estadoToldoLCD\", datoMsg);\n\n\t\tmsg = {topic: \"INSERT INTO \\`toldo\\`(\\`fecha\\`, \\`estado\\`, \\`tempPatioLuz\\`) VALUES (now(),\\\"\" + datoMsg + \"\\\", \" + global.get(\"tempPatioLuz\") + \")\"};\n\t\tnode.send([null, null, msg]);\t\t\n\n\t\tmsg = {topic: \"notifyBlynk\", payload: datoMsg}; node.send([msg, null, null]);\n\t\tmsg = {topic: \"USBout\", payload: \"{\\\"topic\\\":\\\"toldo\\\",\\\"payload\\\":4}\"}; node.send([msg, null, null]);  \n\t\tglobal.set(\"CerrarToldoAuto\", context.CerrarToldoAuto);\n\t\tglobal.set(\"AbrirToldoAuto\", context.AbrirToldoAuto);\n\t\t// return;\t\n\t}\n\n\t//Cerrar\t\n\tif (global.get(\"tempPatioLuz\") > 24 && global.get(\"Dia\") === 1 || global.get(\"tempPatioLuz\") < 15 && global.get(\"Dia\") === 0  && context.abiertoManual === 0){\n\t\tif (context.CerrarToldoAuto === 0 && global.get(\"estadoToldo\") !== \"Cerrado\"){\n\t\t\tcontext.cerradoManual = 0;\n\t\t\tcontext.AbrirToldoAuto = 0;\t\t\n\t\t\tcontext.condicionEstadoToldo = 2;\n\t\t\t// global.set(\"estadoToldo\", \"Cerrando\");\n\t\t\tvar datoMsg = \"Cerrando toldo por temperatura (24<\" + global.get(\"tempPatioLuz\") + \"<15)\";\n\t\t\tglobal.set(\"estadoToldoLCD\", datoMsg);\n\n\t\t\tmsg = {topic: \"INSERT INTO \\`toldo\\`(\\`fecha\\`, \\`estado\\`, \\`tempPatioLuz\\`) VALUES (now(),\\\"\" + datoMsg + \"\\\", \" + global.get(\"tempPatioLuz\") + \")\"};\n\t\t\tnode.send([null, null, msg]);\t\t\n\n\t\t\tmsg = {topic: \"notifyBlynk\", payload: datoMsg}; node.send([msg, null, null]);\n\t\t\tmsg = {topic: \"USBout\", payload: \"{\\\"topic\\\":\\\"toldo\\\",\\\"payload\\\":4}\"};\n\t\t\tnode.send([msg, null, null]);  \n\t\t\tglobal.set(\"CerrarToldoAuto\", context.CerrarToldoAuto);\n\t\t\tglobal.set(\"AbrirToldoAuto\", context.AbrirToldoAuto);\n\t\t\treturn;}\t\t\t\n\t\t}\t\n\n\t//Abrir anochecer\n\tif (topic === \"crepMQTT\" && payload === 0){\n\t\tcontext.aperturaAmanecer = 0;\n\t\tif(global.get(\"tempPatioLuz\") < 23 && global.get(\"tempPatioLuz\") >= 18 && global.get(\"estadoToldo\") !== \"Abierto\" && context.cerradoManual === 0){\n\t\t\tcontext.CerrarToldoAuto = 0;\n\t\t\tcontext.abiertoManual = 0\n\t\t\tcontext.condicionEstadoToldo = 2;\n\t\t\tvar datoMsg = \"Abriendo toldo por hacerse de noche\";\n\t\t\tglobal.set(\"estadoToldoLCD\", datoMsg);\n\n\t\t\tmsg = {topic: \"INSERT INTO \\`toldo\\`(\\`fecha\\`, \\`estado\\`, \\`tempPatioLuz\\`, \\`crepuscular\\`) VALUES (now(),\\\"Abriendo toldo por oscurecer\\\", \" + global.get(\"tempPatioLuz\") + \", \\\"\" + global.get(\"hsAnochecer\") + \"\\\")\"};\n\t\t\tnode.send([null, null, msg]);\n\n\t\t\tmsg = {topic: \"notifyBlynk\", payload: datoMsg}; node.send([msg, null, null]);\n\t\t\tmsg = {topic: \"USBout\", payload: \"{\\\"topic\\\":\\\"toldo\\\",\\\"payload\\\":2}\"};\n\t\t\tnode.send([msg, null, null]);  \n\t\t\tglobal.set(\"CerrarToldoAuto\", context.CerrarToldoAuto);\n\t\t\tglobal.set(\"AbrirToldoAuto\", context.AbrirToldoAuto);\n\t\t}}\t\t\n\n\t//Abrir por temp\n\tif (global.get(\"tempPatioLuz\") < 17 && global.get(\"tempPatioLuz\") > 15 && global.get(\"Dia\") === 1 && context.AbrirToldoAuto === 0 && global.get(\"estadoToldo\") !== \"Abierto\" && context.cerradoManual === 0){\n\t\tcontext.condicionEstadoToldo = 1;\n\t\tcontext.abiertoManual = 0\n\t\tvar datoMsg = \"Abriendo toldo por temperatura (19<\" + global.get(\"tempPatioLuz\") + \">17)\";\n\t\tglobal.set(\"estadoToldoLCD\", datoMsg); \n\n\t\tmsg = {topic: \"INSERT INTO \\`toldo\\`(\\`fecha\\`, \\`estado\\`, \\`tempPatioLuz\\`, \\`crepuscular\\`) VALUES (now(),\\\"\" + datoMsg + \"\\\", \" + global.get(\"tempPatioLuz\") + \", \\\"\" + datoAmanecer + \"\\\")\"};\n\t\tnode.send([null, null, msg]);\t\n\n\t\tmsg = {topic: \"notifyBlynk\", payload: datoMsg}; node.send([msg, null, null]);\n\t\tmsg = {topic: \"USBout\", payload: \"{\\\"topic\\\":\\\"toldo\\\",\\\"payload\\\":2}\"}; node.send([msg, null, null]); \n\t\tglobal.set(\"CerrarToldoAuto\", context.CerrarToldoAuto);\n\t\tglobal.set(\"AbrirToldoAuto\", context.AbrirToldoAuto);\n\t\treturn;}\n\n\t//Abrir amanecer     * 60 * diffAmanecer\n\tif (date.getTime() > (context.datoAmanecer + (1000 * 60 * 60 * diffAmanecer)) && global.get(\"tempPatioLuz\") < 23  && context.aperturaAmanecer === 0){   //Abrir Auto por Hora, hs= 23:15:25\n\t\tcontext.aperturaAmanecer = 1;\n\t\tif(context.AbrirToldoAuto === 0 && global.get(\"estadoToldo\") !== \"Abierto\"){\n\t\t\tcontext.condicionEstadoToldo = 3;\n\t\t\tcontext.aperturaAmanecer = 1;\n\t\t\tcontext.abiertoManual = 0;\t\t\n\t\t\tcontext.CerrarToldoAuto = 0;\n\t\t\tvar datoAmanecer = global.get(\"hsAmanecer\"); if (datoAmanecer === undefined)datoAmanecer = null;\n\t\t\tvar datoMsg = \"Abriendo toldo por Amanecer, hs amanecer: \" + global.get(\"hsCpu\");\n\t\t\tglobal.set(\"estadoToldoLCD\", datoMsg);\n\n\t\t\tmsg = {topic: \"INSERT INTO \\`toldo\\`(\\`fecha\\`, \\`estado\\`, \\`tempPatioLuz\\`, \\`crepuscular\\`) VALUES (now(),\\\"\" + datoMsg + \"\\\", \" + global.get(\"tempPatioLuz\") + \", \\\"\" + datoAmanecer + \"\\\")\"};\n\t\t\tnode.send([null, null, msg]);\n\n\t\t\tmsg = {topic: \"notifyBlynk\", payload: datoMsg}; node.send([msg, null, null]);\n\t\t\tmsg = {topic: \"USBout\", payload: \"{\\\"topic\\\":\\\"toldo\\\",\\\"payload\\\":2}\"}; node.send([msg, null, null]); \n\t\t\tglobal.set(\"CerrarToldoAuto\", context.CerrarToldoAuto);\n\t\t\tglobal.set(\"AbrirToldoAuto\", context.AbrirToldoAuto);\n\t\t\treturn;}\t}\n\n\t//60 * 60 * 1.5\n\n\tif (msg.topic === \"enfriarToldoBlynk\"){global.set(\"enfriarToldo\", msg.apyload);}\n\n\tif (global.get(\"tempPatioLuz\") >= 25 && global.get(\"estadoToldo\") === \"Cerrado\"  && global.get(\"enfriarToldo\") === 0){\n\t\t\tcontext.esperaMojando = date.getTime() - 1000; global.set(\"mojandoToldo\",0);\n\t\t\tvar datoEnfriador = \"Enfriador habilitado (\" + global.get(\"hsCel\") + \" temp: \" + global.get(\"tempPatioLuz\") + \")\";\n\t\t\tmsg = {pin: 9, payload: 1}; node.send([null, msg, null]);\n\t\t\tglobal.set(\"enfriadorToldo\", datoEnfriador);\n\t\t\tmsg = {topic: \"INSERT INTO \\`toldo\\`(\\`fecha\\`, \\`estado\\`) VALUES (now(), \\\"\" + datoEnfriador + \"\\\")\"}; node.send([null, null, msg]);\t\n\t\t\t// msg = {topic: \"notifyBlynk\", payload: datoEnfriador}; node.send([msg, null, null]);\n\t\t\tglobal.set(\"enfriarToldo\", 1);\n\t\t\tcontext.avisoRociador = 0;}\n\n\tif (global.get(\"tempPatioLuz\") <= 18 && global.get(\"enfriarToldo\") === 1 || global.get(\"estadoToldo\") !== \"Cerrado\" && global.get(\"enfriarToldo\") === 1){\n\t\t\tvar datoEnfriador = \"Enfriador deshabilitado (\" + global.get(\"hsCel\") + \" temp: \" + global.get(\"tempPatioLuz\") + \")\";\n\t\t\tmsg = {topic: \"notifyBlynk\", payload: datoEnfriador}; node.send([msg, null, null]);\n\t\t\tglobal.set(\"enfriadorToldo\", datoEnfriador);\n\t\t\tmsg = {topic: \"INSERT INTO \\`toldo\\`(\\`fecha\\`, \\`estado\\`) VALUES (now(), \\\"\" + datoEnfriador + \"\\\")\"}; node.send([null, null, msg]);\t\n\t\t\tglobal.set(\"enfriarToldo\", 0);\n\t\t\tmsg = {topic: \"USBout\", payload: \"{\\\"topic\\\":\\\"rele1\\\",\\\"payload\\\": 0}\"};\t\n\t\t\tnode.send([msg, null, null]);\n\t\t\tmsg = {pin: 9, payload: 0}; node.send([null, msg, null]);\n\t\t}\n\n\tif (global.get(\"enfriarToldo\") === 1){\n\t\tif (global.get(\"mojandoToldo\") === 0 && date.getTime() > context.esperaMojando && global.get(\"tempPatioLuz\") >= 22){\n\t\t\tcontext.tiempoMojando = date.getTime() + (1000*60*global.get(\"tiempoMojandoRociador\"));//3'\n\t\t\tglobal.set(\"mojandoToldo\", 1);\n\t\t\tmsg = {topic: \"USBout\", payload: \"{\\\"topic\\\":\\\"rele1\\\",\\\"payload\\\": 1}\"};\t\n\t\t\tnode.send([msg, null, null])\n\t\t\tmsg = {pin: 9, payload: 1}; node.send([null, msg, null]);\n\n\t\t\tvar datoEnfriador = \"rociador mojando desde las \" + global.get(\"hsCel\") ;\n\t\t\tglobal.set(\"rociadorToldo\", datoEnfriador);\n\t\t\tmsg = {topic: \"notifyBlynk\", payload: \"Rociador mojando desde las \" + global.get(\"hsCel\") }; node.send([msg, null, null]);\n\t\t\tmsg = {topic: \"INSERT INTO \\`toldo\\`(\\`fecha\\`, \\`estado\\`) VALUES (now(), \\\"\" + msg.payload + \"\\\")\"}; \n\t\t\tnode.send([null, null, msg]);\n\t\t\tmsg = {topic: \"ESP/Lavadero/Presurizadora\", payload: 1}; node.send([msg, null, null])\t\t\t\t\t\n\t\t}\n\t\tif (global.get(\"mojandoToldo\") === 1 && date.getTime() > context.tiempoMojando){\n\t\t\tcontext.esperaMojando = date.getTime() + (1000*60*global.get(\"tiempoEsperaRociador\"));//30'\n\t\t\tglobal.set(\"mojandoToldo\", 0);\n\t\t\tmsg = {topic: \"USBout\", payload: \"{\\\"topic\\\":\\\"rele1\\\",\\\"payload\\\": 0}\"};\t\n\t\t\tnode.send([msg, null, null]);\n\t\t\tmsg = {pin: 9, payload: 0}; node.send([null, msg, null]);\n\t\t\tvar datoEnfriador = \"rociador en espera desde las \" + global.get(\"hsCel\") ;\n\t\t\tglobal.set(\"rociadorToldo\", datoEnfriador);\n\t\t\tmsg = {topic: \"notifyBlynk\", payload: \"Rociador en espera desde las \" + global.get(\"hsCel\")}; node.send([msg, null, null]);\n\t\t\tmsg = {topic: \"INSERT INTO \\`toldo\\`(\\`fecha\\`, \\`estado\\`) VALUES (now(), \\\"\" + msg.payload + \"\\\")\"}; \n\t\t\tnode.send([null, null, msg]);\t\t\n\t\t}\n\t}//Cerrando toldo por temperatura (24<\n\tif (global.get(\"enfriarToldo\") === 0 && context.avisoRociador === 0){\t\t\n\t\tvar datoEnfriador = \"Enfriador deshabilitado, \" + global.get(\"hsCel\") + \" temp: \" + global.get(\"tempPatioLuz\");\n\t\tmsg = {topic: \"notifyBlynk\", payload: datoEnfriador}; node.send([msg, null, null]);\n\t\tcontext.avisoRociador = 1;\t\t\n\t\tglobal.set(\"mojandoToldo\" , 0);\n\t\tmsg = {topic: \"USBout\", payload: \"{\\\"topic\\\":\\\"rele1\\\",\\\"payload\\\": 0}\"};\t\n\t\tnode.send([msg, null, null]);}\t\t\n\n\tfunction comprobarToldo(){\n\tswitch (dato.payload){\n\t\tcase 0:\n\t\t\tglobal.set(\"estadoToldo\", \"Parado\");\t\t\n\t\t\tcontext.estadoToldo = 0;\t\n\t\t\tif (context.error !== 0)global.set(\"estadoToldoLCD\", \"Toldo parado de forma manual (Blynk)\");\n\t\t\tmsg = {topic: \"INSERT INTO \\`toldo\\`(\\`fecha\\`, \\`estado\\`, \\`tiempoMov\\`) VALUES (now(),\\\"\" + global.get(\"estadoToldoLCD\") + \"\\\",\" + global.get(\"tiempoMoviendo\") + \")\"};\t\t\n\t\t\tmsg = {topic: \"Blynk/actualizar/estado\", payload: 1}; node.send([msg, null, null]);\n\t\t\tif (context.estAnt === 0){msg = {payload: 0, color: \"#ffbc26\", label: \"Toldo Parado\", offlabel: \"Abrir\", pin: 3}; node.send([null, msg, null]); return;}\n\t\t\tif (context.estAnt === 1){msg = {payload: 0, color: \"#ffbc26\", label: \"Toldo Parado\", offlabel: \"Cerrar\", pin: 3}; node.send([null, msg, null]); return;}\n\t\tbreak;\n\t\tcase 1:\t\n\t\t    // if (global.get(\"estadoToldo\") === \"Abierto\") return;\n\t\t\tcontext.AbrirToldoAuto = 1;\n\t\t\tcontext.error = 0;\n\t\t\tif (global.get(\"estadoToldo\") === \"Cerrado\" || global.get(\"estadoToldo\") === \"Error Toldo abriendo\" || global.get(\"estadoToldo\") === \"Error Toldo cerrando\")global.set(\"tiempoMoviendo\", 0);\n\t\t\tmsg = {payload: 1, color: \"#ffbc26\", label: \"Tol. Abriendo\", onlabel: \"Parar\", pin: 3}; node.send([null, msg, null]);\n\t\t\tcontext.estadoToldo = 1;\n\t\t\tcontext.estAnt = 1;\n\t\t\tglobal.set(\"estadoToldo\", \"Abriendo\");\n\t\t\tnode.status({text: global.get(\"estadoToldo\") + \" \" + context.tiempoToldo});//toldo abierto\n\t\tbreak;\n\t\tcase 2:\n\t\t\tmsg = {topic: \"USBout\", payload: \"{\\\"topic\\\":\\\"abiertoOK\\\",\\\"payload\\\":0}\"}; node.send([msg, null, null]);\n\t\t\tif (global.get(\"estadoToldo\") == \"Abierto\")return;\n\t\t\tglobal.set(\"estadoToldo\", \"Abierto\");\t\t\n\t\t\tglobal.set(\"toldoManual\", 0);\n\t\t\tif (context.condicionEstadoToldo === 0)global.set(\"estadoToldoLCD\", \"Toldo Abierto de forma manual (Blynk)\" + global.get(\"hsCpu\"));\n\t\t\tif (context.condicionEstadoToldo === 1)global.set(\"estadoToldoLCD\", \"Toldo Abierto por temp (\" + global.get(\"hsCpu\") + \", temp: \" + global.get(\"tempPatioLuz\") + \")\");\n\t\t\tif (context.condicionEstadoToldo === 2)global.set(\"estadoToldoLCD\", \"Toldo Abierto por Oscurecer(\"  + global.get(\"hsCpu\") + \")\");\n\t\t\tif (context.condicionEstadoToldo === 3)global.set(\"estadoToldoLCD\", \"Toldo Abierto por Amanecer(\"  + global.get(\"hsCpu\") + \")\");\n\t\t\tvar moviendo = Math.abs(tiempoMover - global.get(\"tiempoMoviendo\"));\n\t\t\tmsg = {topic: \"INSERT INTO \\`toldo\\`(\\`fecha\\`, \\`estado\\`, \\`tiempoMov\\`, \\`tempPatioLuz\\`) VALUES (now(),\\\"\" + global.get(\"estadoToldoLCD\") + \"\\\",\" + moviendo + \",\" + global.get(\"tempPatioLuz\") + \")\"};\n\t\t\tnode.send([null, null, msg]);\t\n\t\t\tmsg = {pin: 3, payload: 1, color: \"#23C48E\", label: \"Toldo Abierto\", onlabel: \"Cerrar\"}; node.send([null, msg, null]);\n\t\t\tmsg = {topic: \"notifyBlynk\", payload: \"Toldo Abierto\"}; node.send([msg, null, null]);\n\t\t\tcontext.estadoToldo = 2;\n\t\t\tcontext.estAnt = 1;\n\t\t\tmsg = {topic: \"Blynk/actualizar/estado\", payload: 1}; node.send([msg, null, null]);\n\t\t\treturn;\n\t\tcase 3:\n\t\t\t// if (global.get(\"estadoToldo\") === \"Cerrado\") return;\t\t\n\t\t\tcontext.CerrarToldoAuto = 1;\t\n\t\t\tcontext.error = 0;\n\t\t\tif (global.get(\"estadoToldo\") === \"Abierto\" || global.get(\"estadoToldo\") === \"Error Toldo abriendo\" || global.get(\"estadoToldo\") === \"Error Toldo cerrando\")global.set(\"tiempoMoviendo\", 0);\n\t\t\tmsg = {payload: 1, color: \"#ffbc26\", label: \"Tol. Cerrando\", onlabel: \"Parar\", pin: 3}; node.send([null, msg, null]);\n\t\t\tcontext.estadoToldo = 3;\n\t\t\tcontext.estAnt = 0;\n\t\t\tglobal.set(\"estadoToldo\", \"Cerrando\");\n\t\t\tnode.status({text: global.get(\"estadoToldo\") + \" \" + context.tiempoToldo});\n\t\tbreak;\n\t\tcase 4://Cerrando toldo por temperatura (24<\n\t\t\tmsg = {topic: \"USBout\", payload: \"{\\\"topic\\\":\\\"cerradoOK\\\",\\\"payload\\\":0}\"}; node.send([msg, null, null]);\n\t\t\tif (global.get(\"estadoToldo\") == \"Cerrado\")return;\n\t\t\tglobal.set(\"estadoToldo\", \"Cerrado\");\n\t\t\tglobal.set(\"toldoManual\", 0);\n\t\t\tif (context.condicionEstadoToldo === 0)global.set(\"estadoToldoLCD\", \"Toldo Cerrado de forma manual (Blynk \" + global.get(\"hsCpu\") + \")\");\n\t\t\tif (context.condicionEstadoToldo === 1)global.set(\"estadoToldoLCD\", \"Toldo Cerrado por oscurcer en invierno (\" + global.get(\"hsCpu\") + \", temp: \" + global.get(\"tempPatioLuz\") + \")\");\n\t\t\tif (context.condicionEstadoToldo === 2)global.set(\"estadoToldoLCD\", \"Toldo Cerrado por temp. (\" + global.get(\"hsCpu\") + \", temp: \" + global.get(\"tempPatioLuz\") + \")\");\n\t\t\tmsg = {topic: \"INSERT INTO \\`toldo\\`(\\`fecha\\`, \\`estado\\`, \\`tiempoMov\\`, \\`tempPatioLuz\\`) VALUES (now(),\\\"\" + global.get(\"estadoToldoLCD\") + \"\\\",\" + global.get(\"tiempoMoviendo\") + \",\" + global.get(\"tempPatioLuz\") + \")\"};\n\t\t\tnode.send([null, null, msg]);\n\t\t\tmsg = {pin: 3, payload: 0, color: \"#23C48E\", label: \"Toldo Cerrado\", offlabel: \"Abrir\"}; node.send([null, msg, null]);\n\t\t\tmsg = {topic: \"notifyBlynk\", payload: \"Toldo Cerrado\"}; node.send([msg, null, null]);\t\n\t\t\tcontext.estadoToldo = 4;\t\t\n\t\t\tcontext.estAnt = 0;\n\t\t\tmsg = {topic: \"Blynk/actualizar/estado\", payload: 1}; node.send([msg, null, null]);\n\t\t\treturn;}\n\tmsg = {topic: \"Blynk/actualizar/toldo\", payload: 1}; node.send([msg, null, null]);}\n\n\t//\"Toldo Cerrado (9:11:13)9:11:12)por temperatura (24<14.0<15)\"\n\n\tif (context.ssAnterior !== ss){\n\t\tcontext.ssAnterior = ss;\n\t\tif (global.get(\"estadoToldo\") === \"Cerrando\" || global.get(\"estadoToldo\") === \"Abriendo\"){\n\t\tvar porcentaje;\n\t\tif (global.get(\"estadoToldo\") === \"Abriendo\"){\n\t\t\tmsg = {pin: 4, payload: \" Abriendo Toldo \"};\n\t\t\ttiempoMoviendo = global.get(\"tiempoMoviendo\") - 1; \n\t\t\tglobal.set(\"tiempoMoviendo\", tiempoMoviendo);}\n\n\t\tif (global.get(\"estadoToldo\") === \"Cerrando\"){\n\t\t\tmsg = {pin: 4, payload: \" Cerrando Toldo \"};\n\t\t\ttiempoMoviendo = global.get(\"tiempoMoviendo\") + 1; \n\t\t\tglobal.set(\"tiempoMoviendo\", tiempoMoviendo);}\n\t\tnode.send([null, msg, null]);\n\n\t\tporcentaje = Math.abs(((parseFloat((tiempoMoviendo * 100)/tiempoMover))).toFixed(1));\n\t\tif (global.get(\"estadoToldo\") === \"Cerrando\")porcentaje = (Math.abs(100 - porcentaje)).toFixed(1);\n\t\tif (porcentaje < 10)porcentaje = \"  \" + porcentaje;\n\t\tif (porcentaje < 100 && porcentaje >= 10)porcentaje = \" \" + porcentaje;\t\n\n\t\tmsg = {pin: 5, payload: \" Avance= \" + porcentaje + \"% \"};// Avance= 100.1%\n\t\tnode.send([null, msg, null]); \n\t\tnode.status({text: tiempoMoviendo + \"  Avance: \" + porcentaje+ \"%\"});\n\t\t}}\n\n\tif (global.get(\"estadoToldo\") === \"Abriendo\" && global.get(\"toldoManual\") === 0){\n\t\tif(Math.abs(global.get(\"tiempoMoviendo\")) > tiempoMover * 1.2){\n\t\t\tcontext.estadoToldo = 0;\n\t\t\tcontext.error = 1;\n\t\t\tglobal.set(\"estadoToldo\", \"Error Toldo abriendo\");\n\t\t\tglobal.set(\"estadoToldoLCD\", \"Error al abrir toldo\");\n\t\t\tvar moviendo = Math.abs(tiempoMover - global.get(\"tiempoMoviendo\"))/2;\n\t\t\tmsg = {topic: \"INSERT INTO \\`toldo\\`(\\`fecha\\`, \\`estado\\`, \\`tiempoMov\\`, \\`tempPatioLuz\\`) VALUES (now(),\\\"\" + global.get(\"estadoToldoLCD\") + \"\\\",\" + moviendo + \",\" + global.get(\"tempPatioLuz\") + \")\"};\n\t\t\tnode.send([null, null, msg]);\t\t\n\t\t\tmsg = {topic: \"notifyBlynk\", payload: global.get(\"estadoToldoLCD\")}; node.send([msg, null, null]);\n\t\t\tmsg = {payload: 1, color: \"#D3435C\", onlabel: \"Error\", pin: 3}; node.send([null, msg, null]);\n\t\t\tmsg = {topic: \"USBout\", payload: \"{\\\"topic\\\":\\\"toldo\\\",\\\"payload\\\":0}\"};node.send([msg, null, null]);\n\t\t\treturn;\t\n\t\t}//error al abrir//error al abrir\n\t}\n\tif (global.get(\"estadoToldo\") === \"Cerrando\" && global.get(\"toldoManual\") === 0){\n\t\tif(Math.abs(global.get(\"tiempoMoviendo\")) > tiempoMover * 1.2){\n\t\t\tcontext.estadoToldo = 0;\n\t\t\tcontext.error = 1;\n\t\t\tglobal.set(\"estadoToldo\", \"Error Toldo cerrando\");\n\t\t\tglobal.set(\"estadoToldoLCD\", \"Error al cerrar toldo\");\n\t\t\tvar moviendo = Math.abs(global.get(\"tiempoMoviendo\"));\n\t\t\tmsg = {topic: \"INSERT INTO \\`toldo\\`(\\`fecha\\`, \\`estado\\`, \\`tiempoMov\\`, \\`tempPatioLuz\\`) VALUES (now(),\\\"\" + global.get(\"estadoToldoLCD\") + \"\\\",\" + moviendo + \",\" + global.get(\"tempPatioLuz\") + \")\"};\n\t\t\tnode.send([null, null, msg]);\t\t\n\t\t\tmsg = {topic: \"notifyBlynk\", payload: global.get(\"estadoToldoLCD\")}; node.send([msg, null, null]);\n\t\t\tmsg = {payload: 1, color: \"#D3435C\", onlabel: \"Error\", pin: 3}; node.send([null, msg, null]);\n\t\t\tmsg = {topic: \"USBout\", payload: \"{\\\"topic\\\":\\\"toldo\\\",\\\"payload\\\":0}\"};node.send([msg, null, null]);\n\t\t\treturn;\t\n\t\t}//error al cerrar\n\t}\n\n\n","outputs":3,"noerr":0,"x":1700,"y":230,"wires":[[],[],[]]},{"id":"555ebd7f.d71624","type":"inject","z":"3ce5b54a.127d6a","name":"","topic":"mandarMail","payload":"1","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":310,"y":240,"wires":[["95935531.f40c18"]]},{"id":"954f709c.f5b4a","type":"function","z":"3ce5b54a.127d6a","name":"","func":"msg = {topic: \"tempAmbiente\", payload: global.get(\"tempAmbienteBat\")}; node.send(msg);","outputs":1,"noerr":0,"x":2635.023780822754,"y":508.30952807835183,"wires":[["8af0a3fa.e59e7"]]},{"id":"9940a873.9a33d8","type":"inject","z":"3ce5b54a.127d6a","name":"","topic":"","payload":"{\"topic\":\"Crep\",\"payload\":\"1\"}","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":300,"y":510,"wires":[["d5de6169.53ddd"]]},{"id":"fc934b68.c77b08","type":"function","z":"3ce5b54a.127d6a","name":"Alarma","func":"var dato = JSON.parse(msg.payload);\npayload = parseInt(dato.payload);\n\n\nif (msg.topic === \"google/Alarma\" || msg.topic === \"alarmaBlynk\"){\n  msg = {topic: \"USBout\", payload:\"{\\\"topic\\\":\\\"Alarma\\\",\\\"payload\\\":\" + msg.payload + \"}\"};\n  node.send([null, msg]);\n}\n\n// if (msg.topic === \"google/Alarma\" || msg.topic === \"alarmaBlynk\"){\n//  if (parseInt(msg.payload) === 1 && global.get(\"estadoAlarma\") === 0){msg = {topic: \"USBout\", payload:\"{\\\"topic\\\":\\\"Alarma\\\",\\\"payload\\\": 1}\"}; return([null, msg]);}\n//  if (parseInt(msg.payload) === 0 && global.get(\"estadoAlarma\") === 1){msg = {topic: \"USBout\", payload:\"{\\\"topic\\\":\\\"Alarma\\\",\\\"payload\\\": 0}\"}; return([null, msg]);}\n  \n// }\n\nif (dato.topic === \"Alarma/Activacion\"){\n  global.set(\"estadoAlarma\", payload); \n//   msg = {topic: \"terminalBlynk\", payload: global.get(\"hsCpu\") + \", top: \" + dato.topic + \", payload:\" + msg.payload + \"\\n\"}; node.send([null, msg]);\n  msg = {topic: \"aviso/Alarma\", payload: 1}; node.send([null, msg]);\n  if (global.get(\"estadoAlarma\") === 1){\n      msg = {payload: 1, color: \"#f5d86b\", pin: 1}; node.send([msg, null]);     \n      // msg = {payload: 140, color: \"#f5d86b\", pin: 0}; node.send([null, null, msg, null, null, null]);\n    }\n    if (global.get(\"estadoAlarma\") === 0){\n      msg = {payload: 0, color: \"#23C48E\", pin: 1}; node.send([msg, null]);\n      msg = {topic: \"notifyBlynk\", payload: \"Se desactivo la alarma de casa\"}; node.send([null, msg]);\n      // msg = {payload: 128, color: \"#23C48E\", pin: 0}; node.send([null, null, msg,null, null, null]);\n      }\n}\n\nif (dato.topic === \"Alarma/Disparo\"){\n  if (payload === 1){\n    msg = {payload: 1, color: \"#cc0000\", pin: 1}; node.send([msg, null]);\n    global.set(\"disparoAlarma\", 1);\n    msg = {topic: \"notifyBlynk\", payload: \"Se disparo Alarma en casa\"};\n\n  }\n  if (payload === 0){\n    global.set(\"disparoAlarma\", 0);\n    msg = {payload: 0, color: \"#23C48E\", pin: 1}; node.send([msg, null]);   \n    // msg = {payload: 0, pin: 10}; node.send([null, null, msg, null, null, null]);\n    msg = {topic: \"notifyBlynk\", payload: \"Se normalizo Alarma en casa\"};\n  }\n  node.send([null, msg]);\n}","outputs":2,"noerr":0,"x":1697.951156616211,"y":987.7857501166208,"wires":[["d88558e1.84a5b8","5909a72.73bd158","d047b6ad.fafdf8"],["d047b6ad.fafdf8","f1758d1f.8c7e"]]},{"id":"497188c9.5cb958","type":"mqtt in","z":"3ce5b54a.127d6a","name":"","topic":"google/Alarma","qos":"2","broker":"c339edbf.39572","x":1520,"y":920,"wires":[["fc934b68.c77b08"]]},{"id":"da17eae0.10cf48","type":"function","z":"3ce5b54a.127d6a","name":"","func":"if (global.get(\"estadoAlarma\") === 1)msg = {topic: \"alarmaBlynk\", payload: 0};\nif (global.get(\"estadoAlarma\") === 0)msg = {topic: \"alarmaBlynk\", payload: 1};\n// msg = {topic: \"alarmaBlynk\", payload: msg.payload};\n\nreturn msg;","outputs":1,"noerr":0,"x":1540,"y":960,"wires":[["fc934b68.c77b08"]]},{"id":"d9a01495.b2dde8","type":"inject","z":"3ce5b54a.127d6a","name":"","topic":"","payload":"2","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1365.7144241333008,"y":608.5713939666748,"wires":[["76adfb47.e0f244"]]},{"id":"2ada1853.b0f5c8","type":"debug","z":"3ce5b54a.127d6a","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":740,"y":510,"wires":[]},{"id":"ac76f2be.6c98a","type":"debug","z":"3ce5b54a.127d6a","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":1720.5358047485352,"y":573.5715401513236,"wires":[]},{"id":"e3c140b0.d9b27","type":"inject","z":"3ce5b54a.127d6a","name":"","topic":"","payload":"[]","payloadType":"json","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":2621.130844116211,"y":101.14285727909635,"wires":[["de866222.be3ce"]]},{"id":"19fdb46e.72052c","type":"function","z":"3ce5b54a.127d6a","name":"","func":"msg = {topic: \"temp Termo\", payload: global.get(\"tempTermoFin\")}; node.send(msg);//global.set(\"tempTermoFin\"\n","outputs":1,"noerr":0,"x":2632.166603088379,"y":384.02379199436746,"wires":[["bee9f645.f336a8"]]},{"id":"a91436a6.a86a88","type":"inject","z":"3ce5b54a.127d6a","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":2412.2141761779785,"y":654.9761947904317,"wires":[["184270ba.7ac29f"]]},{"id":"3605c70e.a23568","type":"mqtt in","z":"3ce5b54a.127d6a","name":"","topic":"USBin/Baterias","qos":"2","broker":"c339edbf.39572","x":150,"y":990,"wires":[["7187c2e5.d9c10c","b50751d4.0745","52dc0931.634188"]]},{"id":"5fb8af81.f26aa","type":"mqtt in","z":"3ce5b54a.127d6a","name":"","topic":"Blynk/actualizar/estado","qos":"2","broker":"c339edbf.39572","x":1304.0243225097656,"y":496.452394757952,"wires":[["445cd48b.3633cc","ac76f2be.6c98a","d325e047.69122"]]},{"id":"2cb776c5.fc9dca","type":"delay","z":"3ce5b54a.127d6a","name":"","pauseType":"delay","timeout":"10","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1918.1667404174805,"y":223.64285346439908,"wires":[["1f81c83c.68a278"]]},{"id":"7819eea3.04131","type":"debug","z":"3ce5b54a.127d6a","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":760,"y":290,"wires":[]},{"id":"897385ea.6c2c38","type":"mqtt out","z":"3ce5b54a.127d6a","name":"","topic":"","qos":"","retain":"","broker":"c339edbf.39572","x":760,"y":170,"wires":[]},{"id":"687f4d32.c23e84","type":"mqtt in","z":"3ce5b54a.127d6a","name":"","topic":"Actualizacion/Baterias","qos":"2","broker":"c339edbf.39572","x":2403.594997406006,"y":364.0238041196553,"wires":[["f20c8fe3.a0061","3b47184b.08c028","f786c1b.12b354","4c70efb7.cbb4","19fdb46e.72052c","b91e565b.c3c818","d0611568.fb10a8","954f709c.f5b4a","5d6a27c3.aa6e28","6426f42f.2ca5bc","184270ba.7ac29f","b7217fe3.78b27","942c7922.626f58"]]},{"id":"6528d108.e3a9c","type":"function","z":"3ce5b54a.127d6a","name":"toldoBlynk","func":"msg = {topic: \"toldoBlynk\", payload: parseInt(msg.payload)};\nreturn msg;","outputs":1,"noerr":0,"x":1506.428554534912,"y":240.95246124267578,"wires":[[]]},{"id":"95935531.f40c18","type":"function","z":"3ce5b54a.127d6a","name":"Baterias y Crep","func":"  context.pruebas = context.pruebas || 0;\n  var haciendoPruebas;\n var offsetCorriente =0;\n\n  var frecuenciaDatos = 5;\n  var vEmergMax = 17;\n  var vEmergMin = 9.6;\n  // {\"topic\":\"Baterias/Est/Pedido/Resp\",\"bat1\":-127.00,\"bat2\":-127.00,\"bat3\":-127.00,\"bat4\":-127.00,\"bat5\":38.50,\"ambBat\":38.92,\"nivTanque\":0,\"volt\":3.72}\n  //{\"topic\":\"Crep\",\"payload\":1}.\n  //{\"topic\":\"Alarma/Disparo\",\"payload\":0}\n  //{\"topic\":\"{\"topic\":\"Baterias/Est/Pedido/Resp\",\"bat1\":-127.00,\"bat2\":-127.00,\"bat3\":-127.00,\"bat4\":-127.00,\"bat5\":38.50,\"ambBat\":38.92,\"nivTanque\":0,\"volt\":3.72}\n  //{\"topic\":\"Crep\",\"payload\":1}.\n  //{\"topic\":\"Alarma/Disparo\",\"payload\":0}\n  //{\"topic\":\"Toldo\",\"payload\":0}\n  //{\"topic\":\"Alarma/Activacion\",\"payload\":1}\n  // salida 1 serial\n  // salida 2 blynk  pin = 0 notificaciones  --  pin 1= led alarma  --  pin2= boton alarma  --  pin3= linea 1 LCD -- pin4= linea 2 LCD\n  // salida 3 mysql\n  var dato = JSON.parse(msg.payload);\n  context.inicioCrep = context.inicioCrep || 0;\n  context.inicioCargador = context.inicioCargador || 0;\n\n  var difTempEmergencia = 25;\n  var avisoBat = [];\n  var date = new Date();\n  var hh = date.getHours(); \n  var mm = date.getMinutes(); \n  var ss = date.getSeconds(); \n  var dia = date.getDate(); \n  var mes = date.getMonth()+1; global.set(\"mes\", mes);\n  var ano = date.getFullYear();\n  global.set(\"fechaDia\", date.getDay());\n\n  if (hh < 10)(hh = \"0\" + hh); if (mm < 10)(mm = \"0\" + mm); if (ss < 10)(ss = \"0\" + ss);\n  global.set(\"hh\", hh); global.set(\"mm\", mm); global.set(\"ss\", ss);\n\n  global.set(\"fechaCompleta\", hh + \":\" + mm + \":\" + ss + \" - \" + dia + \"/\" + mes + \"/\" + ano);\n  context.hsAnterior = context.hsAnterior || 0;\n  context.enviado = context.enviado || 0;\n\n  context.Voltaje = context.Voltaje || null;\n  context.Bat1 = context.Bat1 || null;\n  context.Bat2 = context.Bat2 || null;\n  context.Bat3 = context.Bat3 || null;\n  context.Bat4 = context.Bat4 || null;\n  context.Bat5 = context.Bat5 || null;\n  context.Bat6 = context.Bat6 || null;\n  context.tempAmbienteBat = context.tempAmbienteBat || null;\n  context.nivelTanque = context.nivelTanque || null;\n  context.contador = context.contador ||0;\n  context.avisoMail = context.avisoMail ||0;\n  context.avisoTanque = context.avisoTanque ||0;\n  context.minAnt = context.minAnt || 0;\n  context.mesAnt = context.mesAnt || mes - 1;\n  context.diaAnt = context.diaAnt || dia;\n  context.estadoCargador = context.estadoCargador || 0;\n  context.cargarToldo = context.cargarToldo || 0;\n  context.tiempoCarga = context.tiempoCarga || 0;\n\n  var dateCel = new Date(date.getTime() + 960000); \n  var hhCel = dateCel.getHours(); \n  var mmCel = dateCel.getMinutes();\n  var ssCel = dateCel.getSeconds();\n\n  global.set(\"hsCpu\", hh + \":\" + mm + \":\" + ss);\n  if (hhCel < 10)(hhCel = \"0\" + hhCel); if (mmCel < 10)(mmCel = \"0\" + mmCel); if (ssCel < 10)(ssCel = \"0\" + ssCel);\n  global.set(\"hsCel\", hhCel + \":\" + mmCel + \":\" + ssCel);\n\n  var tiempo = mm % frecuenciaDatos;\n  node.status({text: hh + \":\" + mm + \":\" + ss + \"   \"  + hhCel + \":\" + mmCel + \":\" + ss + \" || \" + context.mesAnt  + \" || \" + mes  + \" || \" +  context.avisoMail});\n\n  if (dato.topic === \"Alarma\"){\n    msg = {topic: \"USBout\", payload: \"{\\\"topic\\\":\\\"Alarma\\\",\\\"payload\\\":\" + dato.payload + \"\\\"}\"}; \n    node.send([msg, null, null, null])}\n\n  if (msg.topic === \"mandarMail\")mandarBackUpMail();\n\n  if (ss === 2){\n    if (context.mesAnt !== mes && hh === 0 && mm === 0  && context.avisoMail === 0){mandarBackUpMail(); context.mesAnt = mes;}\n  }else{context.avisoMail = 0;}\n\n\n  // if (parseInt(ss) === 0){\n  //  // msg = {pin: 6, payload: global.get(\"hsCel\")}; node.send(msg);\n  //  // global.set(\"hsGlobal\", hh + \":\" + mm);\n  //  // if (context.minAnt !== mm){\n  //  //  context.minAnt = mm;\n  //  //  msg = {topic: \"Blynk/actualizar/estado\", payload: 1}; \n  //  //  actualizarEstado();\n  //  // }  avio\n  //  if (parseInt(tiempo) === 0 && context.enviado === 0){\n  //    msg = {topic: \"USBout\", payload: \"{\\\"topic\\\":\\\"Baterias/Est/Pedido\\\",\\\"payload\\\":1}\"}; \n  //    node.send([msg, null, null, null]); \n  //    context.enviado = 1;}\n  //    // return;}\n  // }\n  // else{\n  //  context.enviado = 0;\n  // }\n\n  // if (msg.topic === \"consultaCrep\"){msg = {topic : \"SELECT * FROM crepuscular ORDER BY hora Asc\"}; return ([null, null, msg, null]);}\n  // if (msg.topic === \"borrarCrep\"){msg = {topic : \"DELETE FROM `crepuscular` WHERE 1\"}; return ([null, null, msg, null]);}\n\n  if (msg.topic === \"alarmaBlynk\"){\n    msg = {topic: \"USBout\", payload: \"{\\\"topic\\\":\\\"Alarma\\\",\\\"payload\\\":\" + msg.payload + \"}\"};\n    node.send([msg, null, null, null]);\n  }\n\n  if (dato.topic === \"Baterias/Est/Pedido/Resp\"){\n    context.contador++; \n    global.set(\"tempBat1\", dato.bat1.toFixed(1)); //context.Bat1 += dato.bat1; if (global.get(\"tempBat1\") > difTempEmergencia + dato.tempAmb){avisoBat[1] = 1; avisoBaterias(1);}\n    global.set(\"tempBat2\", dato.bat2.toFixed(1)*2); //context.Bat2 += dato.bat2; if (global.get(\"tempBat2\") > difTempEmergencia + dato.tempAmb){avisoBat[2] = 1; avisoBaterias(2);}\n    // global.set(\"tempBat3\", dato.bat3.toFixed(1)); context.Bat3 += dato.bat3; if (global.get(\"tempBat3\") > difTempEmergencia + dato.tempAmb){avisoBat[3] = 1; avisoBaterias(3);}\n    // global.set(\"tempBat4\", dato.bat4.toFixed(1)); context.Bat4 += dato.bat4; if (global.get(\"tempBat4\") > difTempEmergencia + dato.tempAmb){avisoBat[4] = 1; avisoBaterias(4);}\n    // global.set(\"tempBat5\", dato.bat5.toFixed(1)); context.Bat5 += dato.bat5; if (global.get(\"tempBat5\") > difTempEmergencia + dato.tempAmb){avisoBat[5] = 1; avisoBaterias(5);}\n    global.set(\"tempAmbienteBat\", dato.ambBat.toFixed(1)); //context.tempAmbienteBat += dato.ambBat; \n    node.status({text: global.get(\"tempAmbienteBat\")});\n    // global.set(\"voltajeBaterias\", dato.volt.toFixed(2)); context.Voltaje += dato.volt;// controlarVoltaje(global.get(\"voltajeBaterias\")); \n    // var corrienteCarga = parseFloat(dato.corriente) - offsetCorriente;\n    // global.set(\"corrienteCarga\", corrienteCarga.toFixed(2));\n\n    // if (global.get(\"voltajeBaterias\") > vEmergMax) {avisoBat[6] = 1; avisoBaterias(6);}  \n    // if (global.get(\"voltajeBaterias\") < vEmergMin) { avisoBat[6] = 1; avisoBaterias(6);}\n    actualizarEstado();\n    // mostrarLcd();\n\n    // if (context.contador === 6){\n    //   var mysql = \"INSERT INTO \\`Baterias\\`(\\`Fecha\\`, \\`Voltaje\\`, \\`tempBat1\\`, \\`tempBat2\\`, \\`tempBat3\\`, \\`tempBat4\\`, \\`tempBat5\\`, \\`tempBat6\\`, \\`tempAmbienteBaterias\\`)\"; \n    //   mysql += \"VALUES (now() ,\" + context.Voltaje / context.contador + \",\" + context.Bat1 / context.contador + \",\" + context.Bat2 / context.contador + \",\";\n    //   mysql += context.Bat3 / context.contador + \",\" + context.Bat4 / context.contador + \",\";\n    //   mysql += context.Bat5 / context.contador + \", \" + context.Bat6 / context.contador + \", \";\n    //   mysql += context.tempAmbienteBat / context.contador + \")\";\n    //   msg.topic = mysql;\n    //   node.send([ null, null, msg, null]);\n    //   context.Voltaje = 0; context.Bat1 = 0; context.Bat2 = 0; context.Bat3 = 0; context.Bat4 = 0; context.Bat5 = 0;\n    //   context.tempAmbienteBat = 0; context.nivTanque = 0; context.contador = 0;\n    // }\n    msg = {topic: \"Actualizacion/Baterias\", payload:\"\"}; node.send([msg, null, null, null]);\n  }\n\n  if (dato.topic === \"Cargador\"){\n    global.set(\"estadoCargador\", dato.payload);\n    global.set(\"voltajeBaterias\", parseFloat(dato.volt).toFixed(2));\n    var corrienteCarga = parseFloat(dato.corriente) - offsetCorriente;\n    global.set(\"corrienteCarga\", parseFloat(corrienteCarga).toFixed(2));\n\n    if (global.get(\"voltajeBaterias\") > vEmergMax) {avisoBat[6] = 1; avisoBaterias(6);} \n    if (global.get(\"voltajeBaterias\") < vEmergMin) { avisoBat[6] = 1; avisoBaterias(6);}  \n    \n    if (parseInt(dato.payload) === 1 && context.estadoCargador === 0) {\n      context.estadoCargador = 1;\n      var date1 = new Date(date.getTime() - context.tiempoCarga); \n      global.set(\"tiempoEspera\", (date.getTime() - context.tiempoCarga)/(60*1000));\n      msg = {topic: \"provisoriosMQTT\", payload: \"tiempo espera: \" + global.get(\"tiempoEspera\")}; node.send(msg);\n      // if (context.inicioCargador === 1)global.set(\"tiempoEspera\", (date.getTime() - context.tiempoCarga)/(60*1000));\n      // if (context.inicioCargador === 0)context.inicioCargador = 1;\n\n      var minCarg = date1.getMinutes(); var segCarg = date1.getSeconds();\n      if (minCarg < 10)(minCarg = \"0\" + minCarg); if (segCarg < 10)(segCarg = \"0\" + segCarg);\n      var mostrarTiempoCarga = minCarg + \":\" + segCarg; \n      context.tiempoCarga = date.getTime();\n\n      msg = {topic: \"estadoFallas\", payload: 1}; node.send(msg);\n      // msg = {topic: \"notifyBlynk\", payload: \"Iniciando carga baterias (tiempo espera= \" + mostrarTiempoCarga + \")\"}; node.send(msg); \n\n      global.set(\"estadocargadorTexto\", \"cargando desde \" + dia + \"/\" + (mes+1) + \"/\" + ano + \" \" + hh + \":\" + mm + \":\" + ss);}\n\n    if (parseInt(dato.payload) === 0 && context.estadoCargador === 1) {\n      context.estadoCargador = 0;\n      var date1 = new Date(date.getTime() - context.tiempoCarga); \n      global.set(\"tiempoCargando\", (date.getTime() - context.tiempoCarga)/(60*1000));\n      msg = {topic: \"provisoriosMQTT\", payload: \"tiempo cargand: \" + global.get(\"tiempoCargando\")}; node.send(msg);\n      \n      // if (context.inicioCargador === 1)global.set(\"tiempoCargando\", (date.getTime() - context.tiempoCarga)/(60*1000));\n      // if (context.inicioCargador === 0)context.inicioCargador = 1;\n\n      var minCarg = date1.getMinutes(); var segCarg = date1.getSeconds();\n      if (minCarg < 10)(minCarg = \"0\" + minCarg); if (segCarg < 10)(segCarg = \"0\" + segCarg);\n      var mostrarTiempoCarga = minCarg + \":\" + segCarg; \n      context.tiempoCarga = date.getTime();\n      msg = {topic: \"estadoFallas\", payload: 1}; node.send(msg);\n      // msg = {topic: \"notifyBlynk\", payload: \"Terminando carga baterias (tiempo cargando= \" + mostrarTiempoCarga + \")\"}; node.send(msg);\n\n      global.set(\"estadocargadorTexto\", \"OK desde \" + dia + \"/\" + (mes+1) + \"/\" + ano + \" \" + hh + \":\" + mm + \":\" + ss);\n    }\n    msg = {topic: \"Blynk/actualizar/estado\", payload: \"\"}; node.send([msg, null, null, null, null]);\n  }\n\n  function avisoBaterias(numBat){\n    if (numBat > 0 && numBat <= 5){\n      msg = {topic: \"notifyBlynk\", payload: \"Atencion baterias numero: \" + numBat + \" sobrecalentada\"};//, pin: 0};\n      node.send([msg, null, null, null]);\n    }\n    if (numBat === 6){\n      msg = {topic: \"notifyBlynk\", payload: \"Atencion voltaje de baterias fuera de rango, voltaje: \" + dato.volt + \"V\"};//, pin: 0};\n      node.send([msg, null, null, null]);\n    }\n  }\n\n  function mandarBackUpMail(){\n    var nombre = mes + \"_\" + ano;\n    var directorio = \"/home/gaston/BackUp-Node-Red/\";\n    msg = {topic : \"SELECT * FROM crepuscular ORDER BY hora Asc\"};\n    node.send([null, null, msg, null]);\n    msg = {topic : \"SELECT \\\"hora\\\", \\\"valor\\\" UNION  SELECT \\`hora\\`, \\`valor\\` INTO OUTFILE \\'\" + directorio + nombre + \".csv\\' FIELDS TERMINATED BY \\';\\' OPTIONALLY ENCLOSED BY '\\\"' LINES TERMINATED BY '\\r\\n' FROM \\`crepuscular\\`\"};\n    node.send([null, null, msg, null]);\n    msg = {topic : \"DELETE FROM \\`crepuscular\\` WHERE 1\"};\n    node.send([null, null, msg, null]);\n\n    msg.topic = \"BackUp crepuscular\";\n    msg.payload = \"BackUp crepuscular\";\n    msg.attachments = [{\n        filename: nombre + '.csv',\n        path: directorio + nombre + '.csv',\n        content: msg.payload\n    }];\n    node.send([null, null, null, msg]);\n    context.avisoMail = 1;\n  }\n\n  function actualizarEstado(){\n    if (global.get(\"estadoToldo\") !== \"Abriendo\" && global.get(\"estadoToldo\") !== \"Cerrando\"){\n      msg = {topic: \"Blynk/actualizar/estado\", payload: 1};\n      node.send([msg, null, null, null, null]);}  \n  }\n  //Serial.println(alturaTanque - valorAcumulado);\n  // alturaAgua = alturaAgua + (alturaTanque - valorAcumulado);//Serial.println(alturaTanque - valorAcumulado);","outputs":4,"noerr":0,"x":510,"y":270,"wires":[["897385ea.6c2c38","4a5f13c4.c6331c"],[],[],["f07145ce.8d14a8","7819eea3.04131"]]},{"id":"d325e047.69122","type":"debug","z":"3ce5b54a.127d6a","name":"salida2 lcd blynk","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":1611.809455871582,"y":531.3929204940796,"wires":[]},{"id":"b7217fe3.78b27","type":"function","z":"3ce5b54a.127d6a","name":"","func":"msg = {topic: \"nivTanque\", payload: global.get(\"nivTanque\")}; node.send(msg);\nreturn;","outputs":1,"noerr":0,"x":2621.1310119628906,"y":177.035699571882,"wires":[["de866222.be3ce"]]},{"id":"d0611568.fb10a8","type":"function","z":"3ce5b54a.127d6a","name":"","func":"msg = {topic: \"tempBat6\", payload: global.get(\"tempBat6\")}; node.send(msg);\n","outputs":1,"noerr":0,"x":2632.166603088379,"y":468.30952807835183,"wires":[[]]},{"id":"5d6a27c3.aa6e28","type":"function","z":"3ce5b54a.127d6a","name":"","func":"msg = {topic: \"voltajeBaterias\", payload: global.get(\"voltajeBaterias\")}; node.send(msg);","outputs":1,"noerr":0,"x":2637.880958557129,"y":549.7381147657125,"wires":[["c50fec05.b4a01"]]},{"id":"2e048c0e.d58a74","type":"debug","z":"3ce5b54a.127d6a","name":"USB/Alarma","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":1700,"y":1020,"wires":[]},{"id":"6426f42f.2ca5bc","type":"function","z":"3ce5b54a.127d6a","name":"","func":"msg = {topic: \"nivTanque\", payload: global.get(\"nivTanque\")}; node.send(msg);","outputs":1,"noerr":0,"x":2636.4999389648438,"y":602.119038990566,"wires":[["649cd037.becf5"]]},{"id":"6547685f.652378","type":"mqtt in","z":"3ce5b54a.127d6a","name":"","topic":"USBin/Toldo","qos":"2","broker":"c339edbf.39572","x":1486.095043182373,"y":200.42863273620605,"wires":[[]]},{"id":"445cd48b.3633cc","type":"function","z":"3ce5b54a.127d6a","name":"LCD Blynk","func":"var velocidadTexto = 191;\nvar velocidadTexto1 = 140;\nvar payload = msg.payload;\nvar largo;\nvar estadoCarg;\nvar cont = -1;\nvar timer1;\nvar timer2;\nvar timer3;\nvar Baterias;\nvar Toldo;\nvar datosTemp;\nvar crepuscular;\nvar tempMaxMinAyer;\nvar tempMaxMinHoy;\n\nif (global.get (\"estadoCargador\") === 1) {estadoCarg = \"V Carg\";} else {estadoCarg = \"V OK\";}\n\nBaterias = global.get(\"estadocargadorTexto\") + \"   Volt=\" + global.get(\"voltajeBaterias\");// + estadoCarg + \" Tanque=\" + global.get(\"nivTanque\") + \"mm\" + \" Temp. Alt=\" + global.get(\"tempAmbienteBat\"); \n// Baterias += \" Bat1=\" + global.get(\"tempBat1\") + \" Bat2=\" + global.get(\"tempBat2\") + \" Bat3=\" + global.get(\"tempBat3\");\n// Baterias +=  \" Bat4=\" + global.get(\"tempBat4\") + \" Bat5=\" + global.get(\"tempBat5\");\n\n\nToldo = \"   \" + global.get(\"estadoToldoLCD\") + \", \" + global.get(\"enfriadorToldo\");// + global.get(\"enfriadorToldo\");\nif (global.get(\"enfriarToldo\") === 1){Toldo = Toldo + \", \" + global.get(\"rociadorToldo\");}\n\ndatosTemp = \"   Living=\" + parseFloat(global.get(\"tempLiving\")).toFixed(1) + \" Hum. Living=\" + parseFloat(global.get(\"humLiving\")).toFixed(1);\ndatosTemp += \"% Pasillo=\" + parseFloat(global.get(\"tempPasillo\")).toFixed(1) + \" PatioLuz=\" + parseFloat(global.get(\"tempPatioLuz\")).toFixed(1);\ndatosTemp += \" Exterior=\" + parseFloat(global.get(\"tempExterior\")).toFixed(1);\ndatosTemp +=\" Lavadero=\" + parseFloat(global.get(\"tempLavadero\")).toFixed(1) + \" Tanque=\" + global.get(\"nivTanque\") + \"mm\";\n\ntempMaxMinAyer = \"   Min ayer \" + global.get(\"tempMinExtAnt\") + \", Max ayer \" + global.get(\"tempMaxExtAnt\");\n \ntempMaxMinHoy =  \"   Min hoy \" + global.get(\"tempMinExt\") + \", Max hoy \" + global.get(\"tempMaxExt\") + \", actual \" + global.get(\"tempExterior\");\n\nif (global.get(\"Dia\") === 0){\n\tcrepuscular = \"   Oscurecio a las \" + global.get(\"hsAnochecer\") +  \", Amanecio a las \" + global.get(\"hsAmanecer\") + \", sensorCrep \" + global.get(\"sensorCrep\");}\n\telse{\n\tcrepuscular = \"   Amanecio a las \" + global.get(\"hsAmanecer\") + \", Oscurecio a las \" + global.get(\"hsAnochecer\") + \", sensorCrep \" + global.get(\"sensorCrep\");}\n\n\n\nmsg.payload = Baterias; node.send([null,msg]);\nmsg.payload = datosTemp; node.send([null,msg]);\nmsg.payload = Toldo; node.send([null,msg]);\nmsg.payload = crepuscular; node.send([null,msg]);\nmsg.payload = tempMaxMinAyer; node.send([null,msg]);\nmsg.payload = tempMaxMinHoy; node.send([null,msg]);\n\ncontext.mostrando = context.mostrando || 0;\ncontext.pedido = context.pedido || 0;\n\n\n// var largoTemperaturas = Temperaturas.length;\nvar largoBaterias = Baterias.length;\nvar largoToldo = Toldo.length;\nvar largoDatosTemp = datosTemp.length;\nvar largoCrepuscular = crepuscular.length;\nvar largotempMaxMinAyer = tempMaxMinAyer.length;\nvar largotempMaxMinHoy = tempMaxMinHoy.length;\n// node.status({text: context.mostrando});\nif (context.mostrando === 1)return;\n\n// if (msg.topic === \"pedidoActualizacion\")payload = context.pedido;\n\nif (msg.topic === \"Blynk/actualizar/estado\")actualizarEstado();\nif (global.get(\"estadoToldo\") !== \"Abriendo\" || global.get(\"estadoToldo\") !== \"Cerrando\"){\n\tif (payload === \"2\") velocidadTexto = velocidadTexto1;\n\tif (msg.topic === \"Blynk/actualizar/infos\"){\n\t\tpayload = context.pedido; \n\t\t// if (payload === \"1\") velocidadTexto = 190;\n\t\ttimer1 = setInterval(infoCompleta, velocidadTexto1);}\n\t\t\t\t\t//timer2 = setInterval(mostrarDatosTemp, velocidadTexto2);\n\tif (msg.topic === \"Blynk/mostrar/infos\")timer1 = setInterval(infoCompleta, velocidadTexto);\n\t// if (msg.topic === \"Blynk\")var timer1 = setInterval(datosTemp, velocidadTexto2);\n}\n\nreturn;\nfunction infoCompleta(){\n\tcontext.mostrando = 1;\n\tcont++;\n\tswitch (parseInt(payload)){\n\t\tcase 1:\n\t\t\tcontext.pedido = \"1\";\n\t\t\tlargo = largoDatosTemp;\n\t\t\tmsg = {pin: 4, payload: \" Temp Ambientes \"}; node.send(msg);\n\t\t\tif (cont < largoDatosTemp-15){msg = {pin: 5, payload: datosTemp.substring(cont)}; node.send(msg);}\n\t\tbreak;\n\n\t\tcase 2:\n\t\t\tcontext.pedido = \"2\";\n\t\t\tlargo = largoBaterias;\n\t\t\tmsg = {pin: 4, payload: \"Info de Baterias\"}; node.send(msg);\n\t\t\tif (cont < largoBaterias-15){msg = {pin: 5, payload: Baterias.substring(cont)}; node.send(msg);}\n\t\tbreak;\n\n\t\tcase 3:\n\t\t\tcontext.pedido = \"3\";\n\t\t\tlargo = largoToldo;\n\t\t\tmsg = {pin: 4, payload: \" Info del Toldo \"}; node.send(msg);\n\t\t\tif (cont < largoToldo-15){msg = {pin: 5, payload: Toldo.substring(cont)}; node.send(msg);}\n\t\tbreak;\n\t\tcase 4:\n\t\t\tcontext.pedido = \"4\";\n\t\t\tlargo = largoCrepuscular;\n\t\t\tmsg = {pin: 4, payload: \"Info crepuscular\"}; node.send(msg);\n\t\t\tif (cont < largoCrepuscular-15){msg = {pin: 5, payload: crepuscular.substring(cont)}; node.send(msg);}\n\t\tbreak;\t\n\t\tcase 5:\n\t\t\tcontext.pedido = \"5\";\n\t\t\tlargo = largotempMaxMinAyer;\n\t\t\tmsg = {pin: 4, payload: \"  Temp Max/Min  \"}; node.send(msg);\n\t\t\tif (cont < largotempMaxMinAyer-15){msg = {pin: 5, payload: tempMaxMinAyer.substring(cont)}; node.send(msg);}\n\t\tbreak;\n\t\tcase 6:\n\t\t\tcontext.pedido = \"6\";\n\t\t\tlargo = largotempMaxMinHoy;\n\t\t\tmsg = {pin: 4, payload: \"  Temp Max/Min  \"}; node.send(msg);\n\t\t\tif (cont < largotempMaxMinHoy-15){msg = {pin: 5, payload: tempMaxMinHoy.substring(cont)}; node.send(msg);}\n\t\tbreak;\t\t\n\t}\n\tif (cont > largo-16){clearInterval(timer1); timer3 = setInterval(pantallaPrincipal, 1000);}\n}\n\n// function mostrarDatosTemp(){\n// \tcontext.mostrando = 1;\n// \t// cont++;\n// \tlargo = largoDatosTemp;\n// \tmsg = {pin: 4, payload: \" Temp Ambientes \"}; node.send(msg);\n// \tif (cont < largoDatosTemp-15){msg = {pin: 5, payload: datosTemp.substring(cont)}; node.send(msg);}\n// \tif (cont > largo-16){clearInterval(timer2); timer3 = setInterval(pantallaPrincipal, 1000);}\n// }\n\nfunction pantallaPrincipal(){\n\tcontext.mostrando = 0;\n\tactualizarEstado();\n\tclearInterval(timer3);\t\t\n}\n\nfunction actualizarEstado(){\n\tnode.status({text: global.get(\"hsCel\")}); \n\t// msg = {pin: 6, payload: global.get(\"hsCel\")}; node.send(msg);\n\tif (global.get(\"estadoToldo\") !== \"Abriendo\" || global.get(\"estadoToldo\") !== \"Cerrando\"){\n\t\tif (global.get(\"estadoCargador\") == \"1\"){msg = {pin: 15, label: \"Estado Baterias: Cargando\", color: \"#fcaf17\", payload: parseFloat(global.get(\"voltajeBaterias\")).toFixed(2) + \"v  \" + global.get(\"corrienteCarga\") + \"A  \" + parseFloat((global.get(\"voltajeBaterias\") * global.get(\"corrienteCarga\"))/1000).toFixed(2) + \"Kw\"}; node.send(msg);}\n\t\tif (global.get(\"estadoCargador\") == \"0\"){msg = {pin: 15, label: \"Estado Baterias: Cargada\", color: \"#23C48E\", payload: parseFloat(global.get(\"voltajeBaterias\")).toFixed(2) + \"v    \" + global.get(\"corrienteCarga\") + \"A\"}; node.send(msg);}\t\t\n\t\tmsg = {pin: 4, payload: \"Temp= \" + global.get(\"tempExterior\")}; node.send(msg);\n\t\tmsg = {pin: 5, payload: \"Tq= \" + global.get(\"nivTanque\") + \"mm T=\" + global.get(\"tempPatioLuz\")}; node.send(msg);\n\t}\nreturn;}\n\n\n//temp= 21.5  ll55\n//Mi=10.5  Ma=21.5\n//Act=15.2 Tq=365mm","outputs":2,"noerr":0,"x":1755.5752067565918,"y":676.3690500259399,"wires":[["57b149bd.b8d058","4b014358.da11bc","1fa1bbd5.dc54e4"],["cf18dea9.b1f6d"]]},{"id":"91d5660a.0f6e38","type":"inject","z":"3ce5b54a.127d6a","name":"","topic":"","payload":"","payloadType":"str","repeat":"1","crontab":"","once":false,"onceDelay":0.1,"x":1362.2261047363281,"y":538.0596344811576,"wires":[["c3665e22.cefcc"]]},{"id":"b0f045e1.47c488","type":"mqtt in","z":"3ce5b54a.127d6a","name":"","topic":"USBout","qos":"2","broker":"c339edbf.39572","x":420,"y":640,"wires":[["35c86102.3c4c2e","1e430824.b490a8"]]},{"id":"f47b95aa.c8d258","type":"inject","z":"3ce5b54a.127d6a","name":"pulso","topic":"","payload":"","payloadType":"date","repeat":"1","crontab":"","once":true,"onceDelay":"2","x":1501.4284477233887,"y":118.71432304382324,"wires":[[]]},{"id":"184270ba.7ac29f","type":"function","z":"3ce5b54a.127d6a","name":"","func":"msg.payload = global.get(\"estadocargadorTexto\");\nreturn msg;","outputs":1,"noerr":0,"x":2639.8331909179688,"y":653.7856649671285,"wires":[["a0fdce3d.0029a"]]},{"id":"f1758d1f.8c7e","type":"mqtt out","z":"3ce5b54a.127d6a","name":"","topic":"","qos":"","retain":"","broker":"c339edbf.39572","x":1905.0942497253418,"y":1026.3571545737132,"wires":[]},{"id":"4c70efb7.cbb4","type":"function","z":"3ce5b54a.127d6a","name":"","func":"msg = {topic: \"tempBat2\", payload: global.get(\"tempBat2\")}; node.send(msg);\n","outputs":1,"noerr":0,"x":2629.3095474243164,"y":298.3094975607736,"wires":[["d4a94829.9d2278"]]},{"id":"be210406.8a4f68","type":"inject","z":"3ce5b54a.127d6a","name":"","topic":"","payload":"1","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1351.0951347351074,"y":380.85718154907227,"wires":[["6528d108.e3a9c"]]},{"id":"b5035f2.f7fe4a","type":"mqtt in","z":"3ce5b54a.127d6a","name":"","topic":"USBin/Alarma","qos":"2","broker":"c339edbf.39572","x":1520,"y":1000,"wires":[["fc934b68.c77b08","2e048c0e.d58a74"]]},{"id":"35c86102.3c4c2e","type":"debug","z":"3ce5b54a.127d6a","name":"Serial out","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":590,"y":620,"wires":[]},{"id":"36ea0611.adb13a","type":"inject","z":"3ce5b54a.127d6a","name":"pulso","topic":"","payload":"","payloadType":"date","repeat":"1","crontab":"","once":false,"onceDelay":0.1,"x":322.6429634094238,"y":330.2738253729684,"wires":[["95935531.f40c18","9fdf6dbc.c9208"]]},{"id":"7187c2e5.d9c10c","type":"delay","z":"3ce5b54a.127d6a","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":360,"y":950,"wires":[["aad338fd.eb88b8","bcf69a76.207f48"]]},{"id":"c45d2106.9d2f9","type":"exec","z":"3ce5b54a.127d6a","command":"cat /sys/class/thermal/thermal_zone0/temp ","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":true,"name":"tempCPU","x":350,"y":1050,"wires":[["ceaa70f7.12e92","b5334e08.2a0aa"],[],[]]},{"id":"ceaa70f7.12e92","type":"function","z":"3ce5b54a.127d6a","name":"","func":"var temp = msg.payload;\ncontext.temp = context.temp || 0;\ncontext.cont = context.cont || 0;\n\n// temp = temp.substring(temp.indexOf(\"temp\")+5);\n// temp = temp.substring(0, temp.indexOf(\"''\"));\n// temp = parseFloat(temp).toFixed(1);\ntemp = parseFloat(msg.payload / 1000).toFixed(1);\n// node.status({text: temp});\ncontext.cont++;\ncontext.temp = parseFloat(temp) + parseFloat(context.temp);\nvar dato = parseFloat(context.temp / context.cont).toFixed(1);\n// var dato = context.temp / context.cont;\nnode.status({text: \"cont: \" + context.cont + \"  temp: \"+ temp + \"  tempAc: \"+ context.temp});\n\nif (context.cont >= 10){\n    global.set(\"tempCPU\", context.temp / context.cont);\n    node.status({text: \"cont: \" + context.cont + \"  temp: \" + global.get(\"tempCPU\")});    \n    node.status({text: \"Temp CPU: \" + global.get(\"tempCPU\")});\n    context.cont = 0;\n    context.temp = 0;\n    if (global.get(\"tempCPU\") > 80){\n        msg = {topic: \"notifyBlynk\", payload: \"Atencion, Servidor muy caliente\"};\n        node.send(msg);\n    }    \n}\n\n","outputs":1,"noerr":0,"x":591.111156463623,"y":1070.0000162124634,"wires":[["857b8d95.75481"]]},{"id":"81acbb17.363298","type":"inject","z":"3ce5b54a.127d6a","name":"","topic":"Baterias/Est/Pedido/Resp","payload":"","payloadType":"date","repeat":"30","crontab":"","once":true,"onceDelay":0.1,"x":180,"y":1050,"wires":[["c45d2106.9d2f9"]]},{"id":"857b8d95.75481","type":"mqtt out","z":"3ce5b54a.127d6a","name":"","topic":"","qos":"","retain":"","broker":"e779f8d6.7bc2c8","x":854.444450378418,"y":1063.3333625793457,"wires":[]},{"id":"942c7922.626f58","type":"function","z":"3ce5b54a.127d6a","name":"","func":"msg.payload = global.get(\"tempCPU\");\nreturn msg;","outputs":1,"noerr":0,"x":2640,"y":700,"wires":[["2d31d0b7.e3314"]]},{"id":"fef811df.60e3b","type":"inject","z":"3ce5b54a.127d6a","name":"","topic":"","payload":"","payloadType":"date","repeat":"5","crontab":"","once":true,"onceDelay":"1","x":2430,"y":700,"wires":[["942c7922.626f58"]]},{"id":"c3639553.ac2e58","type":"mqtt in","z":"3ce5b54a.127d6a","name":"","topic":"USBin/Baterias","qos":"2","broker":"c339edbf.39572","x":520,"y":460,"wires":[["faf5118e.e222e"]]},{"id":"faf5118e.e222e","type":"function","z":"3ce5b54a.127d6a","name":"","func":"var dato = JSON.parse(msg.payload);\nif (dato.topic === \"Cargador\")return msg;","outputs":1,"noerr":0,"x":670,"y":460,"wires":[["bef7330f.045f1"]]},{"id":"bef7330f.045f1","type":"debug","z":"3ce5b54a.127d6a","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":810,"y":460,"wires":[]},{"id":"9b78adbf.59e17","type":"inject","z":"3ce5b54a.127d6a","name":"","topic":"","payload":"32","payloadType":"num","repeat":"","crontab":"","once":true,"onceDelay":0.1,"x":360,"y":130,"wires":[["e85d0b9b.bcb288"]]},{"id":"e85d0b9b.bcb288","type":"function","z":"3ce5b54a.127d6a","name":"pwmPatioLuz","func":"global.set(\"pwmPatioLuz\", msg.payload)\nnode.status({text: global.get(\"pwmPatioLuz\")})","outputs":1,"noerr":0,"x":540,"y":130,"wires":[[]]},{"id":"d02f7746.45a218","type":"mqtt out","z":"3ce5b54a.127d6a","name":"","topic":"","qos":"","retain":"","broker":"c339edbf.39572","x":1884.166919708252,"y":132.7857052939279,"wires":[]},{"id":"b5b0d51b.cfbab8","type":"inject","z":"3ce5b54a.127d6a","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1360,"y":920,"wires":[["da17eae0.10cf48"]]},{"id":"d6e38d2.d5e297","type":"inject","z":"3ce5b54a.127d6a","name":"","topic":"","payload":"inicio","payloadType":"str","repeat":"","crontab":"","once":true,"onceDelay":"5","x":1710,"y":880,"wires":[["f8b20280.e0b44"]]},{"id":"f8b20280.e0b44","type":"function","z":"3ce5b54a.127d6a","name":"","func":"if (global.get(\"estadoAlarma\") === undefined)global.set(\"estadoAlarma\", 0);","outputs":1,"noerr":0,"x":1840,"y":880,"wires":[[]]},{"id":"4b014358.da11bc","type":"delay","z":"3ce5b54a.127d6a","name":"100mS","pauseType":"delay","timeout":"100","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1941.3927841186523,"y":635.9643287658691,"wires":[["e7f57541.097388"]]},{"id":"a0acd491.b98338","type":"mqtt in","z":"3ce5b54a.127d6a","name":"","topic":"informarNivel","qos":"2","broker":"e779f8d6.7bc2c8","x":322.00000762939453,"y":879.4167108535767,"wires":[["99ff2535.0c1838"]]},{"id":"99ff2535.0c1838","type":"function","z":"3ce5b54a.127d6a","name":"","func":"msg= {topic: \"nivTanque\", payload: global.get(\"nivTanque\")}; node.send(msg);\nmsg= {topic: \"tasaLlenado\", payload: parseFloat(global.get(\"tasaLlenadoTanque\")).toFixed(2)};\nif (parseInt(global.get(\"llenarTanque\")) === 1){\n    node.send(msg);\n    msg = {pin: 33, payload: global.get(\"nivTanque\")}; node.send([null, msg]);\n    msg = {pin: 22, payload: global.get(\"nivTanque\")}; node.send([null, msg]);\n    \n}\nif (parseInt(global.get(\"llenarTanque\")) === 0)global.set(\"tasaLlenadoTanque\", 0);\n\n\n\n","outputs":2,"noerr":0,"x":552.2222518920898,"y":888.8888626098633,"wires":[["490a73a0.04a99c","c0d2001d.8e91b"],["577fff27.098f7"]]},{"id":"6cc0d0ab.b9ba3","type":"function","z":"3ce5b54a.127d6a","name":"","func":"// var dato = JSON.parse(msg.payload);\n// if (dato.topic == \"Baterias/Est/Pedido/Resp\" || msg.topic == \"ESP/Pasillo/Sens/Temp/Pedido\"){\n    msg= {topic: \"tempAmbiente\", payload: global.get(\"tempAmbienteBat\")}; node.send(msg);\n    // node.status ({text: global.get(\"tempAmbienteBat\")});\n    msg= {topic: \"tempBat1\", payload: global.get(\"tempBat1\")}; node.send(msg);\n    msg= {topic: \"tempBat2\", payload: global.get(\"tempBat2\")}; node.send(msg);    \n    msg= {topic: \"tempCPU\", payload: global.get(\"tempCPU\")}; node.send(msg);\n    \n// }","outputs":1,"noerr":0,"x":530,"y":990,"wires":[["62525e7.2f30ca","5afc7c60.d87c34"]]},{"id":"5afc7c60.d87c34","type":"debug","z":"3ce5b54a.127d6a","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":690,"y":1040,"wires":[]},{"id":"b50751d4.0745","type":"delay","z":"3ce5b54a.127d6a","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":360,"y":990,"wires":[["6cc0d0ab.b9ba3"]]},{"id":"97f0b2f0.7fe07","type":"function","z":"3ce5b54a.127d6a","name":"","func":"if (msg.payload.includes(\"corrMin\"))global.set(\"corrMinimaBaterias\", parseFloat(msg.payload.substring(7)));\nif (msg.payload.includes(\"volMin\"))global.set(\"voltMinimoVaterias\", parseFloat(msg.payload.substring(6)));\nif (msg.payload.includes(\"offCorr\"))global.set(\"offSetCorriente\", parseFloat(msg.payload.substring(7)));\n\nnode.status({text: \"vMin: \" + global.get(\"voltMinimoVaterias\") + \"  corrMin: \" + global.get(\"corrMinimaBaterias\") + \"  offSetCorr: \" + global.get(\"offSetCorriente\") });\nmsg = {topic: \"Baterias/Inicio\", payload: global.get(\"corrMinimaBaterias\") + \"#\" + global.get(\"voltMinimoVaterias\") + \"#\" + global.get(\"offSetCorriente\")};\nreturn msg","outputs":1,"noerr":0,"x":560,"y":680,"wires":[["861fc432.288a68","f6dfc950.057bb8"]]},{"id":"d89575f4.ec7998","type":"debug","z":"3ce5b54a.127d6a","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":470,"y":520,"wires":[]},{"id":"ddddc125.92658","type":"inject","z":"3ce5b54a.127d6a","name":"","topic":"","payload":"{\"topic\":\"Alarma/Activacion\",\"payload\":1}","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":250,"y":430,"wires":[["d5de6169.53ddd"]]},{"id":"737eb8ec.f89e98","type":"inject","z":"3ce5b54a.127d6a","name":"","topic":"","payload":"{\"topic\":\"Alarma/Activacion\",\"payload\":0}","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":250,"y":470,"wires":[["d5de6169.53ddd"]]},{"id":"e38aae49.8ead8","type":"inject","z":"3ce5b54a.127d6a","name":"","topic":"","payload":"{\"topic\":\"Cargador\",\"payload\":1,\"volt\":13.33,\"corriente\":13.27}","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":300,"y":170,"wires":[["95935531.f40c18"]]},{"id":"bf3b0610.5a8468","type":"inject","z":"3ce5b54a.127d6a","name":"","topic":"","payload":"{\"topic\":\"Cargador\",\"payload\":0,\"volt\":13.33,\"corriente\":13.27}","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":300,"y":200,"wires":[["95935531.f40c18"]]},{"id":"11075f36.1f5d01","type":"function","z":"3ce5b54a.127d6a","name":"","func":"\nreturn msg;","outputs":1,"noerr":0,"x":1900,"y":1110,"wires":[["37029e26.0cf782"]]},{"id":"37029e26.0cf782","type":"link out","z":"3ce5b54a.127d6a","name":"Alarma","links":["b1a0c92f.989598"],"x":2005,"y":1110,"wires":[]},{"id":"b1a0c92f.989598","type":"link in","z":"3ce5b54a.127d6a","name":"","links":["37029e26.0cf782"],"x":1375,"y":1000,"wires":[["da17eae0.10cf48"]]},{"id":"d047b6ad.fafdf8","type":"link out","z":"3ce5b54a.127d6a","name":"salidaAlarma","links":["fa1f9137.f79d5"],"x":2005,"y":1010,"wires":[]},{"id":"fa1f9137.f79d5","type":"link in","z":"3ce5b54a.127d6a","name":"","links":["d047b6ad.fafdf8"],"x":1355,"y":1110,"wires":[["3dcd1e2f.ec8c22"]]},{"id":"3dcd1e2f.ec8c22","type":"delay","z":"3ce5b54a.127d6a","name":"","pauseType":"delay","timeout":"020","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1460,"y":1110,"wires":[["eb30c259.d92c8"]]},{"id":"eb30c259.d92c8","type":"function","z":"3ce5b54a.127d6a","name":"","func":"msg = {topic: \"\", payload: global.get(\"estadoAlarma\")}; \nreturn msg;","outputs":1,"noerr":0,"x":1610,"y":1110,"wires":[["34a42ed0.f6adc2"]]},{"id":"3562e1c8.094afe","type":"inject","z":"3ce5b54a.127d6a","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1430,"y":1160,"wires":[["3dcd1e2f.ec8c22"]]},{"id":"a764f4e9.6c1028","type":"function","z":"3ce5b54a.127d6a","name":"","func":"msg.payload = global.get(\"fechaCompleta\");\nreturn msg;","outputs":1,"noerr":0,"x":700,"y":360,"wires":[["e68fc671.d485c8"]]},{"id":"9fdf6dbc.c9208","type":"delay","z":"3ce5b54a.127d6a","name":"","pauseType":"delay","timeout":"100","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":550,"y":360,"wires":[["a764f4e9.6c1028"]]},{"id":"2903e624.47c22a","type":"debug","z":"3ce5b54a.127d6a","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":520,"y":200,"wires":[]},{"id":"b5334e08.2a0aa","type":"debug","z":"3ce5b54a.127d6a","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":510,"y":1130,"wires":[]},{"id":"ea97adc2.af88d","type":"inject","z":"3ce5b54a.127d6a","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":2420,"y":320,"wires":[["19fdb46e.72052c","b7217fe3.78b27","f20c8fe3.a0061"]]},{"id":"14b0e482.88791b","type":"mqtt in","z":"3ce5b54a.127d6a","name":"","topic":"provisoriosMQTT","qos":"2","broker":"e779f8d6.7bc2c8","x":450,"y":80,"wires":[["8a783ae9.33a138"]]},{"id":"8a783ae9.33a138","type":"debug","z":"3ce5b54a.127d6a","name":"provisoriosMQTT","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":650,"y":80,"wires":[]},{"id":"861fc432.288a68","type":"file","z":"3ce5b54a.127d6a","name":"back datos termo","filename":"/home/gaston/BackUp-Node-Red/Baterias.txt","appendNewline":false,"createDir":false,"overwriteFile":"true","x":760,"y":650,"wires":[[]]},{"id":"9606eb35.2c2108","type":"file in","z":"3ce5b54a.127d6a","name":"recover datos termo","filename":"/home/pi/BackUpNodeRed/Baterias.txt","format":"utf8","chunk":false,"sendError":false,"x":560,"y":770,"wires":[["924e9200.5d5d2"]]},{"id":"ca4777b4.f259b8","type":"mqtt in","z":"3ce5b54a.127d6a","name":"","topic":"Baterias/Inicio","qos":"2","broker":"e779f8d6.7bc2c8","x":320,"y":800,"wires":[["9606eb35.2c2108"]]},{"id":"9b66bb8e.b2ab78","type":"mqtt out","z":"3ce5b54a.127d6a","name":"","topic":"","qos":"","retain":"","broker":"c339edbf.39572","x":890,"y":690,"wires":[]},{"id":"f6dfc950.057bb8","type":"delay","z":"3ce5b54a.127d6a","name":"","pauseType":"delay","timeout":"100","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":740,"y":690,"wires":[["9b66bb8e.b2ab78"]]},{"id":"924e9200.5d5d2","type":"function","z":"3ce5b54a.127d6a","name":"val. in. baterias","func":"var dato = msg.payload.split(\"#\");\nglobal.set(\"corrMinimaBaterias\", dato[0]);\nglobal.set(\"voltMinimoVaterias\", dato[1]);\nglobal.set(\"offSetCorriente\", dato[2]);\n\nmsg = {topic: \"USBout\", payload: \"config\" + global.get(\"corrMinimaBaterias\") + \"#\" + global.get(\"voltMinimoVaterias\") + \"#\" + global.get(\"offSetCorriente\")};\nreturn msg\n","outputs":1,"noerr":0,"x":760,"y":770,"wires":[["9b66bb8e.b2ab78"]]},{"id":"d4c46aae.f2e4e8","type":"inject","z":"3ce5b54a.127d6a","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":true,"onceDelay":"5","x":320,"y":760,"wires":[["9606eb35.2c2108"]]},{"id":"52dc0931.634188","type":"debug","z":"3ce5b54a.127d6a","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":300,"y":1120,"wires":[]},{"id":"bcf69a76.207f48","type":"debug","z":"3ce5b54a.127d6a","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":510,"y":850,"wires":[]},{"id":"8e765cc1.2afb1","type":"mqtt out","z":"3ce5b54a.127d6a","name":"","topic":"","qos":"","retain":"","broker":"e779f8d6.7bc2c8","x":760,"y":950,"wires":[]},{"id":"e14463a7.a8348","type":"debug","z":"3ce5b54a.127d6a","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":695.5555572509766,"y":965.5555620193481,"wires":[]},{"id":"71ce9b48.3ad114","type":"mqtt out","z":"73083520.75304c","name":"","topic":"Pedido/Lavadero/Bombas","qos":"","retain":"","broker":"c339edbf.39572","x":840,"y":510,"wires":[]},{"id":"e02bb3bc.f54b9","type":"mqtt in","z":"73083520.75304c","name":"","topic":"ESP/Lavadero/Inicio","qos":"2","broker":"c339edbf.39572","x":330,"y":510,"wires":[["9f837dbe.a7563","aeaa2ce9.06eb4"]]},{"id":"b7daae4c.c7c24","type":"function","z":"73083520.75304c","name":"llenado de tanque (Andando)","func":"var dato = JSON.parse(msg.payload);\nvar nivMaximo = 480;\ncontext.estadoAnterior = context.estadoAnterior || 0;\ncontext.avisoTanque = context.avisoTanque || 0;\nif (global.get(\"fallasLavadero\") === undefined)global.set(\"fallasLavadero\", 0);\n\nif (msg.topic == \"blynk/marchaBomba\"){\n\t// context.avisoTanque = 0;\n\tif (msg.payload === 1)global.set(\"bombaPozo\", 1);\n\tif (msg.payload === 0)global.set(\"bombaPozo\", 0);\n\tmsg = {topic: \"ESP/Lavadero/Bombas/Estado/Rele1\", payload: global.get(\"bombaPozo\")}; node.send([msg, null]);\t\n}\n\nif (msg.topic == \"blynk/llenarTanque\"){\n\tcontext.avisoTanque = 0;\n    context.estadoAnterior = msg.payload;\n    global.set(\"llenarTanque\", msg.payload);\n    global.set(\"bombaPozo\",  msg.payload);\n    global.set(\"valvulaTanque\", msg.payload);\n    // if (global.get(\"nivTanque\") < nivMaximo - 10)global.set(\"valvulaTanque\", 1);\n    msg = {topic: \"USBout\", payload: \"{\\\"topic\\\":\\\"most\\\",\\\"payload\\\":\" + msg.payload + \"}\"}; node.send(msg);\n    enviarDatos();\n}\n\nif (dato.topic == \"bombaRF\"){\n\tif (global.get(\"bombaPozo\") === 0){global.set(\"bombaPozo\", 1);}else{global.set(\"bombaPozo\", 0);}\n\tmsg = {pin: 2, payload: global.get(\"bombaPozo\")}; node.send([null,msg]);\n\tmsg = {topic: \"ESP/Lavadero/Bombas/Estado/Rele1\", payload: global.get(\"bombaPozo\")}; node.send([msg, null]);\t\t\n\treturn;\n}\n\nif (dato.topic === \"google/Tanque\") enviarDatos();\n\nif (dato.topic === \"Nivel\"){\n\tglobal.set(\"nivTanque\", parseInt(dato.payload));\n\tmsg = {topic: \"nivel\", payload: global.get(\"nivTanque\") + \"mm\"}; node.send([msg, null]);\n\tmsg = {topic: \"Actualizacion/Baterias\", payload:\"\"}; node.send([msg, null]);\n\tactualizarEstado();}\n\nif (dato.topic === \"Niveles\"){\n\tmsg = {topic: \"nivMinimo\", payload: dato.nivMinimo};\n\tnode.send([msg, null]);\n\tmsg = {topic: \"nivMaximo\", payload: dato.nivMaximo};\n\tnode.send([msg, null]);\n\tmsg = {topic: \"nivel\", payload: dato.nivel}; global.set(\"nivTanque\", parseInt(dato.nivel)); \n\tnode.send([msg, null]);\n\tmsg = {topic: \"altTanque\", payload: dato.altTanque};\n\tnode.send([msg, null]);\n\tmsg = {topic: \"crepuscular\", payload: dato.crepuscular};\n\tnode.send([msg, null]);\n\tactualizarEstado();\n}\t\n\nif (msg.topic === \"configNano\"){\n\tvar item = msg.payload.split(\" \");\n\tif (item[0] === \"altTanque\")msg.payload = \"{\\\"topic\\\":\\\"altTanque\\\",\\\"payload\\\":\" + item[1] + \"\\\"}\";\n\tif (item[0] === \"minTanque\")msg.payload = \"{\\\"topic\\\":\\\"minTanque\\\",\\\"payload\\\":\" + item[1] + \"\\\"}\";\t\n\tif (item[0] === \"maxTanque\")msg.payload = \"{\\\"topic\\\":\\\"maxTanque\\\",\\\"payload\\\":\" + item[1] + \"\\\"}\";\t\n\tmsg = {topic: \"USBout\", payload: msg.payload}; node.send(msg);}\n\n// if (global.get(\"llenarTanque\") === 1 && global.get(\"nivTanque\") >= nivMaximo)\t{\n// \tglobal.set(\"llenarTanque\", 0);\n// \tmsg = {topic: \"USBout\", payload: \"{\\\"topic\\\":\\\"most\\\",\\\"payload\\\":0}\"}; node.send(msg);\n//     context.estadoAnterior = 0;\n//     global.set(\"bombaPozo\", 0);\n//     global.set(\"valvulaTanque\", 0);\n//     enviarDatos();\t\n// }\n\nif (global.get(\"nivTanque\") >= nivMaximo && context.avisoTanque === 0){\n\tglobal.set(\"bombaPozo\", 0);\n\tglobal.set(\"valvulaTanque\", 0);\n\tglobal.set(\"llenarTanque\", 0);\n    msg = {topic: \"ESP/Lavadero/Bombas/Estado/Rele1\", payload: global.get(\"bombaPozo\")}; node.send(msg);\n    msg = {topic: \"ESP/Lavadero/Bombas/Estado/Rele0\", payload: global.get(\"valvulaTanque\")}; node.send(msg);\n    msg = {topic: \"USBout\", payload: \"{\\\"topic\\\":\\\"most\\\",\\\"payload\\\":0}\"}; node.send(msg);\n\tmsg = {topic: \"notifyBlynk\", payload:\"tanque lleno\"}; node.send(msg);\n\tmsg = {pin: 34, payload: global.get(\"llenarTanque\")}; node.send([null,msg]);\n\tmsg = {pin: 2, payload: global.get(\"bombaPozo\")}; node.send([null,msg]);\n\tcontext.avisoTanque = 1;}\n\nif (dato.topic === \"LlenarTanque\"){global.set(\"llenarTanque\", parseInt(dato.payload));}\n\nif (global.get(\"llenarTanque\") === 1 && context.estadoAnterior === 0){\n\tmsg = {topic: \"USBout\", payload: \"{\\\"topic\\\":\\\"most\\\",\\\"payload\\\":1}\"}; node.send(msg);\n    context.estadoAnterior = 1;\n    global.set(\"bombaPozo\", 1);\n    if (global.get(\"nivTanque\") < nivMaximo - 10){\tcontext.avisoTanque = 0; global.set(\"valvulaTanque\", 1);}\n    enviarDatos();\n    }\nif (global.get(\"llenarTanque\") === 0 && context.estadoAnterior === 1){\n\tmsg = {topic: \"USBout\", payload: \"{\\\"topic\\\":\\\"most\\\",\\\"payload\\\":0}\"}; node.send(msg);\n    context.estadoAnterior = 0;\n    global.set(\"bombaPozo\", 0);\n    global.set(\"valvulaTanque\", 0);\n    context.avisoTanque = 0;\n    enviarDatos();\n    }    \nnode.status({text: \"Bomba: \" + global.get(\"bombaPozo\") + \"  Valvula: \" + global.get(\"valvulaTanque\") + \" - \" + global.get(\"nivTanque\") + \" - \" + global.get(\"llenarTanque\") + \" - \" + context.estadoAnterior});\nif (msg.topic == \"Pedido/Lavadero/Bombas\") {\n\tvar fallasLavadero = global.get(\"fallasLavadero\") + 1;\n\tglobal.set(\"fallasLavadero\", fallasLavadero);\n\tenviarDatos();\n}\n\nfunction enviarDatos(){\n\t// context.avisoTanque = 0;\n\tmsg = {pin: 2, payload: global.get(\"bombaPozo\")}; node.send([null,msg]);\n    msg = {topic: \"ESP/Lavadero/Bombas/Estado/Rele1\", payload: global.get(\"bombaPozo\")}; node.send(msg);\n    msg = {topic: \"ESP/Lavadero/Bombas/Estado/Rele0\", payload: global.get(\"valvulaTanque\")}; node.send(msg);    \n}\n\nfunction actualizarEstado(){\n\tif (global.get(\"estadoToldo\") !== \"Abriendo\" && global.get(\"estadoToldo\") !== \"Cerrando\"){\n\t\tmsg = {topic: \"Blynk/actualizar/estado\", payload: \"\"};\n\t\tnode.send(msg);}\t\n}\n","outputs":2,"noerr":0,"x":620,"y":320,"wires":[[],[]]},{"id":"9f837dbe.a7563","type":"function","z":"73083520.75304c","name":"llenado de tanque","func":"  context.nivelAnterior = context.nivelAnterior || 0;\n  context.estadoAnterior = context.estadoAnterior || 0;\n  // context.avisoTanque = context.avisoTanque || 0;\n  context.llenadoAnulado = context.llenadoAnulado || 0;\n  context.tiempoLlenado = context.tiempoLlenado || 0;\n  context.tiempoRestante = context.tiempoRestante || 0; // 0 == por nivel\n  context.nivelInicioLlenado = context.nivelInicioLlenado || 0;\n  context.tiempoInicioLlenado = context.tiempoInicioLlenado || 0;\n  if (global.get(\"llenarTanque\") === undefined)global.set(\"llenarTanque\", 0);\n\n  var date = new Date();\n  // var dato = JSON.parse(msg.payload);\n  var topic = msg.topic;\n  var pin = parseInt(msg.pin);\n  var nivMaximo = 400;\n  var nivMinimo = 250;\n  var timerLuces = 12000;\n  var tasaLlenado = 0;\n\n  if (global.get(\"fallasLavadero\") === undefined)global.set(\"fallasLavadero\", 0);\n  if (global.get(\"luzLavadero\") === undefined)global.set(\"luzLavadero\", 0);\n  if (global.get(\"luzAlacenaLavadero\") === undefined)global.set(\"luzAlacenaLavadero\", 0);\n  if (global.get(\"bombaPozo\") === undefined)global.set(\"bombaPozo\", 0);\n  if (global.get(\"valvulaTanque\") === undefined)global.set(\"valvulaTanque\", 0);\n  if (global.get(\"bombaPileta\") === undefined)global.set(\"bombaPileta\", 0);\n  if (global.get(\"estadoEspTanque\") === undefined)global.set(\"estadoEspTanque\", 1);\n  if (global.get(\"tasaLlenadoTanque\") === undefined)global.set(\"tasaLlenadoTanque\", 0);\n\n  if (global.get(\"minimoTanque\") === undefined)global.set(\"minimoTanque\", 250);\n  if (global.get(\"maximoTanque\") === undefined)global.set(\"maximoTanque\", 400);\n  if (global.get(\"alturaTanque\") === undefined)global.set(\"alturaTanque\", 680);\n\n  // node.status({text: global.get(\"estadoAlarma\") + \" -- \"  + global.get(\"luzLavadero\")});\n\n  if (topic == \"blynk/marchaBomba\")pin = 2;\n  if (topic == \"blynk/llenarTanque\")pin = 34;\n\n  if (topic == \"aviso/Alarma\"){\n    if (global.get(\"estadoAlarma\") === 1)apagadoLuces();\n  }\n\n  // if (topic == \"google/Alarma\" || topic == \"aviso/Alarma\"){\n  //   if (global.get(\"luzAlacenaLavadero\") === 1 || global.get(\"luzLavadero\") === 1){\n  //     node.status({text: global.get(\"estadoAlarma\") + \" -ppp- \"  + global.get(\"luzLavadero\")});\n  //     if (global.get(\"estadoAlarma\") === 1 && global.get(\"Dia\") === 0){setTimeout(apagadoLuces, timerLuces);}\n  //     if (global.get(\"estadoAlarma\") === 1 && global.get(\"Dia\") === 1)apagadoLuces();\n  //   }\n  // } \n\n  if (topic == \"google/Lavadero\" || topic == \"crepMQTT\"){\n    enviarBlynk();\n    enviarDatos();\n  }   \n\n  // if (topic == \"ESP/Lavadero/Temperatura\"){\n  //   global.set(\"tempLavadero\", parseFloat(msg.payload).toFixed(2)); \n  //   return;\n  // }\n\n  if (topic == \"ESP/Lavadero/Envio\"){\n    if (msg.payload === \"\")return;\n    if (msg.payload.substring(0, 13) == \"bloqueoTeclasSI\"){msg = {pin: 74, payload: 1}; node.send([null, msg]); return;}\n    if (msg.payload.substring(0, 13) == \"bloqueoTeclasNO\"){msg = {pin: 74, payload: 0}; node.send([null, msg]); return;}\n    // if (msg.substring(0, 6) == \"Buzzer\") msg = msg.substring(6);\n    var dato = msg.payload.split(\"#\");\n    global.set(\"bombaPozo\", parseInt(dato[0])); \n    global.set(\"bombaPileta\", parseInt(dato[1])); \n    global.set(\"luzLavadero\", parseInt(dato[2])); \n    global.set(\"luzAlacenaLavadero\", parseInt(dato[3])); \n  //   if (global.get(\"luzLavadero\") === 0)global.set(\"luzAlacenaLavadero\", 0); \n    enviarBlynk();\n    return;\n  }\n\n  if (topic == \"ESP/TanqueAgua/Desconectado\"){\n    var restante = parseInt(nivMaximo) - parseInt(global.get(\"nivTanque\"));\n    var tiempoRestante = (parseInt(restante) * 209) / 104;\n    context.tiempoRestante = parseInt(tiempoRestante * 1000);\n    global.set(\"estadoEspTanque\", 0);// 0 = Desconectado\n    return;\n  }  \n\n  if (topic == \"ESP/TanqueAgua/Inicio\"){\n    global.set(\"estadoEspTanque\", 1);\n    var datos = \"config\" + global.get(\"minimoTanque\") + \"#\" + global.get(\"maximoTanque\") + \"#\" + global.get(\"alturaTanque\");\n    msg = {topic: \"ESP/TanqueAgua/Recibo\", payload: datos}; node.send([msg, null]);\n    // enviarDatos();    \n    return;\n  }   \n\n  // if (global.get(\"estadoEspTanque\") === 0 && global.get(\"llenarTanque\") === 1 && date.getTime() > parseInt(context.tiempoRestante)){\n  //   global.set(\"llenarTanque\", 0); global.set(\"bombaPozo\", 0);  global.set(\"valvulaTanque\", 0); \n  //   msg = {topic: \"notifyBlynk\", payload:\"tanque lleno por tiempo\"}; node.send(msg);\n  //   enviarBlynk(); \n  //   enviarDatos();  \n  // }\n\n  // if (dato.topic == \"bombaRF\"){\n  //   if (global.get(\"bombaPozo\") === 0){global.set(\"bombaPozo\", 1);}else{global.set(\"bombaPozo\", 0);}\n  //   enviarBlynk(); \n  //   enviarDatos(); //return;\n  // }\n\n  if (parseInt(global.get(\"llenarTanque\")) === 1 && parseInt(date.getTime()) > parseInt(context.tiempoLlenado)){\n    context.tiempoLlenado = date.getTime() + 60000;\n    msg = {topic: \"ESP/TanqueAgua/Recibo\", payload: \" \"}; node.send([msg, null]); \n    return;\n  }\n\n  // sube el nivel a razon de 104mm cada 209\"     42mm en 91\"\nif (topic == \"ESP/TanqueAgua/Envio\"){\n    global.set(\"nivTanque\", parseInt(msg.payload)); \n\n    if (parseInt(global.get(\"nivTanque\")) < parseInt(global.get(\"minimoTanque\")) && global.get(\"llenarTanque\") === 0 && context.llenadoAnulado === 0){\n      context.nivelInicioLlenado = parseInt(global.get(\"nivTanque\"));\n      context.tiempoInicioLlenado = date.getTime();  \n      node.status({text: \"nivelInicio: \" + context.nivelInicioLlenado + \"  tiempoInicio: \" + context.tiempoInicioLlenado});\n      context.tiempoLlenado = date.getTime() + 60000;\n      context.estadoAnterior = 1;\n      global.set(\"llenarTanque\", 1);\n      global.set(\"bombaPozo\",  1);\n      global.set(\"valvulaTanque\", 1);\n    //   msg = {topic: \"terminalBlynk\", payload: global.get(\"fechaCompleta\") + \" Inicio AUTO llenado tanque, \" + context.nivelInicioLlenado + \"mm\\n\"}; node.send([msg, null]);\n      msg = {topic: \"ESP/Lavadero/Recibo\", payload: \"llenando1\"}; node.send([msg, null]);\n      msg = {topic: \"informarNivel\", payload: 1}; node.send([msg, null]);\n      enviarBlynk(); \n      msg.topic = \"ESP/Lavadero/Inicio\";\n      enviarDatos();\n      return;    \n    }\n    \n    if (parseInt(global.get(\"nivTanque\")) >= parseInt(global.get(\"maximoTanque\")) && parseInt(global.get(\"llenarTanque\")) === 1){// && parseInt(global.get(\"estadoEspTanque\")) === 1){ //&& context.avisoTanque === 0 && global.get(\"estadoEspTanque\") === 1){\n        var var1 = global.get(\"nivTanque\");\n        tasaLlenado = (date.getTime() - parseInt(context.tiempoInicioLlenado)) / 60000;\n        tasaLlenado = parseFloat((var1 - context.nivelInicioLlenado) / tasaLlenado).toFixed(2);\n        global.set(\"tasaLlenadoTanque\", tasaLlenado);        \n        global.set(\"llenarTanque\", 0); global.set(\"bombaPozo\", 0);  global.set(\"valvulaTanque\", 0); \n        var ponele3 = parseInt(global.get(\"nivTanque\")) - context.nivelInicioLlenado;\n        node.status({text: \"FIN Auto nivelInicio: \" + ponele3 + \"  TiempoLlenado: \" + parseFloat(global.get(\"tasaLlenadoTanque\")).toFixed(2)});\n        // msg = {topic: \"terminalBlynk\", payload: global.get(\"fechaCompleta\") + \" Paro AUTO Llenado tanque, \" + var1 + \"mm\\n\"}; node.send([msg, null]);\n        // msg = {topic: \"notifyBlynk\", payload:\"tanque lleno por nivel\"}; node.send(msg);\n        msg = {topic: \"informarNivel\", payload: 1}; node.send([msg, null]);\n        topicNuevo = \"ESP/Lavadero/Inicio\";\n        enviarBlynk(); \n        msg.topic = \"ESP/Lavadero/Inicio\";\n        enviarDatos();\n        return;\n    }  \n\n    if (global.get(\"nivTanque\") != context.nivelAnterior){\n      context.nivelAnterior = global.get(\"nivTanque\");\n        if (parseInt(global.get(\"llenarTanque\")) === 1){// parseInt(global.get(\"nivTanque\")) < parseInt(nivMaximo)){\n          var var1 = global.get(\"nivTanque\");\n          tasaLlenado = (date.getTime() - parseInt(context.tiempoInicioLlenado)) / 60000;\n          tasaLlenado = parseFloat((var1 - context.nivelInicioLlenado) / tasaLlenado).toFixed(2);\n          context.nivelInicioLlenado = parseInt(global.get(\"nivTanque\"));\n          context.tiempoInicioLlenado = date.getTime();\n          global.set(\"tasaLlenadoTanque\", tasaLlenado);      \n          msg = {topic: \"informarNivel\", payload: 1}; node.send([msg, null]);\n          msg = {topic: \"Blynk/actualizar/estado\", payload: 1}; node.send([msg, null]);\n      }\n    }  \n\n} \n\n  if (topic == \"ESP/Lavadero/Inicio\") {\n    enviarDatos(); \n    return;\n  }\n\n  switch (pin){\n    case 2:\n    global.set(\"bombaPozo\", parseInt(msg.payload));\n      enviarDatos(); //return;\n      break;\n\n    case 34:\n      context.estadoAnterior = msg.payload;\n      global.set(\"llenarTanque\", parseInt(msg.payload));\n      global.set(\"bombaPozo\",  parseInt(msg.payload));\n      global.set(\"valvulaTanque\",parseInt( msg.payload));\n      context.tiempoLlenado = date.getTime() + 60000;\n      if (parseInt(msg.payload) === 0) {\n        var var1 = global.get(\"nivTanque\");\n        tasaLlenado = (date.getTime() - context.tiempoInicioLlenado) / 60000;        \n        parseFloat((var1 - context.nivelInicioLlenado) / tasaLlenado).toFixed(2);\n        var ponele = var1 - context.nivelInicioLlenado;\n        global.set(\"tasaLlenadoTanque\", tasaLlenado);\n        // msg = {topic: \"terminalBlynk\", payload: global.get(\"fechaCompleta\") + \" Paro MANUAL Llenado tanque, \" + var1 + \"mm\\n\"}; node.send([msg, null]);\n        msg = {topic: \"informarNivel\", payload: 1}; node.send([msg, null]);\n        node.status({text: \"FIN Man nivelInicio: \" + ponele + \"  TiempoLlenado: \" + parseFloat(global.get(\"tasaLlenadoTanque\")).toFixed(2)});\n        context.llenadoAnulado = 1;\n      }\n      if (parseInt(msg.payload) === 1) {\n        context.nivelInicioLlenado = parseInt(global.get(\"nivTanque\"));\n        context.tiempoInicioLlenado = date.getTime();\n        // msg = {topic: \"terminalBlynk\", payload: global.get(\"fechaCompleta\") + \" Inicio MANUAL llenado tanque, \" + context.nivelInicioLlenado + \"mm\\n\"}; node.send([msg, null]);\n        msg = {topic: \"informarNivel\", payload: 1}; node.send([msg, null]);\n        node.status({text: \"nivelInicio: \" + context.nivelInicioLlenado + \"  tiempoInicio: \" + context.tiempoInicioLlenado});\n        context.llenadoAnulado = 0;\n        }\n      enviarBlynk();\n      enviarDatos(); //return;\n      break;  \n\n    case 35:\n      // if (parseInt(msg.payload) === 1) global.set(\"luzLavadero\", 0);\n      // if (parseInt(msg.payload) === 0) global.set(\"luzLavadero\", 1);\n      global.set(\"luzLavadero\", parseInt(msg.payload));\n      node.status({text: global.get(\"estadoAlarma\") + \" -fff- \"  + global.get(\"luzLavadero\")});\n      enviarDatos(); //return;\n      break;\n\n    case 36:\n      global.set(\"luzAlacenaLavadero\", parseInt(msg.payload));\n      node.status({text: global.get(\"estadoAlarma\") + \" -ggg- \"  + global.get(\"luzAlacenaLavadero\")});\n      enviarDatos(); //return;\n      break;\n\n    case 37:\n      global.set(\"bombaPileta\", parseInt(msg.payload));\n      enviarDatos(); //return;\n      break;   \n\n    case 38:\n      global.set(\"valvulaTanque\", parseInt(msg.payload));\n      enviarDatos(); //return;\n      break;                  \n  }\n\n  function enviarBlynk(){\n    msg = {pin: 2, payload: global.get(\"bombaPozo\")}; node.send([null, msg]);\n    msg = {pin: 34, payload: global.get(\"llenarTanque\")}; node.send([null, msg]);\n    msg = {pin: 35, payload: global.get(\"luzLavadero\")}; node.send([null, msg]);\n    msg = {pin: 36, payload: global.get(\"luzAlacenaLavadero\")}; node.send([null, msg]);\n    msg = {pin: 37, payload: global.get(\"bombaPileta\")}; node.send([null, msg]);\n    msg = {pin: 38, payload: global.get(\"valvulaTanque\")}; node.send([null, msg]);\n  }\n\n  function enviarDatos(){//return;\n    var topicNuevo = msg.topic;\n    msg = global.get(\"bombaPozo\") + \"#\";\n    msg += global.get(\"valvulaTanque\") + \"#\";\n    msg += global.get(\"bombaPileta\") + \"#\";\n    msg += global.get(\"luzLavadero\") + \"#\";\n    msg += global.get(\"luzAlacenaLavadero\") + \"#\";\n    msg += global.get(\"pwmMaxLed\") + \"#\";\n    msg += global.get(\"pwmMinLed\") + \"#\";\n    msg += global.get(\"Dia\");\n    if (topicNuevo == \"crepMQTT\" || topicNuevo == \"ESP/Lavadero/Inicio\" || topicNuevo == \"aviso/Alarma\")msg += \"#\";\n    msg = {topic: \"ESP/Lavadero/Recibo\", payload: msg}; node.send([msg, null]);\n\n\n    // if (global.get(\"valvulaTanque\") === 1) {context.avisoTanque = 0;}\n    // msg = {pin: 2, payload: global.get(\"bombaPozo\")}; node.send([null,msg]);\n    // msg = {pin: 34, payload: global.get(\"llenarTanque\")}; node.send([null,msg]);\n    // msg = {topic: \"USBout\", payload: \"{\\\"topic\\\":\\\"most\\\",\\\"payload\\\":\" + msg.payload + \"}\"}; node.send(msg);\n    // msg = {topic: \"ESP/Lavadero/Bombas/Estado/Rele1\", payload: global.get(\"bombaPozo\")}; node.send(msg);\n    // msg = {topic: \"ESP/Lavadero/Bombas/Estado/Rele0\", payload: global.get(\"valvulaTanque\")}; node.send(msg);    \n    // node.status({text: \"Bomba: \" + global.get(\"bombaPozo\") + \"  Valvula: \" + global.get(\"valvulaTanque\") + \" - \" + global.get(\"nivTanque\") + \" - \" + global.get(\"llenarTanque\") + \" - \" + context.estadoAnterior});\n  }\n\n  function apagadoLuces(){\n      node.status({text: \"apagado auto\"});\n      global.set(\"luzLavadero\", 0);\n      global.set(\"luzAlacenaLavadero\", 0);\n      enviarBlynk();\n      enviarDatos();\n  }\n\n","outputs":2,"noerr":0,"x":570,"y":400,"wires":[["ee975ea2.1bd88","a8f7ee92.20b99","b42dab48.e96e78"],["f77a9f41.1fd82","70fe7124.dd7c","a8f7ee92.20b99"]]},{"id":"b76455bf.83a1d8","type":"inject","z":"73083520.75304c","name":"","topic":"Pedido/Lavadero/Bombas","payload":"1","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":300,"y":670,"wires":[["9f837dbe.a7563"]]},{"id":"5919cee4.a4cba","type":"inject","z":"73083520.75304c","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":620,"y":510,"wires":[["71ce9b48.3ad114"]]},{"id":"677f3912.9e2b88","type":"inject","z":"73083520.75304c","name":"pulso","topic":"","payload":"","payloadType":"date","repeat":"1","crontab":"","once":false,"onceDelay":0.1,"x":370,"y":710,"wires":[["9f837dbe.a7563"]]},{"id":"45c8def8.16a37","type":"function","z":"73083520.75304c","name":"llenado de tanque","func":"var dato = JSON.parse(msg.payload);\nif (global.get(\"bombaPozo\") === undefined)global.set(\"bombaPozo\", 0);\nif (global.get(\"valvulaTanque\") === undefined)global.set(\"valvulaTanque\", 0);\n\nvar nivMaximo = 420;\ncontext.estadoAnterior = context.estadoAnterior || 0;\ncontext.avisoTanque = context.avisoTanque || 0;\nif (global.get(\"fallasLavadero\") === undefined)global.set(\"fallasLavadero\", 0);\n\n\nif (msg.topic === \"google/Tanque\") enviarDatos();\n\nif (msg.topic == \"blynk/marchaBomba\"){\n\tif (msg.payload === 1)global.set(\"bombaPozo\", 1);\n\tif (msg.payload === 0)global.set(\"bombaPozo\", 0);\n\tenviarDatos(); //return;\n}\n\nif (msg.topic == \"blynk/llenarTanque\"){\n\tcontext.avisoTanque = 0;\n    context.estadoAnterior = msg.payload;\n    global.set(\"llenarTanque\", msg.payload);\n    global.set(\"bombaPozo\",  msg.payload);\n    global.set(\"valvulaTanque\", msg.payload);\n    enviarDatos(); //return;\n}\n\nif (dato.topic == \"bombaRF\"){\n\tif (global.get(\"bombaPozo\") === 0){global.set(\"bombaPozo\", 1);}else{global.set(\"bombaPozo\", 0);}\n\tenviarDatos(); //return;\n}\n\nif (dato.topic === \"Nivel\"){\n\tglobal.set(\"nivTanque\", parseFloat(dato.payload).toFixed(2));\n\tmsg = {topic: \"nivel\", payload: global.get(\"nivTanque\") + \"mm\"}; node.send([msg, null]);\n\tmsg = {topic: \"Actualizacion/Baterias\", payload:\"\"}; node.send([msg, null]);\n\tactualizarEstado();}\n\nif (dato.topic === \"Niveles\"){\n\tmsg = {topic: \"nivMinimo\", payload: dato.nivMinimo};\n\tnode.send([msg, null]);\n\tmsg = {topic: \"nivMaximo\", payload: dato.nivMaximo};\n\tnode.send([msg, null]);\n\tmsg = {topic: \"nivel\", payload: dato.nivel}; global.set(\"nivTanque\", parseInt(dato.nivel)); \n\tnode.send([msg, null]);\n\tmsg = {topic: \"altTanque\", payload: dato.altTanque};\n\tnode.send([msg, null]);\n\tmsg = {topic: \"crepuscular\", payload: dato.crepuscular};\n\tnode.send([msg, null]);\n\tactualizarEstado();\n}\t\n\nif (msg.topic === \"configNano\"){\n\tvar item = msg.payload.split(\" \");\n\tif (item[0] === \"altTanque\")msg.payload = \"{\\\"topic\\\":\\\"altTanque\\\",\\\"payload\\\":\" + item[1] + \"\\\"}\";\n\tif (item[0] === \"minTanque\")msg.payload = \"{\\\"topic\\\":\\\"minTanque\\\",\\\"payload\\\":\" + item[1] + \"\\\"}\";\t\n\tif (item[0] === \"maxTanque\")msg.payload = \"{\\\"topic\\\":\\\"maxTanque\\\",\\\"payload\\\":\" + item[1] + \"\\\"}\";\t\n\tmsg = {topic: \"USBout\", payload: msg.payload}; node.send(msg); return;}\n\nif (global.get(\"nivTanque\") >= nivMaximo && context.avisoTanque === 0){\n\tcontext.avisoTanque = 1;\n\tglobal.set(\"llenarTanque\", 0); global.set(\"bombaPozo\", 0);\tglobal.set(\"valvulaTanque\", 0);\t\n\tmsg = {topic: \"notifyBlynk\", payload:\"tanque lleno\"}; node.send(msg);\n\tenviarDatos();//return;\n} \n\nif (dato.topic === \"LlenarTanque\"){\n\tvar valor = parseInt(dato.payload);\n\tmsg = {topic: \"USBout\", payload: \"llenadoOK\"}; node.send([msg, null]);\n\tglobal.set(\"llenarTanque\", valor); global.set(\"bombaPozo\", valor);\tglobal.set(\"valvulaTanque\", valor);\n\tenviarDatos(); //return;\n}\n\nif (msg.topic === \"Pedido/Lavadero/Bombas\") {\n\tvar fallasLavadero = global.get(\"fallasLavadero\") + 1;\n\tglobal.set(\"fallasLavadero\", fallasLavadero); \n\tglobal.set(\"tipoFallaLav\", msg.payload); msg = {topic: \"fallas_MQTT\", payload: 1}; node.send([msg, null]);\n\tenviarDatos(); //return;\n}\n\nfunction enviarDatos(){\n\tif (global.get(\"valvulaTanque\") === 1) {context.avisoTanque = 0;}\n\tmsg = {pin: 2, payload: global.get(\"bombaPozo\")}; node.send([null,msg]);\n\tmsg = {pin: 34, payload: global.get(\"llenarTanque\")}; node.send([null,msg]);\n\tmsg = {topic: \"USBout\", payload: \"{\\\"topic\\\":\\\"most\\\",\\\"payload\\\":\" + msg.payload + \"}\"}; node.send(msg);\n    msg = {topic: \"ESP/Lavadero/Bombas/Estado/Rele1\", payload: global.get(\"bombaPozo\")}; node.send(msg);\n    msg = {topic: \"ESP/Lavadero/Bombas/Estado/Rele0\", payload: global.get(\"valvulaTanque\")}; node.send(msg);    \n    node.status({text: \"Bomba: \" + global.get(\"bombaPozo\") + \"  Valvula: \" + global.get(\"valvulaTanque\") + \" - \" + global.get(\"nivTanque\") + \" - \" + global.get(\"llenarTanque\") + \" - \" + context.estadoAnterior});\n}\n\nfunction actualizarEstado(){\n\tnode.status({text: \"Bomba: \" + global.get(\"bombaPozo\") + \"  Valvula: \" + global.get(\"valvulaTanque\") + \" - \" + global.get(\"nivTanque\") + \" - \" + global.get(\"llenarTanque\") + \" - \" + context.estadoAnterior});\n\tif (global.get(\"estadoToldo\") !== \"Abriendo\" && global.get(\"estadoToldo\") !== \"Cerrando\"){\n\t\tmsg = {topic: \"Blynk/actualizar/estado\", payload: \"\"};\n\t\tnode.send(msg);}\t\n}\n","outputs":2,"noerr":0,"x":630,"y":280,"wires":[[],[]]},{"id":"7512e54b.bfa1fc","type":"delay","z":"73083520.75304c","name":"","pauseType":"delay","timeout":"100","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":350,"y":430,"wires":[["9f837dbe.a7563"]]},{"id":"9774c645.8766a8","type":"mqtt in","z":"73083520.75304c","name":"","topic":"crepMQTT","qos":"2","broker":"c339edbf.39572","x":170,"y":430,"wires":[["7512e54b.bfa1fc"]]},{"id":"75adfb30.21a464","type":"mqtt in","z":"73083520.75304c","name":"","topic":"ESP/Lavadero/Envio","qos":"2","broker":"c339edbf.39572","x":330,"y":590,"wires":[["9f837dbe.a7563","632a7529.a4550c"]]},{"id":"70fe7124.dd7c","type":"debug","z":"73083520.75304c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":950,"y":420,"wires":[]},{"id":"80e3f8f1.4dad58","type":"mqtt in","z":"73083520.75304c","name":"","topic":"google/Lavadero","qos":"2","broker":"c339edbf.39572","x":340,"y":550,"wires":[["9f837dbe.a7563"]]},{"id":"ad875658.859188","type":"function","z":"73083520.75304c","name":"","func":"if (msg.topic == \"Lavadero\")global.set(\"luzLavadero\", parseInt(msg.payload));\nif (msg.topic == \"alacenaLavadero\")global.set(\"luzAlacenaLavadero\", parseInt(msg.payload));\nif (msg.topic == \"llenarTanque\"){\n    global.set(\"llenarTanque\", parseInt(msg.payload));\n    global.set(\"bombaPozo\",  parseInt(msg.payload));\n    global.set(\"valvulaTanque\", parseInt(msg.payload));\n}\nif (msg.topic == \"bombaPozo\")global.set(\"bombaPozo\", parseInt(msg.payload));\nif (msg.topic == \"bombaPileta\")global.set(\"bombaPileta\", parseInt(msg.payload));\n\n\n    msg = {topic: \"google/Lavadero\", payload: 1}; node.send(msg);","outputs":1,"noerr":0,"x":1570,"y":190,"wires":[["8239a05e.054ae"]]},{"id":"8239a05e.054ae","type":"mqtt out","z":"73083520.75304c","name":"","topic":"","qos":"","retain":"","broker":"e779f8d6.7bc2c8","x":1720,"y":170,"wires":[]},{"id":"add12358.51f9b","type":"mqtt in","z":"73083520.75304c","name":"","topic":"aviso/Alarma","qos":"2","broker":"6b36e4a.1d30b1c","x":160,"y":470,"wires":[["21e34a48.0149b6"]]},{"id":"85d6e558.9b9838","type":"mqtt in","z":"73083520.75304c","name":"","topic":"ESP/TanqueAgua/Envio","qos":"2","broker":"e779f8d6.7bc2c8","x":580,"y":570,"wires":[["f6970a67.481d98","9bd9b334.20d32"]]},{"id":"beab172d.9adee8","type":"mqtt out","z":"73083520.75304c","name":"","topic":"ESP/Lavadero/Recibo","qos":"","retain":"","broker":"e779f8d6.7bc2c8","x":892.8571243286133,"y":672.8571586608887,"wires":[]},{"id":"77654698.b9eda8","type":"inject","z":"73083520.75304c","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":642.8571243286133,"y":632.8571586608887,"wires":[["beab172d.9adee8"]]},{"id":"ccfae20a.9cb3a","type":"debug","z":"73083520.75304c","name":"recibo del tanque agua","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":1090,"y":570,"wires":[]},{"id":"4484dc6e.9206c4","type":"mqtt in","z":"73083520.75304c","name":"","topic":"ESP/TanqueAgua/Debug","qos":"2","broker":"e779f8d6.7bc2c8","x":605.714277267456,"y":778.5714244842529,"wires":[["b6688191.06f9a","2fad1afa.9276c6"]]},{"id":"b6688191.06f9a","type":"debug","z":"73083520.75304c","name":"debug Tanque agua","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":865.714277267456,"y":798.5714244842529,"wires":[]},{"id":"70129ec.d31966","type":"function","z":"73083520.75304c","name":"","func":"var dato = \"niv: \" + global.get(\"nivTanque\") + \" - tasaLlen.: \" + global.get(\"tasaLlenadoTanque\") + \" - \" + global.get(\"hsCpu\");\nnode.status({text: dato});\n\nmsg = {topic: \"terminalBlynk\", payload: dato + \"\\n\"};\nnode.send(msg);\n","outputs":1,"noerr":0,"x":920,"y":570,"wires":[["ccfae20a.9cb3a"]]},{"id":"ae251a3e.ebb0c8","type":"inject","z":"73083520.75304c","name":"","topic":"","payload":"debug1","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":652.8571243286133,"y":712.8571586608887,"wires":[["beab172d.9adee8"]]},{"id":"fd6938a8.9d5648","type":"inject","z":"73083520.75304c","name":"","topic":"","payload":"debug0","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":652.8571243286133,"y":672.8571586608887,"wires":[["beab172d.9adee8"]]},{"id":"2fad1afa.9276c6","type":"function","z":"73083520.75304c","name":"","func":"msg = {topic: \"terminalBlynk\", payload: global.get(\"hsCpu\") + \" -- \" + msg.payload + \"\\n\"};\n// if (msg.payload.includes(\"bomba\") )return msg;\nreturn msg;","outputs":1,"noerr":0,"x":815.714277267456,"y":758.5714244842529,"wires":[["eaa52870.d82168"]]},{"id":"eaa52870.d82168","type":"debug","z":"73083520.75304c","name":"debug Tanque agua","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":985.714277267456,"y":758.5714244842529,"wires":[]},{"id":"f6970a67.481d98","type":"debug","z":"73083520.75304c","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":790,"y":610,"wires":[]},{"id":"4666f8b5.634208","type":"mqtt in","z":"73083520.75304c","name":"","topic":"ESP/TanqueAgua/Envio","qos":"2","broker":"e779f8d6.7bc2c8","x":320,"y":630,"wires":[["9f837dbe.a7563","7dd27b8b.b63394"]]},{"id":"560595ce.92794c","type":"mqtt in","z":"73083520.75304c","name":"","topic":"ESP/TanqueAgua/Desconectado","qos":"2","broker":"e779f8d6.7bc2c8","x":290,"y":350,"wires":[["9f837dbe.a7563"]]},{"id":"b42dab48.e96e78","type":"mqtt out","z":"73083520.75304c","name":"","topic":"","qos":"","retain":"","broker":"e779f8d6.7bc2c8","x":880,"y":320,"wires":[]},{"id":"b2c9e4a2.108c48","type":"mqtt in","z":"73083520.75304c","name":"","topic":"ESP/TanqueAgua/Inicio","qos":"2","broker":"e779f8d6.7bc2c8","x":320,"y":390,"wires":[["9f837dbe.a7563"]]},{"id":"6a7af8d9.d2edd8","type":"mqtt in","z":"73083520.75304c","name":"","topic":"ESP/Lavadero/Recibo","qos":"2","broker":"e779f8d6.7bc2c8","x":850,"y":720,"wires":[["8a69bea6.2b337"]]},{"id":"8a69bea6.2b337","type":"debug","z":"73083520.75304c","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1040,"y":720,"wires":[]},{"id":"a8f7ee92.20b99","type":"link out","z":"73083520.75304c","name":"MQTT_Lavadero","links":["dc99082e.eee2a8"],"x":1045,"y":390,"wires":[]},{"id":"630b3e83.c7f46","type":"function","z":"73083520.75304c","name":"","func":"msg.payload = parseInt(global.get(\"luzLavadero\")); node.send([msg, null]);\nmsg.payload = parseInt(global.get(\"luzAlacenaLavadero\")); node.send([null, msg]);\nmsg.payload = parseInt(global.get(\"llenarTanque\")); node.send([null, null, msg]);\nmsg.payload = parseInt(global.get(\"bombaPozo\")); node.send([null, null, null, msg]);\nmsg.payload = parseInt(global.get(\"bombaPileta\")); node.send([null, null, null, null, msg]);\n","outputs":5,"noerr":0,"x":1200,"y":210,"wires":[["17d6214.c6c9bdf"],["84176557.cef1e8"],["1dc88260.6fd34e"],["d7c0da49.673d58"],["6f669d4b.6dda34"]]},{"id":"dc99082e.eee2a8","type":"link in","z":"73083520.75304c","name":"","links":["a8f7ee92.20b99"],"x":965,"y":210,"wires":[["3b799030.6ff18"]]},{"id":"ee975ea2.1bd88","type":"debug","z":"73083520.75304c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":900,"y":290,"wires":[]},{"id":"17ab055f.02911b","type":"inject","z":"73083520.75304c","name":"","topic":"","payload":"pedidoTemp","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":570,"y":240,"wires":[["d575a75b.9a90a8"]]},{"id":"d575a75b.9a90a8","type":"mqtt out","z":"73083520.75304c","name":"","topic":"ESP/Lavadero/Recibo","qos":"","retain":"","broker":"e779f8d6.7bc2c8","x":770,"y":240,"wires":[]},{"id":"6ecc3d58.b72fc4","type":"inject","z":"73083520.75304c","name":"","topic":"","payload":"debug1","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":550,"y":160,"wires":[["d575a75b.9a90a8"]]},{"id":"99658c46.1f317","type":"inject","z":"73083520.75304c","name":"","topic":"","payload":"debug0","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":550,"y":200,"wires":[["d575a75b.9a90a8"]]},{"id":"632a7529.a4550c","type":"debug","z":"73083520.75304c","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":590,"y":470,"wires":[]},{"id":"d4222a5d.0739e8","type":"mqtt in","z":"73083520.75304c","name":"","topic":"ESP/Lavadero/Debug","qos":"2","broker":"e779f8d6.7bc2c8","x":590,"y":120,"wires":[["ed2a174.a678be8"]]},{"id":"ed2a174.a678be8","type":"debug","z":"73083520.75304c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":790,"y":120,"wires":[]},{"id":"aeaa2ce9.06eb4","type":"debug","z":"73083520.75304c","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":620,"y":370,"wires":[]},{"id":"b5bc542b.d356e8","type":"mqtt in","z":"73083520.75304c","name":"","topic":"ESP/Lavadero/Envio","qos":"2","broker":"c339edbf.39572","x":1280,"y":430,"wires":[[]]},{"id":"cb96a5a1.360ad8","type":"function","z":"73083520.75304c","name":"","func":"msg = {topic: \"terminalBlynk\", payload: global.get(\"hsCpu\") + \" -- \" + msg.payload + \"\\n\"};\nreturn msg;","outputs":1,"noerr":0,"x":1490,"y":430,"wires":[["bf8dec2d.405cb","6264e839.39e838"]]},{"id":"6264e839.39e838","type":"mqtt out","z":"73083520.75304c","name":"","topic":"","qos":"","retain":"","broker":"e779f8d6.7bc2c8","x":1670,"y":430,"wires":[]},{"id":"bf8dec2d.405cb","type":"debug","z":"73083520.75304c","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1620,"y":490,"wires":[]},{"id":"7ebbf747.267f18","type":"inject","z":"73083520.75304c","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1280,"y":480,"wires":[["cb96a5a1.360ad8"]]},{"id":"f5b01669.172ae8","type":"mqtt in","z":"73083520.75304c","name":"","topic":"ESP/TanqueAgua/Envio","qos":"2","broker":"e779f8d6.7bc2c8","x":1280,"y":380,"wires":[["a5d74410.ac2798"]]},{"id":"43cfb392.445e4c","type":"mqtt in","z":"73083520.75304c","name":"","topic":"ESP/TanqueAgua/Debug","qos":"2","broker":"e779f8d6.7bc2c8","x":1290,"y":520,"wires":[["cb96a5a1.360ad8"]]},{"id":"550047c7.aa71d8","type":"mqtt out","z":"73083520.75304c","name":"","topic":"ESP/TanqueAgua/Recibo","qos":"","retain":"","broker":"e779f8d6.7bc2c8","x":1550,"y":630,"wires":[]},{"id":"4aabd0b9.7db36","type":"inject","z":"73083520.75304c","name":"","topic":"","payload":"debug0","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1300,"y":590,"wires":[["550047c7.aa71d8"]]},{"id":"24849a77.3980f6","type":"inject","z":"73083520.75304c","name":"","topic":"","payload":"debug1","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1300,"y":630,"wires":[["550047c7.aa71d8"]]},{"id":"897b77cf.1e98b8","type":"inject","z":"73083520.75304c","name":"","topic":"","payload":"nivel","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1300,"y":670,"wires":[["550047c7.aa71d8"]]},{"id":"a5d74410.ac2798","type":"debug","z":"73083520.75304c","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1500,"y":380,"wires":[]},{"id":"3b799030.6ff18","type":"delay","z":"73083520.75304c","name":"","pauseType":"delay","timeout":"20","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1070,"y":210,"wires":[["630b3e83.c7f46"]]},{"id":"9fc07a03.3e0248","type":"inject","z":"73083520.75304c","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1260,"y":710,"wires":[["91aa366a.957238"]]},{"id":"91aa366a.957238","type":"function","z":"73083520.75304c","name":"","func":"node.status({text: global.get(\"estadoEspTanque\")})","outputs":1,"noerr":0,"x":1430,"y":720,"wires":[[]]},{"id":"55b57916.538338","type":"function","z":"73083520.75304c","name":"","func":"msg.payload = \"bloqueoTeclas\" + msg.payload;\nreturn msg;","outputs":1,"noerr":0,"x":540,"y":900,"wires":[["9b9a8302.2cfbf"]]},{"id":"9b9a8302.2cfbf","type":"mqtt out","z":"73083520.75304c","name":"","topic":"ESP/Lavadero/Recibo","qos":"","retain":"","broker":"e779f8d6.7bc2c8","x":740,"y":910,"wires":[]},{"id":"74f71376.3c258c","type":"debug","z":"73083520.75304c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":700,"y":1010,"wires":[]},{"id":"76f0f733.c330d8","type":"mqtt in","z":"73083520.75304c","name":"","topic":"ESP/Lavadero/Debug","qos":"2","broker":"e779f8d6.7bc2c8","x":440,"y":1000,"wires":[["74f71376.3c258c","b91a37ca.9d35c8"]]},{"id":"9bd9b334.20d32","type":"delay","z":"73083520.75304c","name":"","pauseType":"delay","timeout":"500","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":780,"y":570,"wires":[["70129ec.d31966"]]},{"id":"99ab6ee9.6b0d4","type":"mqtt in","z":"73083520.75304c","name":"","topic":"ESP/Lavadero/AguaCaliente","qos":"2","broker":"c339edbf.39572","x":1650,"y":260,"wires":[[]]},{"id":"21e34a48.0149b6","type":"delay","z":"73083520.75304c","name":"","pauseType":"delay","timeout":"100","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":350,"y":470,"wires":[["9f837dbe.a7563"]]},{"id":"7dd27b8b.b63394","type":"debug","z":"73083520.75304c","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":781.1111145019531,"y":463.3333377838135,"wires":[]},{"id":"b91a37ca.9d35c8","type":"function","z":"73083520.75304c","name":"","func":"// if (msg.payload.includes (\"pwmDucha\") || msg.payload.includes (\"LuzBano\")){\n    msg = {topic: \"terminalBlynk\", payload: msg.payload + \"\\n\"};\n    return msg;\n// }","outputs":1,"noerr":0,"x":640,"y":1060,"wires":[[]]},{"id":"5ff9c137.03e4b","type":"mqtt out","z":"73083520.75304c","name":"","topic":"","qos":"","retain":"","broker":"e779f8d6.7bc2c8","x":770,"y":1060,"wires":[]},{"id":"e7d25c02.7be0d","type":"inject","z":"73083520.75304c","name":"","topic":"","payload":"1","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":300,"y":850,"wires":[["a4147a38.db61c8"]]},{"id":"a4147a38.db61c8","type":"mqtt out","z":"73083520.75304c","name":"","topic":"ESP/TanqueAgua/Recibo","qos":"","retain":"","broker":"e779f8d6.7bc2c8","x":580,"y":850,"wires":[]},{"id":"f6321491.61e598","type":"mqtt in","z":"1b403a13.0ec8c6","name":"","topic":"ESP/TermoSolar/Debug","qos":"2","broker":"900627dc.76e6a8","x":1130,"y":70,"wires":[["b657b0f0.50ad6","7e2f87a5.298818"]]},{"id":"b8d4156f.274c28","type":"mqtt out","z":"1b403a13.0ec8c6","name":"","topic":"","qos":"2","retain":"","broker":"900627dc.76e6a8","x":770,"y":220,"wires":[]},{"id":"e6471751.5c1cc8","type":"function","z":"1b403a13.0ec8c6","name":"val. in. termo","func":"var dato = msg.payload.split(\"#\");\nglobal.set(\"autoBomba\", dato[0]);\nglobal.set(\"autoResistencia\", dato[1]);\nglobal.set(\"autoToldo\", dato[2]);\nglobal.set(\"pedBomba\", dato[3]);\nglobal.set(\"pedResistencia\", dato[4]);\nglobal.set(\"pedToldo\", dato[5]);\nglobal.set(\"tempMaximaTermo\", dato[6]);\nglobal.set(\"tempMaxResistencia\", dato[7]);\nglobal.set(\"tempMaxResistenciaManual\", dato[8]);\nglobal.set(\"tempMinimaResistencia\", dato[9]);\nglobal.set(\"valorDia\", dato[10]);\nglobal.set(\"valorNoche\", dato[11]);\nglobal.set(\"segundosMarchaBomba\", dato[12]);\n// global.set(\"offsetDia\", dato[13]);\n// global.set(\"offsetNoche\", dato[14]);\n\nglobal.set(\"estBomba\", 0);\nglobal.set(\"estResistencia\", 0);\nglobal.set(\"estToldo\", 0);\nglobal.set(\"tempTermoFin\", 0);\nglobal.set(\"tempExteriorFin\", 0);\nglobal.set(\"sensorCrep\", 0);\nglobal.set(\"comienzoLlenado\", 0);\nglobal.set(\"tiempoLlenado\", 0);\nmsg = {topic: \"ESP/TermoSolar/pedido\", payload: 1}; node.send(msg);//ESP/TermoSolar/Recibo\n\n","outputs":1,"noerr":0,"x":1750,"y":600,"wires":[["58ccdacc.e6a2d4"]]},{"id":"938efd9a.a812a","type":"mqtt in","z":"1b403a13.0ec8c6","name":"","topic":"ESP/TermoSolar/Envio","qos":"2","broker":"900627dc.76e6a8","x":210,"y":260,"wires":[["e78455a.6986ca8","e05432b5.73a34"]]},{"id":"54bd2c43.953b64","type":"mqtt in","z":"1b403a13.0ec8c6","name":"","topic":"ESP/TermoSolar/Inicio","qos":"2","broker":"900627dc.76e6a8","x":350,"y":140,"wires":[["ab21644b.e84768","fe06b8fc.396e88"]]},{"id":"cfbdcbb4.4ab528","type":"inject","z":"1b403a13.0ec8c6","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":true,"onceDelay":"1","x":1340,"y":580,"wires":[["6b0b04ae.498c7c","347ec7b.6595338"]]},{"id":"ab21644b.e84768","type":"function","z":"1b403a13.0ec8c6","name":"","func":"// Sal1  thingspeak\n// Sal2  mqtt\n// Sal3  blynk\n// Sal4  mysql\n\ncontext.llenandoTermo = context.llenandoTermo || 0;\ncontext.encendidoResistencia = context.encendidoResistencia || 0;\ncontext.estAnteriorResistencia = context.estAnteriorResistencia || 0;\ncontext.tiempoInicioResistencia = context.tiempoInicioResistencia || 0;\ncontext.manualPorAlarma = context.manualPorAlarma || 0;\ncontext.tiempo = context.tiempo || 0;\n\nvar topic = msg.topic;\nvar payload = msg.payload;\nvar comienzoLlenado;\nvar terminoLlenado;\nvar valorDia = global.get(\"valorDia\");\nvar valorNoche = global.get(\"valorNoche\");\nvar pin = parseInt(msg.pin);\nvar date = new Date();\n\nif (topic == \"timer\"){\n  if (parseInt(global.get(\"hh\")) === 9 && parseInt(global.get(\"mm\")) === 0 && parseInt(global.get(\"autoBomba\")) === 0){\n    context.manualPorAlarma = 1; context.tiempo = date.getTime() + 120000; \n    msg = {pin: 127, payload: global.get(\"hsCpu\") + \", paso a AUTO bomba termo por hora (9:00 \\n\"}; node.send([null, null, msg]);\n    if (parseInt(global.get(\"nivTanque\")) > 150)global.set(\"autoBomba\", 1); \n    // msg = {pin: 102, payload: global.get(\"autoBomba\")}; node.send([null, null, msg, null]);\n    enviarBlynk();\n    enviarMQTT();\n  } \n}\n\n// PONGO BOMBA EN AUTO UNA VEZ QUE SE APAGO Y PASARON 2' DESDE QUE SE APAGO PRESURIZADORA\nif (date.getTime() > context.tiempo && parseInt(context.manualPorAlarma) === 1 && parseInt(global.get(\"estBomba\")) === 0){\n//   msg = {pin: 127, payload: global.get(\"hsCpu\") + \", paso a MANUAL bomba termo por activarse alarma casa o apagarse bomba agua caliente\\n\"}; node.send([null, null, msg]);\n  context.manualPorAlarma = 0;\n  global.set(\"autoBomba\", 0);   \n  enviarBlynk();\n  enviarMQTT();\n}\n\nif (topic == \"ESP/Lavadero/AguaCaliente\"){\n  if (msg.payload.substring(0, 19) == \"BombaAguaCalienteSI\" && parseInt(global.get(\"nivTanque\")) > 150){context.manualPorAlarma = 0; global.set(\"autoBomba\", 1);}\n  if (msg.payload.substring(0, 19) == \"BombaAguaCalienteNO\"){context.manualPorAlarma = 1; context.tiempo = date.getTime() + 120000; return;}\n  enviarBlynk();  \n  enviarMQTT();   \n}\n\nif (topic == \"aviso/Alarma\" && parseInt(global.get(\"estadoAlarma\") === 0 && parseInt(global.get(\"nivTanque\")) > 150) === 0 && parseInt(global.get(\"hh\")) > 6){\n  global.set(\"autoBomba\", 1);   \n  context.manualPorAlarma = 1; context.tiempo = date.getTime() + 120000; \n//   context.manualPorAlarma = 1;  context.tiempo = date.getTime() + 120000;\n//   if (parseInt(global.get(\"estadoAlarma\")) === 1) return;\n//   if (parseInt(global.get(\"estadoAlarma\")) === 0 && parseInt(global.get(\"hh\")) > 6){\n//     msg = {pin: 127, payload: global.get(\"hsCpu\") + \", paso a AUTO bomba termo por desactivarse alarma casa \\n\"}; node.send([null, null, msg]);\n//     global.set(\"autoBomba\", 1);       a\n  enviarBlynk();\n  enviarMQTT();\n//   }\n} \n\nswitch (pin){\n  case 101:\n    if (parseInt(payload) === 0){\n      context.manualPorAlarma = 1; context.tiempo = date.getTime() + 120000;\n      global.set(\"pedBomba\", 0); }\n     // if(parseInt(global.get(\"nivTanque\") > 150))\n    global.set(\"autoBomba\", parseInt(payload)); \n    enviarMQTT();\n  break;\n\n  case 102:\n    if (parseInt(global.get(\"autoBomba\")) === 0){\n      global.set(\"pedBomba\", payload); \n      enviarMQTT();\n    }\n  break;\n\n  case 103:\n    if (parseInt(payload) === 0)global.set(\"pedResistencia\", 0);\n    global.set(\"autoResistencia\", payload); \n    enviarMQTT();\n  break;\n  case 104:\n    if (parseInt(global.get(\"autoResistencia\")) === 0){\n        global.set(\"pedResistencia\", payload); \n        enviarMQTT();}\n  break;\n}\n\nif (topic == \"ESP/TermoSolar/Envio\"){\n  //0#0#0#15.55#25.55#1020\n    var dato = payload.split(\"#\");\n    global.set(\"estBomba\", parseInt(dato[0])); \n    global.set(\"estResistencia\", parseInt(dato[1])); \n    global.set(\"estToldo\", parseInt(dato[2]));  \n    if (parseInt(dato[3]) !== 0) global.set(\"tempTermoFin\", parseFloat(dato[3]).toFixed(1)); \n    if (parseInt(dato[4]) !== 0)global.set(\"tempExterior\", parseFloat(dato[4]).toFixed(1)); \n    global.set(\"sensorCrep\", parseInt(dato[5])); \n\n  msg= {topic: \"temperaturaTermo\", payload: global.get(\"tempTermoFin\")}; node.send([msg, null, null]);\n  msg= {topic: \"crepuscular\", payload: global.get(\"sensorCrep\")}; node.send([msg, null, null]);\n  msg= {topic: \"temperaturaExterior\", payload: global.get(\"tempExterior\")}; node.send([msg, null, null]);\n  msg= {topic: \"horasDia\", payload: global.get(\"horasDia\")}; node.send([msg, null, null]);  \n\n  if(global.get(\"estResistencia\") === 1){\n      if (context.estAnteriorResistencia === 0){\n      context.encendidoResistencia = 1;\n      context.estAnteriorResistencia = 1;\n      // global.set(\"resistenciaEncendida\", new Date().getTime());\n      context.tiempoInicioResistencia = new Date().getTime();}\n\n      var tiempo = (new Date().getTime() - context.tiempoInicioResistencia) / 60000;\n      var potencia = ((1.5/60) * tiempo).toFixed(5);\n      global.set(\"potenciaResistencia\", potencia);\n  // msg = {topic: \"potResistencia\", payload: global.get(\"potenciaResistencia\")}; node.send([msg, null, null, null]);\n  }\n\n  if (global.get(\"estResistencia\") === 0 && context.encendidoResistencia === 1){\n      context.estAnteriorResistencia = 0;\n      context.encendidoResistencia = 0;\n      var tiempo = (new Date().getTime() - context.tiempoInicioResistencia) / 60000;\n      var potencia = ((1.5/60) * tiempo).toFixed(5);\n      tiempo = parseFloat(tiempo).toFixed(2);\n      global.set(\"tiempoEncResis\", tiempo);\n      global.set(\"potenciaResistencia\", potencia);\n    }\n    enviarBlynk();\n}\n  \n\nif (topic == \"ESP/TermoSolar/EstadoBomba\"){\n  if (payload.substring(0, 11) == \"bombaMarcha\"){\n    global.set(\"estBomba\", parseInt(payload.substring(11)));\n    if (global.get(\"autoBomba\") === 1){estadoBomba = \"Automatico\";}else{estadoBomba = \"Manual\";}\n    msg = {pin: 102, label: estadoBomba, payload: global.get(\"estBomba\")}; node.send([null, null, msg]);\n    controlBomba();\n  }\n}\n\n// var status = new Date().getTime() - global.get(\"comienzoLlenado\")\n// node.status({text: global.get(\"estBomba\") + \" -- \" + status}) ; \n\n// PARADA BOMBA POR ERROR DE MARCHA\nif (global.get(\"estBomba\") === 1 && new Date().getTime() - global.get(\"comienzoLlenado\") > 240000){\n  msg = {topic: \"notifyBlynk\", payload: global.get(\"fechaCompleta\") + \" - ERROR bomba termo paso a manual\"}; node.send([null, msg, null]);\n  msg = {topic: \"terminalBlynk\", payload: global.get(\"fechaCompleta\") + \" - ERROR bomba termo paso a manual\"}; node.send([null, msg, null]);\n  global.set(\"autoBomba\", 0);\n  global.set(\"pedBomba\", 0);\n  enviarBlynk();\n  enviarMQTT();\n}\n\nif (topic == \"ESP/TermoSolar/Inicio\"){\n    var fallasLivingIluminacion = global.get(\"fallasLivingIluminacion\") + 1;\n    global.set(\"fallasLivingIluminacion\", fallasLivingIluminacion);\n    global.set(\"tipoFallaIlLiving\", msg.payload); \n    enviarMQTT();}\n\n\n\nfunction controlBomba(){\n  msg = {topic: \"estBomba\", payload: global.get(\"estBomba\")}; node.send([msg, null, null]);\n  if (global.get(\"estBomba\")=== 1 && context.llenandoTermo === 0){\n    context.llenandoTermo = 1;\n    global.set(\"comienzoLlenado\", new Date().getTime());}\n  if (global.get(\"estBomba\") === 0 && context.llenandoTermo === 1){\n    context.llenandoTermo = 0;\n    var tiempo = new Date().getTime() - global.get(\"comienzoLlenado\");\n    tiempo = parseFloat(tiempo / 1000).toFixed(2);\n    global.set(\"tiempoLlenado\", tiempo);\n    msg = {topic: \"tiempoLlenado\", payload: global.get(\"tiempoLlenado\")}; node.send([msg, null, null]);\n    enviarBlynk();\n  } \n}    \n\nfunction enviarBlynk(){\n    msg = {pin: 101, payload: global.get(\"autoBomba\")}; node.send([null, null, msg]);\n    msg = {pin: 102, payload: global.get(\"estBomba\")}; node.send([null, null, msg]);\n    msg = {pin: 104, payload: global.get(\"estResistencia\")}; node.send([null, null, msg]);\n    msg = {pin: 105, payload: global.get(\"tiempoLlenado\")}; node.send([null, null, msg]);\n    msg = {pin: 110, payload: global.get(\"tempTermoFin\") + \"  --  \" + global.get(\"tempExterior\")}; node.send([null, null, msg]);  \n    msg = {pin: 111, payload: global.get(\"sensorCrep\")}; node.send([null, null, msg]);\n    msg = {pin: 112, payload: global.get(\"tempExterior\")}; node.send([null, null, msg]);\n    msg = {pin: 113, payload: global.get(\"tempTermoFin\")}; node.send([null, null, msg]);\n    // msg = {pin: 114, payload: global.get(\"tiempoLlenado\")}; node.send([null, null, msg]);\n}\n\nfunction enviarMQTT(){   \n    payload = global.get(\"autoBomba\");\n    // payload =\"0\";    \n    payload += \"#\"; payload += global.get(\"autoResistencia\") + \"#\"; payload += global.get(\"autoToldo\") + \"#\"; \n    payload += global.get(\"pedBomba\") + \"#\"; payload += global.get(\"pedResistencia\") + \"#\"; payload += global.get(\"pedToldo\") + \"#\"; \n    payload += global.get(\"tempMaximaTermo\") + \"#\"; payload += global.get(\"tempMaxResistencia\") + \"#\"; \n    payload += global.get(\"tempMaxResistenciaManual\") + \"#\"; payload += global.get(\"tempMinimaResistencia\") + \"#\";\n    payload += global.get(\"valorDia\")  + \"#\"; payload += global.get(\"valorNoche\") + \"#\" + global.get(\"segundosMarchaBomba\");\n    // payload += \"#\" + global.get(\"offsetDia\")  + \"#\"; payload += global.get(\"offsetNoche\");\n    msg.payload = payload;  \n    msg = {topic: \"ESP/TermoSolar/Config\", payload: payload}; node.send([null, msg, null]);\n}","outputs":3,"noerr":0,"x":580,"y":250,"wires":[["2f25b814.9dc9c8","41555cf2.768874"],["edf9984a.5d9928","b8d4156f.274c28"],["f0d50320.3b07c","3ab2d3e0.c8ea8c","aefbe126.ba102"]]},{"id":"edf9984a.5d9928","type":"debug","z":"1b403a13.0ec8c6","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":910,"y":230,"wires":[]},{"id":"f0d50320.3b07c","type":"debug","z":"1b403a13.0ec8c6","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":770,"y":350,"wires":[]},{"id":"621c21a8.3a2ba","type":"mqtt in","z":"1b403a13.0ec8c6","name":"Crepuscular","topic":"ESP/TermoSolar/Crepuscular","qos":"2","broker":"e779f8d6.7bc2c8","x":260,"y":600,"wires":[["918b4e96.a03c1","62ab658a.106c0c"]]},{"id":"c40e9cad.cbe","type":"inject","z":"1b403a13.0ec8c6","name":"noche","topic":"ESP/TermoSolar/Crepuscular","payload":"0","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":270,"y":520,"wires":[["62ab658a.106c0c"]]},{"id":"62ab658a.106c0c","type":"function","z":"1b403a13.0ec8c6","name":"","func":"var payload = parseInt(msg.payload);\ncontext.inicioDia = context.inicioDia || 0;\nvar date = new Date();\n\nif (payload === 1){// payload == valor analogico dia/noche\n\tcontext.inicioDia = date.getTime();\n\tglobal.set(\"Dia\", payload);\n\tglobal.set(\"hsAmanecer\",  global.get(\"hsCpu\"));\n\tmsg = {topic: \"notifyBlynk\", payload: \"Se hizo de dia \" + global.get(\"hsAmanecer\")}; node.send(msg);\n\tmsg = {topic: \"crepMQTT\", payload: payload}; node.send(msg);\n// \tmsg = {topic: \"terminalBlynk\", payload: global.get(\"hsCpu\") + \" se hizo de dia\\n\"}; node.send(msg);\n\tglobal.set(\"avisoMail\", \" se hizo de dia:  \" + global.get(\"hsAmanecer\"));\n}\nif (payload === 0){\n\tvar finDia = date.getTime() - context.inicioDia;\n\tfinDia = finDia / 1000;\n\tvar hhFinDia = parseFloat(finDia / 3600);\n\tvar mmFinDia = parseInt((finDia - hhFinDia) * 60);\n\tvar horasDia = parseInt(hhFinDia) + \".\" + parseInt(mmFinDia);\n\tglobal.set(\"horasDia\",horasDia);\n\tglobal.set(\"Dia\", payload);\n\tglobal.set(\"hsAnochecer\",  global.get(\"hsCpu\"));\n\tmsg = {topic: \"notifyBlynk\", payload: \"Se hizo de noche \" + global.get(\"hsAnochecer\")}; node.send(msg);\n\tmsg = {topic: \"crepMQTT\", payload: payload}; node.send(msg);\t\n// \tmsg = {topic: \"terminalBlynk\", payload: global.get(\"hsCpu\") + \" se hizo de noche defasaje termo 3hs\\n\"}; node.send(msg);\n\tglobal.set(\"avisoMail\", \" se hizo de noche:  \" + global.get(\"hsAnochecer\"));\n}\nif (global.get(\"Dia\") === 1)node.status({text: \"amanecio: \" + global.get(\"hsAmanecer\")})\n\tif (global.get(\"Dia\") === 0)node.status({text: \"hs Dia: \" + global.get(\"horasDia\")})\n\n// if (global.get(\"Dia\") === 0)node.status({text: \"hs Dia: \" + global.get(\"horasDia\")})\n","outputs":1,"noerr":0,"x":420,"y":550,"wires":[["3348a52a.b2afaa","6f9ea193.06795"]]},{"id":"6f9ea193.06795","type":"mqtt out","z":"1b403a13.0ec8c6","name":"","topic":"","qos":"2","retain":"","broker":"e779f8d6.7bc2c8","x":570,"y":490,"wires":[]},{"id":"3a9f7070.1ac67","type":"inject","z":"1b403a13.0ec8c6","name":"dia","topic":"ESP/TermoSolar/Crepuscular","payload":"1","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":270,"y":560,"wires":[["62ab658a.106c0c"]]},{"id":"1bb30aa.73dc7f5","type":"debug","z":"1b403a13.0ec8c6","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1010,"y":610,"wires":[]},{"id":"803cd776.b0d768","type":"e-mail","z":"1b403a13.0ec8c6","server":"smtp.mail.yahoo.com","port":"465","secure":true,"tls":false,"name":"gdietrich22@yahoo.com.ar","dname":"gd28722563","x":1010,"y":560,"wires":[]},{"id":"783330d.01a52d","type":"mqtt in","z":"1b403a13.0ec8c6","name":"","topic":"crepMQTT","qos":"2","broker":"e779f8d6.7bc2c8","x":730,"y":550,"wires":[["eca2840c.d24698","36314470.a4bb7c"]]},{"id":"ed7eb6d5.94a428","type":"inject","z":"1b403a13.0ec8c6","name":"","topic":"","payload":"2","payloadType":"global","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":740,"y":600,"wires":[["eca2840c.d24698"]]},{"id":"eca2840c.d24698","type":"function","z":"1b403a13.0ec8c6","name":"","func":"msg.payload = \"cambio en sensor crepuscular\" + global.get(\"avisoMail\") + \" valor sensor: \" + global.get(\"sensorCrep\");\nreturn msg;","outputs":1,"noerr":0,"x":870,"y":600,"wires":[["803cd776.b0d768","1bb30aa.73dc7f5"]]},{"id":"36314470.a4bb7c","type":"debug","z":"1b403a13.0ec8c6","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":990,"y":520,"wires":[]},{"id":"918b4e96.a03c1","type":"debug","z":"1b403a13.0ec8c6","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":440,"y":600,"wires":[]},{"id":"3348a52a.b2afaa","type":"debug","z":"1b403a13.0ec8c6","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":550,"y":550,"wires":[]},{"id":"e78455a.6986ca8","type":"delay","z":"1b403a13.0ec8c6","name":"100mS","pauseType":"delay","timeout":"100","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":390,"y":260,"wires":[["ab21644b.e84768","fe06b8fc.396e88"]]},{"id":"a2044f3e.c75f5","type":"inject","z":"1b403a13.0ec8c6","name":"timer","topic":"timer","payload":"1","payloadType":"str","repeat":"24","crontab":"","once":false,"onceDelay":0.1,"x":400,"y":60,"wires":[["ab21644b.e84768"]]},{"id":"7e2f87a5.298818","type":"function","z":"1b403a13.0ec8c6","name":"","func":"msg = {pin: 127, payload: global.get(\"hsCpu\") + \" -- \" + msg.payload + \"\\n\"};\n// if (msg.payload.includes(\"bomba\") )return msg;\nreturn msg;","outputs":1,"noerr":0,"x":1370,"y":120,"wires":[[]]},{"id":"52c5ffa0.bffc3","type":"mqtt in","z":"1b403a13.0ec8c6","name":"EstadoBomba","topic":"ESP/TermoSolar/EstadoBomba","qos":"2","broker":"900627dc.76e6a8","x":1160,"y":160,"wires":[["7e2f87a5.298818","96988fbf.aede9"]]},{"id":"8eee94e.8744668","type":"inject","z":"1b403a13.0ec8c6","name":"sin debug","topic":"ESP/TermoSolar/Recibo","payload":"debug0","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1270,"y":210,"wires":[["a71fc5d.4fddb38"]]},{"id":"2cb220ee.0584","type":"inject","z":"1b403a13.0ec8c6","name":"con debug","topic":"ESP/TermoSolar/Recibo","payload":"debug1","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1270,"y":250,"wires":[["a71fc5d.4fddb38"]]},{"id":"a71fc5d.4fddb38","type":"mqtt out","z":"1b403a13.0ec8c6","name":"","topic":"","qos":"","retain":"","broker":"e779f8d6.7bc2c8","x":1410,"y":230,"wires":[]},{"id":"2f25b814.9dc9c8","type":"debug","z":"1b403a13.0ec8c6","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":900,"y":140,"wires":[]},{"id":"11f6ca6a.334236","type":"inject","z":"1b403a13.0ec8c6","name":"pruea timer","topic":"ESP/TermoSolar/Recibo","payload":"prueba30","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1270,"y":290,"wires":[["a71fc5d.4fddb38"]]},{"id":"58ccdacc.e6a2d4","type":"mqtt out","z":"1b403a13.0ec8c6","name":"pedido","topic":"","qos":"","retain":"","broker":"e779f8d6.7bc2c8","x":1910,"y":550,"wires":[]},{"id":"96988fbf.aede9","type":"debug","z":"1b403a13.0ec8c6","name":"debug","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":1370,"y":160,"wires":[]},{"id":"b657b0f0.50ad6","type":"debug","z":"1b403a13.0ec8c6","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1360,"y":70,"wires":[]},{"id":"8b86e157.0815c","type":"function","z":"1b403a13.0ec8c6","name":"","func":"msg = {topic: \"ESP/TermoSolar/Recibo\", payload: \"prueba40\"}; node.send(msg);","outputs":1,"noerr":0,"x":1650,"y":550,"wires":[["58ccdacc.e6a2d4","bf1e07b9.dc63d8"]]},{"id":"6b0b04ae.498c7c","type":"delay","z":"1b403a13.0ec8c6","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1510,"y":550,"wires":[["8b86e157.0815c","424b25d7.2c62cc"]]},{"id":"5578996c.94a0f8","type":"mqtt in","z":"1b403a13.0ec8c6","name":"","topic":"ESP/TermoSolar/Config","qos":"2","broker":"e779f8d6.7bc2c8","x":1230,"y":650,"wires":[["c835e0e7.94e71","c031c992.88fc38"]]},{"id":"347ec7b.6595338","type":"file in","z":"1b403a13.0ec8c6","name":"recover datos termo","filename":"/home/pi/BackUpNodeRed/DatosTermo.txt","format":"utf8","chunk":false,"sendError":false,"x":1560,"y":600,"wires":[["e6471751.5c1cc8","e1724aed.64bca8"]]},{"id":"6756c263.6be20c","type":"file","z":"1b403a13.0ec8c6","name":"back datos termo","filename":"/home/pi/BackUpNodeRed/DatosTermo.txt","appendNewline":false,"createDir":false,"overwriteFile":"true","x":1580,"y":650,"wires":[[]]},{"id":"48534c2.23cc5b4","type":"inject","z":"1b403a13.0ec8c6","name":"","topic":"","payload":"0#0#0#0#0#0#80#55#50#40#650#500#60000","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1390,"y":690,"wires":[["6756c263.6be20c"]]},{"id":"bf1e07b9.dc63d8","type":"debug","z":"1b403a13.0ec8c6","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1900,"y":500,"wires":[]},{"id":"c835e0e7.94e71","type":"debug","z":"1b403a13.0ec8c6","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1560,"y":690,"wires":[]},{"id":"66e1d024.2d37e","type":"inject","z":"1b403a13.0ec8c6","name":"","topic":"","payload":"","payloadType":"date","repeat":"15","crontab":"","once":false,"onceDelay":0.1,"x":1740,"y":110,"wires":[[]]},{"id":"d47448fc.6209e8","type":"function","z":"1b403a13.0ec8c6","name":"","func":"if (global.get(\"rociadorToldo\") === undefined)global.set(\"rociadorToldo\", 0);\ncontext.contador = context.contador || 0;\ncontext.manual = context.manual || 0;\nvar topic = msg.topic;\n\nif (parseInt(global.get(\"hh\")) === 0 && context.manual === 1)context.manual = 0;\n\nif (topic == \"reset\"){\n  global.set(\"rociadorToldo\", 0);\n    msg.payload = \"reset\"; node.send([msg, null]);\n    context.manual = 0; return;}\n\nif (parseInt(global.get(\"hh\")) >= 10 && parseInt(global.get(\"hh\")) < 20 && global.get(\"tempExterior\") > 28 && global.get(\"rociadorToldo\") === 0 && context.manual === 0){\n    context.contador = 1;\n    global.set(\"rociadorToldo\", 1);\n    msg = {pin: 99, payload: 1}; node.send([null, msg]);\n    msg = {topic: \"USBout\", payload: \"rociar1\"}; node.send([msg, null]);\n    msg = {topic: \"ESP/Lavadero/Presurizadora\", payload: 1}; node.send([msg, null]);\n}\n\nif (global.get(\"rociadorToldo\") === 1){\n  if (parseInt(global.get(\"hh\")) >= 20 || global.get(\"tempExterior\") < 20){\n      context.contador = 0;\n      global.set(\"rociadorToldo\", 0);\n      msg = {pin: 99, payload: 0}; node.send([null, msg]);\n      msg = {topic: \"USBout\", payload: \"rociar0\"}; node.send([msg, null]);\n      // msg = {topic: \"ESP/Lavadero/Presurizadora\", payload: 0}; node.send([msg, null]);\n  }\n}\n\nif (global.get(\"rociadorToldo\") === 1)context.contador++;\n\nif (context.contador === 240 && global.get(\"rociadorToldo\") === 1){\n    context.contador = 0;\n    msg = {topic: \"USBout\", payload: \"rociar1\"}; node.send([msg, null]);\n    msg = {topic: \"ESP/Lavadero/Presurizadora\", payload: 1}; node.send([msg, null]);\n}\n\nif (context.contador === 4 && global.get(\"rociadorToldo\") === 1){\n    msg = {topic: \"USBout\", payload: \"rociar0\"}; node.send([msg, null]);\n    // msg = {topic: \"ESP/Lavadero/Presurizadora\", payload: 0}; node.send([msg, null]);\n}\n\nif (msg.pin == \"99\"){\n  if (parseInt(msg.payload) === 0)context.manual = 1;\n    global.set(\"rociadorToldo\", parseInt(msg.payload)); msg.payload = global.get(\"rociadorToldo\"); node.send([msg, null]);\n    context.contador = 0;\n    if (global.get(\"rociadorToldo\") === 0) {\n        msg = {topic: \"USBout\", payload: \"rociar0\"}; node.send([msg, null]);\n        // msg = {topic: \"ESP/Lavadero/Presurizadora\", payload: 0}; node.send([msg, null]);\n    }\n    if (global.get(\"rociadorToldo\") === 1)  {\n        msg = {topic: \"USBout\", payload: \"rociar1\"}; node.send([msg, null]);\n        msg = {topic: \"ESP/Lavadero/Presurizadora\", payload: 1}; node.send([msg, null]);\n    }\n}\nnode.status({text: global.get(\"rociadorToldo\") + \" --- \" + context.contador + \"   11\"});\n","outputs":2,"noerr":0,"x":1920,"y":110,"wires":[["7e927e56.df184","bc335887.16ed48"],["e26cc241.b89f1","826e0b7f.79a788"]]},{"id":"81c8c932.e335b8","type":"debug","z":"1b403a13.0ec8c6","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":1890,"y":180,"wires":[]},{"id":"7e927e56.df184","type":"mqtt out","z":"1b403a13.0ec8c6","name":"","topic":"","qos":"2","retain":"","broker":"e779f8d6.7bc2c8","x":2100,"y":80,"wires":[]},{"id":"bc335887.16ed48","type":"debug","z":"1b403a13.0ec8c6","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":2100,"y":50,"wires":[]},{"id":"859f6258.0956b","type":"template","z":"1b403a13.0ec8c6","name":"","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"debug{{payload}}","output":"str","x":1610,"y":460,"wires":[["2ce345cb.64bb4a"]]},{"id":"2ce345cb.64bb4a","type":"mqtt out","z":"1b403a13.0ec8c6","name":"debug","topic":"ESP/TermoSolar/Recibo","qos":"","retain":"","broker":"e779f8d6.7bc2c8","x":1740,"y":460,"wires":[]},{"id":"424b25d7.2c62cc","type":"delay","z":"1b403a13.0ec8c6","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1510,"y":500,"wires":[["4eaafc40.b6ab34"]]},{"id":"4eaafc40.b6ab34","type":"function","z":"1b403a13.0ec8c6","name":"","func":"msg = {topic: \"ESP/TermoSolar/Recibo\", payload: \"debug0\"}; node.send(msg);","outputs":1,"noerr":0,"x":1650,"y":500,"wires":[["58ccdacc.e6a2d4"]]},{"id":"64b8c0d1.4d858","type":"mqtt in","z":"1b403a13.0ec8c6","name":"","topic":"ESP/TermoSolar/pedido","qos":"2","broker":"e779f8d6.7bc2c8","x":1380,"y":730,"wires":[["e8032584.3a14d8"]]},{"id":"e8032584.3a14d8","type":"delay","z":"1b403a13.0ec8c6","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1560,"y":730,"wires":[["b5ee5872.f60828"]]},{"id":"b5ee5872.f60828","type":"function","z":"1b403a13.0ec8c6","name":"","func":"msg = {topic: \"ESP/TermoSolar/Recibo\", payload: \"debug0\"}; node.send(msg);","outputs":1,"noerr":0,"x":1690,"y":730,"wires":[["45b56431.6ab8cc"]]},{"id":"45b56431.6ab8cc","type":"mqtt out","z":"1b403a13.0ec8c6","name":"pedido","topic":"","qos":"","retain":"","broker":"e779f8d6.7bc2c8","x":1810,"y":730,"wires":[]},{"id":"78a57b12.83d954","type":"inject","z":"1b403a13.0ec8c6","name":"","topic":"reset","payload":"1","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1750,"y":50,"wires":[["d47448fc.6209e8"]]},{"id":"826e0b7f.79a788","type":"debug","z":"1b403a13.0ec8c6","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":2070,"y":170,"wires":[]},{"id":"48dd7364.e41f1c","type":"mqtt in","z":"1b403a13.0ec8c6","name":"estadoBomba","topic":"ESP/TermoSolar/EstadoBomba","qos":"2","broker":"900627dc.76e6a8","x":240,"y":220,"wires":[["8586171e.8702d8"]]},{"id":"aefbe126.ba102","type":"delay","z":"1b403a13.0ec8c6","name":"","pauseType":"delay","timeout":"50","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":790,"y":310,"wires":[["63fd5113.ae3c2"]]},{"id":"c031c992.88fc38","type":"function","z":"1b403a13.0ec8c6","name":"","func":"if (msg.payload.substring(0,6) == \"Manual\")return;\nreturn msg;","outputs":1,"noerr":0,"x":1410,"y":650,"wires":[["6756c263.6be20c"]]},{"id":"a0774f9d.da29a","type":"mqtt in","z":"1b403a13.0ec8c6","name":"ModoBomba","topic":"ESP/TermoSolar/ModoBomba","qos":"2","broker":"900627dc.76e6a8","x":1160,"y":110,"wires":[["7e2f87a5.298818"]]},{"id":"aaf71995.b86808","type":"function","z":"1b403a13.0ec8c6","name":"","func":"// Sal1  thingspeak\n// Sal2  mqtt\n// Sal3  blynk\n// Sal4  mysql\n\ncontext.llenandoTermo = context.llenandoTermo || 0;\ncontext.encendidoResistencia = context.encendidoResistencia || 0;\ncontext.estAnteriorResistencia = context.estAnteriorResistencia || 0;\ncontext.tiempoInicioResistencia = context.tiempoInicioResistencia || 0;\ncontext.bombaAutoAnulada = context.bombaAutoAnulada || 1;\n\nvar topic = msg.topic;\nvar payload = msg.payload;\nvar comienzoLlenado;\nvar terminoLlenado;\nvar valorDia = global.get(\"valorDia\");\nvar valorNoche = global.get(\"valorNoche\");\n\nif (topic == \"crepMQTT\" && payload == \"1\"){\n  global.set(\"millisDia\", new Date().getTime() + 1000 * 60 * 60); \n  msg = {pin: 127, payload: global.get(\"hsCpu\") + \", se hizo de dia defasaje 1hs \\n\"};\n  return([null, null, msg, null]);\n}\nnode.status({text: global.get(\"hh\") + \" -- \" + global.get(\"autoBomba\") + \" -- \" + global.get(\"estBomba\")})\n\nif (topic == \"timer\"){\n if (parseInt(global.get(\"hh\")) === 22 && parseInt(global.get(\"mm\")) === 0 && parseInt(global.get(\"autoBomba\")) === 1 && parseInt(global.get(\"estBomba\")) === 0){\n   msg = {pin: 127, payload: global.get(\"hsCpu\") + \", paso a manual bomba termo \\n\"}; node.send([null, null, msg, null]);\n   global.set(\"autoBomba\", 0);\n   global.set(\"pedBomba\", 0);\n   enviarBlynk();\n   enviarMQTT();\n }\n // if (new Date().getTime() > parseInt(global.get(\"millisDia\")) && parseInt(global.get(\"autoBomba\") === 0)){\n //   msg = {pin: 127, payload: global.get(\"hsCpu\") + \", paso a automatico bomba termo por offset dia \\n\"}; node.send([null, null, msg, null]);\n //   global.set(\"autoBomba\", 1); \n //   enviarMQTT();\n // }\n if (parseInt(global.get(\"hh\")) === 9 && parseInt(global.get(\"mm\")) === 0 && parseInt(global.get(\"autoBomba\")) === 0){\n   msg = {pin: 127, payload: global.get(\"hsCpu\") + \", paso a automatico bomba termo por hora \\n\"}; node.send([null, null, msg, null]);\n   context.bombaAutoAnulada = 0;\n   global.set(\"autoBomba\", 1); \n   // msg = {pin: 102, payload: global.get(\"autoBomba\")}; node.send([null, null, msg, null]);\n   enviarBlynk();\n   enviarMQTT();\n } \n return;\n}\n\n\nif (topic == \"bombaAuto\"){\t\n  if (parseInt(payload) === 0){\n    global.set(\"bombaAutoAnulada\", 0);\n    global.set(\"pedBomba\", 0); }\n    // context.bombaAutoAnulada = 1;} \n  if (parseInt(payload) === 1){\n    global.set(\"bombaAutoAnulada\", 1);}\n    // context.bombaAutoAnulada = 0;}\n  global.set(\"autoBomba\", payload); enviarMQTT();}\n\n// if (topic == \"forzarManual\"){\n//  if (parseInt(payload) === 0){//habilitada\n//    // global.set(\"bombaAutoAnulada\", 1);\n//    global.set(\"autoBomba\", 0); \n//    msg = \"Manual0\";\n//  }\n//    // context.bombaAutoAnulada = 1;} \n//  if (parseInt(payload) === 1){//anulada\n//    // global.set(\"bombaAutoAnulada\", 0);\n//    msg = \"Manual1\";}\n//    // context.bombaAutoAnulada = 0;}\n//  global.set(\"autoBomba\", payload); \n//  msg = {topic:\"ESP/TermoSolar/Config\", payload: msg};\n//     node.send([null, msg, null, null]);\n\n//  // enviarMQTT();}  \n// }\n\nif (topic == \"marchaBomba\" && global.get(\"autoBomba\") === 0){\n  global.set(\"pedBomba\", payload); enviarMQTT();}\n  \nif (topic == \"resistenciaAuto\"){\n  if (parseInt(payload) === 0)global.set(\"pedResistencia\", 0);\n  global.set(\"autoResistencia\", payload); enviarMQTT();}//encendidoResistencia\n\nif (topic == \"encendidoResistencia\" && global.get(\"autoResistencia\") === 0){\n  global.set(\"pedResistencia\", payload); enviarMQTT();}\n\nif (topic == \"ESP/TermoSolar/Envio\"){\n  //0#0#0#15.55#25.55#1020\n  var dato = payload.split(\"#\");\n  global.set(\"estBomba\", parseInt(dato[0])); \n  global.set(\"estResistencia\", parseInt(dato[1])); \n  global.set(\"estToldo\", parseInt(dato[2]));  \n  global.set(\"tempTermoFin\", dato[3]); \n  global.set(\"tempExterior\", dato[4]); \n  global.set(\"sensorCrep\", parseInt(dato[5])); //msg.payload = dato[5]; node.send(msg);\n\n  // msg = {pin: 102, payload: global.get(\"estBomba\")}; node.send([null, null, msg, null]);\n  // msg = {pin: 104, payload: global.get(\"estResistencia\")}; node.send([null, null, msg, null]);\n  // msg = {pin: 110, payload: global.get(\"tempTermoFin\")}; node.send([null, null, msg, null]);\n  // msg = {pin: 111, payload: global.get(\"sensorCrep\")}; node.send([null, null, msg, null]);\n  // msg = {pin: 112, payload: global.get(\"tempExterior\")}; node.send([null, null, msg, null]);\n\n\n  msg= {topic: \"temperaturaTermo\", payload: global.get(\"tempTermoFin\")}; node.send([msg, null, null, null]);\n  // msg = {pin: 113, payload: global.get(\"tempTermoFin\")}; node.send([null, null, msg, null]);\n  // msg = {pin: 110, payload: global.get(\"tempTermoFin\") + \"  --  \" + global.get(\"tempExterior\")}; node.send([null, null, msg, null]);\n\n  msg= {topic: \"crepuscular\", payload: global.get(\"sensorCrep\")}; node.send([msg, null, null, null]);\n  // msg = {pin: 111, payload: global.get(\"sensorCrep\")}; node.send([null, null, msg, null]);\n\n  msg= {topic: \"temperaturaExterior\", payload: global.get(\"tempExterior\")}; node.send([msg, null, null, null]);\n  // msg = {pin: 112, payload: global.get(\"tempExterior\")}; node.send([null, null, msg, null]);  //estBomba\n\n  // msg= {topic: \"estBomba\", payload: global.get(\"estBomba\")}; node.send([msg, null, null, null]);\n  // msg= {topic: \"estResistencia\", payload: global.get(\"estResistencia\")}; node.send([msg, null, null, null]);\n\n//  controlCrepuscular();\n  // controlBomba();\n\n    if(global.get(\"estResistencia\") === 1){\n        if (context.estAnteriorResistencia === 0){\n        context.encendidoResistencia = 1;\n        context.estAnteriorResistencia = 1;\n        // global.set(\"resistenciaEncendida\", new Date().getTime());\n        context.tiempoInicioResistencia = new Date().getTime();}\n\n        var tiempo = (new Date().getTime() - context.tiempoInicioResistencia) / 60000;\n        var potencia = ((1.5/60) * tiempo).toFixed(5);\n        global.set(\"potenciaResistencia\", potencia);\n    // msg = {topic: \"potResistencia\", payload: global.get(\"potenciaResistencia\")}; node.send([msg, null, null, null]);\n    }\n\n    if (global.get(\"estResistencia\") === 0 && context.encendidoResistencia === 1){\n        context.estAnteriorResistencia = 0;\n        context.encendidoResistencia = 0;\n        var tiempo = (new Date().getTime() - context.tiempoInicioResistencia) / 60000;\n        var potencia = ((1.5/60) * tiempo).toFixed(5);\n        tiempo = parseFloat(tiempo).toFixed(2);\n        global.set(\"tiempoEncResis\", tiempo);\n        global.set(\"potenciaResistencia\", potencia);\n\n\n\n        // msg = {topic: \"tiempoEncResis\", payload: global.get(\"tiempoEncResis\")}; node.send([msg, null, null, null]);\n        // msg = {topic: \"potResistencia\", payload: global.get(\"potenciaResistencia\")}; node.send([msg, null, null, null]);\n        // global.set(\"potenciaResistencia\",0);\n    }\n    // if (global.get(\"estResistencia\") === \"0\" && context.encendidoResistencia == \"0\"){\n    //  msg = {topic: \"potResistencia\", payload: global.get(\"potenciaResistencia\")}; \n    //  node.send([msg, null, null, null]);}\n    enviarBlynk();\n}\n\n// if (topic == \"ESP/TermoSolar/ModoBomba\"){\n//  if (payload.substring(0, 9) == \"bombaAuto\"){\n//  // if (payload.includes(\"bombaAuto0\") || payload.includes(\"bombaAuto1\")){\n//    global.set(\"autoBomba\", parseInt(payload.substring(9)));\n//    if (global.get(\"autoBomba\") === 0)global.set(\"pedBomba\", 0);\n//    if (global.get(\"autoBomba\") === 1){estadoBomba = \"Automatico\";}else{estadoBomba = \"Manual\";}\n//    msg = {pin: 102, label: estadoBomba, payload: global.get(\"pedBomba\")}; node.send([null, null, msg, null]);    \n//    // enviarMQTT();\n//    // msg = {pin: 102, payload: global.get(\"autoBomba\")}; node.send([null, null, msg, null]);    \n//  }\n// }\nif (topic == \"ESP/TermoSolar/EstadoBomba\"){//  bombaMarcha1\n  if (payload.substring(0, 11) == \"bombaMarcha\"){// || payload.substring(0, 12) == \"bombaM+archa\"){\n  // if (payload.includes(\"bombaMarcha0\") || payload.includes(\"bombaMarcha1\")){\n    global.set(\"estBomba\", parseInt(payload.substring(11)));\n    if (global.get(\"autoBomba\") === 1){estadoBomba = \"Automatico\";}else{estadoBomba = \"Manual\";}\n    msg = {pin: 102, label: estadoBomba, payload: global.get(\"estBomba\")}; node.send([null, null, msg, null]);\n    // if (global.get(\"estBomba\") === 0)global.set(\"pedBomba\", 0);\n    // msg = {pin: 102, payload: global.get(\"estBomba\")}; node.send([null, null, msg, null]);\n    // enviarMQTT();\n    controlBomba();\n  }\n\n  // global.set(\"estBomba\", parseInt(payload));\n  // msg = {pin: 102, payload: global.get(\"estBomba\")}; node.send([null, null, msg, null]);\n  // controlBomba();\n}\n\nif (topic == \"ESP/TermoSolar/pedido\"){\n    var fallasLivingIluminacion = global.get(\"fallasLivingIluminacion\") + 1;\n    global.set(\"fallasLivingIluminacion\", fallasLivingIluminacion);\n    global.set(\"tipoFallaIlLiving\", msg.payload); \n    enviarMQTT();}\n\nfunction controlBomba(){\n  msg = {topic: \"estBomba\", payload: global.get(\"estBomba\")}; node.send([msg, null, null, null]);\n  if (global.get(\"estBomba\")=== 1 && context.llenandoTermo === 0){\n    context.llenandoTermo = 1;\n    global.set(\"comienzoLlenado\", new Date().getTime());}\n  if (global.get(\"estBomba\") === 0 && context.llenandoTermo === 1){\n    context.llenandoTermo = 0;\n    var tiempo = new Date().getTime() - global.get(\"comienzoLlenado\");\n    tiempo = parseFloat(tiempo / 1000).toFixed(2);\n    global.set(\"tiempoLlenado\", tiempo);\n    msg = {topic: \"tiempoLlenado\", payload: global.get(\"tiempoLlenado\")}; node.send([msg, null, null, null]);\n    enviarBlynk();\n    // msg = {pin: 114, payload: global.get(\"tiempoLlenado\")}; node.send([null, null, msg, null]);\n    // msg = {pin: 105, payload: global.get(\"tiempoLlenado\")}; node.send([null, null, msg, null]);\n  } \n}    \n\n// function controlCrepuscular(){\n//  if (global.get(\"sensorCrep\") > valorDia && global.get(\"Dia\") === 0){global.set(\"Dia\", 1); msg = {topic: \"ESP/TermoSolar/Crepuscular\", payload: global.get(\"Dia\")}; node.send([null, msg, null, null]);}\n//  if (global.get(\"sensorCrep\") < valorNoche && global.get(\"Dia\") === 1){global.set(\"Dia\", 0); msg = {topic: \"ESP/TermoSolar/Crepuscular\", payload: global.get(\"Dia\")}; node.send([null, msg, null, null]);}\n//  // msg = {topic: \"ESP/TermoSolar/Crepuscular\", payload: global.get(\"Dia\")}; node.send([null, msg, null, null]);\n// }\n\nfunction enviarBlynk(){\n    msg = {pin: 101, payload: global.get(\"autoBomba\")}; node.send([null, null, msg, null]);\n    msg = {pin: 102, payload: global.get(\"estBomba\")}; node.send([null, null, msg, null]);\n    msg = {pin: 104, payload: global.get(\"estResistencia\")}; node.send([null, null, msg, null]);\n    msg = {pin: 105, payload: global.get(\"tiempoLlenado\")}; node.send([null, null, msg, null]);\n    msg = {pin: 110, payload: global.get(\"tempTermoFin\") + \"  --  \" + global.get(\"tempExterior\")}; node.send([null, null, msg, null]);  \n    msg = {pin: 111, payload: global.get(\"sensorCrep\")}; node.send([null, null, msg, null]);\n    msg = {pin: 112, payload: global.get(\"tempExterior\")}; node.send([null, null, msg, null]);\n    msg = {pin: 113, payload: global.get(\"tempTermoFin\")}; node.send([null, null, msg, null]);\n    msg = {pin: 114, payload: global.get(\"tiempoLlenado\")}; node.send([null, null, msg, null]);\n}\n\nfunction enviarMQTT(){   \n  // msg = {pin: 101, payload: global.get(\"autoBomba\")}; node.send([null, null, msg, null]);\n  // var estadoBomba;\n  // if (global.get(\"autoBomba\") === 1){estadoBomba = \"Automatico\";}else{estadoBomba = \"Manual\";}\n  // msg = {pin: 102, label: estadoBomba, payload: global.get(\"pedBomba\")}; node.send([null, null, msg, null]);\n  // msg = {pin: 104, payload: global.get(\"pedResistencia\")}; node.send([null, null, msg, null]);\n  // if (topic == \"ESP/TermoSolar/Bomba\")return;\n    // msg.payload = topic; node.send([null, msg, null, null]); \n    payload = global.get(\"autoBomba\") + \"#\"; payload += global.get(\"autoResistencia\") + \"#\"; payload += global.get(\"autoToldo\") + \"#\"; \n    payload += global.get(\"pedBomba\") + \"#\"; payload += global.get(\"pedResistencia\") + \"#\"; payload += global.get(\"pedToldo\") + \"#\"; \n    payload += global.get(\"tempMaximaTermo\") + \"#\"; payload += global.get(\"tempMaxResistencia\") + \"#\"; \n    payload += global.get(\"tempMaxResistenciaManual\") + \"#\"; payload += global.get(\"tempMinimaResistencia\") + \"#\";\n    payload += global.get(\"valorDia\")  + \"#\"; payload += global.get(\"valorNoche\") + \"#\" + global.get(\"segundosMarchaBomba\");\n    payload += \"#\" + global.get(\"offsetDia\")  + \"#\"; payload += global.get(\"offsetNoche\");\n    // payload += \"#\" + global.get(\"bombaAutoAnulada\");\n    msg.payload = payload;  \n    msg = {topic: \"ESP/TermoSolar/Config\", payload: payload}; node.send([null, msg, null, null]);\n}","outputs":4,"noerr":0,"x":170,"y":130,"wires":[[],[],[],[]]},{"id":"8586171e.8702d8","type":"delay","z":"1b403a13.0ec8c6","name":"100mS","pauseType":"delay","timeout":"100","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":390,"y":220,"wires":[["ab21644b.e84768","fe06b8fc.396e88"]]},{"id":"714074bc.f19adc","type":"mqtt in","z":"1b403a13.0ec8c6","name":"","topic":"ESP/Lavadero/Presurizadora","qos":"2","broker":"e779f8d6.7bc2c8","x":1810,"y":230,"wires":[["1efdc9d5.58a246","2cfcf6cd.bcf37a"]]},{"id":"1efdc9d5.58a246","type":"function","z":"1b403a13.0ec8c6","name":"","func":"if (msg.payload === \"0\") msg.payload = global.get(\"fechaCompleta\") + \" - Sin Rociar\\n\";\nif (msg.payload === \"1\") msg.payload = global.get(\"fechaCompleta\") + \" - Rociando\\n\";\nreturn msg;","outputs":1,"noerr":0,"x":2000,"y":230,"wires":[["5475e278.3c5b9c"]]},{"id":"5475e278.3c5b9c","type":"mqtt out","z":"1b403a13.0ec8c6","name":"","topic":"terminalBlynk","qos":"","retain":"","broker":"e779f8d6.7bc2c8","x":2160,"y":230,"wires":[]},{"id":"2cfcf6cd.bcf37a","type":"debug","z":"1b403a13.0ec8c6","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":2020,"y":270,"wires":[]},{"id":"7ff991b6.a5e4","type":"mqtt out","z":"1b403a13.0ec8c6","name":"","topic":"ESP/Lavadero/Presurizadora","qos":"","retain":"","broker":"e779f8d6.7bc2c8","x":2280,"y":340,"wires":[]},{"id":"207131b0.1d8eee","type":"mqtt in","z":"1b403a13.0ec8c6","name":"","topic":"aviso/Alarma","qos":"2","broker":"6b36e4a.1d30b1c","x":210,"y":180,"wires":[["bae3486e.dfcff8"]]},{"id":"6991b26c.c8e9bc","type":"inject","z":"1b403a13.0ec8c6","name":"","topic":"","payload":"0","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":560,"y":110,"wires":[["8176684.e76be98"]]},{"id":"8176684.e76be98","type":"function","z":"1b403a13.0ec8c6","name":"","func":"msg.pin = 101;\nreturn msg;","outputs":1,"noerr":0,"x":690,"y":90,"wires":[["ab21644b.e84768"]]},{"id":"c278ff48.39bdd","type":"inject","z":"1b403a13.0ec8c6","name":"","topic":"","payload":"1","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":560,"y":70,"wires":[["8176684.e76be98"]]},{"id":"50158935.a4d658","type":"mqtt in","z":"1b403a13.0ec8c6","name":"","topic":"ESP/Lavadero/AguaCaliente","qos":"2","broker":"e779f8d6.7bc2c8","x":310,"y":90,"wires":[["fe06b8fc.396e88","ab21644b.e84768"]]},{"id":"d4c1348d.835678","type":"inject","z":"1b403a13.0ec8c6","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":170,"y":680,"wires":[["f6be1ee4.df03e"]]},{"id":"f6be1ee4.df03e","type":"function","z":"1b403a13.0ec8c6","name":"","func":"msg.payload = global.get(\"hsCpu\");\nreturn msg;","outputs":1,"noerr":0,"x":310,"y":680,"wires":[["616f0886.bef8c8"]]},{"id":"616f0886.bef8c8","type":"debug","z":"1b403a13.0ec8c6","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":500,"y":680,"wires":[]},{"id":"e1724aed.64bca8","type":"debug","z":"1b403a13.0ec8c6","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1800,"y":630,"wires":[]},{"id":"fe06b8fc.396e88","type":"debug","z":"1b403a13.0ec8c6","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":586,"y":160,"wires":[]},{"id":"24526277.28ed5e","type":"inject","z":"1b403a13.0ec8c6","name":"","topic":"","payload":"1","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":2060,"y":310,"wires":[["7ff991b6.a5e4"]]},{"id":"aeadf4ea.43d888","type":"inject","z":"1b403a13.0ec8c6","name":"","topic":"","payload":"0","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":2060,"y":370,"wires":[["7ff991b6.a5e4"]]},{"id":"f38030c.80697d","type":"mqtt in","z":"1b403a13.0ec8c6","name":"","topic":"ESP/Lavadero/AguaFria","qos":"2","broker":"e779f8d6.7bc2c8","x":2000,"y":400,"wires":[["a8d1fe12.dfe07"]]},{"id":"a8d1fe12.dfe07","type":"function","z":"1b403a13.0ec8c6","name":"","func":"var dato = msg.payload;\nif (dato.substring(0, 15) == \"BombaAguaFriaSI\")msg.payload = 1;\nif (dato.substring(0, 15) == \"BombaAguaFriaNO\")msg.payload = 0;\nreturn msg;","outputs":1,"noerr":0,"x":2180,"y":400,"wires":[["257fa906.068fd6"]]},{"id":"bae3486e.dfcff8","type":"delay","z":"1b403a13.0ec8c6","name":"100mS","pauseType":"delay","timeout":"100","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":390,"y":180,"wires":[["ab21644b.e84768","fe06b8fc.396e88"]]},{"id":"52c7b36.5c7ef4c","type":"link in","z":"1b403a13.0ec8c6","name":"","links":["744f52d5.ad8ecc"],"x":885,"y":560,"wires":[["803cd776.b0d768"]]},{"id":"fe798083.6f5ef","type":"inject","z":"1b403a13.0ec8c6","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":660,"y":430,"wires":[["5b8c1bdb.1402c4"]]},{"id":"5b8c1bdb.1402c4","type":"function","z":"1b403a13.0ec8c6","name":"","func":"msg= {topic: \"horasDia\", payload: \"1.5\"};\nreturn msg;","outputs":1,"noerr":0,"x":820,"y":440,"wires":[["48c20767.e64078"]]},{"id":"ecc24e7c.a4bec","type":"function","z":"950c1426.ff4008","name":"","func":"var pin = parseInt(msg.pin);\nvar intPayload = parseInt(msg.payload);\nvar topic = msg.topic;\nvar topicInicial = msg.topic;\nvar dato;\nvar timerLuces = 12000;  \ncontext.parcheDejarApagarLuz = context.parcheDejarApagarLuz || 0;\nvar date = new Date();\n\nif (global.get(\"estLuzBano\") === undefined)global.set(\"estLuzBano\", 0);\nif (global.get(\"pwmLuzBano\") === undefined)global.set(\"pwmLuzBano\", 512);\nif (global.get(\"modoDucha\") === undefined)global.set(\"modoDucha\", 0);\nif (global.get(\"estDucha\") === undefined)global.set(\"estDucha\", 0);\nif (global.get(\"pwmDucha\") === undefined)global.set(\"pwmDucha\", 512);\nif (global.get(\"estLuzEspejo\") === undefined)global.set(\"estLuzEspejo\", 0);\nif (global.get(\"estExtractorBano\") === undefined)global.set(\"estExtractorBano\", 0);\nif (global.get(\"timerExtractorBano\") === undefined)global.set(\"timerExtractorBano\", 5);\n\n\nif (topic == \"aviso/Alarma\" && global.get(\"estadoAlarma\") === 1){\n  global.set(\"estLuzBano\", 0);\n  global.set(\"estDucha\", 0);\n  global.set(\"estLuzEspejo\", 0);\n  global.set(\"estExtractorBano\", 0);  \n  enviarBlynk();\n  enviarMQTT();\n}\n\nif (topic == \"aviso/Alarma\"){\n  if (global.get(\"estLuzBano\") === 1 && global.get(\"estadoAlarma\") === 1)apagadoLuces();\n  context.parcheDejarApagarLuz = date.getTime();\n  return;\n}\n\n// if (topic == \"ESP/Bano/Desconectado\") {\n//     enviarMQTT();\n//     return;\n// }\n\nif (topic == \"ESP/Pasillo/Iluminacion/Envio\") {\n  global.set(\"estLuzPasillo\", parseInt(msg.payload.substring(4)));\n  msg = {pin: 44, payload: global.get(\"estLuzPasillo\")}; node.send([null, msg]);  \n  }\n\nif (topic == \"google/Baño\"){\n  enviarBlynk();\n  enviarMQTT();\n}\n\nif (topic == \"crepMQTT\"){enviarMQTT(); return;}\n\nif (topic == \"ESP/Bano/Inicio\"){  \n    var fallasBano = global.get(\"fallasBano\") + 1;\n    global.set(\"fallasBano\", fallasBano);\n    global.set(\"fallasBano\", msg.payload);// msg = {topic: \"fallas_MQTT\", payload: 1}; node.send([msg, null]);\n    msg = {topic: \"terminalBlynk\", payload: global.get(\"hsCpu\") + \"  ResetNano Baño\" + \"\\n\"}; node.send([msg, null]);\n    topicInicial = \"ESP/Bano/Inicio\";\n    enviarMQTT();\n    return;\n}\n\nif (topic == \"ESP/Bano/Envio\"){\n  if (msg.payload == \"timerExtractorSI\"){\n    msg = {pin: 43, color: \"#ED9D00\", payload: global.get(\"estExtractorBano\")}; node.send([null, msg]);\n    return;\n  }\n  if (msg.payload == \"timerExtractorNO\"){\n    global.set(\"estExtractorBano\", 0);\n    msg = {pin: 43, color: \"#23C48E\", payload: global.get(\"estExtractorBano\")}; node.send([null, msg]);\n    return;\n  } \n  dato = msg.payload.split(\"#\");\n  global.set(\"estLuzBano\", parseInt(dato[0]));\n  global.set(\"estLuzEspejo\", parseInt(dato[1]));\n  global.set(\"modoDucha\", parseInt(dato[2]));\n  global.set(\"estDucha\", parseInt(dato[3]));\n  global.set(\"estExtractorBano\", parseInt(dato[4]));  \n  enviarBlynk();\n  return;\n}\n// if (global.get(\"luzBano\") === 0 && context.parcheDejarApagarLuz === 1)context.parcheDejarApagarLuz = 0;\n\nswitch (pin){\n  case 39:  \n    global.set(\"modoDucha\", intPayload);\n    if (msg.tema == \"node\")enviarBlynk();\n    enviarMQTT();\n  break;\n  case 40:\n    if (intPayload === 0){global.set(\"modoDucha\", 1); global.set(\"estDucha\", 0);}\n    if (intPayload === 1){global.set(\"modoDucha\", 0); global.set(\"estDucha\", 1);}\n    if (parseInt(global.get(\"Dia\")) === 0 && parseInt(global.get(\"estDucha\")) === 0)global.set(\"estLuzBano\", 1);\n    if (msg.tema = \"node\")enviarBlynk();\n    enviarBlynk();\n    enviarMQTT();\n  break;\n  case 41:\n    global.set(\"estLuzBano\", intPayload);\n    if (global.get(\"estLuzBano\") === 0)global.set(\"estLuzEspejo\", 0);\n    context.parcheDejarApagarLuz = date.getTime();\n    if (msg.tema = \"node\")enviarBlynk();\n    enviarMQTT();  \n  break;\n  case 42:\n    global.set(\"estLuzEspejo\", intPayload);\n    // context.parcheDejarApagarLuz = date.getTime();\n    if (msg.tema = \"node\")enviarBlynk();\n    enviarMQTT();  \n  break;\n  case 43:\n    global.set(\"estExtractorBano\", intPayload);\n    // context.parcheDejarApagarLuz = date.getTime();\n    if (msg.tema = \"node\")enviarBlynk();\n    enviarMQTT();  \n  break;\n  case 44:\n    global.set(\"estLuzPasillo\", intPayload);\n    // context.parcheDejarApagarLuz = date.getTime();\n    if (msg.tema = \"node\")enviarBlynk();\n    msg = {topic: \"ESP/Pasillo/Iluminacion/Recibo\", payload: global.get(\"estLuzPasillo\")}; node.send([msg, null]);\n  break;    \n}\n\nfunction apagadoLuces(){\n  global.set(\"estLuzBano\", 0);\n  global.set(\"estDucha\", 0);\n  global.set(\"estLuzEspejo\", 0);\n  global.set(\"estExtractorBano\", 0); \n  enviarBlynk();\n  enviarDatos();\n}\n\nnode.status({text: context.parcheDejarApagarLuz});\n\nfunction enviarBlynk(){\n  msg = {pin: 39, payload: global.get(\"modoDucha\")}; node.send([null, msg]);\n  msg = {pin: 40, payload: global.get(\"estDucha\")}; node.send([null, msg]);\n  msg = {pin: 41, payload: global.get(\"estLuzBano\")}; node.send([null, msg]);\n  msg = {pin: 42, payload: global.get(\"estLuzEspejo\")}; node.send([null, msg]);\n  msg = {pin: 43, payload: global.get(\"estExtractorBano\")}; node.send([null, msg]);\n  msg = {pin: 44, payload: global.get(\"estLuzPasillo\")}; node.send([null, msg]);\n  msg = {topic: \"bano/nodeRed\", payload: 1}; node.send([msg, null]);\n}\n\nfunction enviarMQTT(){\n  var dato = global.get(\"estLuzBano\") + \"#\" + global.get(\"pwmLuzBano\") + \"#\" + global.get(\"modoDucha\") + \"#\" + global.get(\"estDucha\") + \"#\" + global.get(\"pwmDucha\");\n  dato += \"#\" + global.get(\"estLuzEspejo\") + \"#\" + global.get(\"estExtractorBano\") + \"#\" + global.get(\"timerExtractorBano\") + \"#\" + global.get(\"Dia\");\n\n  if (topicInicial == \"ESP/Bano/Inicio\" || topicInicial == \"aviso/Alarma\" || topicInicial == \"crepMQTT\") dato +=\"#\";\n\n    msg = {topic: \"ESP/Bano/Recibo\", payload: dato}; node.send([msg, null]);\n    msg = {topic: \"bano/nodeRed\", payload: 1}; node.send([msg, null]);\n}","outputs":2,"noerr":0,"x":600,"y":290,"wires":[["7269b5d7.99336c","a4ace061.8ed99","752e79d6.3f74e8"],["a2c7c31d.c89e1","ad5fc954.82ae08","a4ace061.8ed99"]]},{"id":"752e79d6.3f74e8","type":"mqtt out","z":"950c1426.ff4008","name":"","topic":"","qos":"2","retain":"","broker":"e779f8d6.7bc2c8","x":770,"y":240,"wires":[]},{"id":"7269b5d7.99336c","type":"debug","z":"950c1426.ff4008","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":810,"y":200,"wires":[]},{"id":"a2c7c31d.c89e1","type":"delay","z":"950c1426.ff4008","name":"","pauseType":"delay","timeout":"50","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":750,"y":330,"wires":[["812daebc.b64d6"]]},{"id":"7899449.c046cbc","type":"mqtt in","z":"950c1426.ff4008","name":"","topic":"ESP/Bano/Desconectado","qos":"2","broker":"e779f8d6.7bc2c8","x":360,"y":310,"wires":[["ecc24e7c.a4bec"]]},{"id":"1de49172.37446f","type":"mqtt in","z":"950c1426.ff4008","name":"","topic":"ESP/Bano/Inicio","qos":"2","broker":"e779f8d6.7bc2c8","x":390,"y":270,"wires":[["ecc24e7c.a4bec","e527c6fe.977b28"]]},{"id":"5fb2248c.5ea6dc","type":"mqtt in","z":"950c1426.ff4008","name":"","topic":"ESP/Bano/Envio","qos":"2","broker":"e779f8d6.7bc2c8","x":390,"y":230,"wires":[["ecc24e7c.a4bec","c3cff062.b2bab"]]},{"id":"f6460c12.db57b","type":"inject","z":"950c1426.ff4008","name":"","topic":"","payload":"debug1","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1110,"y":510,"wires":[["d568dd07.8f5e2"]]},{"id":"d568dd07.8f5e2","type":"mqtt out","z":"950c1426.ff4008","name":"","topic":"ESP/Bano/Recibo","qos":"","retain":"","broker":"e779f8d6.7bc2c8","x":1370,"y":550,"wires":[]},{"id":"3bc6660d.c1368a","type":"link in","z":"950c1426.ff4008","name":"","links":["a4ace061.8ed99","fdb236.1e712dc8"],"x":205,"y":720,"wires":[[]]},{"id":"21b0c5b2.1b19aa","type":"function","z":"950c1426.ff4008","name":"","func":"if (msg.topic == \"modoDucha\")msg = {pin: 39, tema: \"node\", payload: msg.payload};\nif (msg.topic == \"estadoDucha\")msg = {pin: 40, tema: \"node\", payload: msg.payload};\nif (msg.topic == \"Bano\")msg = {pin: 41, tema: \"node\", payload: msg.payload};\nif (msg.topic == \"LuzEspejo\")msg = {pin: 42, tema: \"node\", payload: msg.payload};\nif (msg.topic == \"Extractor\")msg = {pin: 43, tema: \"node\", payload: msg.payload};\nif (msg.topic == \"LuzPasillo\")msg = {pin: 44, tema: \"node\", payload: msg.payload};\n\nnode.send(msg);","outputs":1,"noerr":0,"x":990,"y":750,"wires":[["5ff65043.e44ec","c766359a.24a6e8"]]},{"id":"cbc33915.1eb6d8","type":"function","z":"950c1426.ff4008","name":"","func":"msg.payload = global.get(\"estLuzBano\"); node.send([msg, null, null, null, null, null]);\nmsg.payload = global.get(\"modoDucha\"); node.send([null, msg, null, null, null, null]);\nmsg.payload = global.get(\"estDucha\"); node.send([null, null, msg, null, null, null]);\nmsg.payload = global.get(\"estLuzEspejo\"); node.send([null, null, null, msg, null, null]);\nmsg.payload = global.get(\"estExtractorBano\"); node.send([null, null, null, null, msg, null]);\nmsg.payload = global.get(\"estLuzPasillo\"); node.send([null, null, null, null, null, msg]);\nnode.status({text: global.get(\"estDucha\")});","outputs":6,"noerr":0,"x":640,"y":760,"wires":[["c2e8ba24.39f3b8"],["f421502e.fe9ae","ad1b1083.a26f5"],["b59774c0.577fd8"],["a2dff89e.cf8708"],["75b90702.f612f8"],["38baede0.8038e2"]]},{"id":"5ff65043.e44ec","type":"link out","z":"950c1426.ff4008","name":"salidaLiving","links":["335c5990.d9cc06"],"x":1090,"y":750,"wires":[]},{"id":"a4ace061.8ed99","type":"link out","z":"950c1426.ff4008","name":"inluminacionBano","links":["3bc6660d.c1368a"],"x":705,"y":290,"wires":[]},{"id":"335c5990.d9cc06","type":"link in","z":"950c1426.ff4008","name":"salidaBano","links":["5ff65043.e44ec"],"x":455,"y":690,"wires":[["ecc24e7c.a4bec"]]},{"id":"38cc6f5f.406e4","type":"delay","z":"950c1426.ff4008","name":"","pauseType":"delay","timeout":"100","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":490,"y":760,"wires":[["cbc33915.1eb6d8","f6336559.461d98"]]},{"id":"c766359a.24a6e8","type":"debug","z":"950c1426.ff4008","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":1060,"y":810,"wires":[]},{"id":"b973308d.f8b82","type":"mqtt in","z":"950c1426.ff4008","name":"","topic":"google/Baño","qos":"2","broker":"e779f8d6.7bc2c8","x":400,"y":190,"wires":[["ecc24e7c.a4bec","56bbf874.a0d958"]]},{"id":"e2d0c339.a9215","type":"inject","z":"950c1426.ff4008","name":"","topic":"","payload":"1","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":450,"y":860,"wires":[["e3839d71.17991"]]},{"id":"b92efdc5.61183","type":"inject","z":"950c1426.ff4008","name":"","topic":"","payload":"0","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":450,"y":900,"wires":[["e3839d71.17991"]]},{"id":"e3839d71.17991","type":"function","z":"950c1426.ff4008","name":"set Dia","func":"global.set(\"Dia\", parseInt(msg.payload));\nmsg.payload = global.get(\"Dia\"); return msg","outputs":1,"noerr":0,"x":600,"y":890,"wires":[["f6336559.461d98"]]},{"id":"f6336559.461d98","type":"debug","z":"950c1426.ff4008","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":760,"y":900,"wires":[]},{"id":"e527c6fe.977b28","type":"debug","z":"950c1426.ff4008","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":610,"y":240,"wires":[]},{"id":"a2597d3.3b1cd8","type":"mqtt in","z":"950c1426.ff4008","name":"","topic":"aviso/Alarma","qos":"2","broker":"6b36e4a.1d30b1c","x":260,"y":130,"wires":[["12c70ffc.778b9","17c2b740.de06a9"]]},{"id":"12c70ffc.778b9","type":"debug","z":"950c1426.ff4008","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":660,"y":140,"wires":[]},{"id":"7b312ac8.2c4c04","type":"function","z":"950c1426.ff4008","name":"","func":"// if (msg.payload.includes (\"pwmDucha\") || msg.payload.includes (\"LuzBano\")){\n    msg = {topic: \"terminalBlynk\", payload: msg.payload + \"\\n\"};\n    return msg;\n// }","outputs":1,"noerr":0,"x":1290,"y":140,"wires":[[]]},{"id":"f3949534.d17538","type":"inject","z":"950c1426.ff4008","name":"","topic":"","payload":"debug1","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1130,"y":180,"wires":[["8158b414.794658"]]},{"id":"8158b414.794658","type":"mqtt out","z":"950c1426.ff4008","name":"","topic":"ESP/Bano/Recibo","qos":"","retain":"","broker":"e779f8d6.7bc2c8","x":1300,"y":200,"wires":[]},{"id":"9e265dda.36651","type":"inject","z":"950c1426.ff4008","name":"","topic":"","payload":"debug0","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1130,"y":220,"wires":[["8158b414.794658"]]},{"id":"565363f0.f181ec","type":"mqtt in","z":"950c1426.ff4008","name":"","topic":"ESP/Pasillo/Iluminacion","qos":"2","broker":"e779f8d6.7bc2c8","x":370,"y":410,"wires":[["ecc24e7c.a4bec"]]},{"id":"d0e1a81.0e9f858","type":"mqtt in","z":"950c1426.ff4008","name":"","topic":"ESP/Bano/Debug","qos":"2","broker":"e779f8d6.7bc2c8","x":1130,"y":120,"wires":[["13ffa04d.829bf","7b312ac8.2c4c04","cbca2d76.46fd5"]]},{"id":"13ffa04d.829bf","type":"debug","z":"950c1426.ff4008","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1310,"y":100,"wires":[]},{"id":"5b6c768b.e019f8","type":"debug","z":"950c1426.ff4008","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":620,"y":420,"wires":[]},{"id":"547d49c.a3042b8","type":"mqtt in","z":"950c1426.ff4008","name":"","topic":"ESP/Pasillo/Iluminacion/Envio","qos":"2","broker":"e779f8d6.7bc2c8","x":350,"y":350,"wires":[["895e93af.60dec","ecc24e7c.a4bec"]]},{"id":"895e93af.60dec","type":"debug","z":"950c1426.ff4008","name":"pasillo baño","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":580,"y":350,"wires":[]},{"id":"1d72ed23.ba6583","type":"debug","z":"950c1426.ff4008","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":500,"y":820,"wires":[]},{"id":"ee08fcf4.5b87d","type":"mqtt in","z":"950c1426.ff4008","name":"node-red","topic":"bano/nodeRed","qos":"2","broker":"e779f8d6.7bc2c8","x":330,"y":740,"wires":[["38cc6f5f.406e4","1d72ed23.ba6583"]]},{"id":"39190795.8dc678","type":"inject","z":"950c1426.ff4008","name":"","topic":"","payload":"debug0","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1110,"y":550,"wires":[["d568dd07.8f5e2"]]},{"id":"cb9cee39.4f60c","type":"mqtt out","z":"950c1426.ff4008","name":"","topic":"","qos":"","retain":"","broker":"e779f8d6.7bc2c8","x":1420,"y":140,"wires":[]},{"id":"4c79eb7e.ac7d54","type":"inject","z":"950c1426.ff4008","name":"","topic":"ESP/Bano/Inicio","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":360,"y":170,"wires":[["ecc24e7c.a4bec"]]},{"id":"76f917e2.c1a968","type":"mqtt in","z":"950c1426.ff4008","name":"","topic":"ESP/Bano/Envio","qos":"2","broker":"e779f8d6.7bc2c8","x":850,"y":430,"wires":[[]]},{"id":"97cc195b.022518","type":"function","z":"950c1426.ff4008","name":"","func":"if (msg.payload.substring(0, 14) == \"timerExtractor\"){\n    var dato = global.get(\"hsCpu\") + \" - \" + msg.payload + \"\\n\";\n    msg = {topic: \"notifyBlynk\", payload: dato}; node.send(msg);\n    msg = {topic: \"terminalBlynk\", payload: dato}; node.send(msg);\n}\n","outputs":1,"noerr":0,"x":1040,"y":430,"wires":[["baefee38.76404","6538d508.b61d3c"]]},{"id":"6538d508.b61d3c","type":"mqtt out","z":"950c1426.ff4008","name":"","topic":"","qos":"2","retain":"","broker":"e779f8d6.7bc2c8","x":1230,"y":440,"wires":[]},{"id":"c3cff062.b2bab","type":"debug","z":"950c1426.ff4008","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":620,"y":190,"wires":[]},{"id":"baefee38.76404","type":"debug","z":"950c1426.ff4008","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1180,"y":390,"wires":[]},{"id":"d009bb52.8329a8","type":"inject","z":"950c1426.ff4008","name":"amarillo","topic":"","payload":"0","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1280,"y":290,"wires":[["8c82206c.1ebc9"]]},{"id":"b4b11dbc.fa4a","type":"inject","z":"950c1426.ff4008","name":"verde","topic":"","payload":"1","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1280,"y":340,"wires":[["8c82206c.1ebc9"]]},{"id":"ce01d6d5.e0d9f8","type":"delay","z":"950c1426.ff4008","name":"","pauseType":"delay","timeout":"100","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1600,"y":330,"wires":[["77563552.e99a9c"]]},{"id":"8c82206c.1ebc9","type":"function","z":"950c1426.ff4008","name":"","func":"if (parseInt(msg.payload) === 0){\n    msg.pin = 43;\n    msg.onLabel = \"12\";\n    msg.payload = 1;\n    // msg = {pin: 43, label : \"EXTRACTOR (ESPERA)\", payload: 1};\n    node.send(msg); return;\n}\n\nif (parseInt(msg.payload) === 1){\n    msg = {pin: 43, label: \"EXTRACTOR\", payload: 0};\n        node.send(msg); return;\n}\nreturn msg;","outputs":1,"noerr":0,"x":1420,"y":300,"wires":[["1067f4ea.ae58eb","ce01d6d5.e0d9f8","4ba37ff.d803d8"]]},{"id":"4ba37ff.d803d8","type":"debug","z":"950c1426.ff4008","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":1710,"y":230,"wires":[]},{"id":"17c2b740.de06a9","type":"delay","z":"950c1426.ff4008","name":"100mS","pauseType":"delay","timeout":"100","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":410,"y":130,"wires":[["ecc24e7c.a4bec"]]},{"id":"13a6fa02.a93ff6","type":"mqtt in","z":"950c1426.ff4008","name":"","topic":"crepMQTT","qos":"2","broker":"c339edbf.39572","x":270,"y":90,"wires":[["d78cc5a7.f98888"]]},{"id":"d78cc5a7.f98888","type":"delay","z":"950c1426.ff4008","name":"100mS","pauseType":"delay","timeout":"100","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":410,"y":90,"wires":[["ecc24e7c.a4bec"]]},{"id":"78364cb0.17f444","type":"function","z":"9c63fd61.9908c","name":"","func":"var pin = parseInt(msg.pin);\nvar intPayload = parseInt(msg.payload);\nvar topic = msg.topic;\nvar dato;\n\nswitch (pin){\n  case 18:\n    global.set(\"itemPotencia\", msg.payload);\n    // if (parseInt(global.get(\"itemPotencia\")) > 0 && parseInt(global.get(\"itemPotencia\")) <= 5){\n      context.item = parseInt(msg.payload);\n      switch(parseInt(msg.payload)){\n          case 1:\n              msg = {pin: 19, min: 1, max: 255, label: \"Living\", payload: global.get(\"potLiving\")};\n          break;\n          case 2:\n              msg = {pin: 19, min: 1, max: 255, label: \"Isla\", payload: global.get(\"potIsla\")};\n          break;\n          case 3:\n              msg = {pin: 19, min: 1, max: 255, label: \"Cielorrazo\", payload: global.get(\"potCielorrazo\")};\n          break;\n          case 4:\n              msg = {pin: 19, min: 1, max: 255, label: \"Led Living\", payload: global.get(\"ledLiving\")};\n          break;\n          case 5:\n              msg = {pin: 19, min: 1, max: 255, label: \"Patio Luz\", payload: global.get(\"pwmPatioLuz\")};\n          break;          \n          case 6:\n              msg = {pin: 19, min: 1, max: 100, label: \"Ducha de bano\", payload: global.get(\"pwmDucha\")};\n          break;     \n          case 7:\n              msg = {pin: 19, min: 1, max: 100, label: \"Luz Bano\", payload: global.get(\"pwmLuzBano\")};\n          break;\n          case 8:\n              msg = {pin: 19, min: 15, max: 240, label: \"timer extractor baño\", payload: global.get(\"timerExtractorBano\")};\n          break;          \n          case 9:\n              msg = {pin: 19, min: 10, max: 200, label: \"tiempo MIN teclas\", payload: global.get(\"minTeclas\")};\n          break;       \n          case 10:\n              msg = {pin: 19, min: 400, max: 2000, label: \"tiempo MAX teclas\", payload: global.get(\"maxTeclas\")};\n          break;   \n          case 11:\n              msg = {pin: 19, min: 1, max: 100, label: \"delay buzzer\", payload: global.get(\"delayBuzzer\")};\n          break;                              \n      }\n      node.send([null, msg]);\n      return;\n    // }\n  break;\n\n  case 19:\n    // if (parseInt(global.get(\"itemPotencia\")) > 0 && parseInt(global.get(\"itemPotencia\")) <= 5){\n      var valor = parseInt(msg.payload);\n      switch(context.item){\n          case 1:\n              // if (global.get(\"estLiving\") === 0)return;\n              global.set(\"potLiving\", valor);\n              global.set(\"potIsla\", valor);\n              global.set(\"potCielorrazo\", valor);\n              global.set(\"ledLiving\", valor);\n              enviarMQTT(\"living\");\n          break;\n          case 2:\n              // if (global.get(\"estIsla\") === 0)return;\n              global.set(\"potIsla\", valor);\n              enviarMQTT(\"living\");\n          break;\n          case 3:\n              // if (global.get(\"estCielorrazo\") === 0)return;\n              global.set(\"potCielorrazo\", valor);\n              enviarMQTT(\"living\");\n          break;\n          case 4:\n              // if (global.get(\"estCielorrazo\") === 0)return;\n              global.set(\"ledLiving\", valor);\n\t\t\t  global.set(\"IslaR\", valor);\n\t\t\t  global.set(\"IslaG\", valor);\n\t\t\t  global.set(\"IslaB\", valor);\n\t\t\t  msg = {pin: 8, payload: [valor, valor, valor]}; node.send([null, msg]);\n              enviarMQTT(\"living\");\n          break;          \n          case 5:\n              // if (global.get(\"Dia\") === 1)return;\n              global.set(\"pwmPatioLuz\", valor);\n              enviarMQTT(\"patioLuz\");\n              return;\n          case 6:\n              // if (global.get(\"estDucha\") === 0)return;  \n              global.set(\"pwmDucha\", valor);\n              enviarMQTT(\"bano\");\n              return;\n          case 7:\n              // if (global.get(\"estLuzBano\") === 0)return;  \n              global.set(\"pwmLuzBano\", valor);\n              enviarMQTT(\"bano\");\n              return;     \n      case 8:\n              global.set(\"timerExtractorBano\", valor);\n              enviarMQTT(\"bano\");\n              return;\n          case 9:\n              global.set(\"minTeclas\", valor);\n              enviarMQTT(\"configGenericas\");\n              return;     \n      case 10:\n              global.set(\"maxTeclas\", valor);\n              enviarMQTT(\"configGenericas\");\n              return;              \n        case 11:  \n              global.set(\"delayBuzzer\", valor);\n              enviarMQTT(\"configGenericas\");\n              return;              \n            }  \n          break;\n}\n\nfunction enviarMQTT(caso){\nvar dato;\n  if (caso == \"bano\"){\n  dato = global.get(\"estLuzBano\") + \"#\" + global.get(\"pwmLuzBano\") + \"#\" + global.get(\"modoDucha\") + \"#\" + global.get(\"estDucha\") + \"#\" + global.get(\"pwmDucha\");\n  dato += \"#\" + global.get(\"estLuzEspejo\") + \"#\" + global.get(\"estExtractorBano\") + \"#\" + global.get(\"timerExtractorBano\") + \"#\" + global.get(\"Dia\");\n    msg = {topic: \"ESP/Bano/Recibo\", payload: dato};\n  }\n\n  if (caso == \"patioLuz\"){msg = {topic: \"USBout\", payload: \"Noche\" + global.get(\"pwmPatioLuz\")};}\n  \n\n  if (caso == \"living\"){\n    dato = global.get(\"estIsla\") + \",\";\n    dato += global.get(\"potIsla\") + \"#\";\n    dato += global.get(\"estCielorrazo\") + \",\";\n    dato += global.get(\"potCielorrazo\") + \"#\";  \n    dato += global.get(\"estIslaRGB\") + \",\";\n    dato += global.get(\"ledLiving\") + \",\";\n    dato += global.get(\"ledLiving\") + \",\";      \n    dato += global.get(\"ledLiving\") + \"#\";\n\n    dato += global.get(\"pwmMaxLed\") + \"#\";\n    dato += global.get(\"pwmMinLed\") + \"#\";\n\n    dato += global.get(\"minTeclas\") + \"#\";\n    dato += global.get(\"maxTeclas\") + \"#\";\n    dato += global.get(\"doblePuls\");\n    dato += \"#\" + global.get(\"Dia\");\n\n    msg = {topic: \"ESP/living/Iluminacion/Recibo\", payload: dato};\n    node.send([msg, null]);\n  }\n  if (caso == \"configGenericas\"){\n    dato = global.get(\"minTeclas\") + \"#\";\n  dato += global.get(\"maxTeclas\") + \"#\";\n  dato += global.get(\"delayBuzzer\");\n  msg = {topic: \"configTeclas\", payload: dato};\n  }\n\nnode.send([msg, null]);\n}","outputs":2,"noerr":0,"x":450,"y":370,"wires":[["e2ad3d73.1ffd8","b58c2246.7ef8c"],["e5d9a366.0b565","d07ce15.d99f32","108e63f1.90676c"]]},{"id":"b58c2246.7ef8c","type":"mqtt out","z":"9c63fd61.9908c","name":"","topic":"","qos":"","retain":"","broker":"e779f8d6.7bc2c8","x":620,"y":340,"wires":[]},{"id":"e2ad3d73.1ffd8","type":"debug","z":"9c63fd61.9908c","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":640,"y":300,"wires":[]},{"id":"d07ce15.d99f32","type":"delay","z":"9c63fd61.9908c","name":"","pauseType":"delay","timeout":"10","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":590,"y":410,"wires":[["90394f1b.d19f2"]]},{"id":"108e63f1.90676c","type":"debug","z":"9c63fd61.9908c","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":590,"y":450,"wires":[]},{"id":"dd0cb6bb.9aa798","type":"inject","z":"9c63fd61.9908c","name":"","topic":"","payload":"10","payloadType":"str","repeat":"","crontab":"","once":true,"onceDelay":0.1,"x":450,"y":200,"wires":[["1f6abca5.9f5c93","87853982.f1a118","3a72cff0.eed6e","9a21c2fc.4e802"]]},{"id":"1f6abca5.9f5c93","type":"function","z":"9c63fd61.9908c","name":"pwmMinLed","func":"global.set(\"pwmMinLed\", 10);\nnode.status({text: global.get(\"pwmMinLed\")})\n","outputs":1,"noerr":0,"x":630,"y":190,"wires":[[]]},{"id":"3a72cff0.eed6e","type":"function","z":"9c63fd61.9908c","name":"pwmMaxLed","func":"global.set(\"pwmMaxLed\", 200);\nnode.status({text: global.get(\"pwmMaxLed\")})","outputs":1,"noerr":0,"x":630,"y":230,"wires":[[]]},{"id":"4f784ad5.70ddb4","type":"mqtt in","z":"9c63fd61.9908c","name":"","topic":"ESP/Bano/Inicio","qos":"2","broker":"e779f8d6.7bc2c8","x":280,"y":90,"wires":[["17a5f10e.b3b96f"]]},{"id":"a09215ab.90c218","type":"mqtt in","z":"9c63fd61.9908c","name":"","topic":"ESP/living/Iluminacion/Inicio","qos":"2","broker":"e779f8d6.7bc2c8","x":240,"y":130,"wires":[["17a5f10e.b3b96f"]]},{"id":"31d203bd.3e842c","type":"mqtt in","z":"9c63fd61.9908c","name":"","topic":"ESP/Lavadero/Inicio","qos":"2","broker":"e779f8d6.7bc2c8","x":270,"y":170,"wires":[["17a5f10e.b3b96f"]]},{"id":"17a5f10e.b3b96f","type":"link out","z":"9c63fd61.9908c","name":"configTeclas","links":["75cc688a.19a5e8","a7eebb16.de23f8"],"x":425,"y":150,"wires":[]},{"id":"511c78ef.861648","type":"debug","z":"9c63fd61.9908c","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":444.44444274902344,"y":321.1111125946045,"wires":[]},{"id":"87853982.f1a118","type":"function","z":"9c63fd61.9908c","name":"delayBuzzer","func":"global.set(\"delayBuzzer\", 60);\nnode.status({text: global.get(\"delayBuzzer\")});\nreturn msg\n","outputs":1,"noerr":0,"x":630,"y":150,"wires":[[]]},{"id":"51598710.300088","type":"function","z":"9c63fd61.9908c","name":"","func":"var dato = global.get(\"minTeclas\") + \"#\";\ndato += global.get(\"maxTeclas\") + \"#\";\ndato += global.get(\"delayBuzzer\");\nmsg = {topic: \"configTeclas\", payload: dato};\nreturn msg;","outputs":1,"noerr":0,"x":770,"y":110,"wires":[["b68c66c0.ead9f8"]]},{"id":"b68c66c0.ead9f8","type":"mqtt out","z":"9c63fd61.9908c","name":"","topic":"","qos":"","retain":"","broker":"e779f8d6.7bc2c8","x":900,"y":110,"wires":[]},{"id":"9a21c2fc.4e802","type":"delay","z":"9c63fd61.9908c","name":"","pauseType":"delay","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":620,"y":110,"wires":[["51598710.300088"]]},{"id":"a7eebb16.de23f8","type":"link in","z":"9c63fd61.9908c","name":"","links":["17a5f10e.b3b96f"],"x":465,"y":150,"wires":[["9a21c2fc.4e802"]]},{"id":"1718f5e3.66efaa","type":"mqtt out","z":"a89e305a.c50bb","name":"","topic":"","qos":"2","retain":"","broker":"6b36e4a.1d30b1c","x":874,"y":318,"wires":[]},{"id":"5b6fe88e.ff3eb8","type":"mqtt in","z":"a89e305a.c50bb","name":"","topic":"ESP/living/Iluminacion/Envio","qos":"2","broker":"6b36e4a.1d30b1c","x":340,"y":300,"wires":[["975ffbce.bc05a8"]]},{"id":"747a877e.d86508","type":"mqtt in","z":"a89e305a.c50bb","name":"","topic":"ESP/living/Iluminacion/Inicio","qos":"2","broker":"6b36e4a.1d30b1c","x":340,"y":180,"wires":[["975ffbce.bc05a8"]]},{"id":"f5bf1a9b.495cb8","type":"mqtt in","z":"a89e305a.c50bb","name":"","topic":"google/Living","qos":"2","broker":"6b36e4a.1d30b1c","x":390,"y":260,"wires":[["975ffbce.bc05a8"]]},{"id":"fa93d2f6.b18bc","type":"mqtt in","z":"a89e305a.c50bb","name":"","topic":"aviso/Alarma","qos":"2","broker":"6b36e4a.1d30b1c","x":385.00000762939453,"y":140.75000190734863,"wires":[["975ffbce.bc05a8"]]},{"id":"79aec6ed.8a6388","type":"debug","z":"a89e305a.c50bb","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":800,"y":440,"wires":[]},{"id":"86d15980.93d188","type":"mqtt in","z":"a89e305a.c50bb","name":"","topic":"crepMQTT","qos":"2","broker":"6b36e4a.1d30b1c","x":240,"y":220,"wires":[["322edf46.e112c"]]},{"id":"f6a7289e.12d9f8","type":"delay","z":"a89e305a.c50bb","name":"","pauseType":"delay","timeout":"10","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":803.0952224731445,"y":395.2142400741577,"wires":[["c8224508.e2da48"]]},{"id":"975ffbce.bc05a8","type":"function","z":"a89e305a.c50bb","name":"recibo2","func":" var timerLuces = 12000;\nif (global.get(\"estLiving\") === undefined)global.set(\"estLiving\", 0);\nif (global.get(\"estIsla\") === undefined)global.set(\"estIsla\", 0);\nif (global.get(\"estCielorrazo\") === undefined)global.set(\"estCielorrazo\", 0);\nif (global.get(\"potLiving\") === undefined)global.set(\"potLiving\", 0);\nif (global.get(\"estIslaRGB\") === undefined)global.set(\"estIslaRGB\", 0);\nif (global.get(\"potIsla\") === undefined)global.set(\"potIsla\", 255);\nif (global.get(\"potCielorrazo\") === undefined)global.set(\"potCielorrazo\", 128);\nif (global.get(\"IslaR\") === undefined)global.set(\"IslaR\", 255);\nif (global.get(\"IslaG\") === undefined)global.set(\"IslaG\", 255);\nif (global.get(\"IslaB\") === undefined)global.set(\"IslaB\", 255);\n\nif (global.get(\"dimmerLeds\") === undefined)global.set(\"dimmerLeds\", 200);\nif (global.get(\"minTeclas\") === undefined)global.set(\"minTeclas\", 100);\nif (global.get(\"maxTeclas\") === undefined)global.set(\"maxTeclas\", 600);\nif (global.get(\"doblePuls\") === undefined)global.set(\"doblePuls\", 1);\nif (global.get(\"fallasLivingIluminacion\") === undefined)global.set(\"fallasLivingIluminacion\", 0);\nif (global.get(\"pwmPatioLuz\") === undefined)global.set(\"pwmPatioLuz\", 33);\ncontext.item = context.item || 0;\nvar pin = parseInt(msg.pin);\nvar topic = msg.topic;\nvar payload = parseInt(msg.payload);\nvar dato;\n\nif (topic == \"ESP/living/Iluminacion/Inicio\"){  \n    var fallasLivingIluminacion = global.get(\"fallasLivingIluminacion\") + 1;\n    global.set(\"fallasLivingIluminacion\", fallasLivingIluminacion);\n    global.set(\"tipoFallaIlLiving\", payload); msg = {topic: \"fallas_MQTT\", payload: 1}; node.send([msg, null]);\n    enviarMQTT();\n    return;\n}\n\nif (topic == \"aviso/Alarma\"){\n    if (global.get(\"estadoAlarma\") === 0 && global.get(\"Dia\") === 0){\n    msg = {topic: \"USBout\", payload: \"Noche\" + global.get(\"pwmPatioLuz\")}; node.send([msg, null]);\n    global.set(\"estLiving\", 1); \n    global.set(\"estIsla\", 1); \n    global.set(\"estCielorrazo\", 1); \n    global.set(\"estIslaRGB\", 1);\n    enviarMQTT();\n    return;\n    }\n    if (global.get(\"estadoAlarma\") === 1 && global.get(\"estLiving\") === 1){setTimeout(apagadoLuces, timerLuces);}\n    if (global.get(\"estadoAlarma\") === 1 && global.get(\"Dia\") === 1){\n        // msg = {topic: \"USBout\", payload: \"Dia\"}; node.send([msg, null]);\n        apagadoLuces();}\n}\n\nif (topic == \"crepMQTT\"){\n    if (global.get(\"Dia\") === 1) {msg = {topic: \"USBout\", payload: \"Dia\"}; node.send([msg, null]);}\n    if (global.get(\"Dia\") === 0) {msg = {topic: \"USBout\", payload: \"Noche\" + global.get(\"pwmPatioLuz\")}; node.send([msg, null]);}    \n    // if (global.get(\"Dia\") === 0 && global.get(\"estadoAlarma\") === 0) {msg = {topic: \"USBout\", payload: \"Noche\" + global.get(\"pwmPatioLuz\")}; node.send([msg, null]);}\n    // enviarMQTT();\n}\n\nif (topic == \"google/Living\") {enviarMQTT(); return;}\n\nif (topic == \"ESP/living/Iluminacion/Envio\" && !topic.includes(\"Recibo de ESP\")){\n    dato = msg.payload.split(\"#\");\n    global.set(\"estIsla\", dato[0]); \n    global.set(\"estCielorrazo\", dato[1]); \n    global.set(\"estIslaRGB\", dato[2]); \n    enviarMQTT();\n    return;\n}\n\nswitch (pin){\n\n  case 8:\n    global.set(\"IslaR\", msg.arrayOfValues[0]);\n    global.set(\"IslaG\", msg.arrayOfValues[1]);\n    global.set(\"IslaB\", msg.arrayOfValues[2]);\n    msg = {pin: 32, payload: \"12\"}; node.send([null, msg]);\n    global.set(\"estIslaRGB\", 1);\n    enviarMQTT();\n  break;\n\n  case 14:\n    global.set(\"estLiving\", payload);  \n    global.set(\"estIsla\", payload);\n    global.set(\"estCielorrazo\", payload);\n    global.set(\"estIslaRGB\", payload);\n    enviarMQTT();\n  break;\n\n  case 16:\n    global.set(\"estIsla\", payload);\n    enviarMQTT();\n  break;\n\n  case 17:\n    global.set(\"estCielorrazo\", payload); \n    enviarMQTT();\n  break;\n\n  case 29:\n    global.set(\"estIslaRGB\", payload); \n    enviarMQTT();\n  break;\n\n  // case 18:\n  //   global.set(\"itemPotencia\", msg.payload);\n  //   if (parseInt(global.get(\"itemPotencia\")) > 0 && parseInt(global.get(\"itemPotencia\")) <= 4){\n  //     context.item = parseInt(msg.payload);\n  //     switch(parseInt(msg.payload)){\n  //         case 1:\n  //             msg = {pin: 19, min: 4, max: 255, label: \"Living\", payload: global.get(\"potLiving\")};\n  //         break;\n  //         case 2:\n  //             msg = {pin: 19, min: 4, max: 255, label: \"Isla\", payload: global.get(\"potIsla\")};\n  //         break;\n  //         case 3:\n  //             msg = {pin: 19, min: 4, max: 255, label: \"Cielorrazo\", payload: global.get(\"potCielorrazo\")};\n  //         break;\n  //         case 4:\n  //             msg = {pin: 19, min: 1, max: 100, label: \"Patio Luz\", payload: global.get(\"pwmPatioLuz\")};\n  //         break;\n  //         case 5:\n  //             msg = {pin: 19, min: 1, max: 254, label: \"Ducha de baño\", payload: global.get(\"pwmDucha\")};\n  //         break;          \n  //     }\n  //     node.send([null, msg]);\n  //   }\n  // break;\n\n  // case 19:\n  //   if (parseInt(global.get(\"itemPotencia\")) > 0 && parseInt(global.get(\"itemPotencia\")) <= 4){\n  //     var valor = parseInt(msg.payload);\n  //     switch(context.item){\n  //         case 1:\n  //             if (global.get(\"estLiving\") === 0)return;\n  //             global.set(\"potLiving\", valor);\n  //             global.set(\"potIsla\", valor);\n  //             global.set(\"potCielorrazo\", valor);\n  //         break;\n  //         case 2:\n  //             if (global.get(\"estIsla\") === 0)return;\n  //             global.set(\"potIsla\", valor);\n  //         break;\n  //         case 3:\n  //             if (global.get(\"estCielorrazo\") === 0)return;\n  //             global.set(\"potCielorrazo\", valor);\n  //         break;\n  //         case 4:\n  //             if (global.get(\"Dia\") === 1)return;\n  //             global.set(\"pwmPatioLuz\", valor);\n  //             msg = {topic: \"USBout\", payload: \"Noche\" + global.get(\"pwmPatioLuz\")}; node.send([msg, null]); return;\n  //         break;\n  //         case 5:\n  //             global.set(\"pwmDucha\", valor);\n  //             var dato = global.get(\"modoDucha\") + \"#\" + global.get(\"pedidoDucha\") + \"#\" + global.get(\"pwmDucha\");\n  //             msg = {topic: \"ESP/Bano/Recibo\", payload: dato}; node.send([msg, null]); return;\n  //         break;          \n  //     }\n  //     enviarMQTT();\n  //   }\n  break;\n}\nreturn;\n\nfunction apagadoLuces(){\n    // msg = {topic: \"USBout\", payload: \"Dia\"}; node.send([msg, null]);\n    global.set(\"estLiving\", 0);\n    global.set(\"estIsla\", 0); \n    global.set(\"estCielorrazo\", 0); \n    global.set(\"estIslaRGB\", 0);\n    msg.topic = \"apagadoAuto\";\n    enviarMQTT();\n}\n\nfunction enviarMQTT(){\n    var topicNuevo = msg.topic;\n    //msg = {pin: 127, payload: global.get(\"hsCpu\") + \", top: \" + topicNuevo + \", D:\" + global.get(\"Dia\") + \", Al:\" + global.get(\"estadoAlarma\") + \"\\n\"}; node.send([null, msg]);\n    // if (global.get(\"estIsla\") === 0 && global.get(\"estCielorrazo\") === 0 && global.get(\"estIslaRGB\") === 0)global.set(\"estLiving\", 0);\n    // if (global.get(\"estIsla\") === 1 || global.get(\"estCielorrazo\") === 1){\n    //     if(topic !== \"Blink/estLiving\" && topicNuevo !== \"fallas_MQTT\")\n    //       if (payload !== 0) global.set(\"estLiving\", 1);\n    //     }\n    // if (topicNuevo !== \"fallas_MQTT\"){\n    msg = {pin: 14, payload: global.get(\"estLiving\")}; node.send([null, msg]);\n    msg = {pin: 16, payload: global.get(\"estIsla\")}; node.send([null, msg]);\n    msg = {pin: 17, payload: global.get(\"estCielorrazo\")}; node.send([null, msg]);\n    msg = {pin: 29, payload: global.get(\"estIslaRGB\")}; node.send([null, msg]);//}\n    if(topicNuevo == \"ESP/living/Iluminacion/Envio\")return;\n    \n    // if (parseInt(global.get(\"estLiving\")) === 0) {\n    //         msg = {pin: 16, payload: \"0\"}; node.send([null, msg]);\n    //         dato = \"0,\"}\n    //     else{\n    //         dato = global.get(\"estIsla\") + \",\";}\n    // dato += global.get(\"potIsla\") + \"#\";\n\n    // if (parseInt(global.get(\"estLiving\")) === 0) {\n    //         msg = {pin: 17, payload: \"0\"}; node.send([null, msg]);\n    //         dato += \"0,\"}\n    //     else{\n    //         dato += global.get(\"estCielorrazo\") + \",\";}\n\n    dato = global.get(\"estIsla\") + \",\";\n    dato += global.get(\"potIsla\") + \"#\";\n    dato += global.get(\"estCielorrazo\") + \",\";\n    dato += global.get(\"potCielorrazo\") + \"#\";  \n    dato += global.get(\"estIslaRGB\") + \",\";\n    dato += global.get(\"IslaR\") + \",\";\n    dato += global.get(\"IslaG\") + \",\";      \n    dato += global.get(\"IslaB\") + \"#\";\n\n  dato += global.get(\"pwmMaxLed\") + \"#\";\n  dato += global.get(\"pwmMinLed\") + \"#\";\n    // dato += global.get(\"dimmerLeds\") + \"#\";\n\n    dato += global.get(\"minTeclas\") + \"#\";\n    dato += global.get(\"maxTeclas\") + \"#\";\n    dato += global.get(\"doblePuls\");\n    dato += \"#\" + global.get(\"Dia\");\n    if (topicNuevo == \"crepMQTT\")dato += \"#\";\n\n//  msg = {topic: \"ESP/living/Iluminacion/Recibo2\", payload: topicNuevo + \"&\" + global.get(\"estadoAlarma\") + \"&\" + global.get(\"Dia\") + \"\\n\" + dato};    node.send([msg, null]);\n    msg = {topic: \"ESP/living/Iluminacion/Recibo\", payload: dato};\n    node.send([msg, null]);     \n}","outputs":2,"noerr":0,"x":645.9524154663086,"y":353.78568840026855,"wires":[["7d51b41e.96593c","aa2ebf44.36aa7","1718f5e3.66efaa"],["f6a7289e.12d9f8","706c129.8f43aec","79aec6ed.8a6388"]]},{"id":"678cccf.f9e5b34","type":"inject","z":"a89e305a.c50bb","name":"","topic":"Pedido/Living/Iluminacion","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":400,"y":100,"wires":[["975ffbce.bc05a8"]]},{"id":"322edf46.e112c","type":"delay","z":"a89e305a.c50bb","name":"","pauseType":"delay","timeout":"20","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":390,"y":220,"wires":[["975ffbce.bc05a8","963b6ab2.6d64f8"]]},{"id":"3c32c6d4.e47bba","type":"mqtt in","z":"a89e305a.c50bb","name":"Debug esp","topic":"Debug/ESP/Living/Iluminacion","qos":"2","broker":"e779f8d6.7bc2c8","x":780,"y":90,"wires":[["a3849db1.0b9f9"]]},{"id":"a3849db1.0b9f9","type":"debug","z":"a89e305a.c50bb","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":940,"y":90,"wires":[]},{"id":"4dba27a4.caac38","type":"function","z":"a89e305a.c50bb","name":"recibo2a","func":" var timerLuces = 12000;\nif (global.get(\"estLiving\") === undefined)global.set(\"estLiving\", 0);\nif (global.get(\"estIsla\") === undefined)global.set(\"estIsla\", 0);\nif (global.get(\"estCielorrazo\") === undefined)global.set(\"estCielorrazo\", 0);\nif (global.get(\"potLiving\") === undefined)global.set(\"potLiving\", 0);\nif (global.get(\"estIslaRGB\") === undefined)global.set(\"estIslaRGB\", 0);\nif (global.get(\"potIsla\") === undefined)global.set(\"potIsla\", 255);\nif (global.get(\"potCielorrazo\") === undefined)global.set(\"potCielorrazo\", 128);\nif (global.get(\"IslaR\") === undefined)global.set(\"IslaR\", 255);\nif (global.get(\"IslaG\") === undefined)global.set(\"IslaG\", 255);\nif (global.get(\"IslaB\") === undefined)global.set(\"IslaB\", 255);\n\nif (global.get(\"pwmMinLed\") === undefined)global.set(\"pwmMinLed\", 20);\nif (global.get(\"pwmMaxLed\") === undefined)global.set(\"pwmMaxLed\", 255);\n\nif (global.get(\"dimmerLeds\") === undefined)global.set(\"dimmerLeds\", 200);\nif (global.get(\"minTeclas\") === undefined)global.set(\"minTeclas\", 15);\nif (global.get(\"maxTeclas\") === undefined)global.set(\"maxTeclas\", 600);\nif (global.get(\"doblePuls\") === undefined)global.set(\"doblePuls\", 1);\nif (global.get(\"fallasLivingIluminacion\") === undefined)global.set(\"fallasLivingIluminacion\", 0);\nif (global.get(\"pwmPatioLuz\") === undefined)global.set(\"pwmPatioLuz\", 33);\ncontext.item = context.item || 0;\n\nvar topic = msg.topic;\nvar payload = parseInt(msg.payload);\n// msg = {topic: \" \", payload: topic}; node.send(msg);\nvar dato;\n// if (global.get(\"Dia\") === 1)global.set(\"dimmerLeds\", 200);\n// if (global.get(\"Dia\") === 0)global.set(\"dimmerLeds\", 50);\n\nif (topic == \"Pedido/Living/Iluminacion\"){  \n    var fallasLivingIluminacion = global.get(\"fallasLivingIluminacion\") + 1;\n    global.set(\"fallasLivingIluminacion\", fallasLivingIluminacion);\n    global.set(\"tipoFallaIlLiving\", payload); msg = {topic: \"fallas_MQTT\", payload: 1}; node.send([msg, null]);\n    enviarMQTT();\n//  msg = {topic: \"minTeclas\", payload: global.get(\"minTeclas\")}; node.send(msg);\n//     msg = {topic: \"maxTeclas\", payload: global.get(\"maxTeclas\")}; node.send(msg);\n    return;\n}\n\nif (topic == \"aviso/Alarma\"){\n    if (global.get(\"estadoAlarma\") === 0 && global.get(\"Dia\") === 0){\n    msg = {topic: \"USBout\", payload: \"Noche\" + global.get(\"pwmPatioLuz\")}; node.send([msg, null]);\n    global.set(\"estLiving\", 1); \n    global.set(\"estIslaRGB\", 1);\n    enviarMQTT();\n    return;\n    }\n    if (global.get(\"estadoAlarma\") === 1 && global.get(\"estLiving\") === 1){setTimeout(apagadoLuces, timerLuces);}\n    if (global.get(\"estadoAlarma\") === 1 && global.get(\"Dia\") === 1){\n        // msg = {topic: \"USBout\", payload: \"Dia\"}; node.send([msg, null]);\n        apagadoLuces();}\n    }\n\n\nif (topic == \"crepMQTT\"){\n    if (global.get(\"Dia\") === 1) {msg = {topic: \"USBout\", payload: \"Dia\"}; node.send([msg, null]);}\n    if (global.get(\"Dia\") === 0) {msg = {topic: \"USBout\", payload: \"Noche\" + global.get(\"pwmPatioLuz\")}; node.send([msg, null]);}\n    // enviarMQTT();\n}\n\n\nif (topic == \"google/Living\") {enviarMQTT(); return;}\n\nif (topic == \"ESP/living/Iluminacion/Envio\" && !topic.includes(\"Recibo de ESP\")){\n    dato = payload.split(\"#\");\n    global.set(\"estIsla\", dato[0]); \n    global.set(\"estCielorrazo\", dato[1]); \n    global.set(\"estIslaRGB\", dato[2]); \n    enviarMQTT();\n    return;\n}\n\nif (topic == \"Blink/potItem\"){\n    context.item = parseInt(msg.payload);\n    switch(parseInt(msg.payload)){\n        case 1:\n            msg = {pin: 19, min: 4, max: 255, label: \"Living\", payload: global.get(\"potLiving\")};\n        break;\n        case 2:\n            msg = {pin: 19, min: 4, max: 255, label: \"Isla\", payload: global.get(\"potIsla\")};\n        break;\n        case 3:\n            msg = {pin: 19, min: 4, max: 255, label: \"Cielorrazo\", payload: global.get(\"potCielorrazo\")};\n        break;\n        case 4:\n            msg = {pin: 19, min: 1, max: 100, label: \"Patio Luz\", payload: global.get(\"pwmPatioLuz\")};\n        break;\n    }\n    node.send([null, msg]);\n}\n\nif (topic == \"Blink/potencia\"){\n    var valor = parseInt(msg.payload);\n    switch(context.item){\n        case 1:\n            if (global.get(\"estLiving\") === 0)return;\n            global.set(\"potLiving\", valor);\n            global.set(\"potIsla\", valor);\n            global.set(\"potCielorrazo\", valor);\n        break;\n        case 2:\n            if (global.get(\"estIsla\") === 0)return;\n            global.set(\"potIsla\", valor);\n        break;\n        case 3:\n            if (global.get(\"estCielorrazo\") === 0)return;\n            global.set(\"potCielorrazo\", valor);\n        break;\n        case 4:\n            if (global.get(\"Dia\") === 1)return;\n            global.set(\"pwmPatioLuz\", valor);\n            msg = {topic: \"USBout\", payload: \"Noche\" + global.get(\"pwmPatioLuz\")}; node.send([msg, null]); return;\n    }\n    enviarMQTT();\n}\n\nif (topic == \"Blink/estLiving\"){\n    global.set(\"estLiving\", payload);  \n    global.set(\"estIslaRGB\", payload);\n    // global.set(\"estIsla\", parseInt(msg.payload)); \n    // global.set(\"estCielorrazo\", parseInt(msg.payload));\n\n    // if (msg.payload === 1) global.set(\"estIslaRGB\", 1);\n    // global.set(\"estIslaRGB\", parseInt(msg.payload));\n    // if (msg.payload === 0) global.set(\"estIslaRGB\", parseInt(msg.payload));\n    enviarMQTT();}\n\nif (topic == \"Blink/estIsla\"){\n    // global.set(\"estIslaRGB\", payload);\n    global.set(\"estIsla\", payload);\n    enviarMQTT();}\n\nif (topic == \"Blink/estCielorrazo\"){\n    // global.set(\"estIslaRGB\", payload);\n    global.set(\"estCielorrazo\", payload); \n    enviarMQTT();}\n\nif (topic == \"Blink/estRGB\"){global.set(\"estIslaRGB\", payload); enviarMQTT();}\n\nif (topic == \"Blink/colorRGB\"){\n    global.set(\"IslaR\", msg.arrayOfValues[0]);\n    global.set(\"IslaG\", msg.arrayOfValues[1]);\n    global.set(\"IslaB\", msg.arrayOfValues[2]);\n    msg = {pin: 32, payload: \"12\"}; node.send([null, msg]);\n    global.set(\"estIslaRGB\", 1);\n    enviarMQTT();\n}\n\nreturn;\n\nfunction apagadoLuces(){\n    // if (global.get(\"estadoAlarma\") === 1 || global.get(\"Dia\") === 1){\n    //  // global.set(\"estLiving\", 0); \n    //  // global.set(\"estIsla\", 0); \n    //  // global.set(\"estCielorrazo\", 0);\n    //  // global.set(\"estIslaRGB\", 0);\n    // }\n    msg = {topic: \"USBout\", payload: \"Dia\"}; node.send([msg, null]);\n    global.set(\"estLiving\", \"0\");\n    global.set(\"estIslaRGB\", \"0\");\n    msg.topic = \"apagadoAuto\";\n    enviarMQTT();\n}\n\nfunction enviarMQTT(){\n    var topicNuevo = msg.topic;\n    msg = {pin: 127, payload: global.get(\"hsCpu\") + \", top: \" + topicNuevo + \", D:\" + global.get(\"Dia\") + \", Al:\" + global.get(\"estadoAlarma\") + \"\\n\"}; node.send([null, msg]);\n    // if (global.get(\"estIsla\") === 0 && global.get(\"estCielorrazo\") === 0 && global.get(\"estIslaRGB\") === 0)global.set(\"estLiving\", 0);\n    if (global.get(\"estIsla\") === 1 || global.get(\"estCielorrazo\") === 1){\n        if(topic !== \"Blink/estLiving\" && topicNuevo !== \"fallas_MQTT\")global.set(\"estLiving\", 1);\n        }\n    if (topicNuevo == \"apagadoAuto\") {\n        global.set(\"estLiving\", 0); \n        msg = {pin: 127, payload: \"Apagado auto\\n\"}; node.send([null, msg]);\n    }\n\n    if (topicNuevo !== \"fallas_MQTT\"){\n    msg = {pin: 14, payload: global.get(\"estLiving\")}; node.send([null, msg]);\n    msg = {pin: 16, payload: global.get(\"estIsla\")}; node.send([null, msg]);\n    msg = {pin: 17, payload: global.get(\"estCielorrazo\")}; node.send([null, msg]);\n    msg = {pin: 29, payload: global.get(\"estIslaRGB\")}; node.send([null, msg]);}\n    if(topic == \"ESP/living/Iluminacion/Envio\")return;\n    \n    if (global.get(\"estLiving\") === 0) {\n            msg = {pin: 16, payload: \"0\"}; node.send([null, msg]);\n            dato = \"0,\"}\n        else{\n            dato = global.get(\"estIsla\") + \",\";}\n    dato += global.get(\"potIsla\") + \"#\";\n\n    if (global.get(\"estLiving\") === 0) {\n            msg = {pin: 17, payload: \"0\"}; node.send([null, msg]);\n            dato += \"0,\"}\n        else{\n            dato += global.get(\"estCielorrazo\") + \",\";}\n    dato += global.get(\"potCielorrazo\") + \"#\";  \n    dato += global.get(\"estIslaRGB\") + \",\";\n    dato += global.get(\"IslaR\") + \",\";\n    dato += global.get(\"IslaG\") + \",\";      \n    dato += global.get(\"IslaB\") + \"#\";\n\n  dato += global.get(\"pwmMaxLed\") + \"#\";\n  dato += global.get(\"pwmMinLed\") + \"#\";\n    // dato += global.get(\"dimmerLeds\") + \"#\";\n\n    dato += global.get(\"minTeclas\") + \"#\";\n    dato += global.get(\"maxTeclas\") + \"#\";\n    dato += global.get(\"doblePuls\");\n    dato += \"#\" + global.get(\"Dia\");\n    if (topicNuevo == \"crepMQTT\")dato += \"#\";\n\n//  msg = {topic: \"ESP/living/Iluminacion/Recibo2\", payload: topicNuevo + \"&\" + global.get(\"estadoAlarma\") + \"&\" + global.get(\"Dia\") + \"\\n\" + dato};    node.send([msg, null]);\n    msg = {topic: \"ESP/living/Iluminacion/Recibo\", payload: dato};\n    node.send([msg, null]);     \n}","outputs":2,"noerr":0,"x":130,"y":80,"wires":[[],[]]},{"id":"98cfaeee.49f83","type":"inject","z":"a89e305a.c50bb","name":"","topic":"ESP/living/Iluminacion/Envio","payload":"1#0#0#","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":580,"y":150,"wires":[["975ffbce.bc05a8"]]},{"id":"15333381.786d6c","type":"inject","z":"a89e305a.c50bb","name":"","topic":"ESP/living/Iluminacion/Envio","payload":"1#1#0#","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":580,"y":190,"wires":[["975ffbce.bc05a8"]]},{"id":"676b6bd5.c7f514","type":"inject","z":"a89e305a.c50bb","name":"","topic":"ESP/living/Iluminacion/Envio","payload":"0#0#0#","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":580,"y":230,"wires":[["975ffbce.bc05a8"]]},{"id":"7d51b41e.96593c","type":"link out","z":"a89e305a.c50bb","name":"iluminacionLiving","links":["81fe7338.07458","f8163bcc.da6ee8"],"x":775,"y":250,"wires":[]},{"id":"81fe7338.07458","type":"link in","z":"a89e305a.c50bb","name":"","links":["7d51b41e.96593c"],"x":535,"y":570,"wires":[["600dc232.0a0b1c"]]},{"id":"1ab2f0fa.9116ef","type":"function","z":"a89e305a.c50bb","name":"","func":"if (msg.topic == \"Living\")msg = {pin: 14, payload: msg.payload};\n\nif (msg.topic == \"Isla\")msg = {pin: 16, payload: msg.payload};\nif (msg.topic == \"Cielorrazo\")msg = {pin: 17, payload: msg.payload};\nif (msg.topic == \"islaRGB\")msg = {pin: 29, payload: msg.payload};\n\nnode.send(msg);","outputs":1,"noerr":0,"x":940,"y":570,"wires":[["decd799b.52caa8"]]},{"id":"600dc232.0a0b1c","type":"function","z":"a89e305a.c50bb","name":"","func":"msg.payload = global.get(\"estLiving\"); node.send([msg, null]);\nmsg.payload = global.get(\"estIsla\"); node.send([null, msg]);\nmsg.payload = global.get(\"estCielorrazo\"); node.send([null, null, msg]);\nmsg.payload = global.get(\"estIslaRGB\"); node.send([null, null, null, msg]);","outputs":4,"noerr":0,"x":620,"y":570,"wires":[["e7995436.864178"],["81391af8.a44828"],["6f3f19e9.fa3cf8"],["1787ebf3.ebb804"]]},{"id":"73587e0a.317fa","type":"function","z":"a89e305a.c50bb","name":"recibo2b","func":" var timerLuces = 12000;\nif (global.get(\"estLiving\") === undefined)global.set(\"estLiving\", 0);\nif (global.get(\"estIsla\") === undefined)global.set(\"estIsla\", 0);\nif (global.get(\"estCielorrazo\") === undefined)global.set(\"estCielorrazo\", 0);\nif (global.get(\"potLiving\") === undefined)global.set(\"potLiving\", 0);\nif (global.get(\"estIslaRGB\") === undefined)global.set(\"estIslaRGB\", 0);\nif (global.get(\"potIsla\") === undefined)global.set(\"potIsla\", 255);\nif (global.get(\"potCielorrazo\") === undefined)global.set(\"potCielorrazo\", 128);\nif (global.get(\"IslaR\") === undefined)global.set(\"IslaR\", 255);\nif (global.get(\"IslaG\") === undefined)global.set(\"IslaG\", 255);\nif (global.get(\"IslaB\") === undefined)global.set(\"IslaB\", 255);\n\nif (global.get(\"pwmMinLed\") === undefined)global.set(\"pwmMinLed\", 20);\nif (global.get(\"pwmMaxLed\") === undefined)global.set(\"pwmMaxLed\", 255);\n\nif (global.get(\"dimmerLeds\") === undefined)global.set(\"dimmerLeds\", 200);\nif (global.get(\"minTeclas\") === undefined)global.set(\"minTeclas\", 15);\nif (global.get(\"maxTeclas\") === undefined)global.set(\"maxTeclas\", 600);\nif (global.get(\"doblePuls\") === undefined)global.set(\"doblePuls\", 1);\nif (global.get(\"fallasLivingIluminacion\") === undefined)global.set(\"fallasLivingIluminacion\", 0);\nif (global.get(\"pwmPatioLuz\") === undefined)global.set(\"pwmPatioLuz\", 33);\ncontext.item = context.item || 0;\nvar pin = parseInt(msg.pin);\nvar topic = msg.topic;\nvar payload = parseInt(msg.payload);\nvar dato;\n\nif (topic == \"ESP/living/Iluminacion/Inicio\"){  \n    var fallasLivingIluminacion = global.get(\"fallasLivingIluminacion\") + 1;\n    global.set(\"fallasLivingIluminacion\", fallasLivingIluminacion);\n    global.set(\"tipoFallaIlLiving\", payload); msg = {topic: \"fallas_MQTT\", payload: 1}; node.send([msg, null]);\n    enviarMQTT();\n    return;\n}\n\nif (topic == \"aviso/Alarma\"){\n    if (global.get(\"estadoAlarma\") === 0 && global.get(\"Dia\") === 0){\n    msg = {topic: \"USBout\", payload: \"Noche\" + global.get(\"pwmPatioLuz\")}; node.send([msg, null]);\n    global.set(\"estLiving\", 1); \n    global.set(\"estIslaRGB\", 1);\n    enviarMQTT();\n    return;\n    }\n    if (global.get(\"estadoAlarma\") === 1 && global.get(\"estLiving\") === 1){setTimeout(apagadoLuces, timerLuces);}\n    if (global.get(\"estadoAlarma\") === 1 && global.get(\"Dia\") === 1){\n        // msg = {topic: \"USBout\", payload: \"Dia\"}; node.send([msg, null]);\n        apagadoLuces();}\n}\n\n\nif (topic == \"crepMQTT\"){\n    if (global.get(\"Dia\") === 1) {msg = {topic: \"USBout\", payload: \"Dia\"}; node.send([msg, null]);}\n    if (global.get(\"Dia\") === 0) {msg = {topic: \"USBout\", payload: \"Noche\" + global.get(\"pwmPatioLuz\")}; node.send([msg, null]);}\n    // enviarMQTT();\n}\n\n\nif (topic == \"google/Living\") {enviarMQTT(); return;}\n\nif (topic == \"ESP/living/Iluminacion/Envio\" && !topic.includes(\"Recibo de ESP\")){\n    dato = msg.payload.split(\"#\");\n    global.set(\"estIsla\", dato[0]); \n    global.set(\"estCielorrazo\", dato[1]); \n    global.set(\"estIslaRGB\", dato[2]); \n    enviarMQTT();\n    return;\n}\n\nswitch (pin){\n\n  case 8:\n    global.set(\"IslaR\", msg.arrayOfValues[0]);\n    global.set(\"IslaG\", msg.arrayOfValues[1]);\n    global.set(\"IslaB\", msg.arrayOfValues[2]);\n    msg = {pin: 32, payload: \"12\"}; node.send([null, msg]);\n    global.set(\"estIslaRGB\", 1);\n    enviarMQTT();\n  break;\n\n  case 14:\n    global.set(\"estLiving\", payload);  \n    global.set(\"estIslaRGB\", payload);\n    enviarMQTT();\n  break;\n\n  case 16:\n    global.set(\"estIsla\", payload);\n    enviarMQTT();\n  break;\n\n  case 17:\n    global.set(\"estCielorrazo\", payload); \n    enviarMQTT();\n  break;\n\n  case 29:\n    global.set(\"estIslaRGB\", payload); \n    enviarMQTT();\n  break;\n\n  case 18:\n    global.set(\"itemPotencia\", msg.payload);\n    if (parseInt(global.get(\"itemPotencia\")) > 0 && parseInt(global.get(\"itemPotencia\")) <= 4){\n      context.item = parseInt(msg.payload);\n      switch(parseInt(msg.payload)){\n          case 1:\n              msg = {pin: 19, min: 4, max: 255, label: \"Living\", payload: global.get(\"potLiving\")};\n          break;\n          case 2:\n              msg = {pin: 19, min: 4, max: 255, label: \"Isla\", payload: global.get(\"potIsla\")};\n          break;\n          case 3:\n              msg = {pin: 19, min: 4, max: 255, label: \"Cielorrazo\", payload: global.get(\"potCielorrazo\")};\n          break;\n          case 4:\n              msg = {pin: 19, min: 1, max: 100, label: \"Patio Luz\", payload: global.get(\"pwmPatioLuz\")};\n          break;\n      }\n      node.send([null, msg]);\n    }\n  break;\n\n  case 19:\n    if (parseInt(global.get(\"itemPotencia\")) > 0 && parseInt(global.get(\"itemPotencia\")) <= 4){\n      var valor = parseInt(msg.payload);\n      switch(context.item){\n          case 1:\n              if (global.get(\"estLiving\") === 0)return;\n              global.set(\"potLiving\", valor);\n              global.set(\"potIsla\", valor);\n              global.set(\"potCielorrazo\", valor);\n          break;\n          case 2:\n              if (global.get(\"estIsla\") === 0)return;\n              global.set(\"potIsla\", valor);\n          break;\n          case 3:\n              if (global.get(\"estCielorrazo\") === 0)return;\n              global.set(\"potCielorrazo\", valor);\n          break;\n          case 4:\n              if (global.get(\"Dia\") === 1)return;\n              global.set(\"pwmPatioLuz\", valor);\n              msg = {topic: \"USBout\", payload: \"Noche\" + global.get(\"pwmPatioLuz\")}; node.send([msg, null]); return;\n      }\n      enviarMQTT();\n    }\n  break;\n}\nreturn;\n\nfunction apagadoLuces(){\n    msg = {topic: \"USBout\", payload: \"Dia\"}; node.send([msg, null]);\n    global.set(\"estLiving\", \"0\");\n    global.set(\"estIslaRGB\", \"0\");\n    msg.topic = \"apagadoAuto\";\n    enviarMQTT();\n}\n\nfunction enviarMQTT(){\n    var topicNuevo = msg.topic;\n    //msg = {pin: 127, payload: global.get(\"hsCpu\") + \", top: \" + topicNuevo + \", D:\" + global.get(\"Dia\") + \", Al:\" + global.get(\"estadoAlarma\") + \"\\n\"}; node.send([null, msg]);\n    // if (global.get(\"estIsla\") === 0 && global.get(\"estCielorrazo\") === 0 && global.get(\"estIslaRGB\") === 0)global.set(\"estLiving\", 0);\n    if (global.get(\"estIsla\") === 1 || global.get(\"estCielorrazo\") === 1){\n        if(topic !== \"Blink/estLiving\" && topicNuevo !== \"fallas_MQTT\")\n          if (payload !== 0) global.set(\"estLiving\", 1);\n        }\n    if (topicNuevo == \"apagadoAuto\") {\n        global.set(\"estLiving\", 0); \n        msg = {pin: 127, payload: \"Apagado auto\\n\"}; node.send([null, msg]);\n    }\n\n    if (topicNuevo !== \"fallas_MQTT\"){\n    msg = {pin: 14, payload: global.get(\"estLiving\")}; node.send([null, msg]);\n    msg = {pin: 16, payload: global.get(\"estIsla\")}; node.send([null, msg]);\n    msg = {pin: 17, payload: global.get(\"estCielorrazo\")}; node.send([null, msg]);\n    msg = {pin: 29, payload: global.get(\"estIslaRGB\")}; node.send([null, msg]);}\n    if(topic == \"ESP/living/Iluminacion/Envio\")return;\n    \n    if (parseInt(global.get(\"estLiving\")) === 0) {\n            msg = {pin: 16, payload: \"0\"}; node.send([null, msg]);\n            dato = \"0,\"}\n        else{\n            dato = global.get(\"estIsla\") + \",\";}\n    dato += global.get(\"potIsla\") + \"#\";\n\n    if (parseInt(global.get(\"estLiving\")) === 0) {\n            msg = {pin: 17, payload: \"0\"}; node.send([null, msg]);\n            dato += \"0,\"}\n        else{\n            dato += global.get(\"estCielorrazo\") + \",\";}\n    dato += global.get(\"potCielorrazo\") + \"#\";  \n    dato += global.get(\"estIslaRGB\") + \",\";\n    dato += global.get(\"IslaR\") + \",\";\n    dato += global.get(\"IslaG\") + \",\";      \n    dato += global.get(\"IslaB\") + \"#\";\n\n  dato += global.get(\"pwmMaxLed\") + \"#\";\n  dato += global.get(\"pwmMinLed\") + \"#\";\n    // dato += global.get(\"dimmerLeds\") + \"#\";\n\n    dato += global.get(\"minTeclas\") + \"#\";\n    dato += global.get(\"maxTeclas\") + \"#\";\n    dato += global.get(\"doblePuls\");\n    dato += \"#\" + global.get(\"Dia\");\n    if (topicNuevo == \"crepMQTT\")dato += \"#\";\n\n//  msg = {topic: \"ESP/living/Iluminacion/Recibo2\", payload: topicNuevo + \"&\" + global.get(\"estadoAlarma\") + \"&\" + global.get(\"Dia\") + \"\\n\" + dato};    node.send([msg, null]);\n    msg = {topic: \"ESP/living/Iluminacion/Recibo\", payload: dato};\n    node.send([msg, null]);     \n}","outputs":2,"noerr":0,"x":650,"y":410,"wires":[[],[]]},{"id":"decd799b.52caa8","type":"link out","z":"a89e305a.c50bb","name":"salidaLiving","links":["73ae05bd.02fb9c"],"x":1040,"y":570,"wires":[]},{"id":"73ae05bd.02fb9c","type":"link in","z":"a89e305a.c50bb","name":"","links":["decd799b.52caa8"],"x":510,"y":380,"wires":[["975ffbce.bc05a8"]]},{"id":"9783d076.2a722","type":"inject","z":"a89e305a.c50bb","name":"","topic":"","payload":"1","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":780,"y":150,"wires":[["58b90d79.d09bf4"]]},{"id":"58b90d79.d09bf4","type":"mqtt out","z":"a89e305a.c50bb","name":"","topic":"crepMQTT","qos":"","retain":"","broker":"e779f8d6.7bc2c8","x":940,"y":200,"wires":[]},{"id":"963b6ab2.6d64f8","type":"debug","z":"a89e305a.c50bb","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":640,"y":280,"wires":[]},{"id":"9de5bca7.31925","type":"inject","z":"a89e305a.c50bb","name":"","topic":"","payload":"0","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":770,"y":200,"wires":[["58b90d79.d09bf4"]]},{"id":"aa2ebf44.36aa7","type":"debug","z":"a89e305a.c50bb","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":890,"y":280,"wires":[]},{"id":"7d69f61f.a06188","type":"file","z":"d1d22de5.be7d8","name":"","filename":"/home/gaston/BackUp-Node-Red/estLavadero.txt","appendNewline":true,"createDir":false,"overwriteFile":"false","x":670,"y":90,"wires":[[]]},{"id":"918ee468.cc1bd8","type":"function","z":"d1d22de5.be7d8","name":"","func":"\nmsg.payload =  global.get(\"fechaCompleta\") + \" - Lavadero: \" + msg.payload;// + \"\\n\";\nreturn msg\n","outputs":1,"noerr":0,"x":380,"y":120,"wires":[["8e9af1cf.bc276","7d69f61f.a06188"]]},{"id":"f8b14028.b396d","type":"mqtt in","z":"d1d22de5.be7d8","name":"","topic":"ESP/Lavadero/Envio","qos":"2","broker":"c339edbf.39572","x":190,"y":120,"wires":[["918ee468.cc1bd8","d02a82c9.c465c"]]},{"id":"8e9af1cf.bc276","type":"mqtt out","z":"d1d22de5.be7d8","name":"","topic":"terminalBlynk","qos":"","retain":"","broker":"e779f8d6.7bc2c8","x":600,"y":120,"wires":[]},{"id":"a18725af.b7d7c8","type":"debug","z":"d1d22de5.be7d8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":800,"y":180,"wires":[]},{"id":"6c96d887.a99fa8","type":"inject","z":"d1d22de5.be7d8","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":210,"y":180,"wires":[["f3ffda7d.e883a8"]]},{"id":"f3ffda7d.e883a8","type":"file in","z":"d1d22de5.be7d8","name":"","filename":"/home/gaston/BackUp-Node-Red/estLavadero.txt","format":"utf8","chunk":false,"sendError":false,"x":500,"y":180,"wires":[["a18725af.b7d7c8"]]},{"id":"907d301e.987da","type":"file","z":"d1d22de5.be7d8","name":"borrar archivo","filename":"/home/gaston/BackUp-Node-Red/estLavadero.txt","appendNewline":true,"createDir":false,"overwriteFile":"delete","x":470,"y":230,"wires":[[]]},{"id":"249da08f.1a587","type":"inject","z":"d1d22de5.be7d8","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":250,"y":230,"wires":[["907d301e.987da"]]},{"id":"d02a82c9.c465c","type":"debug","z":"d1d22de5.be7d8","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":570,"y":50,"wires":[]},{"id":"598e715b.18c47","type":"file","z":"d1d22de5.be7d8","name":"","filename":"/home/gaston/BackUp-Node-Red/estLiving.txt","appendNewline":true,"createDir":false,"overwriteFile":"false","x":660,"y":340,"wires":[[]]},{"id":"656d4dda.2e87c4","type":"function","z":"d1d22de5.be7d8","name":"","func":"\nmsg.payload =  global.get(\"fechaCompleta\") + \" - Living: \" + msg.payload;// + \"\\n\";\nreturn msg;\n","outputs":1,"noerr":0,"x":380,"y":370,"wires":[["b7816c4.1b1ff9","598e715b.18c47"]]},{"id":"f862267.ba7aed8","type":"mqtt in","z":"d1d22de5.be7d8","name":"","topic":"ESP/living/Iluminacion/Envio","qos":"2","broker":"c339edbf.39572","x":200,"y":320,"wires":[["656d4dda.2e87c4","8315fd97.1927e"]]},{"id":"b7816c4.1b1ff9","type":"mqtt out","z":"d1d22de5.be7d8","name":"","topic":"terminalBlynk","qos":"","retain":"","broker":"e779f8d6.7bc2c8","x":600,"y":370,"wires":[]},{"id":"420f8e8e.a1611","type":"debug","z":"d1d22de5.be7d8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":800,"y":430,"wires":[]},{"id":"4f96000e.73e3d","type":"inject","z":"d1d22de5.be7d8","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":210,"y":430,"wires":[["9c395b23.a56d98"]]},{"id":"9c395b23.a56d98","type":"file in","z":"d1d22de5.be7d8","name":"","filename":"/home/gaston/BackUp-Node-Red/estLiving.txt","format":"utf8","chunk":false,"sendError":false,"x":490,"y":430,"wires":[["420f8e8e.a1611"]]},{"id":"62081ac.19465e4","type":"file","z":"d1d22de5.be7d8","name":"borrar archivo","filename":"/home/gaston/BackUp-Node-Red/estLiving.txt","appendNewline":true,"createDir":false,"overwriteFile":"delete","x":470,"y":480,"wires":[[]]},{"id":"a568a6ff.4bab08","type":"inject","z":"d1d22de5.be7d8","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":250,"y":480,"wires":[["62081ac.19465e4"]]},{"id":"8315fd97.1927e","type":"debug","z":"d1d22de5.be7d8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":570,"y":300,"wires":[]},{"id":"93167d6b.4353b","type":"file","z":"d1d22de5.be7d8","name":"","filename":"/home/pi/BackUpNodeRed/estBano.txt","appendNewline":true,"createDir":false,"overwriteFile":"false","x":630,"y":600,"wires":[[]]},{"id":"74b25ac9.eef1c4","type":"function","z":"d1d22de5.be7d8","name":"","func":"\nmsg.payload =  global.get(\"fechaCompleta\") + \" - Bano: \" + msg.payload + \"\\n\";\nreturn msg\n","outputs":1,"noerr":0,"x":380,"y":630,"wires":[["93167d6b.4353b","b422b62a.e109b8"]]},{"id":"6d7f2316.496fcc","type":"mqtt in","z":"d1d22de5.be7d8","name":"","topic":"ESP/Bano/Envio","qos":"2","broker":"c339edbf.39572","x":180,"y":630,"wires":[["74b25ac9.eef1c4"]]},{"id":"2a9abc67.84f7c4","type":"mqtt out","z":"d1d22de5.be7d8","name":"","topic":"terminalBlynk","qos":"","retain":"","broker":"e779f8d6.7bc2c8","x":600,"y":630,"wires":[]},{"id":"b74077e1.945658","type":"debug","z":"d1d22de5.be7d8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":800,"y":690,"wires":[]},{"id":"b878d84b.8c4138","type":"inject","z":"d1d22de5.be7d8","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":210,"y":690,"wires":[["bc00a366.b4165"]]},{"id":"bc00a366.b4165","type":"file in","z":"d1d22de5.be7d8","name":"","filename":"/home/gaston/BackUp-Node-Red/estBano.txt","format":"utf8","chunk":false,"sendError":false,"x":470,"y":690,"wires":[["b74077e1.945658"]]},{"id":"551bb4a3.727f7c","type":"file","z":"d1d22de5.be7d8","name":"borrar archivo","filename":"/home/gaston/BackUp-Node-Red/estBano.txt","appendNewline":true,"createDir":false,"overwriteFile":"delete","x":470,"y":740,"wires":[[]]},{"id":"f473c43a.dcdaf8","type":"inject","z":"d1d22de5.be7d8","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":250,"y":740,"wires":[["551bb4a3.727f7c"]]},{"id":"b422b62a.e109b8","type":"debug","z":"d1d22de5.be7d8","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":570,"y":560,"wires":[]},{"id":"7991a305.fde51c","type":"file","z":"f682d492.22a758","name":"","filename":"","appendNewline":false,"createDir":false,"overwriteFile":"true","x":790,"y":180,"wires":[[]]},{"id":"eb883e95.fe8dd","type":"file in","z":"f682d492.22a758","name":"flows_vps_cred.json","filename":"/home/pi/BackUpNodeRed/flow_cred.json","format":"utf8","sendError":true,"x":431.6666259765625,"y":185.00000953674316,"wires":[["5a5fedce.03ad44"]]},{"id":"cf934abb.45a8e8","type":"mqtt out","z":"f682d492.22a758","name":"","topic":"USBout","qos":"","retain":"","broker":"3fe9d635.ec409a","x":798.6666259765625,"y":379.00000953674316,"wires":[]},{"id":"18e89e7a.cf0832","type":"comment","z":"f682d492.22a758","name":"PID Control For CPU Temperature of Raspberry PI","info":"","x":278.6666259765625,"y":219.00000953674316,"wires":[]},{"id":"94e31487.9c74d8","type":"inject","z":"f682d492.22a758","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":true,"onceDelay":"16","x":218.6666259765625,"y":499.00000953674316,"wires":[["a80e4842.3b8e58","1e6fdef2.dd07c1"]]},{"id":"a1c9ca5b.e24338","type":"function","z":"f682d492.22a758","name":"","func":"msg.filename = \"/home/gaston/BackUp-Node-Red/flow.json\";\nreturn msg;\n","outputs":1,"noerr":0,"x":641.6666259765625,"y":125.00000953674316,"wires":[["87cd0f62.9b7b9"]]},{"id":"29360839.1062a8","type":"comment","z":"f682d492.22a758","name":"PID Control For CPU Temperature of Raspberry PI","info":"","x":318.6666259765625,"y":79.00000953674316,"wires":[]},{"id":"a80e4842.3b8e58","type":"function","z":"f682d492.22a758","name":"","func":"msg.payload = \"Ser reinicio servidor\";\nreturn msg;","outputs":1,"noerr":0,"x":408.6666259765625,"y":479.00000953674316,"wires":[["eb9007a.8c8bff8"]]},{"id":"9ed2f840.371ee8","type":"file in","z":"f682d492.22a758","name":"flows_vps.json","filename":"/home/pi/BackUpNodeRed/Node-Red-Mi-Casa/flow.json","format":"utf8","sendError":true,"x":411.6666259765625,"y":125.00000953674316,"wires":[["a1c9ca5b.e24338"]]},{"id":"87cd0f62.9b7b9","type":"file","z":"f682d492.22a758","name":"","filename":"","appendNewline":false,"createDir":true,"overwriteFile":"true","x":792.1667175292969,"y":117.00000953674316,"wires":[[]]},{"id":"3b3dba45.0945a6","type":"inject","z":"f682d492.22a758","name":"","topic":"","payload":"restarted","payloadType":"str","repeat":"","crontab":"","once":true,"x":201.6666259765625,"y":125.00000953674316,"wires":[["9ed2f840.371ee8","eb883e95.fe8dd"]]},{"id":"5a5fedce.03ad44","type":"function","z":"f682d492.22a758","name":"","func":"msg.filename = \"/home/gaston/BackUp-Node-Red/flow_cred.json\";\nreturn msg;\n","outputs":1,"noerr":0,"x":641.6666259765625,"y":185.00000953674316,"wires":[["7991a305.fde51c"]]},{"id":"682b5613.2a3718","type":"delay","z":"f682d492.22a758","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":608.6666259765625,"y":379.00000953674316,"wires":[["cf934abb.45a8e8","cbccd783.cab558"]]},{"id":"1e6fdef2.dd07c1","type":"function","z":"f682d492.22a758","name":"","func":"var date = new Date();\nvar hh = date.getHours(); global.set(\"hh\", hh);\nvar mm = date.getMinutes(); global.set(\"mm\", mm);\nvar ss = date.getSeconds(); global.set(\"ss\", ss);\nvar dia = date.getDate(); \nvar mes = date.getMonth()+1;\nvar ano = date.getFullYear(); \n\nvar reinicio = hh + \":\" +mm + \":\" + ss + \" -- \"+ dia + \"/\"+mes+ \"\\n\";\n\n\nmsg.payload = reinicio;\nreturn msg;","outputs":1,"noerr":0,"x":398.6666259765625,"y":559.0000095367432,"wires":[["b4a6cd49.2b908","2a31c302.c6da1c"]]},{"id":"b4a6cd49.2b908","type":"file","z":"f682d492.22a758","name":"reinicios","filename":"/home/pi/BackUpNodeRed/reinicios.txt","appendNewline":true,"createDir":false,"overwriteFile":"true","x":548.6666259765625,"y":529.0000095367432,"wires":[["2a31c302.c6da1c"]]},{"id":"2a31c302.c6da1c","type":"debug","z":"f682d492.22a758","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":748.6666259765625,"y":559.0000095367432,"wires":[]},{"id":"3a7a53b.5e20bac","type":"inject","z":"f682d492.22a758","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":228.6666259765625,"y":569.0000095367432,"wires":[["1e6fdef2.dd07c1"]]},{"id":"eb845b84.38ce88","type":"inject","z":"f682d492.22a758","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":218.6666259765625,"y":439.00000953674316,"wires":[[]]},{"id":"15f5e9fc.96d0e6","type":"ping","z":"f682d492.22a758","name":"","host":"www.google.com","timer":"15","x":1200,"y":110,"wires":[["8fffeae3.8c4f58","ffc75de3.b748d"]]},{"id":"8fffeae3.8c4f58","type":"function","z":"f682d492.22a758","name":"reinicio por falta de internet","func":"var hh = new Date().getHours();\nvar payload = msg.payload;\ncontext.contador = context.contador || 0;\ncontext.hh = context.hh || 25;\nnode.status({text: context.contador + \" -- \" + hh + \"  --  \" + context.hh});\n\nif (payload === false && context.hh != hh ){\n    context.contador = context.contador + 1;\n    if (context.contador === 4){\n        context.hh = hh;\n        context.contador = 0;\n        msg = {topic: \"reiniciar\", payload: 1};\n        return msg;\n    }\n    return;\n}\nif (payload !== false){context.contador = 0; context.hh = 25;}\n","outputs":1,"noerr":0,"x":1248.6666259765625,"y":164.00000953674316,"wires":[["e381f13b.67d59","ea330fed.01274"]]},{"id":"81e33838.5108d8","type":"mqtt out","z":"f682d492.22a758","name":"","topic":"","qos":"","retain":"","broker":"af08803a.808f4","x":1868.6666259765625,"y":189.00000953674316,"wires":[]},{"id":"ffc75de3.b748d","type":"debug","z":"f682d492.22a758","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1410,"y":110,"wires":[]},{"id":"e381f13b.67d59","type":"debug","z":"f682d492.22a758","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":1468.6666259765625,"y":164.00000953674316,"wires":[]},{"id":"ea330fed.01274","type":"function","z":"f682d492.22a758","name":"reinicio auto lunes (02:03:08)","func":"context.reset = context.reset || 0;\nnode.status({text: global.get(\"fechaDia\") + \" - \" + context.reset});\nif (msg.topic == \"reiniciar\"){\n    msg = {topic: \"USBout\", payload: \"resetAntenas\"};\n    node.send(msg);}\n\nif (global.get(\"fechaDia\") === 3 && parseInt(global.get(\"hh\")) === 2 && parseInt(global.get(\"mm\")) === 17 && context.reset >= 1)context.reset = 0;\n\nif (global.get(\"fechaDia\") === 3 && parseInt(global.get(\"hh\")) === 2 && parseInt(global.get(\"mm\")) === 16 && parseInt(global.get(\"ss\")) >= 8 && context.reset === 0){\n    context.reset = 1; msg = {topic: \"USBout\", payload: \"resetAntenas\"}; node.send(msg);}","outputs":1,"noerr":0,"x":1518.6666259765625,"y":199.00000953674316,"wires":[["5924c499.efbe5c","e64fa228.ab2f5","cb64b80e.2bae48"]]},{"id":"11c41031.dc0ff","type":"inject","z":"f682d492.22a758","name":"","topic":"","payload":"","payloadType":"date","repeat":"14","crontab":"","once":false,"onceDelay":0.1,"x":1203.6666259765625,"y":204.00000953674316,"wires":[["ea330fed.01274"]]},{"id":"444b000.6357","type":"inject","z":"f682d492.22a758","name":"reinicio manual","topic":"reiniciar","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1198.6666259765625,"y":239.00000953674316,"wires":[["ea330fed.01274"]]},{"id":"5924c499.efbe5c","type":"debug","z":"f682d492.22a758","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":1588.6666259765625,"y":289.00000953674316,"wires":[]},{"id":"2bd0f557.1bf01a","type":"function","z":"f682d492.22a758","name":"","func":"if (msg.payload != \"1\")return;\nmsg = {topic: \"reiniciar\", payload: 1};\nreturn msg;","outputs":1,"noerr":0,"x":1308.6666259765625,"y":279.00000953674316,"wires":[["ea330fed.01274"]]},{"id":"e64fa228.ab2f5","type":"delay","z":"f682d492.22a758","name":"","pauseType":"delay","timeout":"15","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1708.6666259765625,"y":149.00000953674316,"wires":[["81e33838.5108d8"]]},{"id":"cb64b80e.2bae48","type":"function","z":"f682d492.22a758","name":"","func":"msg = {topic: \"notifyBlynk\", payload: global.get(\"hsCpu\") + \" - Reinicio antena en 15\"};\nnode.send(msg);\nmsg = {topic: \"terminalBlynk\", payload: global.get(\"hsCpu\") + \" - ResetAntenas\\n\"};\nreturn msg;","outputs":1,"noerr":0,"x":1708.6666259765625,"y":229.00000953674316,"wires":[["81e33838.5108d8"]]},{"id":"d63c0df6.57c6d","type":"mqtt in","z":"f682d492.22a758","name":"","topic":"USBin","qos":"2","broker":"e779f8d6.7bc2c8","x":128.6666259765625,"y":389.00000953674316,"wires":[["4ad52aaf.d04e64"]]},{"id":"4ad52aaf.d04e64","type":"function","z":"f682d492.22a758","name":"","func":"if (msg.payload.substring(0,10) == \"inicioNano\"){\n    msg.payload = global.get(\"hsCpu\") + \" se reinicio el nano de baterias\\n\";\n    return msg;\n}//inicioNode-Red\nif (msg.payload == \"inicioNode-Red\"){\n    msg.payload = global.get(\"hsCpu\") + \" inicio el servidor\\n\";\n    return msg;\n}//inicioNode-Red","outputs":1,"noerr":0,"x":248.6666259765625,"y":389.00000953674316,"wires":[["139fd31f.d9d46d"]]},{"id":"139fd31f.d9d46d","type":"mqtt out","z":"f682d492.22a758","name":"","topic":"terminalBlynk","qos":"","retain":"","broker":"3fe9d635.ec409a","x":358.6666259765625,"y":289.00000953674316,"wires":[]},{"id":"19984082.8b92df","type":"inject","z":"f682d492.22a758","name":"inicio serv","topic":"","payload":"inicioNode-Red","payloadType":"str","repeat":"","crontab":"","once":true,"onceDelay":0.1,"x":148.6666259765625,"y":339.00000953674316,"wires":[["4ad52aaf.d04e64"]]},{"id":"cbccd783.cab558","type":"debug","z":"f682d492.22a758","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":798.6666259765625,"y":309.00000953674316,"wires":[]},{"id":"b496b6cd.cffae8","type":"delay","z":"f682d492.22a758","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":608.6666259765625,"y":419.00000953674316,"wires":[["cf934abb.45a8e8","50b13260.8627ec"]]},{"id":"50b13260.8627ec","type":"debug","z":"f682d492.22a758","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":778.6666259765625,"y":449.00000953674316,"wires":[]},{"id":"c4700118.501d","type":"function","z":"f682d492.22a758","name":"","func":"// msg.payload = \"Reinicios: \\n\" + msg.payload;\n\nmsg.payload = \"\";\nfor (i = 0; i < 25; i++) {msg.payload += \"\\n\";}\nmsg = {topic: \"terminalBlynk\", payload: msg.payload};\nreturn msg;","outputs":1,"noerr":0,"x":458.6666259765625,"y":649.0000095367432,"wires":[["51ca6144.ae74a"]]},{"id":"d6e6bc14.e41e7","type":"function","z":"f682d492.22a758","name":"","func":"if (msg.payload == 1)return msg;","outputs":1,"noerr":0,"x":338.6666259765625,"y":649.0000095367432,"wires":[["c4700118.501d"]]},{"id":"ad073b7f.7616d8","type":"mqtt in","z":"f682d492.22a758","name":"","topic":"terminalBlynk","qos":"2","broker":"e779f8d6.7bc2c8","x":138.6666259765625,"y":709.0000095367432,"wires":[["5ecd3c4a.fa40b4"]]},{"id":"51ca6144.ae74a","type":"mqtt out","z":"f682d492.22a758","name":"","topic":"","qos":"","retain":"","broker":"e779f8d6.7bc2c8","x":598.6666259765625,"y":649.0000095367432,"wires":[]},{"id":"db8d29a9.395938","type":"debug","z":"f682d492.22a758","name":"notify blynk","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":638.6666259765625,"y":759.0000095367432,"wires":[]},{"id":"28e6a691.0c236a","type":"mqtt in","z":"f682d492.22a758","name":"","topic":"notifyBlynk","qos":"2","broker":"c339edbf.39572","x":487.9761935642782,"y":733.4285719735282,"wires":[["bb713a62.b0fdf8","db8d29a9.395938"]]},{"id":"1335719f.0a145e","type":"mqtt in","z":"f682d492.22a758","name":"","topic":"ESP/TanqueAgua/Desconectado","qos":"2","broker":"e779f8d6.7bc2c8","x":1208.6666259765625,"y":449.00000953674316,"wires":[["73d128c4.318fd8"]]},{"id":"73d128c4.318fd8","type":"function","z":"f682d492.22a758","name":"","func":"if (msg.topic == \"ESP/TanqueAgua/Desconectado\"){\n    global.set(\"estado-TanqueAgua\", global.get(\"fechaCompleta\") + \" - Desc\\n\");\n    node.send(msg);}\nif (msg.topic == \"ESP/TanqueAgua/Inicio\"){\n    global.set(\"estado-TanqueAgua\", global.get(\"fechaCompleta\") + \" - Con\\n\");\n    node.send(msg);}    ","outputs":1,"noerr":0,"x":1498.6666259765625,"y":509.00000953674316,"wires":[["6e57dcc9.a5e0a4"]]},{"id":"2c6d5499.e60dfc","type":"mqtt in","z":"f682d492.22a758","name":"","topic":"ESP/TanqueAgua/Inicio","qos":"2","broker":"e779f8d6.7bc2c8","x":1238.6666259765625,"y":479.00000953674316,"wires":[["73d128c4.318fd8"]]},{"id":"b581d7d4.c586d8","type":"function","z":"f682d492.22a758","name":"","func":"if (msg.topic == \"ESP/Lavadero/Desconectado\"){\n    global.set(\"estado-Lavadero\", global.get(\"fechaCompleta\") + \" - Desc\\n\");\n    node.send(msg);}\nif (msg.topic == \"ESP/Lavadero/Inicio\"){\n    global.set(\"estado-Lavadero\", global.get(\"fechaCompleta\") + \" - Con\\n\");\n    node.send(msg);}    ","outputs":1,"noerr":0,"x":1498.6666259765625,"y":549.0000095367432,"wires":[["6e57dcc9.a5e0a4"]]},{"id":"1a8fa907.ac3d77","type":"mqtt in","z":"f682d492.22a758","name":"","topic":"ESP/Lavadero/Desconectado","qos":"2","broker":"e779f8d6.7bc2c8","x":1218.6666259765625,"y":519.0000095367432,"wires":[["b581d7d4.c586d8"]]},{"id":"921caa7a.92e9a8","type":"mqtt in","z":"f682d492.22a758","name":"","topic":"ESP/Lavadero/Inicio","qos":"2","broker":"e779f8d6.7bc2c8","x":1248.6666259765625,"y":549.0000095367432,"wires":[["b581d7d4.c586d8"]]},{"id":"43fc7397.9a6c8c","type":"mqtt in","z":"f682d492.22a758","name":"","topic":"ESP/living/Iluminacion/Desconectado","qos":"2","broker":"e779f8d6.7bc2c8","x":1188.6666259765625,"y":589.0000095367432,"wires":[["a0e5bba2.dd9068"]]},{"id":"3226cbc8.5acec4","type":"mqtt in","z":"f682d492.22a758","name":"","topic":"ESP/living/Iluminacion/Inicio","qos":"2","broker":"e779f8d6.7bc2c8","x":1218.6666259765625,"y":619.0000095367432,"wires":[["a0e5bba2.dd9068"]]},{"id":"a0e5bba2.dd9068","type":"function","z":"f682d492.22a758","name":"","func":"if (msg.topic == \"ESP/living/Iluminacion/Desconectado\"){\n    global.set(\"estado-IluminacionLiving\", global.get(\"fechaCompleta\") + \" - Desc\\n\");\n    node.send(msg);}\nif (msg.topic == \"ESP/living/Iluminacion/Inicio\"){\n    global.set(\"estado-IluminacionLiving\", global.get(\"fechaCompleta\") + \" - Con\\n\");\n    node.send(msg);}    ","outputs":1,"noerr":0,"x":1498.6666259765625,"y":589.0000095367432,"wires":[["6e57dcc9.a5e0a4"]]},{"id":"d8ba8495.1ac0e8","type":"mqtt in","z":"f682d492.22a758","name":"","topic":"USBin","qos":"2","broker":"e779f8d6.7bc2c8","x":1128.6666259765625,"y":839.0000095367432,"wires":[["e2e4d07c.f032c"]]},{"id":"269fcb97.b09bf4","type":"mqtt out","z":"f682d492.22a758","name":"","topic":"USBout","qos":"","retain":"","broker":"e779f8d6.7bc2c8","x":1378.6666259765625,"y":899.0000095367432,"wires":[]},{"id":"e2e4d07c.f032c","type":"function","z":"f682d492.22a758","name":"","func":"var dato = JSON.parse(msg.payload);\n\nif (dato.topic === \"Alarma\"){\n     msg.payload = global.get(\"hsCpu\") + \" -- \" + msg.payload + \"\\n\";\n    return msg;\n}","outputs":1,"noerr":0,"x":1288.6666259765625,"y":839.0000095367432,"wires":[["19734678.231f3a"]]},{"id":"c009ce09.2565f","type":"inject","z":"f682d492.22a758","name":"","topic":"","payload":"{\"topic\":\"Alarma\", \"payload\":1}","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1138.6666259765625,"y":759.0000095367432,"wires":[["e2e4d07c.f032c"]]},{"id":"19734678.231f3a","type":"debug","z":"f682d492.22a758","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1568.6666259765625,"y":889.0000095367432,"wires":[]},{"id":"6e57dcc9.a5e0a4","type":"function","z":"f682d492.22a758","name":"","func":"if (global.get(\"estado-TanqueAgua\") === undefined)global.set(\"estado-TanqueAgua\", null);\nif (global.get(\"estado-Lavadero\") === undefined)global.set(\"estado-Lavadero\", null);\nif (global.get(\"estado-IluminacionLiving\") === undefined)global.set(\"estado-IluminacionLiving\", null);\nif (global.get(\"estado-TermoSolar\") === undefined)global.set(\"estado-TermoSolar\", null);\nif (global.get(\"estado-Bano\") === undefined)global.set(\"estado-Bano\", null);\n// node.send(msg.payload);\nmsg.payload = \"\";\nfor (i = 0; i < 8; i++) {msg = {topic: \"terminalBlynk\", payload: msg};}\nnode.send(msg);\n\nmsg =  \"Tanque: \" + global.get(\"estado-TanqueAgua\");// + \"\\n\";// + \"\\n\";\nmsg += \"Lav.  : \" + global.get(\"estado-Lavadero\");// + \"\\n\";// + \"\\n\"; + \"\\n\";\nmsg += \"Liv.  : \" + global.get(\"estado-IluminacionLiving\");// + \"\\n\";// + \"\\n\"; + \"\\n\";\nmsg += \"Termo : \" + global.get(\"estado-TermoSolar\");// + \"\\n\";// + \"\\n\"; + \"\\n\";\nmsg += \"Bano  : \" + global.get(\"estado-Bano\");// + \"\\n\\n\";// + \"\\n\"; + \"\\n\";\n\nmsg = {topic: \"terminalBlynk\", payload: msg};\nnode.send(msg);","outputs":1,"noerr":0,"x":1708.6666259765625,"y":539.0000095367432,"wires":[["e53926c8.eea898","fa6c834e.be6f1"]]},{"id":"97f54fd4.80678","type":"function","z":"f682d492.22a758","name":"","func":"if (msg.payload == 1)return msg;","outputs":1,"noerr":0,"x":1328.6666259765625,"y":799.0000095367432,"wires":[[]]},{"id":"d7fd4e5c.e7461","type":"mqtt in","z":"f682d492.22a758","name":"","topic":"ESP/TermoSolar/Desconectado","qos":"2","broker":"e779f8d6.7bc2c8","x":1208.6666259765625,"y":659.0000095367432,"wires":[["46f76de.72d8f94"]]},{"id":"bd29a9fa.85e6d8","type":"mqtt in","z":"f682d492.22a758","name":"","topic":"ESP/TermoSolar/Inicio","qos":"2","broker":"e779f8d6.7bc2c8","x":1238.6666259765625,"y":689.0000095367432,"wires":[["46f76de.72d8f94"]]},{"id":"46f76de.72d8f94","type":"function","z":"f682d492.22a758","name":"","func":"if (msg.topic == \"ESP/TermoSolar/Desconectado\"){\n    global.set(\"estado-TermoSolar\", global.get(\"fechaCompleta\") + \" - Desc\\n\");\n    node.send(msg);}\nif (msg.topic == \"ESP/TermoSolar/Inicio\"){\n    global.set(\"estado-TermoSolar\", global.get(\"fechaCompleta\") + \" - Con\\n\");\n    node.send(msg);}    ","outputs":1,"noerr":0,"x":1498.6666259765625,"y":629.0000095367432,"wires":[["6e57dcc9.a5e0a4"]]},{"id":"e53926c8.eea898","type":"debug","z":"f682d492.22a758","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":1828.6666259765625,"y":589.0000095367432,"wires":[]},{"id":"87f3a3d0.62b6e","type":"mqtt in","z":"f682d492.22a758","name":"","topic":"ESP/Bano/Desconectado","qos":"2","broker":"e779f8d6.7bc2c8","x":1228.6666259765625,"y":369.00000953674316,"wires":[["c5655f3c.f162e","197b885.ecf6e78"]]},{"id":"dccdb57c.3134b8","type":"mqtt in","z":"f682d492.22a758","name":"","topic":"ESP/Bano/Inicio","qos":"2","broker":"e779f8d6.7bc2c8","x":1258.6666259765625,"y":409.00000953674316,"wires":[["c5655f3c.f162e","8685813e.d449b"]]},{"id":"c5655f3c.f162e","type":"function","z":"f682d492.22a758","name":"","func":"if (msg.topic == \"ESP/Bano/Desconectado\"){\n    global.set(\"estado-Bano\", global.get(\"fechaCompleta\") + \" - Desc\\n\");\n    node.send(msg);}\nif (msg.topic == \"ESP/Bano/Inicio\"){\n    global.set(\"estado-Bano\", global.get(\"fechaCompleta\") + \" - Con\\n\");\n    node.send(msg);}    ","outputs":1,"noerr":0,"x":1498.6666259765625,"y":469.00000953674316,"wires":[["6e57dcc9.a5e0a4"]]},{"id":"8685813e.d449b","type":"debug","z":"f682d492.22a758","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1528.6666259765625,"y":379.00000953674316,"wires":[]},{"id":"197b885.ecf6e78","type":"debug","z":"f682d492.22a758","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1528.6666259765625,"y":339.00000953674316,"wires":[]},{"id":"d362115.3b801f","type":"delay","z":"f682d492.22a758","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":608.6666259765625,"y":339.00000953674316,"wires":[["cf934abb.45a8e8"]]},{"id":"a0c13759.208ff8","type":"inject","z":"f682d492.22a758","name":"","topic":"ESP/Bano/Inicio","payload":"Conectado 0","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1528.6666259765625,"y":689.0000095367432,"wires":[["de20f11c.46b02"]]},{"id":"aaebb20e.8ef97","type":"inject","z":"f682d492.22a758","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1728.6666259765625,"y":339.00000953674316,"wires":[["3b673663.6004da"]]},{"id":"3b673663.6004da","type":"function","z":"f682d492.22a758","name":"","func":"node.status({text: global.get(\"estadoEspTanque\")})\nreturn msg;","outputs":1,"noerr":0,"x":1848.6666259765625,"y":389.00000953674316,"wires":[[]]},{"id":"6b5587f6.474118","type":"inject","z":"f682d492.22a758","name":"","topic":"ESP/Bano/Desconectado","payload":"Desconectado","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1478.6666259765625,"y":729.0000095367432,"wires":[["de20f11c.46b02"]]},{"id":"de20f11c.46b02","type":"mqtt out","z":"f682d492.22a758","name":"","topic":"","qos":"","retain":"","broker":"e779f8d6.7bc2c8","x":1828.6666259765625,"y":729.0000095367432,"wires":[]},{"id":"eb67c8bc.3a61e8","type":"debug","z":"f682d492.22a758","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":2218.6666259765625,"y":379.00000953674316,"wires":[]},{"id":"2313982d.866288","type":"function","z":"f682d492.22a758","name":"","func":"msg = {topic: \"reinBano\", payload: global.get(\"tiempoAndando\")}; \nreturn msg;","outputs":1,"noerr":0,"x":2068.6666259765625,"y":329.00000953674316,"wires":[["b77070fe.51184","eb67c8bc.3a61e8"]]},{"id":"8d98a034.686d5","type":"delay","z":"f682d492.22a758","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1948.6666259765625,"y":329.00000953674316,"wires":[["2313982d.866288"]]},{"id":"fbe5b982.1f0278","type":"mqtt in","z":"f682d492.22a758","name":"","topic":"USBin/Baterias","qos":"2","broker":"c339edbf.39572","x":188.6666259765625,"y":899.0000095367432,"wires":[[]]},{"id":"f4da8f05.5a80d","type":"mqtt in","z":"f682d492.22a758","name":"","topic":"informarNivel","qos":"2","broker":"e779f8d6.7bc2c8","x":198.6666259765625,"y":859.0000095367432,"wires":[["4f1f018.98907"]]},{"id":"4f1f018.98907","type":"function","z":"f682d492.22a758","name":"","func":"msg = {topic: \"terminalBlynk\", payload: global.get(\"hsCpu\") + \"  \" + msg.topic + \"\\n\"};\nreturn msg;","outputs":1,"noerr":0,"x":408.6666259765625,"y":879.0000095367432,"wires":[["40d4f530.97cc9c"]]},{"id":"fc965419.7e0fd8","type":"mqtt out","z":"f682d492.22a758","name":"","topic":"","qos":"","retain":"","broker":"e779f8d6.7bc2c8","x":558.6666259765625,"y":879.0000095367432,"wires":[]},{"id":"eb89c027.f0a68","type":"debug","z":"f682d492.22a758","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":568.6666259765625,"y":979.0000095367432,"wires":[]},{"id":"3cb10e58.2072a2","type":"mqtt in","z":"f682d492.22a758","name":"","topic":"tiempoCargando","qos":"2","broker":"e779f8d6.7bc2c8","x":188.6666259765625,"y":809.0000095367432,"wires":[["eb89c027.f0a68"]]},{"id":"40d4f530.97cc9c","type":"debug","z":"f682d492.22a758","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":598.6666259765625,"y":939.0000095367432,"wires":[]},{"id":"fc3e5606.585ee8","type":"inject","z":"7ac92c99.66ea94","name":"","topic":"","payload":"luces del lavadero alacena","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":260,"y":400,"wires":[["15d3c9e4.d9caa6"]]},{"id":"f2b6cf60.3bf01","type":"function","z":"7ac92c99.66ea94","name":"","func":"msg.estado = 1;\nreturn msg;","outputs":1,"noerr":0,"x":421.6071891784668,"y":138.92858457565308,"wires":[["1e25bad1.b2b155"]]},{"id":"cc1add85.586c5","type":"debug","z":"7ac92c99.66ea94","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":488.3691177368164,"y":599.7857265472412,"wires":[]},{"id":"5172e6e0.6c63c8","type":"function","z":"7ac92c99.66ea94","name":"Penreder (Nuevo)","func":"var payload = msg.payload;\nvar estado = msg.estado;\n\n// if (!payload.includes(\"living\")) return;\n\nif (payload.includes(\"luces\") || payload.includes(\"luz\")){\n\n\t// if (payload.includes(\"apaga\") || payload.includes(\"apagar\")){\n\t\tif (payload.includes(\"apaga\") || payload.includes(\"apagar\") || payload.includes(\"todas\")){\n\t\t\tglobal.set(\"luzAlacenaLavadero\", 0); global.set(\"luzLavadero\", 0); \n\t\t\t\tmsg = {topic: \"google/Lavadero\", payload: \"1\"}; node.send(msg);\n\t\t\tglobal.set(\"estLuzBano\", 0); global.set(\"estLuzEspejo\", 0); \n\t\t\t\tmsg = {topic: \"google/Baño\", payload: \"1\"}; node.send(msg);\n\t        global.set(\"estLiving\", 0); global.set(\"estIsla\", 0); global.set(\"estCielorrazo\", 0); global.set(\"estIslaRGB\", 0); \n\t        \tmsg = {topic: \"google/Living\", payload: \"estLiving= \" + global.get(\"estLiving\")}; node.send(msg);\n\t\t\t// global.set(\"luzLavadero\", 0);\n\t\t\treturn;\n\t\t}\n\t// }\n\n    if (payload.includes(\"lavadero\") || payload.includes(\"Lavadero\")){\n        if (payload.includes(\"alacena\")){\n            global.set(\"luzAlacenaLavadero\", parseInt(estado));\n            msg = {topic: \"google/Lavadero\", payload: \"1\"};\n            // msg = {pin: 35, payload: estado}; node.send([null, msg]);\n            // msg = {topic: \"ESP/Lavadero/Bombas/Estado/Rele0\", payload: estado}; //node.send(msg);    \n            return msg;\n        }             \n        // msg = {pin: 36, payload: estado}; node.send([null, msg]);\n        global.set(\"luzLavadero\", parseInt(estado));\n        // if (global.get(\"luzLavadero\") === 0)global.set(\"luzAlacenaLavadero\", 0); \n        msg = {topic: \"google/Lavadero\", payload: \"1\"};\n        // msg = {topic: \"ESP/Lavadero/Bombas/Estado/Rele1\", payload: estado}; //node.send(msg);   \n        return msg;\n    }      \n\n    if (payload.includes(\"baño\") || payload.includes(\"Baño\")){\n        if (payload.includes(\"ducha\") || payload.includes(\"Ducha\")){\n\t\t\tglobal.set(\"modoDucha\", 0);\n\t\t\tglobal.set(\"pedidoDucha\", parseInt(estado));\n            msg = {topic: \"google/Baño\", payload: \"1\"};\n            return msg;\n        }             \n        global.set(\"luzBano\", parseInt(estado));\n        msg = {topic: \"google/Baño\", payload: \"1\"}; \n        return msg;\n    }     \n\n    if (payload.includes(\"living\")){\n        if (payload.includes(\"isla\")){\n            global.set(\"estIsla\", estado);\n            msg = {topic: \"google/Living\", payload: \"estIsla= \" + global.get(\"estIsla\")};\n            return msg;\n        }\n        if (payload.includes(\"cielo raso\")){\n            global.set(\"estCielorrazo\", estado);\n            msg = {topic: \"google/Living\", payload: \"estCielorrazo= \" + global.get(\"estCielorrazo\")};\n            return msg;\n        }\n        if (payload.includes(\"rgb\")){\n            global.set(\"estIslaRGB\", estado);\n            msg = {topic: \"google/Living\", payload: \"estIslaRGB= \" + global.get(\"estIslaRGB\")};\n            return msg;\n        }\n    }\n        global.set(\"estLiving\", estado); \n        global.set(\"estIsla\", estado);\n        global.set(\"estCielorrazo\", estado);\n        global.set(\"estIslaRGB\", estado);\n        msg = {topic: \"google/Living\", payload: \"estLiving= \" + global.get(\"estLiving\")};\n        return msg;}\n\nif (payload.includes(\"bomba\") && payload.includes(\"centrifuga\") || payload.includes(\"centrífuga\")){\n    global.set(\"bombaPozo\", msg.estado);\n    msg = {topic: \"google/Lavadero\", payload: \"luzLavadero= \" + global.get(\"luzLavadero\")};\n    // msg = {topic: \"google/Tanque\", payload: msg.estado};\n    return msg; \n}","outputs":1,"noerr":0,"x":644.4642677307129,"y":346.071457862854,"wires":[["dd2ec6d9.69a7b8","23f16719.2216e8"]]},{"id":"300b7f5b.9609c","type":"debug","z":"7ac92c99.66ea94","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":661.9405250549316,"y":728.1786017417908,"wires":[]},{"id":"4474aa4a.d59244","type":"debug","z":"7ac92c99.66ea94","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":544.4405250549316,"y":449.42860174179077,"wires":[]},{"id":"66d6bc25.ebcf74","type":"debug","z":"7ac92c99.66ea94","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":773.9405250549316,"y":116.92860174179077,"wires":[]},{"id":"beb20938.616a28","type":"http in","z":"7ac92c99.66ea94","name":"prender luces","url":"/prender","method":"post","upload":false,"swaggerDoc":"","x":303.1309623718262,"y":320.85715103149414,"wires":[["3723238d.48cb5c"]]},{"id":"5fb5c510.42824c","type":"http in","z":"7ac92c99.66ea94","name":"apagar luces","url":"/apagar","method":"post","upload":false,"swaggerDoc":"","x":301.0476417541504,"y":362.6429567337036,"wires":[["15d3c9e4.d9caa6"]]},{"id":"9e62beff.2ba1f","type":"http in","z":"7ac92c99.66ea94","name":"cambiar color luces","url":"/colorluces","method":"post","upload":false,"swaggerDoc":"","x":267.6548538208008,"y":506.8689994812012,"wires":[["d0facd41.3bb66","4474aa4a.d59244"]]},{"id":"36115df0.567c42","type":"mqtt out","z":"7ac92c99.66ea94","name":"","topic":"","qos":"","retain":"","broker":"43555c62.30ed34","x":861.3690605163574,"y":488.9286513328552,"wires":[]},{"id":"eb1152.3061ceb","type":"function","z":"7ac92c99.66ea94","name":"","func":"msg.estado = 0;\nreturn msg;","outputs":1,"noerr":0,"x":425.8929214477539,"y":183.21431970596313,"wires":[["1e25bad1.b2b155","b431a03.de72c6"]]},{"id":"15d3c9e4.d9caa6","type":"function","z":"7ac92c99.66ea94","name":"","func":"msg.estado = 0;\nreturn msg;","outputs":1,"noerr":0,"x":446.9881582260132,"y":356.92860174179077,"wires":[["5172e6e0.6c63c8","6fd15169.7f306"]]},{"id":"3723238d.48cb5c","type":"function","z":"7ac92c99.66ea94","name":"","func":"msg.estado = 1;\nreturn msg;","outputs":1,"noerr":0,"x":449.8571662902832,"y":322.5238199234009,"wires":[["5172e6e0.6c63c8","6c03eb14.54b114"]]},{"id":"ed33619f.9a01a","type":"function","z":"7ac92c99.66ea94","name":"","func":"msg.payload = msg.payload + \"living color \";\nreturn msg;","outputs":1,"noerr":0,"x":475.51197814941406,"y":545.5000057220459,"wires":[["d0facd41.3bb66"]]},{"id":"1e25bad1.b2b155","type":"function","z":"7ac92c99.66ea94","name":"Activacion (Nuevo)","func":"if (msg.payload.includes(\"alarma\") && msg.payload.includes(\"casa\")){\n\tif (msg.estado === 0){\n\t\tif(global.get(\"estadoAlarma\") === 1){\n\t\t\tmsg = {topic: \"google/Alarma\", payload: 1}; return msg;\n\t\t}\n\t\tif(global.get(\"estadoAlarma\") === 0){\n\t\t\tmsg = {topic: \"aviso/Alarma\", payload: 1}; return msg;\n\t\t}\n\t}\n    msg = {topic: \"google/Alarma\", payload: msg.estado}; return msg;\n}\n\nif (msg.payload.includes(\"llenado\") && msg.payload.includes(\"tanque\")){\n\tglobal.set(\"llenarTanque\", parseInt(msg.estado));\n\tmsg = {topic: \"google/Lavadero\", payload: msg.estado};\n    return msg;\n}","outputs":1,"noerr":0,"x":592.5595741271973,"y":156.54764604568481,"wires":[["33295f84.632f7","66d6bc25.ebcf74"]]},{"id":"838a8e76.22bf4","type":"mqtt out","z":"7ac92c99.66ea94","name":"","topic":"","qos":"","retain":"","broker":"43555c62.30ed34","x":685.2619438171387,"y":672.476279258728,"wires":[]},{"id":"a69ff076.ba745","type":"inject","z":"7ac92c99.66ea94","name":"","topic":"","payload":"desactivar alarma casa","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":315.94052505493164,"y":220.92860174179077,"wires":[["eb1152.3061ceb"]]},{"id":"f545455.731d8b8","type":"delay","z":"7ac92c99.66ea94","name":"","pauseType":"delay","timeout":"10","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":859.4642906188965,"y":536.7857308387756,"wires":[["7f28f9ae.46e9d8"]]},{"id":"7f28f9ae.46e9d8","type":"mqtt out","z":"7ac92c99.66ea94","name":"","topic":"ESP/living/Iluminacion/beep","qos":"","retain":"","broker":"43555c62.30ed34","x":1068.0357398986816,"y":536.785807132721,"wires":[]},{"id":"d0facd41.3bb66","type":"function","z":"7ac92c99.66ea94","name":"Cambiar color (Nuevo)","func":"var payload = msg.payload;\n\n// if (global.get(\"estIslaRGB\") === 0)return;\nif (payload.includes(\"living\") && payload.includes(\"color\")){\n\tglobal.set(\"estIslaRGB\", 1);\n\n\tif ((payload.includes(\"azul\") && payload.includes(\"muy\") && payload.includes(\"oscuro\")) || payload.includes(\"1\")){\n\t\tglobal.set(\"IslaR\",  0); global.set(\"IslaG\", 0);\tglobal.set(\"IslaB\", 102);\n\t\tmsg.payload = \"1\"; node.send([null, msg]);\n\t}\n\tif ((payload.includes(\"azul\") && payload.includes(\"oscuro\")) || payload.includes(\"2\")){\n\t\tglobal.set(\"IslaR\", 0);\tglobal.set(\"IslaG\", 0);\tglobal.set(\"IslaB\", 150);\n\t\tmsg.payload = \"2\"; node.send([null, msg]);\n\t}\n\tif (payload.includes(\"azul\")  || payload.includes(\"3\")){\n\t\tglobal.set(\"IslaR\", 0);\tglobal.set(\"IslaG\", 0);\tglobal.set(\"IslaB\", 255);\n\t\tmsg.payload = \"3\"; node.send([null, msg]);\n\t}\n\tif (payload.includes(\"rojo\")  || payload.includes(\"4\")){\n\t\tglobal.set(\"IslaR\", 255); global.set(\"IslaG\", 0); global.set(\"IslaB\", 0);\n\t\tmsg.payload = \"4\"; node.send([null, msg]);\n\t}\n\tif (payload.includes(\"verde\")  || payload.includes(\"5\")){\n\t\tglobal.set(\"IslaR\", 0);\tglobal.set(\"IslaG\", 255); global.set(\"IslaB\", 0);\n\t\tmsg.payload = \"5\"; node.send([null, msg]);\n\t}\n\tif (payload.includes(\"blanco\") || payload.includes(\"6\")){\n\t\tglobal.set(\"IslaR\", 255); global.set(\"IslaG\", 255);\tglobal.set(\"IslaB\", 255);\n\t\tmsg.payload = \"6\"; node.send([null, msg]);\n\t}\n\tif (payload.includes(\"amarillo\")  || payload.includes(\"7\")){\n\t\tglobal.set(\"IslaR\", 255); global.set(\"IslaG\", 255);\tglobal.set(\"IslaB\", 0);\n\t\tmsg.payload = \"7\"; node.send([null, msg]);\n\t}\n\tif (payload.includes(\"lila\") || payload.includes(\"8\")){\n\t\tglobal.set(\"IslaR\", 153); global.set(\"IslaG\", 0);\tglobal.set(\"IslaB\", 204);\n\t\tmsg.payload = \"8\"; node.send([null, msg]);\n\t}\n\tif (payload.includes(\"gris\") || payload.includes(\"9\")){\n\t\tglobal.set(\"IslaR\", 90); global.set(\"IslaG\", 90);\tglobal.set(\"IslaB\", 90);\n\t\tmsg.payload = \"9\"; node.send([null, msg]);\n\t}\t\n\tif ((payload.includes(\"gris\") && payload.includes(\"claro\")) || payload.includes(\"10\")){\n\t\tglobal.set(\"IslaR\", 50); global.set(\"IslaG\", 50);\tglobal.set(\"IslaB\", 50);\n\t\tmsg.payload = \"10\"; node.send([null, msg]);\n\t}\n\tif ((payload.includes(\"gris\") && payload.includes(\"oscuro\")) || payload.includes(\"11\")){\n\t\tglobal.set(\"IslaR\", 15); global.set(\"IslaG\", 15);\tglobal.set(\"IslaB\", 15);\n\t\tmsg.payload = \"11\"; node.send([null, msg]);\n\t}\n\tmsg = {topic: \"google/Living\", payload: \"blanco\"}; return msg;\t\t\n}","outputs":2,"noerr":0,"x":652.7978210449219,"y":506.7857856750488,"wires":[["36115df0.567c42","f545455.731d8b8","d0e6ce07.4a58"],[]]},{"id":"23f16719.2216e8","type":"debug","z":"7ac92c99.66ea94","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":836.9881582260132,"y":346.92860174179077,"wires":[]},{"id":"bb649691.2325e8","type":"inject","z":"7ac92c99.66ea94","name":"","topic":"","payload":" gris muy oscuro","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":334.08337783813477,"y":474.07144594192505,"wires":[["d0facd41.3bb66"]]},{"id":"22bcd575.30145a","type":"inject","z":"7ac92c99.66ea94","name":"","topic":"","payload":"color living gris muy oscuro","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":309.464298248291,"y":541.0714249610901,"wires":[["d0facd41.3bb66"]]},{"id":"a434b87c.353a38","type":"inject","z":"7ac92c99.66ea94","name":"","topic":"","payload":"activar alarma casa","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":281.94052505493164,"y":103.92860174179077,"wires":[["f2b6cf60.3bf01"]]},{"id":"93d17e2b.1ecf1","type":"inject","z":"7ac92c99.66ea94","name":"alacena","topic":"","payload":"luces del lavadero alacena","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":258.03570556640625,"y":281.6071357727051,"wires":[["3723238d.48cb5c"]]},{"id":"613374ae.4c1edc","type":"http in","z":"7ac92c99.66ea94","name":"Request","url":"/activar","method":"post","upload":false,"swaggerDoc":"","x":271.94052505493164,"y":138.59526586532593,"wires":[["f2b6cf60.3bf01"]]},{"id":"33295f84.632f7","type":"mqtt out","z":"7ac92c99.66ea94","name":"","topic":"","qos":"","retain":"","broker":"43555c62.30ed34","x":781.6072196960449,"y":158.92859745025635,"wires":[]},{"id":"e0426764.d08828","type":"function","z":"7ac92c99.66ea94","name":"regula potencia (Nuevo)","func":"var payload = msg.payload;\nvar estado = msg.estado;\nvar minimo = 6;\nvar maximo = 255;\n\n// if (!payload.includes(\"living\")) return;\nif (payload.includes(\"luces\") || payload.includes(\"luz\")){\n\tif (payload.includes(\"living\")){\n\t\tvar potencia;\n\t\tpotencia = payload.replace(/\\D/g,'');\n\t\tpotencia = parseInt(potencia * 255 / 100);\n\t\tif (payload.includes(\"minimo\") || payload.includes(\"mínimo\"))var potencia = minimo;\n\t\tif (payload.includes(\"maximo\") || payload.includes(\"máximo\"))var potencia = maximo;\n\t\tif (payload.includes(\"isla\")){\n\t\t\tglobal.set(\"potIsla\", potencia);\n\t\t\tmsg = {topic: \"google/Living\", payload: \"estIsla= \" + global.get(\"estIsla\")};\n\t\t\treturn msg;\n\t\t}\n\t\tif (payload.includes(\"cielo raso\")){\n\t\t\tglobal.set(\"potCielorrazo\", potencia);\n\t\t\tmsg = {topic: \"google/Living\", payload: \"estCielorrazo= \" + global.get(\"estCielorrazo\")};\n\t\t\treturn msg;\n\t\t}\n\t\tglobal.set(\"potLiving\", potencia);\n\t\tglobal.set(\"potIsla\", potencia);\n\t\tglobal.set(\"potCielorrazo\", potencia);\n        global.set(\"IslaR\", potencia);\n        global.set(\"IslaG\", potencia);\n        global.set(\"IslaB\", potencia);\n\t\tmsg = {topic: \"google/Living\", payload: \"estCielorrazo= \" + global.get(\"estCielorrazo\")};\n\t\treturn msg;\n\t}\n}\n","outputs":1,"noerr":0,"x":481.51206493377686,"y":674.7977213859558,"wires":[["838a8e76.22bf4","300b7f5b.9609c"]]},{"id":"d0e6ce07.4a58","type":"debug","z":"7ac92c99.66ea94","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":863.3928718566895,"y":451.42860746383667,"wires":[]},{"id":"f80a5391.65bad","type":"http in","z":"7ac92c99.66ea94","name":"Request","url":"/desactivar","method":"post","upload":false,"swaggerDoc":"","x":276.6071891784668,"y":187.26192045211792,"wires":[["eb1152.3061ceb"]]},{"id":"c26049d5.571fc8","type":"http in","z":"7ac92c99.66ea94","name":"regular luces","url":"/regularluces","method":"post","upload":false,"swaggerDoc":"","x":238.98815822601318,"y":676.78573179245,"wires":[["e0426764.d08828","73edbc93.9b89e4"]]},{"id":"73edbc93.9b89e4","type":"debug","z":"7ac92c99.66ea94","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":464.44052505493164,"y":719.4286017417908,"wires":[]},{"id":"dd2ec6d9.69a7b8","type":"mqtt out","z":"7ac92c99.66ea94","name":"","topic":"","qos":"","retain":"","broker":"43555c62.30ed34","x":846.9881582260132,"y":296.92860174179077,"wires":[]},{"id":"94586275.a2467","type":"inject","z":"7ac92c99.66ea94","name":"lavadero","topic":"","payload":"luces del lavadero ","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":266.9881582260132,"y":256.92860174179077,"wires":[["3723238d.48cb5c"]]},{"id":"259024da.a7b9ac","type":"inject","z":"7ac92c99.66ea94","name":"lavadero","topic":"","payload":"luces del lavadero ","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":306.9881582260132,"y":406.92860174179077,"wires":[["15d3c9e4.d9caa6"]]},{"id":"2fa7e13d.b0570e","type":"inject","z":"7ac92c99.66ea94","name":"alacena","topic":"","payload":"luces del lavadero alacena","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":298.03570556640625,"y":431.6071357727051,"wires":[["15d3c9e4.d9caa6"]]},{"id":"b431a03.de72c6","type":"delay","z":"7ac92c99.66ea94","name":"","pauseType":"delay","timeout":"250","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":596.9881582260132,"y":226.92860174179077,"wires":[["3723238d.48cb5c","8915996e.13abb8"]]},{"id":"3498fc21.c391d4","type":"inject","z":"7ac92c99.66ea94","name":"desactivar alarma casa","topic":"","payload":"desactivar alarma casa y prendeme la luz del lavadero","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":256.9881582260132,"y":66.92860174179077,"wires":[["eb1152.3061ceb"]]},{"id":"8915996e.13abb8","type":"debug","z":"7ac92c99.66ea94","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":776.9881582260132,"y":226.92860174179077,"wires":[]},{"id":"3cbba0f1.1702a","type":"debug","z":"50119c6e.6ff584","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":430,"y":40,"wires":[]},{"id":"ea775eb.b6bcba","type":"inject","z":"3ce5b54a.127d6a","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":2380,"y":520,"wires":[["5d6a27c3.aa6e28"]]},{"id":"52908e32.a7c6c","type":"mqtt in","z":"3ce5b54a.127d6a","name":"","topic":"informarNivel","qos":"2","broker":"e779f8d6.7bc2c8","x":2400,"y":570,"wires":[["6426f42f.2ca5bc"]]},{"id":"af28e6c5.534938","type":"inject","z":"950c1426.ff4008","name":"","topic":"","payload":"bloqueoTeclas1","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1140,"y":590,"wires":[["d568dd07.8f5e2"]]},{"id":"916c08bd.e7ca88","type":"inject","z":"950c1426.ff4008","name":"","topic":"","payload":"bloqueoTeclas0","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1140,"y":630,"wires":[["d568dd07.8f5e2"]]},{"id":"49bf1e9d.427ec","type":"mqtt in","z":"950c1426.ff4008","name":"","topic":"ESP/Bano/Recibo","qos":"2","datatype":"auto","broker":"e779f8d6.7bc2c8","x":670,"y":600,"wires":[["a4e7912a.1db0a"]]},{"id":"a4e7912a.1db0a","type":"debug","z":"950c1426.ff4008","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":870,"y":580,"wires":[]},{"id":"d4599fda.594b8","type":"function","z":"9c63fd61.9908c","name":"","func":"var pin = parseInt(msg.pin);\nvar intPayload = parseInt(msg.payload);\nvar topic = msg.topic;\nvar dato;\n\nswitch (pin){\n  case 18:\n    global.set(\"itemPotencia\", msg.payload);\n    // if (parseInt(global.get(\"itemPotencia\")) > 0 && parseInt(global.get(\"itemPotencia\")) <= 5){\n      context.item = parseInt(msg.payload);\n      switch(parseInt(msg.payload)){\n          case 1:\n              msg = {pin: 19, min: 4, max: 255, label: \"Living\", payload: global.get(\"potLiving\")};\n          break;\n          case 2:\n              msg = {pin: 19, min: 4, max: 255, label: \"Isla\", payload: global.get(\"potIsla\")};\n          break;\n          case 3:\n              msg = {pin: 19, min: 4, max: 255, label: \"Cielorrazo\", payload: global.get(\"potCielorrazo\")};\n          break;\n          case 4:\n              msg = {pin: 19, min: 1, max: 255, label: \"Patio Luz\", payload: global.get(\"pwmPatioLuz\")};\n          break;\n          case 5:\n              msg = {pin: 19, min: 1, max: 100, label: \"Ducha de bano\", payload: global.get(\"pwmDucha\")};\n          break;          \n          case 6:\n              msg = {pin: 19, min: 1, max: 100, label: \"Luz Bano\", payload: global.get(\"pwmLuzBano\")};\n          break;     \n          case 7:\n              msg = {pin: 19, min: 15, max: 240, label: \"timer extractor baño\", payload: global.get(\"timerExtractorBano\")};\n          break;\n          case 8:\n              msg = {pin: 19, min: 10, max: 200, label: \"tiempo MIN teclas\", payload: global.get(\"minTeclas\")};\n          break;          \n          case 9:\n              msg = {pin: 19, min: 400, max: 2000, label: \"tiempo MAX teclas\", payload: global.get(\"maxTeclas\")};\n          break;       \n          case 10:\n              msg = {pin: 19, min: 1, max: 100, label: \"delay buzzer\", payload: global.get(\"delayBuzzer\")};\n          break;                      \n      }\n      node.send([null, msg]);\n      return;\n    // }\n  break;\n\n  case 19:\n    // if (parseInt(global.get(\"itemPotencia\")) > 0 && parseInt(global.get(\"itemPotencia\")) <= 5){\n      var valor = parseInt(msg.payload);\n      switch(context.item){\n          case 1:\n              // if (global.get(\"estLiving\") === 0)return;\n              global.set(\"potLiving\", valor);\n              global.set(\"potIsla\", valor);\n              global.set(\"potCielorrazo\", valor);\n              enviarMQTT(\"living\");\n          break;\n          case 2:\n              // if (global.get(\"estIsla\") === 0)return;\n              global.set(\"potIsla\", valor);\n              enviarMQTT(\"living\");\n          break;\n          case 3:\n              // if (global.get(\"estCielorrazo\") === 0)return;\n              global.set(\"potCielorrazo\", valor);\n              enviarMQTT(\"living\");\n          break;\n          case 4:\n              // if (global.get(\"Dia\") === 1)return;\n              global.set(\"pwmPatioLuz\", valor);\n              enviarMQTT(\"patioLuz\");\n              return;\n          case 5:\n              // if (global.get(\"estDucha\") === 0)return;  \n              global.set(\"pwmDucha\", valor);\n              enviarMQTT(\"bano\");\n              return;\n          case 6:\n              // if (global.get(\"estLuzBano\") === 0)return;  \n              global.set(\"pwmLuzBano\", valor);\n              enviarMQTT(\"bano\");\n              return;     \n      case 7:\n              global.set(\"timerExtractorBano\", valor);\n              enviarMQTT(\"bano\");\n              return;\n          case 8:\n              global.set(\"minTeclas\", valor);\n              enviarMQTT(\"configGenericas\");\n              return;     \n      case 9:\n              global.set(\"maxTeclas\", valor);\n              enviarMQTT(\"configGenericas\");\n              return;              \n        case 10:  \n              global.set(\"delayBuzzer\", valor);\n              enviarMQTT(\"configGenericas\");\n              return;              \n            }  \n          break;\n}\n\nfunction enviarMQTT(caso){\nvar dato;\n  if (caso == \"bano\"){\n  dato = global.get(\"estLuzBano\") + \"#\" + global.get(\"pwmLuzBano\") + \"#\" + global.get(\"modoDucha\") + \"#\" + global.get(\"estDucha\") + \"#\" + global.get(\"pwmDucha\");\n  dato += \"#\" + global.get(\"estLuzEspejo\") + \"#\" + global.get(\"estExtractorBano\") + \"#\" + global.get(\"timerExtractorBano\") + \"#\" + global.get(\"Dia\");\n    msg = {topic: \"ESP/Bano/Recibo\", payload: dato};\n  }\n\n  if (caso == \"patioLuz\"){msg = {topic: \"USBout\", payload: \"Noche\" + global.get(\"pwmPatioLuz\")};}\n  \n\n  if (caso == \"living\"){\n    dato = global.get(\"estIsla\") + \",\";\n    dato += global.get(\"potIsla\") + \"#\";\n    dato += global.get(\"estCielorrazo\") + \",\";\n    dato += global.get(\"potCielorrazo\") + \"#\";  \n    dato += global.get(\"estIslaRGB\") + \",\";\n    dato += global.get(\"IslaR\") + \",\";\n    dato += global.get(\"IslaG\") + \",\";      \n    dato += global.get(\"IslaB\") + \"#\";\n\n    dato += global.get(\"pwmMaxLed\") + \"#\";\n    dato += global.get(\"pwmMinLed\") + \"#\";\n\n    dato += global.get(\"minTeclas\") + \"#\";\n    dato += global.get(\"maxTeclas\") + \"#\";\n    dato += global.get(\"doblePuls\");\n    dato += \"#\" + global.get(\"Dia\");\n\n    msg = {topic: \"ESP/living/Iluminacion/Recibo\", payload: dato};\n    node.send([msg, null]);\n  }\n  if (caso == \"configGenericas\"){\n    dato = global.get(\"minTeclas\") + \"#\";\n  dato += global.get(\"maxTeclas\") + \"#\";\n  dato += global.get(\"delayBuzzer\");\n  msg = {topic: \"configTeclas\", payload: dato};\n  }\n\nnode.send([msg, null]);\n}","outputs":2,"noerr":0,"x":260,"y":280,"wires":[[],[]]},{"id":"156d91dc.8dc6ce","type":"mqtt in","z":"1b403a13.0ec8c6","name":"","topic":"USBin","qos":"2","datatype":"auto","broker":"e779f8d6.7bc2c8","x":1500,"y":920,"wires":[["27246e94.692872"]]},{"id":"27246e94.692872","type":"function","z":"1b403a13.0ec8c6","name":"","func":"if (msg.payload.substring(0, 9) == \"Resultado\"){\n    msg = {topic: \"terminalBlynk\", payload: msg.payload};\n    return msg;\n}","outputs":1,"noerr":0,"x":1700,"y":920,"wires":[["4bc2da12.2c62d4"]]},{"id":"4bc2da12.2c62d4","type":"mqtt out","z":"1b403a13.0ec8c6","name":"pedido","topic":"","qos":"","retain":"","broker":"e779f8d6.7bc2c8","x":1840,"y":910,"wires":[]},{"id":"2b6e7641.a45dfa","type":"mqtt out","z":"3ce5b54a.127d6a","name":"","topic":"USBout","qos":"","retain":"","broker":"e779f8d6.7bc2c8","x":570,"y":1200,"wires":[]},{"id":"8847dfbb.b88ad","type":"template","z":"3ce5b54a.127d6a","name":"","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"medicion","output":"str","x":380,"y":1210,"wires":[["2b6e7641.a45dfa"]]},{"id":"60955f88.18ba3","type":"inject","z":"3ce5b54a.127d6a","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":200,"y":1180,"wires":[["8847dfbb.b88ad"]]},{"id":"8491f917.c4e458","type":"inject","z":"230e7f04.aca52","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":410,"y":140,"wires":[["5cae64fe.b91d4c"]]},{"id":"5cae64fe.b91d4c","type":"mqtt out","z":"230e7f04.aca52","name":"","topic":"app","qos":"","retain":"","broker":"e779f8d6.7bc2c8","x":630,"y":150,"wires":[]},{"id":"b3b788dd.6d8f38","type":"mqtt in","z":"230e7f04.aca52","name":"","topic":"app","qos":"2","datatype":"auto","broker":"e779f8d6.7bc2c8","x":550,"y":90,"wires":[["403a458.e829abc"]]},{"id":"403a458.e829abc","type":"debug","z":"230e7f04.aca52","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":710,"y":90,"wires":[]},{"id":"ebb696a3.aa7358","type":"http in","z":"65561250.4225fc","name":"Request","url":"/salamandra","method":"get","upload":false,"swaggerDoc":"","x":120,"y":270,"wires":[["4db7751a.afaa9c","846055d3.225218"]]},{"id":"4db7751a.afaa9c","type":"debug","z":"65561250.4225fc","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":260,"y":240,"wires":[]},{"id":"20844f68.97aff","type":"http response","z":"65561250.4225fc","name":"","statusCode":"","headers":{},"x":890,"y":270,"wires":[]},{"id":"846055d3.225218","type":"function","z":"65561250.4225fc","name":"","func":"if (msg.payload.estado == \"PedidoInicial\"){\n    msg.app= \"1\";\n    return ([msg, null, null]);\n}\nif (msg.payload.estado == \"Pedido\"){\n    msg.app= \"1\";\n    return ([null, msg, null]);\n}\nif (msg.payload.estado.substring(0, 3) == \"sal\"){\n    msg.payload.estado = msg.payload.estado.substring(3);\n    var dato = msg.payload.estado.split(\"-\");//global.get(\"AutoMan\");\n    global.set(\"salamandraAuto\", parseInt(dato[0]));\n    global.set(\"salamandraBbaCirc\", parseInt(dato[1]));\n    global.set(\"salamandraBbaRad\", parseInt(dato[2]));\n    global.set(\"salamandraBbaTermo\", parseInt(dato[3]));\n    global.set(\"estadoTurbo\", parseInt(dato[4]));    \n    global.set(\"aire1\", parseInt(dato[5]));\n    global.set(\"aire2\", parseInt(dato[6]));\n    global.set(\"aire3\", parseInt(dato[7]));\n    global.set(\"aire4\", parseInt(dato[8]));\n    dato = global.get(\"salamandraAuto\") + \" -- \"\n    dato += global.get(\"bombaCirculadora\") + \" -- \"\n    dato += global.get(\"bombaRadiadores\") + \" -- \"\n    dato += global.get(\"bombaTermo\") + \" -- \"\n    dato += global.get(\"aire1\") + \" -- \"\n    dato += global.get(\"aire2\") + \" -- \"\n    dato += global.get(\"aire3\") + \" -- \"\n    dato += global.get(\"aire4\") + \" -- \"    \n    msg.app= \"1\";\n    node.send ([null, msg, null]);\n    msg = {topic: \"salamandra/Envio/PedidoEstado\", payload: 1}; \n    return ([null, null, msg]);\n}\n\n\n// msg.payload = \"sin estado\"; return msg;","outputs":3,"noerr":0,"x":350,"y":270,"wires":[["6f2f50e6.ed7df"],["5632122d.b59e1c"],["89cb398.6194fc8"]]},{"id":"c0e7f8c8.467858","type":"comment","z":"65561250.4225fc","name":"","info":"AutoMan\nbomba Circ\nbomba Rad\nbomba Termo\nAire1\nAire2\nAire3\nAire4\n\n1\n","x":140,"y":30,"wires":[]},{"id":"1c3cbb6b.b13a55","type":"inject","z":"65561250.4225fc","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":true,"onceDelay":"0.1","x":180,"y":80,"wires":[["d361cbfe.b5ce88"]]},{"id":"d361cbfe.b5ce88","type":"file in","z":"65561250.4225fc","name":"recover datos termo","filename":"/home/pi/BackUpNodeRed/Salamandra.txt","format":"utf8","chunk":false,"sendError":false,"x":390,"y":80,"wires":[["5b4f292a.00ed68","28ccd5a3.d6e7ba"]]},{"id":"e7200e51.1312a","type":"file","z":"65561250.4225fc","name":"back datos termo","filename":"/home/pi/BackUpNodeRed/Salamandra.txt","appendNewline":false,"createDir":false,"overwriteFile":"true","x":460,"y":190,"wires":[[]]},{"id":"58f7f2da.1362dc","type":"inject","z":"65561250.4225fc","name":"inicial","topic":"inicial","payload":"0#0#0#0#0#50#60#70#80","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":"2","x":130,"y":190,"wires":[["a6ec15ee.8e8e78"]]},{"id":"a6ec15ee.8e8e78","type":"function","z":"65561250.4225fc","name":"","func":"global.set(\"tempPatioLuz\", 1);\nif (msg.topic == \"inicial\"){// && isNaN(global.get(\"salamandraAuto\"))){\n    global.set(\"salamandraAuto\", 0);\n    global.set(\"bombaCirculadora\", 0);\n    global.set(\"bombaRadiadores\", 0);\n    global.set(\"bombaTermo\", 0);\n    global.set(\"estadoTurbo\", 0);    \n    global.set(\"aire1\", 0);\n    global.set(\"aire2\", 0);\n    global.set(\"aire3\", 0);\n    global.set(\"aire4\", 0);\n}\n\nvar dato = global.get(\"salamandraAuto\") + \"-\";\ndato += global.get(\"bombaCirculadora\") + \"-\";\ndato += global.get(\"bombaRadiadores\") + \"-\";\ndato += global.get(\"bombaTermo\") + \"-\";\ndato += global.get(\"estadoTurbo\") + \"-\";\ndato += global.get(\"aire1\") + \"-\";\ndato += global.get(\"aire2\") + \"-\";\ndato += global.get(\"aire3\") + \"-\";\ndato += global.get(\"aire4\");\nmsg.payload = dato;\nnode.status({text: dato});\nreturn msg;","outputs":1,"noerr":0,"x":290,"y":190,"wires":[["e7200e51.1312a"]]},{"id":"d77f0205.e7ea1","type":"debug","z":"65561250.4225fc","name":"Salamandra","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":720,"y":20,"wires":[]},{"id":"5b4f292a.00ed68","type":"function","z":"65561250.4225fc","name":"","func":"var dato = msg.payload.split(\"-\");\nglobal.set(\"salamandraAuto\", dato[0]);\nglobal.set(\"salamandraBbaCirc\", dato[1]);\nglobal.set(\"salamandraBbaRad\", dato[2]);\nglobal.set(\"salamandraBbaTermo\", dato[3]);\nglobal.set(\"estadoTurbo\", dato[4]);\nglobal.set(\"aire1\", dato[5]);\nglobal.set(\"aire2\", dato[6]);\nglobal.set(\"aire3\", dato[7]);\nglobal.set(\"aire4\", dato[8]);\n\nmsg.payload = global.get(\"salamandraAuto\") + \"-\";\nmsg.payload += global.get(\"salamandraBbaCirc\") + \"-\";\nmsg.payload += global.get(\"salamandraBbaRad\") + \"-\";\nmsg.payload += global.get(\"salamandraBbaTermo\") + \"-\";\nmsg.payload += global.get(\"estadoTurbo\") + \"-\";\nmsg.payload += global.get(\"aire1\") + \"-\";\nmsg.payload += global.get(\"aire2\") + \"-\";\nmsg.payload += global.get(\"aire3\") + \"-\";\nmsg.payload += global.get(\"aire4\");\n\n// msg.payload += parseInt(10 * Math.random()) + \"-\";\n// msg.payload += parseInt(10 * Math.random()) + \"-\";\n// msg.payload += parseInt(1 * Math.random()) + \"-\";\n// msg.payload += parseInt(100 * Math.random()) + \"-\";\n// msg.payload += parseInt(100 * Math.random()) + \"-\";\n// msg.payload += parseInt(100 * Math.random()) + \"-\";\n// msg.payload += parseInt(100 * Math.random());\n\nif (msg.app == \"1\"){\n    // msg.payload += \"  - \" + global.get(\"hsCpu\");\n    // msg.payload += \"-\" + global.get(\"tempExterior\");\n    // msg.payload += \"-\" + global.get(\"tempPatioLuz\");\n    // msg.payload += \"-\" + global.get(\"tempLavadero\");\n    // msg.payload += \"-\" + global.get(\"tempPasillo\");\n    // msg.payload += \"-\" + global.get(\"tempLiving\");\n    // msg.payload += \"-\" + global.get(\"tempExterior\");\n    node.send([msg, null]);\n    msg = {topic: \"salamandra/Envio/PedidoEstado\", payload: 1}; \n    return([null, msg]);     \n    \n}\n    \nif (msg.salamandra == \"1\"){\n    msg = {topic: \"salamandra/Envio/PedidoEstado\", payload: 1}; \n    return([null, msg]);    \n}\n\n","outputs":2,"noerr":0,"x":570,"y":80,"wires":[["d77f0205.e7ea1","89c4b954.7c2528"],["b55d0684.92dc98","7ead4ddf.087944"]]},{"id":"6f2f50e6.ed7df","type":"link out","z":"65561250.4225fc","name":"pedidoInicialEstadoSalamandra","links":["7d3e3fa9.e0d3c"],"x":475,"y":230,"wires":[]},{"id":"7d3e3fa9.e0d3c","type":"link in","z":"65561250.4225fc","name":"","links":["6f2f50e6.ed7df","27eb1174.97129e"],"x":235,"y":50,"wires":[["d361cbfe.b5ce88","e035e0d0.d5c2c"]]},{"id":"89c4b954.7c2528","type":"link out","z":"65561250.4225fc","name":"respuestaApp","links":["fa751805.ebbdd8"],"x":675,"y":60,"wires":[]},{"id":"76beb0b0.68eb5","type":"link in","z":"65561250.4225fc","name":"","links":["116f9afe.9947c5","df8b4a86.664ce8"],"x":795,"y":250,"wires":[["20844f68.97aff","b762ebc8.f81368"]]},{"id":"28ccd5a3.d6e7ba","type":"debug","z":"65561250.4225fc","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":550,"y":50,"wires":[]},{"id":"e035e0d0.d5c2c","type":"debug","z":"65561250.4225fc","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":340,"y":40,"wires":[]},{"id":"2e188d3a.689a92","type":"inject","z":"65561250.4225fc","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":110,"y":320,"wires":[["1ad520ae.27b98f"]]},{"id":"1ad520ae.27b98f","type":"function","z":"65561250.4225fc","name":"","func":"    msg = {salamandra: \"1\", payload: \"estado\"};\nreturn msg;","outputs":1,"noerr":0,"x":240,"y":320,"wires":[["27eb1174.97129e"]]},{"id":"7ead4ddf.087944","type":"debug","z":"65561250.4225fc","name":"App","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":710,"y":130,"wires":[]},{"id":"b55d0684.92dc98","type":"mqtt out","z":"65561250.4225fc","name":"","topic":"","qos":"","retain":"","broker":"e779f8d6.7bc2c8","x":710,"y":90,"wires":[]},{"id":"bdacff03.59e9e","type":"debug","z":"65561250.4225fc","name":"App","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":280,"y":360,"wires":[]},{"id":"3f567b72.9923c4","type":"mqtt in","z":"65561250.4225fc","name":"","topic":"salamandra/Recibo","qos":"2","datatype":"auto","broker":"e779f8d6.7bc2c8","x":120,"y":360,"wires":[["bdacff03.59e9e"]]},{"id":"def92016.fba6f","type":"inject","z":"65561250.4225fc","name":"Automatico","topic":"auto","payload":"1","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":150,"y":470,"wires":[["9620c90.0493538"]]},{"id":"fc476015.19c73","type":"inject","z":"65561250.4225fc","name":"Manual","topic":"auto","payload":"0","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":160,"y":510,"wires":[["9620c90.0493538"]]},{"id":"9620c90.0493538","type":"function","z":"65561250.4225fc","name":"Auto/Man","func":"if (msg.topic == \"auto\"){\n    global.set(\"salamandraAuto\", parseInt(msg.payload));\n}\n\nmsg.payload = global.get(\"salamandraAuto\") + \"-\";\nmsg.payload += parseInt(10 * Math.random()) + \"-\";\nmsg.payload += parseInt(10 * Math.random()) + \"-\";\nmsg.payload += parseInt(10 * Math.random()) + \"-\";\nmsg.payload += parseInt(100 * Math.random()) + \"-\";\nmsg.payload += parseInt(100 * Math.random()) + \"-\";\nmsg.payload += parseInt(100 * Math.random()) + \"-\";\nmsg.payload += parseInt(100 * Math.random());\nreturn msg;\n\nif (msg.app == \"1\"){\n    // msg.payload += \"  - \" + global.get(\"hsCpu\");\n    return([msg, null]);}\n    \nif (msg.salamandra == \"1\")return([null, msg]);    \n\n","outputs":1,"noerr":0,"x":300,"y":480,"wires":[["f31ed485.cf1638"]]},{"id":"825a44b0.f2d258","type":"link in","z":"65561250.4225fc","name":"","links":["5632122d.b59e1c","f31ed485.cf1638","664c1386.9587ec"],"x":185,"y":150,"wires":[["a6ec15ee.8e8e78"]]},{"id":"ed9ca648.e58918","type":"link in","z":"65561250.4225fc","name":"","links":["5632122d.b59e1c","63eaebae.f4f3e4","664c1386.9587ec"],"x":755,"y":340,"wires":[["bf604a8b.05ad38","7a152c17.ed02c4"]]},{"id":"bf604a8b.05ad38","type":"function","z":"65561250.4225fc","name":"","func":"var dato = global.get(\"salamandraAuto\") + \" -- \"\ndato += global.get(\"salamandraBbaCirc\") + \" -- \"\ndato += global.get(\"salamandraBbaRad\") + \" -- \"\ndato += global.get(\"salamandraBbaTermo\") + \" -- \"\ndato += global.get(\"estadoTurbo\") + \" -- \"\ndato += global.get(\"aire1\") + \" -- \"\ndato += global.get(\"aire2\") + \" -- \"\ndato += global.get(\"aire3\") + \" -- \"\ndato += global.get(\"aire4\")\n// dato += global.get(\"bombaCirculadora\") + \" -- \"\n\n\nnode.status({text: dato})","outputs":1,"noerr":0,"x":870,"y":350,"wires":[[]]},{"id":"7a152c17.ed02c4","type":"debug","z":"65561250.4225fc","name":"App","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":870,"y":310,"wires":[]},{"id":"5632122d.b59e1c","type":"link out","z":"65561250.4225fc","name":"PedidoEstadoSalamandra","links":["fa751805.ebbdd8","ed9ca648.e58918","825a44b0.f2d258"],"x":475,"y":270,"wires":[]},{"id":"27eb1174.97129e","type":"link out","z":"65561250.4225fc","name":"pedidoEstadoSalamandra","links":["7d3e3fa9.e0d3c"],"x":325,"y":320,"wires":[]},{"id":"78691845.de5d18","type":"function","z":"65561250.4225fc","name":"","func":"//1#0#0#0#750.2#125.2#115.2#78.5#10#15#25#35#21.2#22.5#23.6#21.2#22.5#23.6\n// if (isNaN(global.get(\"tempPatioLuz\")))\nglobal.set(\"tempPatioLuz\", 1);\nmsg.payload = global.get(\"salamandraAuto\");//1\nmsg.payload += \"#\" + global.get(\"salamandraBbaCirc\");//2 bomba circ\nmsg.payload += \"#\" + global.get(\"salamandraBbaRad\");//3 bomba radiadores\nmsg.payload += \"#\" + global.get(\"salamandraBbaTermo\");//4 bomba termo\nmsg.payload += \"#\" + global.get(\"estadoTurbo\");//4 bomba termo\nmsg.payload += \"#\" + parseInt(100 * Math.random());//5 temp camara comb\nmsg.payload += \"#\" + parseInt(100 * Math.random());//6 temp 1 serpentina\nmsg.payload += \"#\" + parseInt(100 * Math.random());//7 temp 2 serpentina\nmsg.payload += \"#\" + parseInt(100 * Math.random());//8 temp chimenea\nmsg.payload += \"#\" + parseInt(100 * Math.random());//9 tempRetRadiadores\nmsg.payload += \"#\" + parseInt(100 * Math.random());//10 tempIdaRadiadores\nmsg.payload += \"#\" + parseInt(100 * Math.random());//11 temp sal. serpentina camara\nmsg.payload += \"#\" + parseInt(100 * Math.random());//12 temp ida Termo\nmsg.payload += \"#\" + global.get(\"aire1\");//13 aire encendido\nmsg.payload += \"#\" + global.get(\"aire2\");//14 aire primario\nmsg.payload += \"#\" + global.get(\"aire3\");//15aire secundario\nmsg.payload += \"#\" + global.get(\"aire4\");//16 aire terciario\nmsg.payload += \"#\" + global.get(\"tempExterior\");//17temp exterior\nmsg.payload += \"#\" + global.get(\"tempPatioLuz\");//18 temp patio luz\nmsg.payload += \"#\" + global.get(\"tempLavadero\");//19 temp lavadero\nmsg.payload += \"#\" + global.get(\"tempPasillo\");//20 temp pasillo\nmsg.payload += \"#\" + global.get(\"tempLiving\") + \" \" + global.get(\"humLiving\");//21 temp living\nmsg.payload += \"#\" + global.get(\"tempTermoFin\");//22 temp termo\n\n// msg.payload += \"#\" + global.get(\"tempTermoFin\") + \" ºC\";\n// msg.payload += \"#\" + global.get(\"tempTermoFin\") + \" ºC\";\n\nreturn msg; \n\n","outputs":1,"noerr":0,"x":880,"y":190,"wires":[["df8b4a86.664ce8","3b4fa2da.6010ce"]]},{"id":"fa751805.ebbdd8","type":"link in","z":"65561250.4225fc","name":"","links":["5632122d.b59e1c","89c4b954.7c2528","664c1386.9587ec"],"x":645,"y":190,"wires":[["78402b6c.725834","78691845.de5d18"]]},{"id":"df8b4a86.664ce8","type":"link out","z":"65561250.4225fc","name":"respuestaApp","links":["76beb0b0.68eb5"],"x":985,"y":190,"wires":[]},{"id":"f31ed485.cf1638","type":"link out","z":"65561250.4225fc","name":"EstadoSalamandra","links":["825a44b0.f2d258"],"x":385,"y":480,"wires":[]},{"id":"b762ebc8.f81368","type":"debug","z":"65561250.4225fc","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":910,"y":230,"wires":[]},{"id":"3b4fa2da.6010ce","type":"debug","z":"65561250.4225fc","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":970,"y":160,"wires":[]},{"id":"9de4f7f3.4d5558","type":"serial in","z":"3ce5b54a.127d6a","name":"","serial":"b86d561e.834378","x":280,"y":550,"wires":[["d5de6169.53ddd","d89575f4.ec7998"]]},{"id":"1e430824.b490a8","type":"serial out","z":"3ce5b54a.127d6a","name":"","serial":"b86d561e.834378","x":560,"y":730,"wires":[]},{"id":"78402b6c.725834","type":"debug","z":"65561250.4225fc","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":880,"y":130,"wires":[]},{"id":"ac1dab87.86d418","type":"inject","z":"65561250.4225fc","name":"Si","topic":"auto","payload":"1","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":160,"y":550,"wires":[["facf49d2.b050d8"]]},{"id":"bf877ba0.b56668","type":"inject","z":"65561250.4225fc","name":"No","topic":"auto","payload":"0","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":160,"y":590,"wires":[["facf49d2.b050d8"]]},{"id":"facf49d2.b050d8","type":"function","z":"65561250.4225fc","name":"bombaTermo","func":"    global.set(\"bombaTermo\", parseInt(msg.payload));\n","outputs":1,"noerr":0,"x":310,"y":570,"wires":[[]]},{"id":"c6d6e9de.d973a8","type":"inject","z":"65561250.4225fc","name":"Si","topic":"auto","payload":"1","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":158.75,"y":705.0000104904175,"wires":[["b0de88a.72fd078"]]},{"id":"b0de88a.72fd078","type":"function","z":"65561250.4225fc","name":"bombaCirc","func":"    global.set(\"bombaCirculadora\", parseInt(msg.payload));\n","outputs":1,"noerr":0,"x":308.75,"y":725.0000104904175,"wires":[[]]},{"id":"95b8d4b1.31ad38","type":"inject","z":"65561250.4225fc","name":"No","topic":"auto","payload":"0","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":158.75,"y":745.0000104904175,"wires":[["b0de88a.72fd078"]]},{"id":"2d192673.7154ba","type":"inject","z":"65561250.4225fc","name":"Si","topic":"auto","payload":"1","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":160,"y":630,"wires":[["842c5e52.33947"]]},{"id":"842c5e52.33947","type":"function","z":"65561250.4225fc","name":"bombaRad","func":"    global.set(\"bombaRadiadores\", parseInt(msg.payload));\n","outputs":1,"noerr":0,"x":310,"y":650,"wires":[[]]},{"id":"5ba7d7e5.ca4f18","type":"inject","z":"65561250.4225fc","name":"No","topic":"auto","payload":"0","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":160,"y":670,"wires":[["842c5e52.33947"]]},{"id":"dc70c9c.2b0bc38","type":"function","z":"7ac92c99.66ea94","name":"","func":"if (msg.payload == \"1\"){\n    msg = {estado: 0, payload: \"apaga todas luces\"}; \n    return msg;}","outputs":1,"noerr":0,"x":170,"y":350,"wires":[["5172e6e0.6c63c8"]]},{"id":"56bbf874.a0d958","type":"debug","z":"950c1426.ff4008","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":690,"y":100,"wires":[]},{"id":"6fd15169.7f306","type":"debug","z":"7ac92c99.66ea94","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":640,"y":300,"wires":[]},{"id":"6c03eb14.54b114","type":"debug","z":"7ac92c99.66ea94","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":720,"y":270,"wires":[]},{"id":"22b80324.69601c","type":"mqtt in","z":"3ce5b54a.127d6a","name":"","topic":"ESP/PatioLuz/Sens/Temp/Resp","qos":"2","broker":"e779f8d6.7bc2c8","x":2540,"y":820,"wires":[["899168e0.b0a6b8"]]},{"id":"899168e0.b0a6b8","type":"function","z":"3ce5b54a.127d6a","name":"","func":"msg.payload = \"Temp Termo: \" + global.get(\"tempTermoFin\") + \"ºC          --          Ext.: \" + global.get(\"tempExterior\")+ \"ºC\";\n\nreturn msg;","outputs":1,"noerr":0,"x":2760,"y":820,"wires":[["e4abd47d.da0148"]]},{"id":"4b27d3c9.db51fc","type":"inject","z":"3ce5b54a.127d6a","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":2570,"y":890,"wires":[["899168e0.b0a6b8","f821222.7f29be"]]},{"id":"f821222.7f29be","type":"function","z":"3ce5b54a.127d6a","name":"","func":"msg.payload = \"Temp CPU: \" + global.get(\"tempCPU\") + \"ºC\";\n\nreturn msg;","outputs":1,"noerr":0,"x":2760,"y":860,"wires":[["a1ec76c.03b9088"]]},{"id":"1582d2b5.75d17d","type":"inject","z":"950c1426.ff4008","name":"reset Nano","topic":"","payload":"ResetNano","payloadType":"str","repeat":"86400","crontab":"","once":false,"onceDelay":0.1,"x":1130,"y":670,"wires":[["d568dd07.8f5e2"]]},{"id":"82ff517a.1fe18","type":"inject","z":"65561250.4225fc","name":"","topic":"","payload":"25","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":680,"y":710,"wires":[["44bad6f6.392098"]]},{"id":"a394c137.035f6","type":"debug","z":"65561250.4225fc","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1050,"y":750,"wires":[]},{"id":"d4698233.0ebe1","type":"inject","z":"65561250.4225fc","name":"","topic":"","payload":"35","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":680,"y":740,"wires":[["44bad6f6.392098"]]},{"id":"eea9634f.09fe1","type":"inject","z":"65561250.4225fc","name":"","topic":"","payload":"45","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":680,"y":770,"wires":[["44bad6f6.392098"]]},{"id":"df0e99cb.bdbd38","type":"inject","z":"65561250.4225fc","name":"","topic":"","payload":"55","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":680,"y":800,"wires":[["44bad6f6.392098"]]},{"id":"3d7e38fe.af40d8","type":"inject","z":"65561250.4225fc","name":"","topic":"","payload":"76","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":680,"y":870,"wires":[["44bad6f6.392098"]]},{"id":"4b3547d6.50abb8","type":"inject","z":"65561250.4225fc","name":"","topic":"","payload":"85","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":680,"y":910,"wires":[["44bad6f6.392098"]]},{"id":"4875db01.ff4204","type":"inject","z":"65561250.4225fc","name":"","topic":"","payload":"72","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":680,"y":840,"wires":[["44bad6f6.392098"]]},{"id":"97a06aa9.7a52a8","type":"mqtt in","z":"deff4396.4722a","name":"","topic":"cortinas/living/mando","qos":"2","datatype":"auto","broker":"e779f8d6.7bc2c8","x":660,"y":350,"wires":[["95952e02.a4fb4"]]},{"id":"95952e02.a4fb4","type":"debug","z":"deff4396.4722a","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":900,"y":350,"wires":[]},{"id":"328e56ab.38360a","type":"function","z":"deff4396.4722a","name":"","func":"context.cortina = context.cortina || \"\";\ncontext.item = context.item || 0;\ncontext.valor = context.valor || 0;\ncontext.limMax = context.limMax || 0;\ncontext.velSubir = context.velSubir || 0;\ncontext.velParar = context.velParar || 0;\ncontext.velBajar = context.velBajar || 0;\ncontext.limMinimo = context.limMinimo || 0;\ncontext.posicion = context.posicion || 0;\nvar mensaje;\n\nif (msg.topic == \"respuestaSetCortina\"){\n\tmensaje = msg.payload.split(\"#\");\n\tcontext.limMax = mensaje[0];\n\tcontext.velSubir = mensaje[1];\n\tcontext.velParar = mensaje[2];\n\tcontext.velBajar = mensaje[3];\n\tcontext.limMinimo = mensaje[4];\n\tcontext.posicion = mensaje[5];\n\tmensaje = context.limMax;\n\tmensaje += \"#\" + context.velSubir;\n\tmensaje += \"#\" + context.velParar;\n\tmensaje += \"#\" + context.velBajar;\n\tmensaje += \"#\" + context.limMinimo;\n\tmensaje += \"#\" + context.posicion;\n\tmsg.payload = mensaje; node.send ([null, msg]);\n\tmsg = {topic: \"terminal/Cortinas\", payload: context.cortina + \": \" + mensaje + \"\\n\"}; return([null, null, null, null, msg]);\n\t}\n\nif (msg.pin == \"90\"){\n\tif (msg.payload == \"1\")context.cortina = \"Living\";\n\tif (msg.payload == \"2\")context.cortina = \"ComedorFrente\";\n\tif (msg.payload == \"3\")context.cortina = \"ComedorLateral\";\n\tif (msg.payload == \"4\")context.cortina = \"CocinaEsquinero\";\n\tif (msg.payload == \"5\")context.cortina = \"CocinaLateral\";\n\tif (msg.payload == \"6\")context.cortina = \"LavaderoVentana\";\n\tif (msg.payload == \"7\")context.cortina = \"LavaderoPuerta\";\t\n\tmsg = {filename : \"/home/pi/BackUpNodeRed/Cortinas/\" + context.cortina + \".txt\", payload : msg.payload};\n\treturn ([null, null, msg]);\t\n}\t\nif (msg.topic == \"cortina\"){\n\tcontext.cortina = msg.payload;\n\tmsg = {filename : \"/home/pi/BackUpNodeRed/Cortinas/\" + context.cortina + \".txt\", payload : msg.payload};\n\treturn ([null, null, msg]);\n}\n\n\nif (msg.pin == \"91\"){\n\tif (msg.payload == \"1\"){context.item = 1; msg.payload = parseInt(context.limMax);}\n\tif (msg.payload == \"2\"){context.item = 2; msg.payload = parseInt(context.velSubir);}\n\tif (msg.payload == \"3\"){context.item = 3; msg.payload = parseInt(context.velParar);}\n\tif (msg.payload == \"4\"){context.item = 4; msg.payload = parseInt(context.velBajar);}\n\tif (msg.payload == \"5\"){context.item = 5; msg.payload = parseInt(context.limMinimo);}\n\tif (msg.payload == \"6\"){context.item = 6; msg.payload = parseInt(context.posicion);}\n\treturn([null, null, null, msg]);\n}\nif (msg.topic == \"item\"){\n\tif (msg.payload == \"limMax\" || msg.payload == \"1\"){context.item = 1; msg.payload = parseInt(context.limMax);}\n\tif (msg.payload == \"velSubir\" || msg.payload == \"2\"){context.item = 2; msg.payload = parseInt(context.velSubir);}\n\tif (msg.payload == \"velParar\" || msg.payload == \"3\"){context.item = 3; msg.payload = parseInt(context.velParar);}\n\tif (msg.payload == \"velBajar\" || msg.payload == \"4\"){context.item = 4; msg.payload = parseInt(context.velBajar);}\n\tif (msg.payload == \"limMinimo\" || msg.payload == \"5\"){context.item = 5; msg.payload = parseInt(context.limMinimo);}\n\tif (msg.payload == \"posicion\" || msg.payload == \"6\"){context.item = 6; msg.payload = parseInt(context.posicion);}\n\treturn([null, null, null, msg]);\n}\n\n\nif (msg.topic == \"valor\" || msg.pin == \"92\"){\n\tif (context.item === 1)context.limMax = msg.payload;\n\tif (context.item === 2)context.velSubir = msg.payload;\n\tif (context.item === 3)context.velParar = msg.payload;\n\tif (context.item === 4)context.velBajar = msg.payload;\n\tif (context.item === 5)context.limMinimo = msg.payload;\n\tif (context.item === 6)context.posicion = msg.payload;\n}\n\nif (msg.topic == \"guardar\" || msg.pin == \"93\"){\n\tmensaje = context.limMax;\n\tmensaje += \"#\" + context.velSubir;\n\tmensaje += \"#\" + context.velParar;\n\tmensaje += \"#\" + context.velBajar;\n\tmensaje += \"#\" + context.limMinimo;\n\tmensaje += \"#\" + context.posicion;\n\t// crearCadena();\n\tmsg = {filename : \"/home/pi/BackUpNodeRed/Cortinas/\" + context.cortina + \".txt\", payload : mensaje}; node.send ([msg, msg]);\n\tmsg = {topic: \"terminal/Cortinas\", payload: context.cortina + \": \" + mensaje + \"\\n\"}; return([null, null, null, null, msg]);\n}\n\nif (msg.topic == \"subir\" || msg.pin == \"95\"){msg = {topic: \"ESP/Cortina/\" + context.cortina + \"/Recibo\", payload: \"subir\"}; return([null, null, null, null, msg]);};\nif (msg.topic == \"parar\" || msg.pin == \"96\"){msg = {topic: \"ESP/Cortina/\" + context.cortina + \"/Recibo\", payload: \"parar\"}; return([null, null, null, null, msg]);};\nif (msg.topic == \"bajar\" || msg.pin == \"97\"){msg = {topic: \"ESP/Cortina/\" + context.cortina + \"/Recibo\", payload: \"bajar\"}; return([null, null, null, null, msg]);};","outputs":5,"noerr":0,"x":480,"y":160,"wires":[["cc3d13b.cf5c6f"],["29561e60.eebfd2"],["d879585a.4165e8","165e6249.7594de"],["16610236.793cee"],["967c6e7f.974c"]]},{"id":"cc3d13b.cf5c6f","type":"file","z":"deff4396.4722a","name":"back Cortinas","filename":"","appendNewline":false,"createDir":false,"overwriteFile":"true","x":680,"y":60,"wires":[[]]},{"id":"d879585a.4165e8","type":"file in","z":"deff4396.4722a","name":"back Cortinas","filename":"","format":"utf8","chunk":false,"sendError":false,"x":670,"y":150,"wires":[["4e11b9e1.de1478"]]},{"id":"f6af298f.ffc118","type":"link out","z":"deff4396.4722a","name":"respuestaSetCortina","links":["863b906c.c63a8"],"x":955,"y":150,"wires":[]},{"id":"4e11b9e1.de1478","type":"function","z":"deff4396.4722a","name":"","func":"msg = {topic: \"respuestaSetCortina\", payload: msg.payload};\nreturn msg;","outputs":1,"noerr":0,"x":870,"y":150,"wires":[["f6af298f.ffc118"]]},{"id":"863b906c.c63a8","type":"link in","z":"deff4396.4722a","name":"","links":["f6af298f.ffc118"],"x":325,"y":350,"wires":[["328e56ab.38360a"]]},{"id":"16610236.793cee","type":"link out","z":"deff4396.4722a","name":"valorItem","links":["70408250.d216dc","7d9c24f8.82a52c"],"x":575,"y":180,"wires":[]},{"id":"70408250.d216dc","type":"link in","z":"deff4396.4722a","name":"","links":["16610236.793cee"],"x":65,"y":160,"wires":[["de146c4e.373df"]]},{"id":"967c6e7f.974c","type":"mqtt out","z":"deff4396.4722a","name":"","topic":"","qos":"","retain":"","broker":"e779f8d6.7bc2c8","x":640,"y":220,"wires":[]},{"id":"328af9c9.887df6","type":"mqtt in","z":"deff4396.4722a","name":"","topic":"ESP/Cortina/Living/Inicio","qos":"2","datatype":"auto","broker":"e779f8d6.7bc2c8","x":150,"y":630,"wires":[["bd55d9ae.794ee8"]]},{"id":"62882fb1.862ab","type":"mqtt in","z":"deff4396.4722a","name":"","topic":"terminal/Cortinas","qos":"2","datatype":"auto","broker":"e779f8d6.7bc2c8","x":660,"y":300,"wires":[["f84ee0c0.77286"]]},{"id":"7d9c24f8.82a52c","type":"link in","z":"deff4396.4722a","name":"","links":["16610236.793cee"],"x":195,"y":430,"wires":[["6e68ecc4.cf3184"]]},{"id":"fe384b08.9d9d98","type":"function","z":"deff4396.4722a","name":"","func":"msg.payload = 0;\nreturn msg;","outputs":1,"noerr":0,"x":133.3333339691162,"y":469.9999885559082,"wires":[["3443c861.a5ee58","2f97fc11.e764a4"]]},{"id":"8474c43e.6fad38","type":"link out","z":"deff4396.4722a","name":"pararBlynk","links":["e334256d.0578d8"],"x":395,"y":280,"wires":[]},{"id":"e334256d.0578d8","type":"link in","z":"deff4396.4722a","name":"","links":["8474c43e.6fad38"],"x":43.88889122009277,"y":469.9999885559082,"wires":[["fe384b08.9d9d98"]]},{"id":"42a422be.f1f79c","type":"function","z":"deff4396.4722a","name":"","func":"msg = {topic: \"terminal/Cortinas\", payload: \"Rec. living: \" + msg.payload + \"\\n\"};\nreturn msg;","outputs":1,"noerr":0,"x":810,"y":490,"wires":[["f13d2094.f3ff9"]]},{"id":"f13d2094.f3ff9","type":"mqtt out","z":"deff4396.4722a","name":"","topic":"","qos":"","retain":"","broker":"e779f8d6.7bc2c8","x":930,"y":490,"wires":[]},{"id":"13b4eca7.bbdef3","type":"inject","z":"deff4396.4722a","name":"basico Living","topic":"","payload":"490#122#97#81#101#81","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":240,"y":670,"wires":[["be327a78.688fb8"]]},{"id":"165e6249.7594de","type":"debug","z":"deff4396.4722a","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":800,"y":220,"wires":[]},{"id":"fb84d14.d29f73","type":"inject","z":"73083520.75304c","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":290,"y":1200,"wires":[["44a49ae0.78b014"]]},{"id":"44a49ae0.78b014","type":"function","z":"73083520.75304c","name":"","func":"msg.payload = global.get(\"llenarTanque\");\nreturn msg;","outputs":1,"noerr":0,"x":500,"y":1210,"wires":[["70a83477.f8e40c"]]},{"id":"70a83477.f8e40c","type":"debug","z":"73083520.75304c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":640,"y":1210,"wires":[]},{"id":"7c3a631d.b269ac","type":"mqtt in","z":"deff4396.4722a","name":"","topic":"ESP/Cortina/Living/Envio","qos":"2","datatype":"auto","broker":"e779f8d6.7bc2c8","x":630,"y":460,"wires":[["42a422be.f1f79c","62e689d8.1d5d18","16e3b756.f95069"]]},{"id":"63c0ed73.1d09d4","type":"debug","z":"deff4396.4722a","name":"inicioCortinaLiving","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":550,"y":610,"wires":[]},{"id":"16e3b756.f95069","type":"debug","z":"deff4396.4722a","name":"ReciboCortinaLiving","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":910,"y":410,"wires":[]},{"id":"bd55d9ae.794ee8","type":"file in","z":"deff4396.4722a","name":"back Cortinas","filename":"/home/pi/BackUpNodeRed/Cortinas/living.txt","format":"utf8","chunk":false,"sendError":false,"x":360,"y":630,"wires":[["63c0ed73.1d09d4","59e6b1a4.8b009"]]},{"id":"59e6b1a4.8b009","type":"mqtt out","z":"deff4396.4722a","name":"","topic":"ESP/Cortina/Living/Recibo","qos":"","retain":"","broker":"e779f8d6.7bc2c8","x":580,"y":650,"wires":[]},{"id":"3f5e5a4d.169216","type":"inject","z":"65561250.4225fc","name":"Si","topic":"auto","payload":"1","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":160,"y":780,"wires":[["24c3ba98.202246"]]},{"id":"24c3ba98.202246","type":"function","z":"65561250.4225fc","name":"estTurbo","func":"    global.set(\"estadoTurbo\", parseInt(msg.payload));\n","outputs":1,"noerr":0,"x":300,"y":800,"wires":[[]]},{"id":"3b2a1642.34cc9a","type":"inject","z":"65561250.4225fc","name":"No","topic":"auto","payload":"0","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":160,"y":820,"wires":[["24c3ba98.202246"]]},{"id":"191adbf.f1b7d24","type":"function","z":"65561250.4225fc","name":"","func":"var dato;\ncontext.mmAnt == context.mmAnt || 0;\n\nif (msg.topic == \"timer\"){\n\tif (parseInt(global.get(\"mm\")) !== context.mmAnt){\n\t\tcontext.mmAnt = global.get(\"mm\");\n\t\tmsg = {topic: \"salamandra/Recibo\", payload: \"pedidoTemp\"}; return ([msg, null, null, null]);\n\t}\n}\n\nif (msg.topic == \"salamandra/Envio/PedidoEstado\"){\n    // dato = global.get(\"salamandraAuto\") + \"#\";\n    dato = global.get(\"salamandraBbaCirc\") + \"#\";\n    dato += global.get(\"salamandraBbaRad\") + \"#\";\n    dato += global.get(\"salamandraBbaTermo\") + \"#\";\n    dato += global.get(\"estadoTurbo\") + \"#\";\n    dato += global.get(\"aire1\") + \"#\";\n    dato += global.get(\"aire2\") + \"#\";\n    dato += global.get(\"aire3\") + \"#\";\n    dato += global.get(\"aire4\");\n    msg = {topic: \"salamandra/Recibo\", payload: \"estado\" + dato};\n    return ([msg, null, null, null]);\n}\n\nif (msg.topic == \"termoSolar/Salamandra\"){\n\tdato = msg.payload.split(\"#\");\n\tglobal.set(\"tempBajTermo\", dato[0]);\n\tglobal.set(\"tempSubTermo\", dato[1]);\n\treturn;\n}\n\nif (msg.topic == \"salamandra/Envio\"){\n\tdato = msg.payload.split(\"#\");\n\tglobal.set(\"tempCamara\", dato[0]);\n\tglobal.set(\"tempSerp1Fuego\", dato[1]);\n\tglobal.set(\"tempSerp2Fuego\", dato[2]);\n\tglobal.set(\"tempChimenea\", dato[3]);\n\tglobal.set(\"tempDepTermo\", dato[4]);\n\tglobal.set(\"tempDepRadiadores\", dato[5]);\n\tglobal.set(\"tempSerpCamara\", dato[6]);\n\tglobal.set(\"tempSerp1Agua\", dato[7]);\n\tglobal.set(\"tempRetRadiadores\", dato[8]);\n\n\tmsg = {topic: \"tempLiving\", payload: global.get(\"tempLiving\")}; node.send([null, null, msg, null]);\n\tmsg = {topic: \"tempPasillo\", payload: global.get(\"tempPasillo\")}; node.send([null, null, msg, null]);\n\tmsg = {topic: \"tempBano\", payload: global.get(\"tempBano\")}; node.send([null, null, msg, null]);\n\tmsg = {topic: \"tempHab1\", payload: global.get(\"tempHab1\")}; node.send([null, null, msg, null]);\n\tmsg = {topic: \"tempHab2\", payload: global.get(\"tempHab2\")}; node.send([null, null, msg, null]);\n\tmsg = {topic: \"tempComedor\", payload: global.get(\"tempComedor\")}; node.send([null, null, msg, null]);\n\tmsg = {topic: \"tempCocina\", payload: global.get(\"tempCocina\")}; node.send([null, null, msg, null]);\n\tmsg = {topic: \"tempLavadero\", payload: global.get(\"tempLavadero\")}; node.send([null, null, msg, null]);\n\tmsg = {topic: \"tempExterior\", payload: global.get(\"tempExterior\")}; node.send([null, null, msg, null]);\n\tmsg = {topic: \"tempTermo\", payload: global.get(\"tempTermo\")}; node.send([null, null, msg, null]);\n\n\tmsg = {topic: \"tempBajTermo\", payload: global.get(\"tempBajTermo\")}; node.send([null, null, msg, null]);\n\tmsg = {topic: \"tempSubTermo\", payload: global.get(\"tempSubTermo\")}; node.send([null, null, msg, null]);\n\n\tmsg = {topic: \"tempDepTermo\", payload: global.get(\"tempDepTermo\")}; node.send([null, null, msg, null]);\n\tmsg = {topic: \"tempDepRadiadores\", payload: global.get(\"tempDepRadiadores\")}; node.send([null, null, msg, null]);\n\tmsg = {topic: \"tempSerpCamara\", payload: global.get(\"tempSerpCamara\")}; node.send([null, null, msg, null]);\n\tmsg = {topic: \"tempSerp1Agua\", payload: global.get(\"tempSerp1Agua\")}; node.send([null, null, msg, null]);\n\tmsg = {topic: \"tempRetRadiadores\", payload: global.get(\"tempRetRadiadores\")}; node.send([null, null, msg, null]);\n\tmsg = {topic: \"tempCamara\", payload: global.get(\"tempCamara\")}; node.send([null, null, msg, null]);\n\tmsg = {topic: \"tempSerp1Fuego\", payload: global.get(\"tempSerp1Fuego\")}; node.send([null, null, msg, null]);\n\tmsg = {topic: \"tempSerp2Fuego\", payload: global.get(\"tempSerp2Fuego\")}; node.send([null, null, msg, null]);\n\n\tmsg = {topic: \"aire1\", payload: global.get(\"aire1\")}; node.send([null, null, msg, null]);\n\tmsg = {topic: \"aire2\", payload: global.get(\"aire2\")}; node.send([null, null, msg, null]);\n\tmsg = {topic: \"aire3\", payload: global.get(\"aire3\")}; node.send([null, null, msg, null]);\n\tmsg = {topic: \"aire4\", payload: global.get(\"aire4\")}; node.send([null, null, msg, null]);\n\tmsg = {topic: \"estadoTurbo\", payload: global.get(\"estadoTurbo\")}; node.send([null, null, msg, null]);\n\tmsg = {topic: \"salamandraBbaRad\", payload: global.get(\"salamandraBbaRad\")}; node.send([null, null, msg, null]);\n\tmsg = {topic: \"salamandraBbaCirc\", payload: global.get(\"salamandraBbaCirc\")}; node.send([null, null, msg, null]);\n\tmsg = {topic: \"salamandraBbaTermo\", payload: global.get(\"salamandraBbaTermo\")}; node.send([null, null, msg, null]);\n\n\tif (parseInt(global.get(\"tempCamara\")) > 50){\n\t\tvar mysql = \"INSERT INTO \\`salamandra\\`(\\`tiempo\\`, \\`tempLiving\\`, \\`tempPasillo\\`, \\`tempBano\\`, \\`tempHab1\\`, \\`tempHab2\\`, \\`tempComedor\\`, \\`tempCocina\\`, \\`tempLavadero\\`, \\`tempExterior\\`, \\`tempTermo\\`,\";\n\t\tmysql += \" \\`tempBajTermo\\`, \\`tempSubTermo\\`,\";\n\t\tmysql += \" \\`tempDepTermo\\`, \\`tempSerpCamara\\`, \\`temp1Serp\\`, \\`tempRetRad\\`, \\`tempDepRad\\`, \\`tempCamara\\`, \\`temp1SerpFuego\\`, \\`temp2SerpFuego\\`, \\`tempChimenea\\`,\";\n\t\tmysql += \" \\`aireEnc\\`, \\`airePrim\\`, \\`aireSec\\`, \\`aireTerc\\`, \\`turbo\\`, \\`bombaRad\\`, \\`bombaRec\\`, \\`bombaTermo\\`) VALUES (now(),\";\n\t\t\n\t\tmysql += 55 + \",\"; mysql += 0 + \",\"; mysql += 0 + \",\"; mysql += 0 + \",\";\n\t\tmysql += 0 + \",\"; mysql += 0 + \",\"; mysql += 0 + \",\"; \n\t\tmysql += 0 + \",\"; mysql += 0 + \",\"; mysql += 0 + \",\";\n\n\t\tmysql += global.get(\"tempBajTermo\") + \",\" + global.get(\"tempSubTermo\") + \",\";\n\n\t\tmysql += global.get(\"tempDepTermo\") + \",\" + global.get(\"tempDepRadiadores\") + \",\" + global.get(\"tempSerpCamara\") + \",\" + global.get(\"tempSerp1Agua\") + \",\";\n\t\tmysql += global.get(\"tempRetRadiadores\") + \",\" + global.get(\"tempCamara\") + \",\" + global.get(\"tempSerp1Fuego\") + \",\" + global.get(\"tempSerp2Fuego\") + \",\";\n\t\tmysql += global.get(\"tempChimenea\") + \",\";\n\n\t\tmysql += global.get(\"aire1\") + \",\" + global.get(\"aire2\") + \",\" + global.get(\"aire3\") + \",\" + global.get(\"aire4\") + \",\";\n\t\tmysql += global.get(\"estadoTurbo\") + \",\" + global.get(\"salamandraBbaRad\") + \",\" + global.get(\"salamandraBbaCirc\") + \",\" + global.get(\"salamandraBbaTermo\") + \")\";\n\t\tmsg.topic = mysql;\n\t\treturn ([null, null, null, msg]);\t\t\n\t}\n}\n\n\n\n// var mysql = \"INSERT INTO \\\\`salamandra\\\\`(\\\\`tiempo\\\\`, \\\\`tempLiving\\\\`, \\\\`tempPasillo\\\\`, \\\\`tempBano\\\\`, \\\\`tempHab1\\\\`, \\\\`tempHab2\\\\`, \\\\`tempComedor\\\\`, \\\\`tempCocina\\\\`, \\\\`tempLavadero\\\\`, \\\\`tempExterior\\\\`, \\\\`tempTermo\\\\`, \\\\`tempBajTermo\\\\`, \\\\`tempSubTermo\\\\`, \\\\`tempDepTermo\\\\`, \\\\`tempSerpCamara\\\\`, \\\\`temp1Serp\\\\`, \\\\`tempChimenea\\\\`, \\\\`tempRetRad\\\\`, \\\\`tempDepRad\\\\`, \\\\`aireEnc\\\\`, \\\\`airePrim\\\\`, \\\\`aireSec\\\\`, \\\\`aireTerc\\\\`, \\\\`turbo\\\\`, \\\\`bombaRad\\\\`, \\\\`bombaRec\\\\`, \\\\`bombaTermo\\\\`) VALUES (now(),\";\n// mysql += 55 + \",\"; mysql += 0 + \",\"; mysql += 0 + \",\"; mysql += 0 + \",\";\n// mysql += 0 + \",\"; mysql += 0 + \",\"; mysql += 0 + \",\"; mysql += 0 + \",\";\n// mysql += 0 + \",\"; mysql += 0 + \",\"; mysql += 0 + \",\"; mysql += 0 + \",\";\n// mysql += 0 + \",\"; mysql += 0 + \",\"; mysql += 0 + \",\"; mysql += 0 + \",\";\n// mysql += 0 + \",\"; mysql += 0 + \",\"; mysql += 0 + \",\"; mysql += 0 + \",\";\n// mysql += 0 + \",\"; mysql += 0 + \",\"; mysql += 0 + \",\"; mysql += 0 + \",\";\n// mysql += 0 + \",\"; mysql += 0 + \")\";\n// msg.topic = mysql;\n// return msg;","outputs":4,"noerr":0,"x":770,"y":460,"wires":[["d49172fe.f82d","6e69b3c3.10e39c"],[],["52f9a6c1.0b7488"],["ffdc7d32.9db9d"]]},{"id":"1f9a8b7a.160ec5","type":"mqtt in","z":"65561250.4225fc","name":"","topic":"salamandra/Envio/PedidoEstado","qos":"2","datatype":"auto","broker":"e779f8d6.7bc2c8","x":530,"y":430,"wires":[["191adbf.f1b7d24"]]},{"id":"d49172fe.f82d","type":"mqtt out","z":"65561250.4225fc","name":"","topic":"","qos":"","retain":"","broker":"e779f8d6.7bc2c8","x":930,"y":400,"wires":[]},{"id":"6e69b3c3.10e39c","type":"debug","z":"65561250.4225fc","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":930,"y":440,"wires":[]},{"id":"49e6f5a8.62d5dc","type":"inject","z":"65561250.4225fc","name":"timer","topic":"timer","payload":"","payloadType":"date","repeat":"14","crontab":"","once":false,"onceDelay":0.1,"x":610,"y":390,"wires":[["191adbf.f1b7d24"]]},{"id":"89cb398.6194fc8","type":"mqtt out","z":"65561250.4225fc","name":"","topic":"","qos":"","retain":"","broker":"e779f8d6.7bc2c8","x":510,"y":310,"wires":[]},{"id":"824d7e7b.545c5","type":"debug","z":"a89e305a.c50bb","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":640,"y":470,"wires":[]},{"id":"ad1b1083.a26f5","type":"debug","z":"950c1426.ff4008","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":940,"y":980,"wires":[]},{"id":"fd46a1ee.e820e","type":"inject","z":"950c1426.ff4008","name":"","topic":"","payload":"1","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":580,"y":660,"wires":[["f421502e.fe9ae"]]},{"id":"55216813.2b1c08","type":"inject","z":"950c1426.ff4008","name":"","topic":"","payload":"0","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":580,"y":700,"wires":[["f421502e.fe9ae"]]},{"id":"44bad6f6.392098","type":"PID control","z":"65561250.4225fc","name":"","target":"72","kp":"50","ki":"10","kd":"10","x":860,"y":750,"wires":[["a394c137.035f6"]]},{"id":"df618569.a65f68","type":"ui_button","z":"deff4396.4722a","name":"","group":"ff8a613f.fd5b7","order":4,"width":0,"height":0,"passthru":false,"label":"Guardar","tooltip":"","color":"","bgcolor":"","icon":"","payload":"1","payloadType":"str","topic":"guardar","x":130,"y":200,"wires":[["328e56ab.38360a"]]},{"id":"cc191962.60c108","type":"ui_button","z":"deff4396.4722a","name":"","group":"ff8a613f.fd5b7","order":7,"width":0,"height":0,"passthru":false,"label":"Subir","tooltip":"","color":"","bgcolor":"","icon":"","payload":"1","payloadType":"str","topic":"subir","x":140,"y":240,"wires":[["328e56ab.38360a"]]},{"id":"978ba17a.9fec4","type":"ui_button","z":"deff4396.4722a","name":"","group":"ff8a613f.fd5b7","order":8,"width":0,"height":0,"passthru":false,"label":"Parar","tooltip":"","color":"","bgcolor":"","icon":"","payload":"1","payloadType":"str","topic":"parar","x":140,"y":280,"wires":[["328e56ab.38360a"]]},{"id":"53e48a11.985b34","type":"ui_button","z":"deff4396.4722a","name":"","group":"ff8a613f.fd5b7","order":9,"width":0,"height":0,"passthru":false,"label":"Bajar","tooltip":"","color":"","bgcolor":"","icon":"","payload":"1","payloadType":"str","topic":"bajar","x":140,"y":320,"wires":[["328e56ab.38360a"]]},{"id":"82f47ef0.ce954","type":"ui_dropdown","z":"deff4396.4722a","name":"","label":"Cortina","tooltip":"","place":"Select option","group":"ff8a613f.fd5b7","order":1,"width":0,"height":0,"passthru":true,"options":[{"label":"Living","value":"Living","type":"str"},{"label":"Frente comedor ","value":"ComedorFrente","type":"str"},{"label":"Lateral comedor ","value":"ComedorLateral","type":"str"},{"label":"Esquinero cocina ","value":"CocinaEsquinero","type":"str"},{"label":"Lateral cocina","value":"CocinaLateral","type":"str"},{"label":"Ventana lavedero ","value":"LavaderoVentana","type":"str"},{"label":"Puerta Lavadero","value":"LavaderoPuerta","type":"str"}],"payload":"","topic":"cortina","x":130,"y":80,"wires":[["328e56ab.38360a"]]},{"id":"461a1cac.111c04","type":"ui_dropdown","z":"deff4396.4722a","name":"","label":"Item","tooltip":"","place":"Select option","group":"ff8a613f.fd5b7","order":2,"width":0,"height":0,"passthru":true,"options":[{"label":"Limite Maximo","value":"limMax","type":"str"},{"label":"Velocidad Subir","value":"velSubir","type":"str"},{"label":"Velocidad Parar","value":"velParar","type":"str"},{"label":"Velocidad Bajar","value":"velBajar","type":"str"},{"label":"Limite Minimo","value":"limMinimo","type":"str"},{"label":"Posicion","value":"posicion","type":"str"}],"payload":"","topic":"item","x":140,"y":120,"wires":[["328e56ab.38360a"]]},{"id":"24d7f863.61d028","type":"ui_switch","z":"230e7f04.aca52","name":"","label":"D0","tooltip":"","group":"ff2252ef.d12aa","order":1,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"0","style":"","onvalue":"1","onvalueType":"num","onicon":"","oncolor":"","offvalue":"0","offvalueType":"num","officon":"","offcolor":"","x":210,"y":70,"wires":[["411b27cf.122ad8"]]},{"id":"b72e08a8.825f08","type":"ui_switch","z":"230e7f04.aca52","name":"","label":"D1","tooltip":"","group":"ff2252ef.d12aa","order":2,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"1","style":"","onvalue":"1","onvalueType":"num","onicon":"","oncolor":"","offvalue":"0","offvalueType":"num","officon":"","offcolor":"","x":210,"y":110,"wires":[["411b27cf.122ad8"]]},{"id":"cc6a27e0.7872a8","type":"ui_switch","z":"230e7f04.aca52","name":"","label":"D2","tooltip":"","group":"ff2252ef.d12aa","order":3,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"2","style":"","onvalue":"1","onvalueType":"num","onicon":"","oncolor":"","offvalue":"0","offvalueType":"num","officon":"","offcolor":"","x":210,"y":150,"wires":[["411b27cf.122ad8"]]},{"id":"7de9350c.2c638c","type":"ui_switch","z":"230e7f04.aca52","name":"","label":"D3","tooltip":"","group":"ff2252ef.d12aa","order":4,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"3","style":"","onvalue":"1","onvalueType":"num","onicon":"","oncolor":"","offvalue":"0","offvalueType":"num","officon":"","offcolor":"","x":210,"y":190,"wires":[["411b27cf.122ad8"]]},{"id":"c0c34e09.35861","type":"ui_switch","z":"230e7f04.aca52","name":"","label":"D5","tooltip":"","group":"ff2252ef.d12aa","order":5,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"5","style":"","onvalue":"1","onvalueType":"num","onicon":"","oncolor":"","offvalue":"0","offvalueType":"num","officon":"","offcolor":"","x":210,"y":270,"wires":[["411b27cf.122ad8"]]},{"id":"f9c62d54.7f094","type":"ui_switch","z":"230e7f04.aca52","name":"","label":"D6","tooltip":"","group":"ff2252ef.d12aa","order":6,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"6","style":"","onvalue":"1","onvalueType":"num","onicon":"","oncolor":"","offvalue":"0","offvalueType":"num","officon":"","offcolor":"","x":210,"y":310,"wires":[["411b27cf.122ad8"]]},{"id":"93568155.14a6e","type":"ui_switch","z":"230e7f04.aca52","name":"","label":"D7","tooltip":"","group":"ff2252ef.d12aa","order":7,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"7","style":"","onvalue":"1","onvalueType":"num","onicon":"","oncolor":"","offvalue":"0","offvalueType":"num","officon":"","offcolor":"","x":210,"y":350,"wires":[["411b27cf.122ad8"]]},{"id":"97f851d.49cc7b","type":"ui_switch","z":"230e7f04.aca52","name":"","label":"D8","tooltip":"","group":"ff2252ef.d12aa","order":8,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"8","style":"","onvalue":"1","onvalueType":"num","onicon":"","oncolor":"","offvalue":"0","offvalueType":"num","officon":"","offcolor":"","x":210,"y":390,"wires":[["411b27cf.122ad8"]]},{"id":"dcf8322b.95d13","type":"ui_switch","z":"230e7f04.aca52","name":"","label":"D4","tooltip":"","group":"ff2252ef.d12aa","order":10,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"4","style":"","onvalue":"1","onvalueType":"num","onicon":"","oncolor":"","offvalue":"0","offvalueType":"num","officon":"","offcolor":"","x":210,"y":230,"wires":[["411b27cf.122ad8"]]},{"id":"34a42ed0.f6adc2","type":"ui_switch","z":"3ce5b54a.127d6a","name":"","label":"Alarma","tooltip":"","group":"1134b585.4c9e0a","order":5,"width":0,"height":0,"passthru":false,"decouple":"false","topic":"","style":"","onvalue":"1","onvalueType":"num","onicon":"","oncolor":"","offvalue":"0","offvalueType":"num","officon":"","offcolor":"","x":1760,"y":1110,"wires":[["11075f36.1f5d01"]]},{"id":"17d6214.c6c9bdf","type":"ui_switch","z":"73083520.75304c","name":"","label":"Luz Lavadero","tooltip":"","group":"1c362bad.cfd2e4","order":2,"width":0,"height":0,"passthru":false,"decouple":"true","topic":"Lavadero","style":"","onvalue":"1","onvalueType":"num","onicon":"","oncolor":"","offvalue":"0","offvalueType":"num","officon":"","offcolor":"","x":1380,"y":110,"wires":[["ad875658.859188"]]},{"id":"84176557.cef1e8","type":"ui_switch","z":"73083520.75304c","name":"","label":"Luz Alacena Lavadero","tooltip":"","group":"1c362bad.cfd2e4","order":3,"width":0,"height":0,"passthru":false,"decouple":"true","topic":"alacenaLavadero","style":"","onvalue":"1","onvalueType":"num","onicon":"","oncolor":"","offvalue":"0","offvalueType":"num","officon":"","offcolor":"","x":1390,"y":160,"wires":[["ad875658.859188"]]},{"id":"1dc88260.6fd34e","type":"ui_switch","z":"73083520.75304c","name":"","label":"llenar Tanque","tooltip":"","group":"1c362bad.cfd2e4","order":6,"width":0,"height":0,"passthru":false,"decouple":"true","topic":"llenarTanque","style":"","onvalue":"1","onvalueType":"num","onicon":"","oncolor":"","offvalue":"0","offvalueType":"num","officon":"","offcolor":"","x":1370,"y":210,"wires":[["ad875658.859188"]]},{"id":"d7c0da49.673d58","type":"ui_switch","z":"73083520.75304c","name":"","label":"bomba Centrifuga","tooltip":"","group":"1c362bad.cfd2e4","order":4,"width":0,"height":0,"passthru":false,"decouple":"true","topic":"bombaPozo","style":"","onvalue":"1","onvalueType":"num","onicon":"","oncolor":"","offvalue":"0","offvalueType":"num","officon":"","offcolor":"","x":1390,"y":250,"wires":[["ad875658.859188"]]},{"id":"6f669d4b.6dda34","type":"ui_switch","z":"73083520.75304c","name":"","label":"bomba Pileta","tooltip":"","group":"1c362bad.cfd2e4","order":5,"width":0,"height":0,"passthru":false,"decouple":"true","topic":"bombaPileta","style":"","onvalue":"1","onvalueType":"num","onicon":"","oncolor":"","offvalue":"0","offvalueType":"num","officon":"","offcolor":"","x":1380,"y":300,"wires":[["ad875658.859188"]]},{"id":"c2e8ba24.39f3b8","type":"ui_switch","z":"950c1426.ff4008","name":"","label":"Luz Baño","tooltip":"","group":"1a0f799.46f9186","order":1,"width":0,"height":0,"passthru":false,"decouple":"true","topic":"Bano","style":"","onvalue":"1","onvalueType":"num","onicon":"","oncolor":"","offvalue":"0","offvalueType":"num","officon":"","offcolor":"","x":820,"y":650,"wires":[["21b0c5b2.1b19aa"]]},{"id":"f421502e.fe9ae","type":"ui_switch","z":"950c1426.ff4008","name":"","label":"Modo Ducha","tooltip":"","group":"1a0f799.46f9186","order":3,"width":0,"height":0,"passthru":false,"decouple":"true","topic":"modoDucha","style":"","onvalue":"1","onvalueType":"num","onicon":"","oncolor":"","offvalue":"0","offvalueType":"num","officon":"","offcolor":"","x":820,"y":690,"wires":[["21b0c5b2.1b19aa"]]},{"id":"b59774c0.577fd8","type":"ui_switch","z":"950c1426.ff4008","name":"","label":"estado Ducha","tooltip":"","group":"1a0f799.46f9186","order":4,"width":0,"height":0,"passthru":false,"decouple":"true","topic":"estadoDucha","style":"","onvalue":"1","onvalueType":"num","onicon":"","oncolor":"","offvalue":"0","offvalueType":"num","officon":"","offcolor":"","x":820,"y":730,"wires":[["21b0c5b2.1b19aa"]]},{"id":"a2dff89e.cf8708","type":"ui_switch","z":"950c1426.ff4008","name":"","label":"Luz Espejo","tooltip":"","group":"1a0f799.46f9186","order":2,"width":0,"height":0,"passthru":false,"decouple":"true","topic":"LuzEspejo","style":"","onvalue":"1","onvalueType":"num","onicon":"","oncolor":"","offvalue":"0","offvalueType":"num","officon":"","offcolor":"","x":820,"y":770,"wires":[["21b0c5b2.1b19aa"]]},{"id":"75b90702.f612f8","type":"ui_switch","z":"950c1426.ff4008","name":"","label":"Extractor","tooltip":"","group":"1a0f799.46f9186","order":5,"width":0,"height":0,"passthru":false,"decouple":"true","topic":"Extractor","style":"","onvalue":"1","onvalueType":"num","onicon":"","oncolor":"","offvalue":"0","offvalueType":"num","officon":"","offcolor":"","x":820,"y":810,"wires":[["21b0c5b2.1b19aa"]]},{"id":"38baede0.8038e2","type":"ui_switch","z":"950c1426.ff4008","name":"","label":"Luz Pasillo","tooltip":"","group":"1a0f799.46f9186","order":6,"width":0,"height":0,"passthru":false,"decouple":"false","topic":"LuzPasillo","style":"","onvalue":"1","onvalueType":"num","onicon":"","oncolor":"","offvalue":"0","offvalueType":"num","officon":"","offcolor":"","x":820,"y":850,"wires":[["21b0c5b2.1b19aa"]]},{"id":"e7995436.864178","type":"ui_switch","z":"a89e305a.c50bb","name":"","label":"Living","tooltip":"","group":"6a6e2505.7b8a5c","order":2,"width":0,"height":0,"passthru":false,"decouple":"true","topic":"Living","style":"","onvalue":"1","onvalueType":"num","onicon":"","oncolor":"","offvalue":"0","offvalueType":"num","officon":"","offcolor":"","x":760,"y":520,"wires":[["1ab2f0fa.9116ef"]]},{"id":"81391af8.a44828","type":"ui_switch","z":"a89e305a.c50bb","name":"","label":"Isla","tooltip":"","group":"6a6e2505.7b8a5c","order":3,"width":0,"height":0,"passthru":false,"decouple":"true","topic":"Isla","style":"","onvalue":"1","onvalueType":"num","onicon":"","oncolor":"","offvalue":"0","offvalueType":"num","officon":"","offcolor":"","x":760,"y":560,"wires":[["1ab2f0fa.9116ef"]]},{"id":"6f3f19e9.fa3cf8","type":"ui_switch","z":"a89e305a.c50bb","name":"","label":"Cielorrazo","tooltip":"","group":"6a6e2505.7b8a5c","order":4,"width":0,"height":0,"passthru":false,"decouple":"true","topic":"Cielorrazo","style":"","onvalue":"1","onvalueType":"num","onicon":"","oncolor":"","offvalue":"0","offvalueType":"num","officon":"","offcolor":"","x":780,"y":600,"wires":[["1ab2f0fa.9116ef"]]},{"id":"1787ebf3.ebb804","type":"ui_switch","z":"a89e305a.c50bb","name":"","label":"isla RGB","tooltip":"","group":"6a6e2505.7b8a5c","order":5,"width":0,"height":0,"passthru":false,"decouple":"true","topic":"islaRGB","style":"","onvalue":"1","onvalueType":"num","onicon":"","oncolor":"","offvalue":"0","offvalueType":"num","officon":"","offcolor":"","x":770,"y":640,"wires":[["1ab2f0fa.9116ef"]]},{"id":"50a1b16c.2984","type":"ui_text_input","z":"3ce5b54a.127d6a","name":"","label":"Serial Arduino Nano","tooltip":"","group":"177e0064.22348","order":5,"width":0,"height":0,"passthru":true,"mode":"text","delay":"0","topic":"","x":370,"y":680,"wires":[["97f0b2f0.7fe07","1e430824.b490a8"]]},{"id":"de146c4e.373df","type":"ui_text_input","z":"deff4396.4722a","name":"","label":"valor","tooltip":"","group":"ff8a613f.fd5b7","order":3,"width":0,"height":0,"passthru":false,"mode":"number","delay":300,"topic":"valor","x":140,"y":160,"wires":[["328e56ab.38360a"]]},{"id":"f1992d54.9e6b6","type":"ui_text","z":"230e7f04.aca52","group":"ff2252ef.d12aa","order":9,"width":0,"height":0,"name":"","label":"Debug","format":"{{msg.payload}}","layout":"row-center","x":580,"y":300,"wires":[]},{"id":"a0fdce3d.0029a","type":"ui_text","z":"3ce5b54a.127d6a","group":"1134b585.4c9e0a","order":10,"width":0,"height":0,"name":"","label":"est. bat.: ","format":"{{msg.payload}}","layout":"row-left","x":2858.6428451538086,"y":644.4999935286387,"wires":[]},{"id":"d1b1c079.3077f","type":"ui_text","z":"3ce5b54a.127d6a","group":"177e0064.22348","order":6,"width":0,"height":0,"name":"","label":"info arduino","format":"{{msg.payload}}","layout":"row-spread","x":760,"y":590,"wires":[]},{"id":"e68fc671.d485c8","type":"ui_text","z":"3ce5b54a.127d6a","group":"1134b585.4c9e0a","order":1,"width":0,"height":0,"name":"","label":"","format":"{{msg.payload}}","layout":"row-center","x":830,"y":360,"wires":[]},{"id":"cbca2d76.46fd5","type":"ui_text","z":"950c1426.ff4008","group":"1134b585.4c9e0a","order":11,"width":0,"height":0,"name":"","label":"text","format":"{{msg.payload}}","layout":"row-spread","x":1300,"y":40,"wires":[]},{"id":"25e92b87.f7d434","type":"ui_text","z":"50119c6e.6ff584","group":"1c362bad.cfd2e4","order":1,"width":0,"height":0,"name":"","label":"Temp Lavadero","format":"{{msg.payload}} ºC","layout":"row-spread","x":660,"y":240,"wires":[]},{"id":"7aaed2d0.0da38c","type":"ui_text","z":"50119c6e.6ff584","group":"6a6e2505.7b8a5c","order":1,"width":0,"height":0,"name":"","label":"Temp Living","format":"{{msg.payload}} ºC","layout":"row-spread","x":660,"y":400,"wires":[]},{"id":"e4abd47d.da0148","type":"ui_text","z":"3ce5b54a.127d6a","group":"1134b585.4c9e0a","order":2,"width":0,"height":0,"name":"","label":"","format":"{{msg.payload}}","layout":"row-left","x":2910,"y":820,"wires":[]},{"id":"a1ec76c.03b9088","type":"ui_text","z":"3ce5b54a.127d6a","group":"1134b585.4c9e0a","order":4,"width":0,"height":0,"name":"","label":"","format":"{{msg.payload}}","layout":"row-left","x":2910,"y":860,"wires":[]},{"id":"29561e60.eebfd2","type":"ui_text","z":"deff4396.4722a","group":"ff8a613f.fd5b7","order":5,"width":0,"height":0,"name":"","label":"limMax-velSub-velPar-velBaj-limMin-Pos","format":"{{msg.payload}}","layout":"col-center","x":750,"y":110,"wires":[]},{"id":"62e689d8.1d5d18","type":"ui_text","z":"deff4396.4722a","group":"ff8a613f.fd5b7","order":6,"width":0,"height":0,"name":"","label":"recibo Cortina","format":"{{msg.payload}}","layout":"col-center","x":920,"y":450,"wires":[]},{"id":"f172b930.5a1238","type":"ui_gauge","z":"3ce5b54a.127d6a","name":"","group":"177e0064.22348","order":3,"width":"2","height":"2","gtype":"gage","title":"Temp Bat1","label":"units","format":"{{value}}","min":"0","max":"50","colors":["#00b500","#e6e600","#ca3838"],"seg1":"","seg2":"","x":2850,"y":250,"wires":[]},{"id":"c50fec05.b4a01","type":"ui_gauge","z":"3ce5b54a.127d6a","name":"","group":"1134b585.4c9e0a","order":6,"width":"2","height":"2","gtype":"gage","title":"Voltaje Bat.","label":"units","format":"{{value}}","min":"9","max":"16","colors":["#00b500","#e6e600","#ca3838"],"seg1":"","seg2":"","x":2857.880958557129,"y":552.5952598026824,"wires":[]},{"id":"2d31d0b7.e3314","type":"ui_gauge","z":"3ce5b54a.127d6a","name":"","group":"177e0064.22348","order":1,"width":"2","height":"2","gtype":"gage","title":"Temp CPU","label":"units","format":"{{value}}","min":"30","max":"100","colors":["#00b500","#e6e600","#ca3838"],"seg1":"","seg2":"","x":2838.8807258605957,"y":696.6428856168477,"wires":[]},{"id":"8af0a3fa.e59e7","type":"ui_gauge","z":"3ce5b54a.127d6a","name":"","group":"177e0064.22348","order":2,"width":"2","height":"2","gtype":"gage","title":"Amb. Baterias","label":"units","format":"{{value}}","min":"0","max":"50","colors":["#00b500","#e6e600","#ca3838"],"seg1":"","seg2":"","x":2865.023780822754,"y":511.1666731153218,"wires":[]},{"id":"649cd037.becf5","type":"ui_gauge","z":"3ce5b54a.127d6a","name":"","group":"1134b585.4c9e0a","order":8,"width":"2","height":"2","gtype":"gage","title":"Niv Tanque","label":"units","format":"{{value}}","min":"100","max":"550","colors":["#00b500","#e6e600","#ca3838"],"seg1":"","seg2":"","x":2856.4999389648438,"y":604.976184027536,"wires":[]},{"id":"d4a94829.9d2278","type":"ui_gauge","z":"3ce5b54a.127d6a","name":"","group":"177e0064.22348","order":4,"width":"2","height":"2","gtype":"gage","title":"Temp Bat2","label":"units","format":"{{value}}","min":"0","max":"50","colors":["#00b500","#e6e600","#ca3838"],"seg1":"","seg2":"","x":2840,"y":300,"wires":[]},{"id":"a300fbef.9d5148","type":"ui_gauge","z":"3ce5b54a.127d6a","name":"","group":"1134b585.4c9e0a","order":7,"width":"2","height":"2","gtype":"gage","title":"Corr. Carga","label":"Ampers","format":"{{value}}","min":"0","max":"20","colors":["#00b500","#e6e600","#ca3838"],"seg1":"","seg2":"","x":2840,"y":340,"wires":[]},{"id":"bee9f645.f336a8","type":"ui_gauge","z":"3ce5b54a.127d6a","name":"","group":"1134b585.4c9e0a","order":9,"width":"2","height":"2","gtype":"gage","title":"temp. Termo","label":"Ampers","format":"{{value}}","min":"20","max":"105","colors":["#00b500","#e6e600","#ca3838"],"seg1":"","seg2":"","x":2840,"y":380,"wires":[]},{"id":"de866222.be3ce","type":"ui_chart","z":"3ce5b54a.127d6a","name":"","group":"177e0064.22348","order":7,"width":"16","height":"10","label":"Tanque","chartType":"line","legend":"false","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":false,"ymin":"140","ymax":"450","removeOlder":"3","removeOlderPoints":"","removeOlderUnit":"604800","cutout":0,"useOneColor":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":true,"outputs":1,"x":2839.8810119628906,"y":178.285699571882,"wires":[[]]},{"id":"c886ed5f.c4e19","type":"ui_chart","z":"3ce5b54a.127d6a","name":"","group":"177e0064.22348","order":8,"width":"16","height":"10","label":"Temperaturas","chartType":"line","legend":"false","xformat":"HH:mm:ss","interpolate":"bezier","nodata":"","dot":false,"ymin":"-10","ymax":"30","removeOlder":"3","removeOlderPoints":"","removeOlderUnit":"86400","cutout":0,"useOneColor":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":true,"outputs":1,"x":2855.0238723754883,"y":221.16658374241422,"wires":[[]]},{"id":"d9f5febb.e48e8","type":"blynk-ws-in-write","z":"e6e33852.2495f8","name":"","pin":"76","pin_all":0,"client":"2c18e412.5f5cbc","x":141.8888931274414,"y":195.66666221618652,"wires":[["16b67857.ba97a8"]]},{"id":"455e965f.effd68","type":"blynk-ws-in-write","z":"e364a467.07a6a8","name":"","pin":"58","pin_all":0,"client":"2c18e412.5f5cbc","x":252.4999771118164,"y":106.25000095367432,"wires":[["b9c8c2ba.5fe5c"]]},{"id":"c0ac8ea4.256ab","type":"blynk-ws-in-write","z":"e364a467.07a6a8","name":"","pin":"52","pin_all":0,"client":"2c18e412.5f5cbc","x":252.50000762939453,"y":156.25,"wires":[["c4d6adc9.7d5d7"]]},{"id":"8b4d983f.4cde68","type":"blynk-ws-in-write","z":"e364a467.07a6a8","name":"","pin":"57","pin_all":0,"client":"2c18e412.5f5cbc","x":248.2222442626953,"y":55.75000190734863,"wires":[["23a53a0d.bc6c56"]]},{"id":"ffde6b3a.171c38","type":"blynk-ws-in-write","z":"3ce5b54a.127d6a","name":"Blynk","pin":"1","client":"2c18e412.5f5cbc","x":1370,"y":960,"wires":[["da17eae0.10cf48"]]},{"id":"c500e5cf.a925d8","type":"blynk-ws-in-write","z":"73083520.75304c","name":"llenar tanque","pin":"34","pin_all":false,"client":"2c18e412.5f5cbc","x":350,"y":190,"wires":[["9f837dbe.a7563"]]},{"id":"653959cc.7d0be8","type":"blynk-ws-in-write","z":"73083520.75304c","name":"marcha Bomba","pin":"2","pin_all":false,"client":"2c18e412.5f5cbc","x":340,"y":150,"wires":[["9f837dbe.a7563"]]},{"id":"f992f6b3.5ca268","type":"blynk-ws-in-write","z":"73083520.75304c","name":"Luz Lavadero","pin":"35","pin_all":false,"client":"2c18e412.5f5cbc","x":350,"y":270,"wires":[["9f837dbe.a7563"]]},{"id":"1061c31a.83e24d","type":"blynk-ws-in-write","z":"73083520.75304c","name":"Bomba Pil","pin":"37","pin_all":false,"client":"2c18e412.5f5cbc","x":360,"y":230,"wires":[["9f837dbe.a7563"]]},{"id":"c0e91452.73c0e8","type":"blynk-ws-in-write","z":"73083520.75304c","name":"Luz Alacena","pin":"36","pin_all":false,"client":"2c18e412.5f5cbc","x":350,"y":310,"wires":[["9f837dbe.a7563"]]},{"id":"887abd1a.c9f08","type":"blynk-ws-in-write","z":"73083520.75304c","name":"Electrovalvula","pin":"38","pin_all":false,"client":"2c18e412.5f5cbc","x":350,"y":110,"wires":[["9f837dbe.a7563"]]},{"id":"4ecbbc81.f52434","type":"blynk-ws-in-write","z":"73083520.75304c","name":"","pin":"74","pin_all":0,"client":"2c18e412.5f5cbc","x":340,"y":890,"wires":[["55b57916.538338"]]},{"id":"d86d70ac.fb902","type":"blynk-ws-in-write","z":"1b403a13.0ec8c6","name":"bomba man/auto","pin":"101","pin_all":0,"client":"2c18e412.5f5cbc","x":370,"y":300,"wires":[["ab21644b.e84768"]]},{"id":"b9342d19.8889d","type":"blynk-ws-in-write","z":"1b403a13.0ec8c6","name":"marcha bomba","pin":"102","pin_all":0,"client":"2c18e412.5f5cbc","x":370,"y":350,"wires":[["ab21644b.e84768"]]},{"id":"21c78482.1c0bdc","type":"blynk-ws-in-write","z":"1b403a13.0ec8c6","name":"resistencia man/auto","pin":"103","pin_all":0,"client":"2c18e412.5f5cbc","x":360,"y":400,"wires":[["ab21644b.e84768"]]},{"id":"410759b4.a87158","type":"blynk-ws-in-write","z":"1b403a13.0ec8c6","name":"encendido resistencia","pin":"104","pin_all":0,"client":"2c18e412.5f5cbc","x":350,"y":450,"wires":[["ab21644b.e84768"]]},{"id":"cc8ef2c4.e89bf","type":"blynk-ws-in-write","z":"1b403a13.0ec8c6","name":"Rociador 99","pin":"99","pin_all":0,"client":"2c18e412.5f5cbc","x":1740,"y":160,"wires":[["d47448fc.6209e8","81c8c932.e335b8"]]},{"id":"8817dbe1.b5ce48","type":"blynk-ws-in-write","z":"1b403a13.0ec8c6","name":"","pin":"98","pin_all":0,"client":"2c18e412.5f5cbc","x":2010,"y":340,"wires":[["7ff991b6.a5e4"]]},{"id":"a1bcce76.9236b","type":"blynk-ws-in-write","z":"950c1426.ff4008","name":"","pin":"39","pin_all":0,"client":"2c18e412.5f5cbc","x":370,"y":450,"wires":[["ecc24e7c.a4bec"]]},{"id":"733629df.764a18","type":"blynk-ws-in-write","z":"950c1426.ff4008","name":"","pin":"40","pin_all":0,"client":"2c18e412.5f5cbc","x":370,"y":490,"wires":[["ecc24e7c.a4bec","5b6c768b.e019f8"]]},{"id":"a09c99c5.f37d68","type":"blynk-ws-in-write","z":"950c1426.ff4008","name":"","pin":"41","pin_all":0,"client":"2c18e412.5f5cbc","x":370,"y":530,"wires":[["ecc24e7c.a4bec"]]},{"id":"aa04336b.4ba64","type":"blynk-ws-in-write","z":"950c1426.ff4008","name":"","pin":"42","pin_all":0,"client":"2c18e412.5f5cbc","x":370,"y":570,"wires":[["ecc24e7c.a4bec"]]},{"id":"15c50044.b9249","type":"blynk-ws-in-write","z":"950c1426.ff4008","name":"","pin":"43","pin_all":0,"client":"2c18e412.5f5cbc","x":370,"y":610,"wires":[["ecc24e7c.a4bec"]]},{"id":"bbb5de09.2dafa","type":"blynk-ws-in-write","z":"950c1426.ff4008","name":"","pin":"44","pin_all":0,"client":"2c18e412.5f5cbc","x":370,"y":650,"wires":[["ecc24e7c.a4bec"]]},{"id":"6270b00f.b76af","type":"blynk-ws-in-write","z":"9c63fd61.9908c","name":"","pin":"18","pin_all":0,"client":"2c18e412.5f5cbc","x":220,"y":350,"wires":[["78364cb0.17f444","511c78ef.861648"]]},{"id":"eea067e9.de8c78","type":"blynk-ws-in-write","z":"9c63fd61.9908c","name":"","pin":"19","pin_all":0,"client":"2c18e412.5f5cbc","x":220,"y":390,"wires":[["78364cb0.17f444","511c78ef.861648"]]},{"id":"b5a4419.4319dc","type":"blynk-ws-in-write","z":"a89e305a.c50bb","name":"","pin":"16","pin_all":false,"client":"2c18e412.5f5cbc","x":360,"y":380,"wires":[["975ffbce.bc05a8"]]},{"id":"cc5a4c07.31051","type":"blynk-ws-in-write","z":"a89e305a.c50bb","name":"","pin":"19","pin_all":false,"client":"2c18e412.5f5cbc","x":360,"y":540,"wires":[[]]},{"id":"3f72ed79.5ffed2","type":"blynk-ws-in-write","z":"a89e305a.c50bb","name":"","pin":"14","pin_all":false,"client":"2c18e412.5f5cbc","x":360,"y":340,"wires":[["975ffbce.bc05a8","824d7e7b.545c5","44609e54.87142"]]},{"id":"d387673.cfc7398","type":"blynk-ws-in-write","z":"a89e305a.c50bb","name":"","pin":"29","pin_all":false,"client":"2c18e412.5f5cbc","x":360,"y":460,"wires":[["975ffbce.bc05a8"]]},{"id":"1999084e.05e4d8","type":"blynk-ws-in-write","z":"a89e305a.c50bb","name":"","pin":"17","pin_all":false,"client":"2c18e412.5f5cbc","x":360,"y":420,"wires":[["975ffbce.bc05a8"]]},{"id":"11c34e0b.b2b172","type":"blynk-ws-in-write","z":"a89e305a.c50bb","name":"","pin":"8","pin_all":false,"client":"2c18e412.5f5cbc","x":370,"y":580,"wires":[["975ffbce.bc05a8"]]},{"id":"47e1f4a0.2f8bec","type":"blynk-ws-in-write","z":"a89e305a.c50bb","name":"","pin":"18","pin_all":false,"client":"2c18e412.5f5cbc","x":360,"y":500,"wires":[[]]},{"id":"d9d79109.95d2","type":"blynk-ws-in-write","z":"f682d492.22a758","name":"reset router","pin":"117","pin_all":0,"client":"2c18e412.5f5cbc","x":1168.6666259765625,"y":279.00000953674316,"wires":[["2bd0f557.1bf01a"]]},{"id":"18cb51fa.c0837e","type":"blynk-ws-in-write","z":"f682d492.22a758","name":"","pin":"125","pin_all":0,"client":"2c18e412.5f5cbc","x":168.6666259765625,"y":649.0000095367432,"wires":[["d6e6bc14.e41e7"]]},{"id":"fa12fe6a.a3741","type":"blynk-ws-in-write","z":"f682d492.22a758","name":"","pin":"124","pin_all":0,"client":"2c18e412.5f5cbc","x":1158.6666259765625,"y":899.0000095367432,"wires":[["269fcb97.b09bf4"]]},{"id":"13ae8396.95201c","type":"blynk-ws-in-write","z":"f682d492.22a758","name":"","pin":"125","pin_all":0,"client":"2c18e412.5f5cbc","x":1158.6666259765625,"y":799.0000095367432,"wires":[["97f54fd4.80678"]]},{"id":"853fe079.6d881","type":"blynk-ws-in-write","z":"f682d492.22a758","name":"","pin":"73","pin_all":0,"client":"2c18e412.5f5cbc","x":1538.6666259765625,"y":429.00000953674316,"wires":[["6e57dcc9.a5e0a4"]]},{"id":"e4cf65a4.859558","type":"blynk-ws-in-write","z":"7ac92c99.66ea94","name":"","pin":"32","pin_all":false,"client":"2c18e412.5f5cbc","x":261.94055557250977,"y":576.9286065101624,"wires":[["cc1add85.586c5","ed33619f.9a01a"]]},{"id":"e8d96369.eb6f2","type":"blynk-ws-in-write","z":"7ac92c99.66ea94","name":"Apagar luces","pin":"13","pin_all":0,"client":"2c18e412.5f5cbc","x":90,"y":300,"wires":[["dc70c9c.2b0bc38"]]},{"id":"e4e59e31.5f96","type":"blynk-ws-in-write","z":"deff4396.4722a","name":"Cortinas (90)","pin":"90","pin_all":0,"client":"2c18e412.5f5cbc","x":270,"y":80,"wires":[["328e56ab.38360a"]]},{"id":"3d5b0886.05c928","type":"blynk-ws-in-write","z":"deff4396.4722a","name":"Cortinas (91)","pin":"91","pin_all":0,"client":"2c18e412.5f5cbc","x":270,"y":120,"wires":[["328e56ab.38360a"]]},{"id":"38ed1e27.dd87c2","type":"blynk-ws-in-write","z":"deff4396.4722a","name":"Cortinas (92)","pin":"92","pin_all":0,"client":"2c18e412.5f5cbc","x":270,"y":160,"wires":[["328e56ab.38360a"]]},{"id":"26aad263.d1a57e","type":"blynk-ws-in-write","z":"deff4396.4722a","name":"Cortinas (93)","pin":"93","pin_all":0,"client":"2c18e412.5f5cbc","x":270,"y":200,"wires":[["328e56ab.38360a"]]},{"id":"3c9eb739.a3d0f8","type":"blynk-ws-in-write","z":"deff4396.4722a","name":"Cortinas (95)","pin":"95","pin_all":0,"client":"2c18e412.5f5cbc","x":270,"y":240,"wires":[["328e56ab.38360a"]]},{"id":"7e7fc0dd.3b4ec","type":"blynk-ws-in-write","z":"deff4396.4722a","name":"Cortinas (96)","pin":"96","pin_all":0,"client":"2c18e412.5f5cbc","x":270,"y":280,"wires":[["328e56ab.38360a","8474c43e.6fad38"]]},{"id":"29b51cd7.7edf94","type":"blynk-ws-in-write","z":"deff4396.4722a","name":"Cortinas (97)","pin":"97","pin_all":0,"client":"2c18e412.5f5cbc","x":270,"y":320,"wires":[["328e56ab.38360a"]]},{"id":"cfe8aa20.5a0e18","type":"blynk-ws-out-write","z":"e6e33852.2495f8","name":"","pin":0,"pinmode":"1","client":"2c18e412.5f5cbc","x":876.3332977294922,"y":474.5555667877197,"wires":[]},{"id":"9f8c863a.5e4538","type":"blynk-ws-out-write","z":"e364a467.07a6a8","name":"","pin":"65","pinmode":"1","client":"2c18e412.5f5cbc","x":677.0833206176758,"y":561.5277709960938,"wires":[]},{"id":"2d7d44ee.9b478c","type":"blynk-ws-out-write","z":"e364a467.07a6a8","name":"","pin":"55","pinmode":"1","client":"2c18e412.5f5cbc","x":806.5000076293945,"y":511.25,"wires":[]},{"id":"e7f57541.097388","type":"blynk-ws-out-write","z":"3ce5b54a.127d6a","name":"","pin":0,"pinmode":"1","client":"2c18e412.5f5cbc","x":2111.3927841186523,"y":635.9643287658691,"wires":[]},{"id":"1f81c83c.68a278","type":"blynk-ws-out-write","z":"3ce5b54a.127d6a","name":"","pin":0,"pinmode":"1","client":"2c18e412.5f5cbc","x":2116.381134033203,"y":223.5357119696481,"wires":[]},{"id":"74700a6b.b7b424","type":"blynk-ws-out-write","z":"3ce5b54a.127d6a","name":"","pin":0,"pinmode":"1","client":"2c18e412.5f5cbc","x":2059.7374954223633,"y":970.8214833395822,"wires":[]},{"id":"746f78d9.9ca9d8","type":"blynk-ws-out-write","z":"3ce5b54a.127d6a","name":"","pin":"6","pinmode":0,"client":"2c18e412.5f5cbc","x":1735.9761123657227,"y":617.6429290771484,"wires":[]},{"id":"f77a9f41.1fd82","type":"blynk-ws-out-write","z":"73083520.75304c","name":"","pin":0,"pinmode":"1","client":"2c18e412.5f5cbc","x":910,"y":360,"wires":[]},{"id":"63fd5113.ae3c2","type":"blynk-ws-out-write","z":"1b403a13.0ec8c6","name":"","pin":0,"pinmode":"1","client":"2c18e412.5f5cbc","x":970,"y":310,"wires":[]},{"id":"fce35841.951a48","type":"blynk-ws-out-write","z":"1b403a13.0ec8c6","name":"","pin":0,"pinmode":"1","client":"2c18e412.5f5cbc","x":1550,"y":120,"wires":[]},{"id":"e26cc241.b89f1","type":"blynk-ws-out-write","z":"1b403a13.0ec8c6","name":"","pin":0,"pinmode":"1","client":"2c18e412.5f5cbc","x":2100,"y":130,"wires":[]},{"id":"257fa906.068fd6","type":"blynk-ws-out-write","z":"1b403a13.0ec8c6","name":"","pin":"98","pinmode":0,"client":"2c18e412.5f5cbc","x":2330,"y":400,"wires":[]},{"id":"812daebc.b64d6","type":"blynk-ws-out-write","z":"950c1426.ff4008","name":"","pin":0,"pinmode":"1","client":"2c18e412.5f5cbc","x":950,"y":330,"wires":[]},{"id":"77563552.e99a9c","type":"blynk-ws-out-write","z":"950c1426.ff4008","name":"","pin":0,"pinmode":"1","client":"2c18e412.5f5cbc","x":1790,"y":330,"wires":[]},{"id":"90394f1b.d19f2","type":"blynk-ws-out-write","z":"9c63fd61.9908c","name":"","pin":0,"pinmode":"1","client":"2c18e412.5f5cbc","x":760,"y":410,"wires":[]},{"id":"c8224508.e2da48","type":"blynk-ws-out-write","z":"a89e305a.c50bb","name":"","pin":0,"pinmode":"1","client":"2c18e412.5f5cbc","x":991.8810272216797,"y":397.7499885559082,"wires":[]},{"id":"5ecd3c4a.fa40b4","type":"blynk-ws-out-write","z":"f682d492.22a758","name":"","pin":"127","pinmode":0,"client":"2c18e412.5f5cbc","x":318.6666259765625,"y":709.0000095367432,"wires":[]},{"id":"f84ee0c0.77286","type":"blynk-ws-out-write","z":"deff4396.4722a","name":"","pin":"94","pinmode":0,"client":"2c18e412.5f5cbc","x":850,"y":300,"wires":[]},{"id":"6e68ecc4.cf3184","type":"blynk-ws-out-write","z":"deff4396.4722a","name":"","pin":"92","pinmode":0,"client":"2c18e412.5f5cbc","x":310,"y":430,"wires":[]},{"id":"3443c861.a5ee58","type":"blynk-ws-out-write","z":"deff4396.4722a","name":"","pin":"95","pinmode":0,"client":"2c18e412.5f5cbc","x":310,"y":460,"wires":[]},{"id":"2f97fc11.e764a4","type":"blynk-ws-out-write","z":"deff4396.4722a","name":"","pin":"97","pinmode":0,"client":"2c18e412.5f5cbc","x":310,"y":490,"wires":[]},{"id":"5909a72.73bd158","type":"blynk-ws-out-set-property","z":"3ce5b54a.127d6a","name":"","pin":0,"pinmode":"1","prop":"bycode","client":"2c18e412.5f5cbc","x":1927.951431274414,"y":932.0714795248849,"wires":[]},{"id":"d15959e0.b491f8","type":"blynk-ws-out-set-property","z":"3ce5b54a.127d6a","name":"","pin":0,"pinmode":"1","prop":"bycode","client":"2c18e412.5f5cbc","x":1967.4522857666016,"y":177.64284678867887,"wires":[]},{"id":"1fa1bbd5.dc54e4","type":"blynk-ws-out-set-property","z":"3ce5b54a.127d6a","name":"","pin":0,"pinmode":"1","prop":"bycode","client":"2c18e412.5f5cbc","x":2001.3927841186523,"y":675.9643287658691,"wires":[]},{"id":"3ab2d3e0.c8ea8c","type":"blynk-ws-out-set-property","z":"1b403a13.0ec8c6","name":"","pin":0,"pinmode":"1","prop":"bycode","client":"2c18e412.5f5cbc","x":840,"y":270,"wires":[]},{"id":"ad5fc954.82ae08","type":"blynk-ws-out-set-property","z":"950c1426.ff4008","name":"","pin":0,"pinmode":"1","prop":"bycode","client":"2c18e412.5f5cbc","x":930,"y":280,"wires":[]},{"id":"1067f4ea.ae58eb","type":"blynk-ws-out-set-property","z":"950c1426.ff4008","name":"","pin":48,"pinmode":"1","prop":"bycode","client":"2c18e412.5f5cbc","x":1770,"y":290,"wires":[]},{"id":"e5d9a366.0b565","type":"blynk-ws-out-set-property","z":"9c63fd61.9908c","name":"","pin":0,"pinmode":"1","prop":"bycode","client":"2c18e412.5f5cbc","x":790,"y":370,"wires":[]},{"id":"706c129.8f43aec","type":"blynk-ws-out-set-property","z":"a89e305a.c50bb","name":"","pin":0,"pinmode":"1","prop":"bycode","client":"2c18e412.5f5cbc","x":910,"y":360,"wires":[]},{"id":"eb9007a.8c8bff8","type":"blynk-ws-out-notify","z":"f682d492.22a758","name":"","client":"2c18e412.5f5cbc","queue":false,"rate":15,"x":548.6666259765625,"y":479.00000953674316,"wires":[]},{"id":"bb713a62.b0fdf8","type":"blynk-ws-out-notify","z":"f682d492.22a758","name":"","client":"2c18e412.5f5cbc","queue":false,"rate":1,"x":628.6666259765625,"y":709.0000095367432,"wires":[]},{"id":"6e949be8.c70644","type":"thingspeak42","z":"e6e33852.2495f8","name":"BDX88EB6QMF2IKY0","delay":"5","topic1":"DescargaFast","topic2":"SubidaFast","topic3":"DescargaFiber","topic4":"SubidaFiber","topic5":"","topic6":"","topic7":"","topic8":"","endpoint":"https://thingspeak.com","x":884.6666564941406,"y":425.66665029525757,"wires":[]},{"id":"1f5e6cad.b1cab3","type":"thingspeak42","z":"50119c6e.6ff584","name":"DPO83R5G06KFD4UD","delay":"15","topic1":"tempPasillo","topic2":"tempLiving","topic3":"tempLavadero","topic4":"tempExterior","topic5":"tempPatioLuz","topic6":"humLiving","topic7":"Crep","topic8":"","endpoint":"https://thingspeak.com","x":703.761890411377,"y":337.47623348236084,"wires":[]},{"id":"490a73a0.04a99c","type":"thingspeak42","z":"3ce5b54a.127d6a","name":"YJCFSNIEZMNH6U0G","delay":"15","topic1":"voltajeBat","topic2":"corrienteCarga","topic3":"cargador","topic4":"tiempoCargando","topic5":"tiempoEspera","topic6":"nivTanque","topic7":"tasaLlenado","topic8":"","endpoint":"https://thingspeak.com","x":782.2221984863281,"y":891.1111125946045,"wires":[]},{"id":"62525e7.2f30ca","type":"thingspeak42","z":"3ce5b54a.127d6a","name":"FUVQOCDCDSQ684O3","delay":"15","topic1":"tempAmbiente","topic2":"tempBat1","topic3":"tempBat2","topic4":"tempCPU","topic5":"","topic6":"","topic7":"","topic8":"","endpoint":"https://thingspeak.com","x":730,"y":990,"wires":[]},{"id":"41555cf2.768874","type":"thingspeak42","z":"1b403a13.0ec8c6","name":"4EICHLJL446HHU1Z","delay":"15","topic1":"temperaturaTermo","topic2":"temperaturaExterior","topic3":"crepuscular","topic4":"estBomba","topic5":"tiempoLlenado","topic6":"estResistencia","topic7":"tiempoEncResis","topic8":"horasDia","endpoint":"https://thingspeak.com","x":820,"y":180,"wires":[]},{"id":"48c20767.e64078","type":"thingspeak42","z":"1b403a13.0ec8c6","name":"4EICHLJL446HHU1Z","delay":"1","topic1":"temperaturaTermo","topic2":"temperaturaExterior","topic3":"crepuscular","topic4":"estBomba","topic5":"tiempoLlenado","topic6":"estResistencia","topic7":"tiempoEncResis","topic8":"horasDia","endpoint":"https://thingspeak.com","x":1050,"y":420,"wires":[]},{"id":"b77070fe.51184","type":"thingspeak42","z":"f682d492.22a758","name":"reinicions","delay":"2","topic1":"reinBano","topic2":"","topic3":"","topic4":"","topic5":"","topic6":"","topic7":"","topic8":"","endpoint":"https://thingspeak.com","x":2218.6666259765625,"y":329.00000953674316,"wires":[]},{"id":"c73e087.839dbf8","type":"thingspeak42","z":"e364a467.07a6a8","name":"NBKVMGLFCL4MD6XC","delay":"5","topic1":"DolarVenta","topic2":"DolarCompra","topic3":"BitCoinUSD","topic4":"BitCoinPesos","topic5":"","topic6":"","topic7":"","topic8":"","endpoint":"https://thingspeak.com","x":770,"y":250,"wires":[]},{"id":"e05432b5.73a34","type":"debug","z":"1b403a13.0ec8c6","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":582.7777777777777,"y":355.55555555555554,"wires":[]},{"id":"44609e54.87142","type":"debug","z":"a89e305a.c50bb","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":669.4444444444445,"y":737.7777777777777,"wires":[]},{"id":"49bb5a50.c72c84","type":"mqtt in","z":"3ce5b54a.127d6a","name":"","topic":"ESP/TermoSolar/Envio","qos":"2","datatype":"auto","broker":"c339edbf.39572","x":127.77777099609375,"y":955.5555324554443,"wires":[["b50751d4.0745","99ff2535.0c1838"]]},{"id":"fa6c834e.be6f1","type":"mqtt out","z":"f682d492.22a758","name":"","topic":"terminalBlynk","qos":"","retain":"","broker":"e779f8d6.7bc2c8","x":1873.5554542541504,"y":537.9999599456787,"wires":[]},{"id":"be327a78.688fb8","type":"file","z":"deff4396.4722a","name":"Living","filename":"/home/pi/BackUpNodeRed/Cortinas/Living.txt","appendNewline":false,"createDir":false,"overwriteFile":"true","x":387.7777633666992,"y":683.3333206176758,"wires":[[]]},{"id":"c0d2001d.8e91b","type":"debug","z":"3ce5b54a.127d6a","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":741,"y":851,"wires":[]},{"id":"f0e8ac88.addef","type":"mqtt in","z":"a89e305a.c50bb","name":"","topic":"ESP/living/Iluminacion/Recibo","qos":"2","datatype":"auto","broker":"6b36e4a.1d30b1c","x":530,"y":40,"wires":[["af5e970.dfc2168"]]},{"id":"af5e970.dfc2168","type":"debug","z":"a89e305a.c50bb","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":774,"y":43,"wires":[]},{"id":"577fff27.098f7","type":"blynk-ws-out-write","z":"3ce5b54a.127d6a","name":"","pin":0,"pinmode":"1","client":"2c18e412.5f5cbc","x":934,"y":923,"wires":[]},{"id":"9469939c.74979","type":"inject","z":"3ce5b54a.127d6a","name":"","topic":"informarNivel","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":"5","x":272,"y":847,"wires":[["99ff2535.0c1838"]]},{"id":"fcc8fe1f.82cfe","type":"mqtt in","z":"3ce5b54a.127d6a","name":"","topic":"ESP/Lavadero/Temperatura","qos":"2","datatype":"auto","broker":"c339edbf.39572","x":2378,"y":406,"wires":[["19fdb46e.72052c","6426f42f.2ca5bc","942c7922.626f58","b7217fe3.78b27","f20c8fe3.a0061"]]},{"id":"27971f19.75688","type":"inject","z":"65561250.4225fc","name":"Prueba insertar","topic":"INSERT INTO `salamandra`(`tiempo`, `tempLiving`, `tempPasillo`, `tempBano`, `tempHab1`, `tempHab2`, `tempComedor`, `tempCocina`, `tempLavadero`, `tempExterior`, `tempTermo`, `tempBajTermo`, `tempSubTermo`, `tempDepTermo`, `tempSerpCamara`, `temp1Serp`, `tempChimenea`, `tempRetRad`, `tempDepRad`, `aireEnc`, `airePrim`, `aireSec`, `aireTerc`, `turbo`, `bombaRad`, `bombaRec`, `bombaTermo`) VALUES (now(),0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":331.5,"y":1034,"wires":[["32a74fc5.58978"]]},{"id":"4178563f.d9c9d8","type":"function","z":"65561250.4225fc","name":"","func":"var mysql = \"INSERT INTO \\`salamandra\\`(\\`tiempo\\`, \\`tempLiving\\`, \\`tempPasillo\\`, \\`tempBano\\`, \\`tempHab1\\`, \\`tempHab2\\`, \\`tempComedor\\`, \\`tempCocina\\`, \\`tempLavadero\\`, \\`tempExterior\\`, \\`tempTermo\\`, \\`tempBajTermo\\`, \\`tempSubTermo\\`, \\`tempDepTermo\\`, \\`tempSerpCamara\\`, \\`temp1Serp\\`, \\`tempChimenea\\`, \\`tempRetRad\\`, \\`tempDepRad\\`, \\`aireEnc\\`, \\`airePrim\\`, \\`aireSec\\`, \\`aireTerc\\`, \\`turbo\\`, \\`bombaRad\\`, \\`bombaRec\\`, \\`bombaTermo\\`) VALUES (now(),\";\nmysql += 55 + \",\";\nmysql += 0 + \",\";\nmysql += 0 + \",\";\nmysql += 0 + \",\";\nmysql += 0 + \",\";\nmysql += 0 + \",\";\nmysql += 0 + \",\";\nmysql += 0 + \",\";\nmysql += 0 + \",\";\nmysql += 0 + \",\";\nmysql += 0 + \",\";\nmysql += 0 + \",\";\nmysql += 0 + \",\";\nmysql += 0 + \",\";\nmysql += 0 + \",\";\nmysql += 0 + \",\";\nmysql += 0 + \",\";\nmysql += 0 + \",\";\nmysql += 0 + \",\";\nmysql += 0 + \",\";\nmysql += 0 + \",\";\nmysql += 0 + \",\";\nmysql += 0 + \",\";\nmysql += 0 + \",\";\nmysql += 0 + \",\";\nmysql += 0 + \")\";\nmsg.topic = mysql;\nreturn msg;","outputs":1,"noerr":0,"x":484.5,"y":1156,"wires":[["32a74fc5.58978","be1e12a6.9a7f8"]]},{"id":"32a74fc5.58978","type":"mysql","z":"65561250.4225fc","mydb":"57f54dcb.069894","name":"","x":528.5,"y":1084,"wires":[["113481ef.252bee"]]},{"id":"113481ef.252bee","type":"debug","z":"65561250.4225fc","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":691.5,"y":1087,"wires":[]},{"id":"31d831c2.6b225e","type":"inject","z":"65561250.4225fc","name":"consulta gral","topic":"SELECT * FROM `salamandra` WHERE 1","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":340.5,"y":1076,"wires":[["32a74fc5.58978"]]},{"id":"5a9198c5.692d88","type":"inject","z":"65561250.4225fc","name":"Vaciar","topic":"DELETE FROM `salamandra` WHERE 1","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":322,"y":1116,"wires":[["32a74fc5.58978"]]},{"id":"9f007328.7ff43","type":"inject","z":"65561250.4225fc","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":267.5,"y":1191,"wires":[["4178563f.d9c9d8"]]},{"id":"be1e12a6.9a7f8","type":"debug","z":"65561250.4225fc","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"topic","targetType":"msg","x":703,"y":1157,"wires":[]},{"id":"148f0752.92ea69","type":"mqtt in","z":"65561250.4225fc","name":"salamandra/Envio","topic":"salamandra/Envio","qos":"2","datatype":"auto","broker":"e779f8d6.7bc2c8","x":471.5,"y":516,"wires":[["dc89ff68.1264c"]]},{"id":"dc89ff68.1264c","type":"delay","z":"65561250.4225fc","name":"100mS","pauseType":"delay","timeout":"100","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":637.5,"y":516,"wires":[["191adbf.f1b7d24"]]},{"id":"3d9cd840.f417c8","type":"mqtt in","z":"65561250.4225fc","name":"salamandra/Envio","topic":"termoSolar/Salamandra","qos":"2","datatype":"auto","broker":"e779f8d6.7bc2c8","x":569,"y":468,"wires":[["191adbf.f1b7d24"]]},{"id":"ffdc7d32.9db9d","type":"mysql","z":"65561250.4225fc","mydb":"57f54dcb.069894","name":"","x":932.22216796875,"y":520,"wires":[[]]},{"id":"b45542a.c06eec","type":"function","z":"65561250.4225fc","name":"","func":"\tmsg = {topic: \"tempLiving\", payload: global.get(\"tempLiving\")}; node.send([null, null, msg, null]);\n\tmsg = {topic: \"tempPasillo\", payload: global.get(\"tempPasillo\")}; node.send([null, null, msg, null]);\n\tmsg = {topic: \"tempBano\", payload: global.get(\"tempBano\")}; node.send([null, null, msg, null]);\n\tmsg = {topic: \"tempHab1\", payload: global.get(\"tempHab1\")}; node.send([null, null, msg, null]);\n\tmsg = {topic: \"tempHab2\", payload: global.get(\"tempHab2\")}; node.send([null, null, msg, null]);\n\tmsg = {topic: \"tempComedor\", payload: global.get(\"tempComedor\")}; node.send([null, null, msg, null]);\n\tmsg = {topic: \"tempCocina\", payload: global.get(\"tempCocina\")}; node.send([null, null, msg, null]);\n\tmsg = {topic: \"tempLavadero\", payload: global.get(\"tempLavadero\")}; node.send([null, null, msg, null]);\n\tmsg = {topic: \"tempExterior\", payload: global.get(\"tempExterior\")}; node.send([null, null, msg, null]);\n\tmsg = {topic: \"tempTermo\", payload: global.get(\"tempTermo\")}; node.send([null, null, msg, null]);\n\n\tmsg = {topic: \"tempBajTermo\", payload: global.get(\"tempBajTermo\")}; node.send([null, null, msg, null]);\n\tmsg = {topic: \"tempSubTermo\", payload: global.get(\"tempSubTermo\")}; node.send([null, null, msg, null]);\n\n\tmsg = {topic: \"tempDepTermo\", payload: global.get(\"tempDepTermo\")}; node.send([null, null, msg, null]);\n\tmsg = {topic: \"tempDepRadiadores\", payload: global.get(\"tempDepRadiadores\")}; node.send([null, null, msg, null]);\n\tmsg = {topic: \"tempSerpCamara\", payload: global.get(\"tempSerpCamara\")}; node.send([null, null, msg, null]);\n\tmsg = {topic: \"tempSerp1Agua\", payload: global.get(\"tempSerp1Agua\")}; node.send([null, null, msg, null]);\n\tmsg = {topic: \"tempRetRadiadores\", payload: global.get(\"tempRetRadiadores\")}; node.send([null, null, msg, null]);\n\tmsg = {topic: \"tempCamara\", payload: global.get(\"tempCamara\")}; node.send([null, null, msg, null]);\n\tmsg = {topic: \"tempSerp1Fuego\", payload: global.get(\"tempSerp1Fuego\")}; node.send([null, null, msg, null]);\n\tmsg = {topic: \"tempSerp2Fuego\", payload: global.get(\"tempSerp2Fuego\")}; node.send([null, null, msg, null]);\n\n\tmsg = {topic: \"aire1\", payload: global.get(\"aire1\")}; node.send([null, null, msg, null]);\n\tmsg = {topic: \"aire2\", payload: global.get(\"aire2\")}; node.send([null, null, msg, null]);\n\tmsg = {topic: \"aire3\", payload: global.get(\"aire3\")}; node.send([null, null, msg, null]);\n\tmsg = {topic: \"aire4\", payload: global.get(\"aire4\")}; node.send([null, null, msg, null]);\n\tmsg = {topic: \"estadoTurbo\", payload: global.get(\"estadoTurbo\")}; node.send([null, null, msg, null]);\n\tmsg = {topic: \"salamandraBbaRad\", payload: global.get(\"salamandraBbaRad\")}; node.send([null, null, msg, null]);\n\tmsg = {topic: \"salamandraBbaCirc\", payload: global.get(\"salamandraBbaCirc\")}; node.send([null, null, msg, null]);\n\tmsg = {topic: \"salamandraBbaTermo\", payload: global.get(\"salamandraBbaTermo\")}; node.send([null, null, msg, null]);","outputs":1,"noerr":0,"x":780.5555725097656,"y":565.5555438995361,"wires":[[]]},{"id":"52f9a6c1.0b7488","type":"ui_chart","z":"65561250.4225fc","name":"","group":"ff2252ef.d12aa","order":10,"width":0,"height":0,"label":"chart","chartType":"line","legend":"false","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":false,"ymin":"","ymax":"","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"86400","cutout":0,"useOneColor":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"outputs":1,"x":936.1110801696777,"y":485.5555648803711,"wires":[[]]},{"id":"932d1858.23c2d8","type":"mqtt in","z":"65561250.4225fc","name":"","topic":"ESP/Living/Sens/Temp/Resp","qos":"2","broker":"e779f8d6.7bc2c8","x":575.5555419921875,"y":571.111083984375,"wires":[["b45542a.c06eec"]]}]